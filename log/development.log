DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
Started GET "/" for 127.0.0.1 at 2017-04-26 22:36:21 +0300
  [1m[36mActiveRecord::SchemaMigration Load (2.7ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Processing by HomeController#index as HTML
Completed 401 Unauthorized in 19ms (ActiveRecord: 0.0ms)


Started GET "/signin" for 127.0.0.1 at 2017-04-26 22:36:21 +0300
Processing by Devise::SessionsController#new as HTML
  Rendering devise/sessions/new.html.haml within layouts/application
  Rendered devise/sessions/new.html.haml within layouts/application (904.2ms)
  Rendered layouts/_header.html.haml (8.9ms)
Completed 200 OK in 2052ms (Views: 2020.9ms | ActiveRecord: 14.3ms)


Started POST "/signin" for 127.0.0.1 at 2017-04-26 22:36:32 +0300
Processing by Devise::SessionsController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"0StYxYQSONcVGoq/O24MBDD5IPCa7Kk9pXCjd+/NIsHBtzwRUYdAVqaZ+gemq/NE+a2I1mK58w9sS8JhqcKe1Q==", "user"=>{"email"=>"admin@test.test", "password"=>"[FILTERED]"}, "commit"=>"Войти"}
  [1m[36mUser Load (3.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."email" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["email", "admin@test.test"], ["LIMIT", 1]]
Redirected to http://localhost:3000/
Completed 302 Found in 161ms (ActiveRecord: 3.6ms)


Started GET "/" for 127.0.0.1 at 2017-04-26 22:36:33 +0300
Processing by HomeController#index as HTML
  [1m[36mUser Load (2.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering home/index.html.haml within layouts/application
  Rendered home/index.html.haml within layouts/application (1.2ms)
  Rendered layouts/_header.html.haml (77.7ms)
Completed 200 OK in 653ms (Views: 647.1ms | ActiveRecord: 2.5ms)


Started GET "/composites" for 127.0.0.1 at 2017-04-26 22:36:37 +0300
Processing by CompositesController#index as HTML
  [1m[36mUser Load (1.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering composites/index.html.haml within layouts/application
  [1m[36mCategory Load (1.8ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mComposite Load (3.5ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Composite') AND "constructor_objects"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" IN (1, 2)[0m
  [1m[36mUnit Load (2.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (1, 3)[0m
  Rendered composites/_listing.html.haml (3.4ms)
  Rendered composites/_listing.html.haml (0.8ms)
  Rendered composites/index.html.haml within layouts/application (93.7ms)
  Rendered layouts/_header.html.haml (9.4ms)
Completed 200 OK in 645ms (Views: 609.6ms | ActiveRecord: 28.3ms)


Started GET "/primitives" for 127.0.0.1 at 2017-04-26 22:36:43 +0300
Processing by PrimitivesController#index as HTML
  [1m[36mUser Load (1.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering primitives/index.html.haml within layouts/application
  [1m[36mCategory Load (4.5ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[35m (2.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (1.9ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 1[0m
  [1m[36mPrimitive Load (1.1ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 1[0m
  [1m[36mCategory Load (0.8ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 1[0m
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendered primitives/_listing.html.haml (7.9ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 2[0m
  [1m[36mPrimitive Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 2[0m
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 2[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 2[0m
  Rendered primitives/_listing.html.haml (3.7ms)
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 3[0m
  [1m[36mPrimitive Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 3[0m
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendered primitives/_listing.html.haml (3.6ms)
  [1m[35m (1.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 4[0m
  [1m[36mPrimitive Load (1.2ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 4[0m
  [1m[36mCategory Load (0.9ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 4[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 5)[0m
  Rendered primitives/_listing.html.haml (3.6ms)
  Rendered primitives/_listing.html.haml (3.5ms)
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 5[0m
  [1m[36mPrimitive Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 5[0m
  [1m[36mCategory Load (3.4ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 5[0m
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (1, 5)[0m
  Rendered primitives/_listing.html.haml (3.4ms)
  Rendered primitives/_listing.html.haml (4.0ms)
  Rendered primitives/_listing.html.haml (3.9ms)
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 6[0m
  [1m[36mPrimitive Load (0.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 6[0m
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 6[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 2[0m
  Rendered primitives/_listing.html.haml (3.4ms)
  Rendered primitives/_listing.html.haml (3.3ms)
  [1m[35m (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 7[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 8[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 9[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 10[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 11[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 12[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 13[0m
  [1m[35m (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 14[0m
  [1m[35m (1.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 15[0m
  Rendered primitives/index.html.haml within layouts/application (154.4ms)
  Rendered layouts/_header.html.haml (10.7ms)
Completed 200 OK in 699ms (Views: 647.3ms | ActiveRecord: 42.8ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-26 22:36:46 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (3.2ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (2.4ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (13.3ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (4.5ms)
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (4.3ms)
  Rendered clients/_table.html.haml (29.6ms)
  [1m[36mUserClient Load (1.1ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (142.6ms)
  Rendered layouts/_header.html.haml (11.1ms)
Completed 200 OK in 699ms (Views: 651.6ms | ActiveRecord: 28.0ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-26 22:36:56 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/index.html.haml within layouts/application
  [1m[36mEstimate Load (1.1ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered estimates/_listing.html.haml (3.7ms)
  Rendered estimates/_listing.html.haml (1.0ms)
  Rendered estimates/index.html.haml within layouts/application (16.6ms)
  Rendered layouts/_header.html.haml (9.9ms)
Completed 200 OK in 553ms (Views: 546.7ms | ActiveRecord: 1.8ms)


Started GET "/estimates/new?client_id=1" for 127.0.0.1 at 2017-04-26 22:37:08 +0300
Processing by EstimatesController#new as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mProduct Load (5.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (2.1ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (1.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (4.2ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.9ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (1.8ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (2.1ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (1.2ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (13.1ms)
  Rendered estimates/_technical_file_fields.html.haml (6.1ms)
  Rendered estimates/_discount.html.haml (9.0ms)
  Rendered estimates/_stages.html.haml (21.0ms)
  Rendered estimates/_form.html.haml (150.7ms)
  Rendered estimates/new.html.haml within layouts/application (155.1ms)
  Rendered layouts/_header.html.haml (12.0ms)
Completed 200 OK in 928ms (Views: 698.9ms | ActiveRecord: 74.5ms)


Started GET "/estimates/2/edit" for 127.0.0.1 at 2017-04-26 22:55:59 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"2"}
  [1m[36mProduct Load (3.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (4.3ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.6ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (1.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.2ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (3.2ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mStageProduct Load (2.3ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (4, 5, 6)[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 4]]
  [1m[36mStageProductSet Load (2.0ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 4[0m
  [1m[36mProduct Load (1.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 5]]
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 5[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 6]]
  [1m[36mStageProductSet Load (1.0ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 6[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 6]]
  [1m[36mStageProductSetValue Load (3.5ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 2[0m
  [1m[36mProductSet Load (1.0ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.9ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.7ms)
  [1m[36mClientFile Load (2.6ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (1.6ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendered estimates/_client_file_fields.html.haml (23.1ms)
  Rendered estimates/_technical_file_fields.html.haml (3.2ms)
  [1m[36mTechnicalFile Load (2.1ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.4ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendered estimates/_technical_file_fields.html.haml (7.0ms)
  Rendered estimates/_discount.html.haml (8.0ms)
  Rendered estimates/_stages.html.haml (18.9ms)
  Rendered estimates/_form.html.haml (122.1ms)
  Rendered estimates/edit.html.haml within layouts/application (127.1ms)
  Rendered layouts/_header.html.haml (19.7ms)
Completed 200 OK in 1040ms (Views: 786.6ms | ActiveRecord: 74.8ms)


DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
Started GET "/estimates/2/edit" for 127.0.0.1 at 2017-04-26 23:04:05 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"2"}
  [1m[36mProduct Load (2.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.5ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (4.2ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (1.2ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (5.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (1.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (1.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (1.0ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (2.2ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.8ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (4, 5, 6)[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 4]]
  [1m[36mStageProductSet Load (0.8ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 4[0m
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (2.1ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 5]]
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 5[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (1.1ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 6]]
  [1m[36mStageProductSet Load (1.2ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 6[0m
  [1m[36mProduct Load (1.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 6]]
  [1m[36mStageProductSetValue Load (0.8ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 2[0m
  [1m[36mProductSet Load (0.5ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (7.7ms)
  [1m[36mClientFile Load (0.9ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.5ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendered estimates/_client_file_fields.html.haml (25.0ms)
  Rendered estimates/_technical_file_fields.html.haml (5.8ms)
  [1m[36mTechnicalFile Load (1.3ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.7ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendered estimates/_technical_file_fields.html.haml (9.6ms)
  Rendered estimates/_discount.html.haml (7.8ms)
  Rendered estimates/_stages.html.haml (21.7ms)
  Rendered estimates/_form.html.haml (184.5ms)
  Rendered estimates/edit.html.haml within layouts/application (187.9ms)
  Rendered layouts/_header.html.haml (28.1ms)
Completed 200 OK in 2373ms (Views: 1909.9ms | ActiveRecord: 90.6ms)


Started POST "/expenses/1" for 127.0.0.1 at 2017-04-26 23:04:10 +0300
  
Started POST "/expenses/1" for 127.0.0.1 at 2017-04-26 23:04:10 +0300
ActionController::RoutingError (No route matches [POST] "/expenses/1"):
  
actionpack (5.0.2) lib/action_dispatch/middleware/debug_exceptions.rb:53:in `call'
web-console (3.4.0) lib/web_console/middleware.rb:135:in `call_app'
web-console (3.4.0) lib/web_console/middleware.rb:28:in `block in call'
web-console (3.4.0) lib/web_console/middleware.rb:18:in `catch'
web-console (3.4.0) lib/web_console/middleware.rb:18:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/show_exceptions.rb:31:in `call'
railties (5.0.2) lib/rails/rack/logger.rb:36:in `call_app'
railties (5.0.2) lib/rails/rack/logger.rb:24:in `block in call'
activesupport (5.0.2) lib/active_support/tagged_logging.rb:69:in `block in tagged'
activesupport (5.0.2) lib/active_support/tagged_logging.rb:26:in `tagged'
activesupport (5.0.2) lib/active_support/tagged_logging.rb:69:in `tagged'
railties (5.0.2) lib/rails/rack/logger.rb:24:in `call'
sprockets-rails (3.2.0) lib/sprockets/rails/quiet_assets.rb:13:in `call'
request_store (1.2.0) lib/request_store/middleware.rb:8:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/request_id.rb:24:in `call'
rack (2.0.1) lib/rack/method_override.rb:22:in `call'
rack (2.0.1) lib/rack/runtime.rb:22:in `call'
activesupport (5.0.2) lib/active_support/cache/strategy/local_cache_middleware.rb:28:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/executor.rb:12:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/static.rb:136:in `call'
rack (2.0.1) lib/rack/sendfile.rb:111:in `call'
railties (5.0.2) lib/rails/engine.rb:522:in `call'
puma (3.7.1) lib/puma/configuration.rb:232:in `call'
puma (3.7.1) lib/puma/server.rb:578:in `handle_request'
puma (3.7.1) lib/puma/server.rb:415:in `process_client'
puma (3.7.1) lib/puma/server.rb:275:in `block in run'
puma (3.7.1) lib/puma/thread_pool.rb:120:in `block in spawn_thread'
  
Started POST "/expenses/1" for 127.0.0.1 at 2017-04-26 23:04:10 +0300
ActionController::RoutingError (No route matches [POST] "/expenses/1"):
  
actionpack (5.0.2) lib/action_dispatch/middleware/debug_exceptions.rb:53:in `call'
web-console (3.4.0) lib/web_console/middleware.rb:135:in `call_app'
web-console (3.4.0) lib/web_console/middleware.rb:28:in `block in call'
web-console (3.4.0) lib/web_console/middleware.rb:18:in `catch'
web-console (3.4.0) lib/web_console/middleware.rb:18:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/show_exceptions.rb:31:in `call'
railties (5.0.2) lib/rails/rack/logger.rb:36:in `call_app'
railties (5.0.2) lib/rails/rack/logger.rb:24:in `block in call'
activesupport (5.0.2) lib/active_support/tagged_logging.rb:69:in `block in tagged'
activesupport (5.0.2) lib/active_support/tagged_logging.rb:26:in `tagged'
activesupport (5.0.2) lib/active_support/tagged_logging.rb:69:in `tagged'
railties (5.0.2) lib/rails/rack/logger.rb:24:in `call'
sprockets-rails (3.2.0) lib/sprockets/rails/quiet_assets.rb:13:in `call'
request_store (1.2.0) lib/request_store/middleware.rb:8:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/request_id.rb:24:in `call'
rack (2.0.1) lib/rack/method_override.rb:22:in `call'
rack (2.0.1) lib/rack/runtime.rb:22:in `call'
activesupport (5.0.2) lib/active_support/cache/strategy/local_cache_middleware.rb:28:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/executor.rb:12:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/static.rb:136:in `call'
rack (2.0.1) lib/rack/sendfile.rb:111:in `call'
railties (5.0.2) lib/rails/engine.rb:522:in `call'
puma (3.7.1) lib/puma/configuration.rb:232:in `call'
puma (3.7.1) lib/puma/server.rb:578:in `handle_request'
puma (3.7.1) lib/puma/server.rb:415:in `process_client'
puma (3.7.1) lib/puma/server.rb:275:in `block in run'
puma (3.7.1) lib/puma/thread_pool.rb:120:in `block in spawn_thread'
  
ActionController::RoutingError (No route matches [POST] "/expenses/1"):
  
actionpack (5.0.2) lib/action_dispatch/middleware/debug_exceptions.rb:53:in `call'
web-console (3.4.0) lib/web_console/middleware.rb:135:in `call_app'
web-console (3.4.0) lib/web_console/middleware.rb:28:in `block in call'
web-console (3.4.0) lib/web_console/middleware.rb:18:in `catch'
web-console (3.4.0) lib/web_console/middleware.rb:18:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/show_exceptions.rb:31:in `call'
railties (5.0.2) lib/rails/rack/logger.rb:36:in `call_app'
railties (5.0.2) lib/rails/rack/logger.rb:24:in `block in call'
activesupport (5.0.2) lib/active_support/tagged_logging.rb:69:in `block in tagged'
activesupport (5.0.2) lib/active_support/tagged_logging.rb:26:in `tagged'
activesupport (5.0.2) lib/active_support/tagged_logging.rb:69:in `tagged'
railties (5.0.2) lib/rails/rack/logger.rb:24:in `call'
sprockets-rails (3.2.0) lib/sprockets/rails/quiet_assets.rb:13:in `call'
request_store (1.2.0) lib/request_store/middleware.rb:8:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/request_id.rb:24:in `call'
rack (2.0.1) lib/rack/method_override.rb:22:in `call'
rack (2.0.1) lib/rack/runtime.rb:22:in `call'
activesupport (5.0.2) lib/active_support/cache/strategy/local_cache_middleware.rb:28:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/executor.rb:12:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/static.rb:136:in `call'
rack (2.0.1) lib/rack/sendfile.rb:111:in `call'
railties (5.0.2) lib/rails/engine.rb:522:in `call'
puma (3.7.1) lib/puma/configuration.rb:232:in `call'
puma (3.7.1) lib/puma/server.rb:578:in `handle_request'
puma (3.7.1) lib/puma/server.rb:415:in `process_client'
puma (3.7.1) lib/puma/server.rb:275:in `block in run'
puma (3.7.1) lib/puma/thread_pool.rb:120:in `block in spawn_thread'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/routing_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/routing_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/routing_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (1.5ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (1.4ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (1.3ms)
  Rendered collection of /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/routes/_route.html.erb [91 times] (33.4ms)
  Rendered collection of /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/routes/_route.html.erb [91 times] (68.5ms)
  Rendered collection of /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/routes/_route.html.erb [91 times] (36.6ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/routes/_table.html.erb (6.5ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/routes/_table.html.erb (4.6ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/routes/_table.html.erb (3.2ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.2ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/routing_error.html.erb within rescues/layout (289.6ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.2ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/routing_error.html.erb within rescues/layout (258.5ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.4ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/routing_error.html.erb within rescues/layout (248.7ms)
Started GET "/estimates/2/edit" for 127.0.0.1 at 2017-04-26 23:04:32 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"2"}
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (3.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (2.2ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.7ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (2.3ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (2.5ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (1.5ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (4, 5, 6)[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 4]]
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 4[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 5]]
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 5[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 6]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 6[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.8ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 6]]
  [1m[36mStageProductSetValue Load (0.5ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 2[0m
  [1m[36mProductSet Load (0.7ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.3ms)
  [1m[36mClientFile Load (0.5ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.9ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendered estimates/_client_file_fields.html.haml (6.3ms)
  Rendered estimates/_technical_file_fields.html.haml (3.3ms)
  [1m[36mTechnicalFile Load (0.7ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (1.3ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendered estimates/_technical_file_fields.html.haml (6.4ms)
  Rendered estimates/_discount.html.haml (7.1ms)
  Rendered estimates/_stages.html.haml (23.4ms)
  Rendered estimates/_form.html.haml (99.9ms)
  Rendered estimates/edit.html.haml within layouts/application (104.3ms)
  Rendered layouts/_header.html.haml (7.7ms)
Completed 200 OK in 1633ms (Views: 1489.5ms | ActiveRecord: 38.2ms)


Started GET "/expenses/1" for 127.0.0.1 at 2017-04-26 23:04:35 +0300
Processing by ExpensesController#show as HTML
  Parameters: {"id"=>"1"}
  [1m[36mUser Load (1.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started GET "/estimates/2/edit" for 127.0.0.1 at 2017-04-26 23:05:00 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"2"}
Completed 500 Internal Server Error in 56153ms (ActiveRecord: 1.4ms)


Started GET "/expenses/1" for 127.0.0.1 at 2017-04-26 23:05:31 +0300
Started GET "/expenses/1" for 127.0.0.1 at 2017-04-26 23:05:31 +0300
Started GET "/estimates/2/edit" for 127.0.0.1 at 2017-04-26 23:05:31 +0300
  
  [1m[36mProduct Load (82.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
SystemExit (exit):
  
  [1m[36mUnit Load (3.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
app/controllers/expenses_controller.rb:10:in `show'
  [1m[36mProductComposition Load (440.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
Completed 401 Unauthorized in 1125ms (ActiveRecord: 525.8ms)


DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
Started GET "/estimates/2/edit" for 127.0.0.1 at 2017-04-26 23:05:40 +0300
  [1m[36mActiveRecord::SchemaMigration Load (2.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"2"}
  [1m[36mProduct Load (1.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (2.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (5.5ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (4.1ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (2.7ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (1.5ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.2ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (1.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mStageProduct Load (0.9ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (4, 5, 6)[0m
  [1m[36mStageProduct Load (1.1ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 4]]
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 4[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 5]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 5[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 6]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 6[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (1.0ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 6]]
  [1m[36mStageProductSetValue Load (0.8ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 2[0m
  [1m[36mProductSet Load (0.7ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (1879.9ms)
  [1m[36mClientFile Load (4.3ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (1.3ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendered estimates/_client_file_fields.html.haml (24.1ms)
  Rendered estimates/_technical_file_fields.html.haml (5.9ms)
  [1m[36mTechnicalFile Load (1.4ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.6ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendered estimates/_technical_file_fields.html.haml (7.6ms)
  Rendered estimates/_discount.html.haml (7.4ms)
  Rendered estimates/_stages.html.haml (16.6ms)
  Rendered estimates/_form.html.haml (2064.3ms)
  Rendered estimates/edit.html.haml within layouts/application (2073.2ms)
  Rendered layouts/_header.html.haml (49.2ms)
Completed 200 OK in 3267ms (Views: 2665.9ms | ActiveRecord: 134.9ms)


Started GET "/expenses/1" for 127.0.0.1 at 2017-04-26 23:05:45 +0300
Processing by ExpensesController#show as HTML
  Parameters: {"id"=>"1"}
  [1m[36mUser Load (11.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (1.7ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 406 Not Acceptable in 109ms (ActiveRecord: 17.0ms)


  
ActionController::UnknownFormat (ExpensesController#show is missing a template for this request format and variant.

request.formats: ["text/html"]
request.variant: []

NOTE! For XHR/Ajax or API requests, this action would normally respond with 204 No Content: an empty white screen. Since you're loading it in a web browser, we assume that you expected to actually render a template, not nothing, so we're showing an error to be extra-clear. If you expect 204 No Content, carry on. That's what you'll get from an XHR or API request. Give it a shot.):
  
actionpack (5.0.2) lib/action_controller/metal/implicit_render.rb:56:in `default_render'
actionpack (5.0.2) lib/action_controller/metal/basic_implicit_render.rb:4:in `block in send_action'
actionpack (5.0.2) lib/action_controller/metal/basic_implicit_render.rb:4:in `tap'
actionpack (5.0.2) lib/action_controller/metal/basic_implicit_render.rb:4:in `send_action'
actionpack (5.0.2) lib/abstract_controller/base.rb:188:in `process_action'
actionpack (5.0.2) lib/action_controller/metal/rendering.rb:30:in `process_action'
actionpack (5.0.2) lib/abstract_controller/callbacks.rb:20:in `block in process_action'
activesupport (5.0.2) lib/active_support/callbacks.rb:126:in `call'
activesupport (5.0.2) lib/active_support/callbacks.rb:506:in `block (2 levels) in compile'
activesupport (5.0.2) lib/active_support/callbacks.rb:455:in `call'
activesupport (5.0.2) lib/active_support/callbacks.rb:448:in `block (2 levels) in around'
activesupport (5.0.2) lib/active_support/callbacks.rb:286:in `block (2 levels) in halting'
audited (4.3.0) lib/audited/sweeper.rb:10:in `around'
activesupport (5.0.2) lib/active_support/callbacks.rb:405:in `public_send'
activesupport (5.0.2) lib/active_support/callbacks.rb:405:in `block in make_lambda'
activesupport (5.0.2) lib/active_support/callbacks.rb:285:in `block in halting'
activesupport (5.0.2) lib/active_support/callbacks.rb:447:in `block in around'
activesupport (5.0.2) lib/active_support/callbacks.rb:455:in `call'
activesupport (5.0.2) lib/active_support/callbacks.rb:448:in `block (2 levels) in around'
activesupport (5.0.2) lib/active_support/callbacks.rb:286:in `block (2 levels) in halting'
audited (4.3.0) lib/audited/sweeper.rb:10:in `around'
activesupport (5.0.2) lib/active_support/callbacks.rb:405:in `public_send'
activesupport (5.0.2) lib/active_support/callbacks.rb:405:in `block in make_lambda'
activesupport (5.0.2) lib/active_support/callbacks.rb:285:in `block in halting'
activesupport (5.0.2) lib/active_support/callbacks.rb:447:in `block in around'
activesupport (5.0.2) lib/active_support/callbacks.rb:455:in `call'
activesupport (5.0.2) lib/active_support/callbacks.rb:101:in `__run_callbacks__'
activesupport (5.0.2) lib/active_support/callbacks.rb:750:in `_run_process_action_callbacks'
activesupport (5.0.2) lib/active_support/callbacks.rb:90:in `run_callbacks'
actionpack (5.0.2) lib/abstract_controller/callbacks.rb:19:in `process_action'
actionpack (5.0.2) lib/action_controller/metal/rescue.rb:20:in `process_action'
actionpack (5.0.2) lib/action_controller/metal/instrumentation.rb:32:in `block in process_action'
activesupport (5.0.2) lib/active_support/notifications.rb:164:in `block in instrument'
activesupport (5.0.2) lib/active_support/notifications/instrumenter.rb:21:in `instrument'
activesupport (5.0.2) lib/active_support/notifications.rb:164:in `instrument'
actionpack (5.0.2) lib/action_controller/metal/instrumentation.rb:30:in `process_action'
actionpack (5.0.2) lib/action_controller/metal/params_wrapper.rb:248:in `process_action'
activerecord (5.0.2) lib/active_record/railties/controller_runtime.rb:18:in `process_action'
actionpack (5.0.2) lib/abstract_controller/base.rb:126:in `process'
actionview (5.0.2) lib/action_view/rendering.rb:30:in `process'
actionpack (5.0.2) lib/action_controller/metal.rb:190:in `dispatch'
actionpack (5.0.2) lib/action_controller/metal.rb:262:in `dispatch'
actionpack (5.0.2) lib/action_dispatch/routing/route_set.rb:50:in `dispatch'
actionpack (5.0.2) lib/action_dispatch/routing/route_set.rb:32:in `serve'
actionpack (5.0.2) lib/action_dispatch/journey/router.rb:39:in `block in serve'
actionpack (5.0.2) lib/action_dispatch/journey/router.rb:26:in `each'
actionpack (5.0.2) lib/action_dispatch/journey/router.rb:26:in `serve'
actionpack (5.0.2) lib/action_dispatch/routing/route_set.rb:725:in `call'
warden (1.2.7) lib/warden/manager.rb:36:in `block in call'
warden (1.2.7) lib/warden/manager.rb:35:in `catch'
warden (1.2.7) lib/warden/manager.rb:35:in `call'
rack (2.0.1) lib/rack/etag.rb:25:in `call'
rack (2.0.1) lib/rack/conditional_get.rb:25:in `call'
rack (2.0.1) lib/rack/head.rb:12:in `call'
rack (2.0.1) lib/rack/session/abstract/id.rb:222:in `context'
rack (2.0.1) lib/rack/session/abstract/id.rb:216:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/cookies.rb:613:in `call'
activerecord (5.0.2) lib/active_record/migration.rb:553:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/callbacks.rb:38:in `block in call'
activesupport (5.0.2) lib/active_support/callbacks.rb:97:in `__run_callbacks__'
activesupport (5.0.2) lib/active_support/callbacks.rb:750:in `_run_call_callbacks'
activesupport (5.0.2) lib/active_support/callbacks.rb:90:in `run_callbacks'
actionpack (5.0.2) lib/action_dispatch/middleware/callbacks.rb:36:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/executor.rb:12:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/remote_ip.rb:79:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/debug_exceptions.rb:49:in `call'
web-console (3.4.0) lib/web_console/middleware.rb:135:in `call_app'
web-console (3.4.0) lib/web_console/middleware.rb:28:in `block in call'
web-console (3.4.0) lib/web_console/middleware.rb:18:in `catch'
web-console (3.4.0) lib/web_console/middleware.rb:18:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/show_exceptions.rb:31:in `call'
railties (5.0.2) lib/rails/rack/logger.rb:36:in `call_app'
railties (5.0.2) lib/rails/rack/logger.rb:24:in `block in call'
activesupport (5.0.2) lib/active_support/tagged_logging.rb:69:in `block in tagged'
activesupport (5.0.2) lib/active_support/tagged_logging.rb:26:in `tagged'
activesupport (5.0.2) lib/active_support/tagged_logging.rb:69:in `tagged'
railties (5.0.2) lib/rails/rack/logger.rb:24:in `call'
sprockets-rails (3.2.0) lib/sprockets/rails/quiet_assets.rb:13:in `call'
request_store (1.2.0) lib/request_store/middleware.rb:8:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/request_id.rb:24:in `call'
rack (2.0.1) lib/rack/method_override.rb:22:in `call'
rack (2.0.1) lib/rack/runtime.rb:22:in `call'
activesupport (5.0.2) lib/active_support/cache/strategy/local_cache_middleware.rb:28:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/executor.rb:12:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/static.rb:136:in `call'
rack (2.0.1) lib/rack/sendfile.rb:111:in `call'
railties (5.0.2) lib/rails/engine.rb:522:in `call'
puma (3.7.1) lib/puma/configuration.rb:232:in `call'
puma (3.7.1) lib/puma/server.rb:578:in `handle_request'
puma (3.7.1) lib/puma/server.rb:415:in `process_client'
puma (3.7.1) lib/puma/server.rb:275:in `block in run'
puma (3.7.1) lib/puma/thread_pool.rb:120:in `block in spawn_thread'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (6.2ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.1ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.5ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (54.0ms)
Started GET "/expenses/1" for 127.0.0.1 at 2017-04-26 23:05:46 +0300
Processing by ExpensesController#show as HTML
  Parameters: {"id"=>"1"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.9ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 406 Not Acceptable in 99ms (ActiveRecord: 1.6ms)


  
ActionController::UnknownFormat (ExpensesController#show is missing a template for this request format and variant.

request.formats: ["text/html"]
request.variant: []

NOTE! For XHR/Ajax or API requests, this action would normally respond with 204 No Content: an empty white screen. Since you're loading it in a web browser, we assume that you expected to actually render a template, not nothing, so we're showing an error to be extra-clear. If you expect 204 No Content, carry on. That's what you'll get from an XHR or API request. Give it a shot.):
  
actionpack (5.0.2) lib/action_controller/metal/implicit_render.rb:56:in `default_render'
actionpack (5.0.2) lib/action_controller/metal/basic_implicit_render.rb:4:in `block in send_action'
actionpack (5.0.2) lib/action_controller/metal/basic_implicit_render.rb:4:in `tap'
actionpack (5.0.2) lib/action_controller/metal/basic_implicit_render.rb:4:in `send_action'
actionpack (5.0.2) lib/abstract_controller/base.rb:188:in `process_action'
actionpack (5.0.2) lib/action_controller/metal/rendering.rb:30:in `process_action'
actionpack (5.0.2) lib/abstract_controller/callbacks.rb:20:in `block in process_action'
activesupport (5.0.2) lib/active_support/callbacks.rb:126:in `call'
activesupport (5.0.2) lib/active_support/callbacks.rb:506:in `block (2 levels) in compile'
activesupport (5.0.2) lib/active_support/callbacks.rb:455:in `call'
activesupport (5.0.2) lib/active_support/callbacks.rb:448:in `block (2 levels) in around'
activesupport (5.0.2) lib/active_support/callbacks.rb:286:in `block (2 levels) in halting'
audited (4.3.0) lib/audited/sweeper.rb:10:in `around'
activesupport (5.0.2) lib/active_support/callbacks.rb:405:in `public_send'
activesupport (5.0.2) lib/active_support/callbacks.rb:405:in `block in make_lambda'
activesupport (5.0.2) lib/active_support/callbacks.rb:285:in `block in halting'
activesupport (5.0.2) lib/active_support/callbacks.rb:447:in `block in around'
activesupport (5.0.2) lib/active_support/callbacks.rb:455:in `call'
activesupport (5.0.2) lib/active_support/callbacks.rb:448:in `block (2 levels) in around'
activesupport (5.0.2) lib/active_support/callbacks.rb:286:in `block (2 levels) in halting'
audited (4.3.0) lib/audited/sweeper.rb:10:in `around'
activesupport (5.0.2) lib/active_support/callbacks.rb:405:in `public_send'
activesupport (5.0.2) lib/active_support/callbacks.rb:405:in `block in make_lambda'
activesupport (5.0.2) lib/active_support/callbacks.rb:285:in `block in halting'
activesupport (5.0.2) lib/active_support/callbacks.rb:447:in `block in around'
activesupport (5.0.2) lib/active_support/callbacks.rb:455:in `call'
activesupport (5.0.2) lib/active_support/callbacks.rb:101:in `__run_callbacks__'
activesupport (5.0.2) lib/active_support/callbacks.rb:750:in `_run_process_action_callbacks'
activesupport (5.0.2) lib/active_support/callbacks.rb:90:in `run_callbacks'
actionpack (5.0.2) lib/abstract_controller/callbacks.rb:19:in `process_action'
actionpack (5.0.2) lib/action_controller/metal/rescue.rb:20:in `process_action'
actionpack (5.0.2) lib/action_controller/metal/instrumentation.rb:32:in `block in process_action'
activesupport (5.0.2) lib/active_support/notifications.rb:164:in `block in instrument'
activesupport (5.0.2) lib/active_support/notifications/instrumenter.rb:21:in `instrument'
activesupport (5.0.2) lib/active_support/notifications.rb:164:in `instrument'
actionpack (5.0.2) lib/action_controller/metal/instrumentation.rb:30:in `process_action'
actionpack (5.0.2) lib/action_controller/metal/params_wrapper.rb:248:in `process_action'
activerecord (5.0.2) lib/active_record/railties/controller_runtime.rb:18:in `process_action'
actionpack (5.0.2) lib/abstract_controller/base.rb:126:in `process'
actionview (5.0.2) lib/action_view/rendering.rb:30:in `process'
actionpack (5.0.2) lib/action_controller/metal.rb:190:in `dispatch'
actionpack (5.0.2) lib/action_controller/metal.rb:262:in `dispatch'
actionpack (5.0.2) lib/action_dispatch/routing/route_set.rb:50:in `dispatch'
actionpack (5.0.2) lib/action_dispatch/routing/route_set.rb:32:in `serve'
actionpack (5.0.2) lib/action_dispatch/journey/router.rb:39:in `block in serve'
actionpack (5.0.2) lib/action_dispatch/journey/router.rb:26:in `each'
actionpack (5.0.2) lib/action_dispatch/journey/router.rb:26:in `serve'
actionpack (5.0.2) lib/action_dispatch/routing/route_set.rb:725:in `call'
warden (1.2.7) lib/warden/manager.rb:36:in `block in call'
warden (1.2.7) lib/warden/manager.rb:35:in `catch'
warden (1.2.7) lib/warden/manager.rb:35:in `call'
rack (2.0.1) lib/rack/etag.rb:25:in `call'
rack (2.0.1) lib/rack/conditional_get.rb:25:in `call'
rack (2.0.1) lib/rack/head.rb:12:in `call'
rack (2.0.1) lib/rack/session/abstract/id.rb:222:in `context'
rack (2.0.1) lib/rack/session/abstract/id.rb:216:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/cookies.rb:613:in `call'
activerecord (5.0.2) lib/active_record/migration.rb:553:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/callbacks.rb:38:in `block in call'
activesupport (5.0.2) lib/active_support/callbacks.rb:97:in `__run_callbacks__'
activesupport (5.0.2) lib/active_support/callbacks.rb:750:in `_run_call_callbacks'
activesupport (5.0.2) lib/active_support/callbacks.rb:90:in `run_callbacks'
actionpack (5.0.2) lib/action_dispatch/middleware/callbacks.rb:36:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/executor.rb:12:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/remote_ip.rb:79:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/debug_exceptions.rb:49:in `call'
web-console (3.4.0) lib/web_console/middleware.rb:135:in `call_app'
web-console (3.4.0) lib/web_console/middleware.rb:28:in `block in call'
web-console (3.4.0) lib/web_console/middleware.rb:18:in `catch'
web-console (3.4.0) lib/web_console/middleware.rb:18:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/show_exceptions.rb:31:in `call'
railties (5.0.2) lib/rails/rack/logger.rb:36:in `call_app'
railties (5.0.2) lib/rails/rack/logger.rb:24:in `block in call'
activesupport (5.0.2) lib/active_support/tagged_logging.rb:69:in `block in tagged'
activesupport (5.0.2) lib/active_support/tagged_logging.rb:26:in `tagged'
activesupport (5.0.2) lib/active_support/tagged_logging.rb:69:in `tagged'
railties (5.0.2) lib/rails/rack/logger.rb:24:in `call'
sprockets-rails (3.2.0) lib/sprockets/rails/quiet_assets.rb:13:in `call'
request_store (1.2.0) lib/request_store/middleware.rb:8:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/request_id.rb:24:in `call'
rack (2.0.1) lib/rack/method_override.rb:22:in `call'
rack (2.0.1) lib/rack/runtime.rb:22:in `call'
activesupport (5.0.2) lib/active_support/cache/strategy/local_cache_middleware.rb:28:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/executor.rb:12:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/static.rb:136:in `call'
rack (2.0.1) lib/rack/sendfile.rb:111:in `call'
railties (5.0.2) lib/rails/engine.rb:522:in `call'
puma (3.7.1) lib/puma/configuration.rb:232:in `call'
puma (3.7.1) lib/puma/server.rb:578:in `handle_request'
puma (3.7.1) lib/puma/server.rb:415:in `process_client'
puma (3.7.1) lib/puma/server.rb:275:in `block in run'
puma (3.7.1) lib/puma/thread_pool.rb:120:in `block in spawn_thread'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (10.6ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.2ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.3ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (51.9ms)
Started GET "/expenses/1" for 127.0.0.1 at 2017-04-26 23:05:46 +0300
Processing by ExpensesController#show as HTML
  Parameters: {"id"=>"1"}
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.9ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 406 Not Acceptable in 93ms (ActiveRecord: 1.7ms)


  
ActionController::UnknownFormat (ExpensesController#show is missing a template for this request format and variant.

request.formats: ["text/html"]
request.variant: []

NOTE! For XHR/Ajax or API requests, this action would normally respond with 204 No Content: an empty white screen. Since you're loading it in a web browser, we assume that you expected to actually render a template, not nothing, so we're showing an error to be extra-clear. If you expect 204 No Content, carry on. That's what you'll get from an XHR or API request. Give it a shot.):
  
actionpack (5.0.2) lib/action_controller/metal/implicit_render.rb:56:in `default_render'
actionpack (5.0.2) lib/action_controller/metal/basic_implicit_render.rb:4:in `block in send_action'
actionpack (5.0.2) lib/action_controller/metal/basic_implicit_render.rb:4:in `tap'
actionpack (5.0.2) lib/action_controller/metal/basic_implicit_render.rb:4:in `send_action'
actionpack (5.0.2) lib/abstract_controller/base.rb:188:in `process_action'
actionpack (5.0.2) lib/action_controller/metal/rendering.rb:30:in `process_action'
actionpack (5.0.2) lib/abstract_controller/callbacks.rb:20:in `block in process_action'
activesupport (5.0.2) lib/active_support/callbacks.rb:126:in `call'
activesupport (5.0.2) lib/active_support/callbacks.rb:506:in `block (2 levels) in compile'
activesupport (5.0.2) lib/active_support/callbacks.rb:455:in `call'
activesupport (5.0.2) lib/active_support/callbacks.rb:448:in `block (2 levels) in around'
activesupport (5.0.2) lib/active_support/callbacks.rb:286:in `block (2 levels) in halting'
audited (4.3.0) lib/audited/sweeper.rb:10:in `around'
activesupport (5.0.2) lib/active_support/callbacks.rb:405:in `public_send'
activesupport (5.0.2) lib/active_support/callbacks.rb:405:in `block in make_lambda'
activesupport (5.0.2) lib/active_support/callbacks.rb:285:in `block in halting'
activesupport (5.0.2) lib/active_support/callbacks.rb:447:in `block in around'
activesupport (5.0.2) lib/active_support/callbacks.rb:455:in `call'
activesupport (5.0.2) lib/active_support/callbacks.rb:448:in `block (2 levels) in around'
activesupport (5.0.2) lib/active_support/callbacks.rb:286:in `block (2 levels) in halting'
audited (4.3.0) lib/audited/sweeper.rb:10:in `around'
activesupport (5.0.2) lib/active_support/callbacks.rb:405:in `public_send'
activesupport (5.0.2) lib/active_support/callbacks.rb:405:in `block in make_lambda'
activesupport (5.0.2) lib/active_support/callbacks.rb:285:in `block in halting'
activesupport (5.0.2) lib/active_support/callbacks.rb:447:in `block in around'
activesupport (5.0.2) lib/active_support/callbacks.rb:455:in `call'
activesupport (5.0.2) lib/active_support/callbacks.rb:101:in `__run_callbacks__'
activesupport (5.0.2) lib/active_support/callbacks.rb:750:in `_run_process_action_callbacks'
activesupport (5.0.2) lib/active_support/callbacks.rb:90:in `run_callbacks'
actionpack (5.0.2) lib/abstract_controller/callbacks.rb:19:in `process_action'
actionpack (5.0.2) lib/action_controller/metal/rescue.rb:20:in `process_action'
actionpack (5.0.2) lib/action_controller/metal/instrumentation.rb:32:in `block in process_action'
activesupport (5.0.2) lib/active_support/notifications.rb:164:in `block in instrument'
activesupport (5.0.2) lib/active_support/notifications/instrumenter.rb:21:in `instrument'
activesupport (5.0.2) lib/active_support/notifications.rb:164:in `instrument'
actionpack (5.0.2) lib/action_controller/metal/instrumentation.rb:30:in `process_action'
actionpack (5.0.2) lib/action_controller/metal/params_wrapper.rb:248:in `process_action'
activerecord (5.0.2) lib/active_record/railties/controller_runtime.rb:18:in `process_action'
actionpack (5.0.2) lib/abstract_controller/base.rb:126:in `process'
actionview (5.0.2) lib/action_view/rendering.rb:30:in `process'
actionpack (5.0.2) lib/action_controller/metal.rb:190:in `dispatch'
actionpack (5.0.2) lib/action_controller/metal.rb:262:in `dispatch'
actionpack (5.0.2) lib/action_dispatch/routing/route_set.rb:50:in `dispatch'
actionpack (5.0.2) lib/action_dispatch/routing/route_set.rb:32:in `serve'
actionpack (5.0.2) lib/action_dispatch/journey/router.rb:39:in `block in serve'
actionpack (5.0.2) lib/action_dispatch/journey/router.rb:26:in `each'
actionpack (5.0.2) lib/action_dispatch/journey/router.rb:26:in `serve'
actionpack (5.0.2) lib/action_dispatch/routing/route_set.rb:725:in `call'
warden (1.2.7) lib/warden/manager.rb:36:in `block in call'
warden (1.2.7) lib/warden/manager.rb:35:in `catch'
warden (1.2.7) lib/warden/manager.rb:35:in `call'
rack (2.0.1) lib/rack/etag.rb:25:in `call'
rack (2.0.1) lib/rack/conditional_get.rb:25:in `call'
rack (2.0.1) lib/rack/head.rb:12:in `call'
rack (2.0.1) lib/rack/session/abstract/id.rb:222:in `context'
rack (2.0.1) lib/rack/session/abstract/id.rb:216:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/cookies.rb:613:in `call'
activerecord (5.0.2) lib/active_record/migration.rb:553:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/callbacks.rb:38:in `block in call'
activesupport (5.0.2) lib/active_support/callbacks.rb:97:in `__run_callbacks__'
activesupport (5.0.2) lib/active_support/callbacks.rb:750:in `_run_call_callbacks'
activesupport (5.0.2) lib/active_support/callbacks.rb:90:in `run_callbacks'
actionpack (5.0.2) lib/action_dispatch/middleware/callbacks.rb:36:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/executor.rb:12:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/remote_ip.rb:79:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/debug_exceptions.rb:49:in `call'
web-console (3.4.0) lib/web_console/middleware.rb:135:in `call_app'
web-console (3.4.0) lib/web_console/middleware.rb:28:in `block in call'
web-console (3.4.0) lib/web_console/middleware.rb:18:in `catch'
web-console (3.4.0) lib/web_console/middleware.rb:18:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/show_exceptions.rb:31:in `call'
railties (5.0.2) lib/rails/rack/logger.rb:36:in `call_app'
railties (5.0.2) lib/rails/rack/logger.rb:24:in `block in call'
activesupport (5.0.2) lib/active_support/tagged_logging.rb:69:in `block in tagged'
activesupport (5.0.2) lib/active_support/tagged_logging.rb:26:in `tagged'
activesupport (5.0.2) lib/active_support/tagged_logging.rb:69:in `tagged'
railties (5.0.2) lib/rails/rack/logger.rb:24:in `call'
sprockets-rails (3.2.0) lib/sprockets/rails/quiet_assets.rb:13:in `call'
request_store (1.2.0) lib/request_store/middleware.rb:8:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/request_id.rb:24:in `call'
rack (2.0.1) lib/rack/method_override.rb:22:in `call'
rack (2.0.1) lib/rack/runtime.rb:22:in `call'
activesupport (5.0.2) lib/active_support/cache/strategy/local_cache_middleware.rb:28:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/executor.rb:12:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/static.rb:136:in `call'
rack (2.0.1) lib/rack/sendfile.rb:111:in `call'
railties (5.0.2) lib/rails/engine.rb:522:in `call'
puma (3.7.1) lib/puma/configuration.rb:232:in `call'
puma (3.7.1) lib/puma/server.rb:578:in `handle_request'
puma (3.7.1) lib/puma/server.rb:415:in `process_client'
puma (3.7.1) lib/puma/server.rb:275:in `block in run'
puma (3.7.1) lib/puma/thread_pool.rb:120:in `block in spawn_thread'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (5.1ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.4ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.2ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (31.9ms)
Started GET "/estimates/2/edit" for 127.0.0.1 at 2017-04-26 23:06:44 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"2"}
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (3.4ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.5ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (5.3ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (3.0ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (3.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (3.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.5ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.8ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (4, 5, 6)[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 4]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 4[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 5]]
  [1m[36mStageProductSet Load (2.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 5[0m
  [1m[36mProduct Load (1.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 6]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 6[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 6]]
  [1m[36mStageProductSetValue Load (0.6ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 2[0m
  [1m[36mProductSet Load (0.6ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.6ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (1.0ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (9.9ms)
  [1m[36mClientFile Load (2.2ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.6ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendered estimates/_client_file_fields.html.haml (25.4ms)
  Rendered estimates/_technical_file_fields.html.haml (40.2ms)
  [1m[36mTechnicalFile Load (0.7ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (1.0ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendered estimates/_technical_file_fields.html.haml (13.1ms)
  Rendered estimates/_discount.html.haml (11.0ms)
  Rendered estimates/_stages.html.haml (20.0ms)
  Rendered estimates/_form.html.haml (234.2ms)
  Rendered estimates/edit.html.haml within layouts/application (237.8ms)
  Rendered layouts/_header.html.haml (30.1ms)
Completed 200 OK in 1313ms (Views: 781.4ms | ActiveRecord: 128.5ms)


Started GET "/expenses/1" for 127.0.0.1 at 2017-04-26 23:06:48 +0300
Processing by ExpensesController#show as HTML
  Parameters: {"id"=>"1"}
  [1m[36mUser Load (1.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 406 Not Acceptable in 103ms (ActiveRecord: 7.8ms)


  
ActionController::UnknownFormat (ExpensesController#show is missing a template for this request format and variant.

request.formats: ["text/html"]
request.variant: []

NOTE! For XHR/Ajax or API requests, this action would normally respond with 204 No Content: an empty white screen. Since you're loading it in a web browser, we assume that you expected to actually render a template, not nothing, so we're showing an error to be extra-clear. If you expect 204 No Content, carry on. That's what you'll get from an XHR or API request. Give it a shot.):
  
actionpack (5.0.2) lib/action_controller/metal/implicit_render.rb:56:in `default_render'
actionpack (5.0.2) lib/action_controller/metal/basic_implicit_render.rb:4:in `block in send_action'
actionpack (5.0.2) lib/action_controller/metal/basic_implicit_render.rb:4:in `tap'
actionpack (5.0.2) lib/action_controller/metal/basic_implicit_render.rb:4:in `send_action'
actionpack (5.0.2) lib/abstract_controller/base.rb:188:in `process_action'
actionpack (5.0.2) lib/action_controller/metal/rendering.rb:30:in `process_action'
actionpack (5.0.2) lib/abstract_controller/callbacks.rb:20:in `block in process_action'
activesupport (5.0.2) lib/active_support/callbacks.rb:126:in `call'
activesupport (5.0.2) lib/active_support/callbacks.rb:506:in `block (2 levels) in compile'
activesupport (5.0.2) lib/active_support/callbacks.rb:455:in `call'
activesupport (5.0.2) lib/active_support/callbacks.rb:448:in `block (2 levels) in around'
activesupport (5.0.2) lib/active_support/callbacks.rb:286:in `block (2 levels) in halting'
audited (4.3.0) lib/audited/sweeper.rb:10:in `around'
activesupport (5.0.2) lib/active_support/callbacks.rb:405:in `public_send'
activesupport (5.0.2) lib/active_support/callbacks.rb:405:in `block in make_lambda'
activesupport (5.0.2) lib/active_support/callbacks.rb:285:in `block in halting'
activesupport (5.0.2) lib/active_support/callbacks.rb:447:in `block in around'
activesupport (5.0.2) lib/active_support/callbacks.rb:455:in `call'
activesupport (5.0.2) lib/active_support/callbacks.rb:448:in `block (2 levels) in around'
activesupport (5.0.2) lib/active_support/callbacks.rb:286:in `block (2 levels) in halting'
audited (4.3.0) lib/audited/sweeper.rb:10:in `around'
activesupport (5.0.2) lib/active_support/callbacks.rb:405:in `public_send'
activesupport (5.0.2) lib/active_support/callbacks.rb:405:in `block in make_lambda'
activesupport (5.0.2) lib/active_support/callbacks.rb:285:in `block in halting'
activesupport (5.0.2) lib/active_support/callbacks.rb:447:in `block in around'
activesupport (5.0.2) lib/active_support/callbacks.rb:455:in `call'
activesupport (5.0.2) lib/active_support/callbacks.rb:101:in `__run_callbacks__'
activesupport (5.0.2) lib/active_support/callbacks.rb:750:in `_run_process_action_callbacks'
activesupport (5.0.2) lib/active_support/callbacks.rb:90:in `run_callbacks'
actionpack (5.0.2) lib/abstract_controller/callbacks.rb:19:in `process_action'
actionpack (5.0.2) lib/action_controller/metal/rescue.rb:20:in `process_action'
actionpack (5.0.2) lib/action_controller/metal/instrumentation.rb:32:in `block in process_action'
activesupport (5.0.2) lib/active_support/notifications.rb:164:in `block in instrument'
activesupport (5.0.2) lib/active_support/notifications/instrumenter.rb:21:in `instrument'
activesupport (5.0.2) lib/active_support/notifications.rb:164:in `instrument'
actionpack (5.0.2) lib/action_controller/metal/instrumentation.rb:30:in `process_action'
actionpack (5.0.2) lib/action_controller/metal/params_wrapper.rb:248:in `process_action'
activerecord (5.0.2) lib/active_record/railties/controller_runtime.rb:18:in `process_action'
actionpack (5.0.2) lib/abstract_controller/base.rb:126:in `process'
actionview (5.0.2) lib/action_view/rendering.rb:30:in `process'
actionpack (5.0.2) lib/action_controller/metal.rb:190:in `dispatch'
actionpack (5.0.2) lib/action_controller/metal.rb:262:in `dispatch'
actionpack (5.0.2) lib/action_dispatch/routing/route_set.rb:50:in `dispatch'
actionpack (5.0.2) lib/action_dispatch/routing/route_set.rb:32:in `serve'
actionpack (5.0.2) lib/action_dispatch/journey/router.rb:39:in `block in serve'
actionpack (5.0.2) lib/action_dispatch/journey/router.rb:26:in `each'
actionpack (5.0.2) lib/action_dispatch/journey/router.rb:26:in `serve'
actionpack (5.0.2) lib/action_dispatch/routing/route_set.rb:725:in `call'
warden (1.2.7) lib/warden/manager.rb:36:in `block in call'
warden (1.2.7) lib/warden/manager.rb:35:in `catch'
warden (1.2.7) lib/warden/manager.rb:35:in `call'
rack (2.0.1) lib/rack/etag.rb:25:in `call'
rack (2.0.1) lib/rack/conditional_get.rb:25:in `call'
rack (2.0.1) lib/rack/head.rb:12:in `call'
rack (2.0.1) lib/rack/session/abstract/id.rb:222:in `context'
rack (2.0.1) lib/rack/session/abstract/id.rb:216:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/cookies.rb:613:in `call'
activerecord (5.0.2) lib/active_record/migration.rb:553:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/callbacks.rb:38:in `block in call'
activesupport (5.0.2) lib/active_support/callbacks.rb:97:in `__run_callbacks__'
activesupport (5.0.2) lib/active_support/callbacks.rb:750:in `_run_call_callbacks'
activesupport (5.0.2) lib/active_support/callbacks.rb:90:in `run_callbacks'
actionpack (5.0.2) lib/action_dispatch/middleware/callbacks.rb:36:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/executor.rb:12:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/remote_ip.rb:79:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/debug_exceptions.rb:49:in `call'
web-console (3.4.0) lib/web_console/middleware.rb:135:in `call_app'
web-console (3.4.0) lib/web_console/middleware.rb:28:in `block in call'
web-console (3.4.0) lib/web_console/middleware.rb:18:in `catch'
web-console (3.4.0) lib/web_console/middleware.rb:18:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/show_exceptions.rb:31:in `call'
railties (5.0.2) lib/rails/rack/logger.rb:36:in `call_app'
railties (5.0.2) lib/rails/rack/logger.rb:24:in `block in call'
activesupport (5.0.2) lib/active_support/tagged_logging.rb:69:in `block in tagged'
activesupport (5.0.2) lib/active_support/tagged_logging.rb:26:in `tagged'
activesupport (5.0.2) lib/active_support/tagged_logging.rb:69:in `tagged'
railties (5.0.2) lib/rails/rack/logger.rb:24:in `call'
sprockets-rails (3.2.0) lib/sprockets/rails/quiet_assets.rb:13:in `call'
request_store (1.2.0) lib/request_store/middleware.rb:8:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/request_id.rb:24:in `call'
rack (2.0.1) lib/rack/method_override.rb:22:in `call'
rack (2.0.1) lib/rack/runtime.rb:22:in `call'
activesupport (5.0.2) lib/active_support/cache/strategy/local_cache_middleware.rb:28:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/executor.rb:12:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/static.rb:136:in `call'
rack (2.0.1) lib/rack/sendfile.rb:111:in `call'
railties (5.0.2) lib/rails/engine.rb:522:in `call'
puma (3.7.1) lib/puma/configuration.rb:232:in `call'
puma (3.7.1) lib/puma/server.rb:578:in `handle_request'
puma (3.7.1) lib/puma/server.rb:415:in `process_client'
puma (3.7.1) lib/puma/server.rb:275:in `block in run'
puma (3.7.1) lib/puma/thread_pool.rb:120:in `block in spawn_thread'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (7.2ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.4ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.2ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (35.2ms)
Started GET "/expenses/1" for 127.0.0.1 at 2017-04-26 23:06:48 +0300
Processing by ExpensesController#show as HTML
  Parameters: {"id"=>"1"}
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.6ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 406 Not Acceptable in 65ms (ActiveRecord: 1.4ms)


  
ActionController::UnknownFormat (ExpensesController#show is missing a template for this request format and variant.

request.formats: ["text/html"]
request.variant: []

NOTE! For XHR/Ajax or API requests, this action would normally respond with 204 No Content: an empty white screen. Since you're loading it in a web browser, we assume that you expected to actually render a template, not nothing, so we're showing an error to be extra-clear. If you expect 204 No Content, carry on. That's what you'll get from an XHR or API request. Give it a shot.):
  
actionpack (5.0.2) lib/action_controller/metal/implicit_render.rb:56:in `default_render'
actionpack (5.0.2) lib/action_controller/metal/basic_implicit_render.rb:4:in `block in send_action'
actionpack (5.0.2) lib/action_controller/metal/basic_implicit_render.rb:4:in `tap'
actionpack (5.0.2) lib/action_controller/metal/basic_implicit_render.rb:4:in `send_action'
actionpack (5.0.2) lib/abstract_controller/base.rb:188:in `process_action'
actionpack (5.0.2) lib/action_controller/metal/rendering.rb:30:in `process_action'
actionpack (5.0.2) lib/abstract_controller/callbacks.rb:20:in `block in process_action'
activesupport (5.0.2) lib/active_support/callbacks.rb:126:in `call'
activesupport (5.0.2) lib/active_support/callbacks.rb:506:in `block (2 levels) in compile'
activesupport (5.0.2) lib/active_support/callbacks.rb:455:in `call'
activesupport (5.0.2) lib/active_support/callbacks.rb:448:in `block (2 levels) in around'
activesupport (5.0.2) lib/active_support/callbacks.rb:286:in `block (2 levels) in halting'
audited (4.3.0) lib/audited/sweeper.rb:10:in `around'
activesupport (5.0.2) lib/active_support/callbacks.rb:405:in `public_send'
activesupport (5.0.2) lib/active_support/callbacks.rb:405:in `block in make_lambda'
activesupport (5.0.2) lib/active_support/callbacks.rb:285:in `block in halting'
activesupport (5.0.2) lib/active_support/callbacks.rb:447:in `block in around'
activesupport (5.0.2) lib/active_support/callbacks.rb:455:in `call'
activesupport (5.0.2) lib/active_support/callbacks.rb:448:in `block (2 levels) in around'
activesupport (5.0.2) lib/active_support/callbacks.rb:286:in `block (2 levels) in halting'
audited (4.3.0) lib/audited/sweeper.rb:10:in `around'
activesupport (5.0.2) lib/active_support/callbacks.rb:405:in `public_send'
activesupport (5.0.2) lib/active_support/callbacks.rb:405:in `block in make_lambda'
activesupport (5.0.2) lib/active_support/callbacks.rb:285:in `block in halting'
activesupport (5.0.2) lib/active_support/callbacks.rb:447:in `block in around'
activesupport (5.0.2) lib/active_support/callbacks.rb:455:in `call'
activesupport (5.0.2) lib/active_support/callbacks.rb:101:in `__run_callbacks__'
activesupport (5.0.2) lib/active_support/callbacks.rb:750:in `_run_process_action_callbacks'
activesupport (5.0.2) lib/active_support/callbacks.rb:90:in `run_callbacks'
actionpack (5.0.2) lib/abstract_controller/callbacks.rb:19:in `process_action'
actionpack (5.0.2) lib/action_controller/metal/rescue.rb:20:in `process_action'
actionpack (5.0.2) lib/action_controller/metal/instrumentation.rb:32:in `block in process_action'
activesupport (5.0.2) lib/active_support/notifications.rb:164:in `block in instrument'
activesupport (5.0.2) lib/active_support/notifications/instrumenter.rb:21:in `instrument'
activesupport (5.0.2) lib/active_support/notifications.rb:164:in `instrument'
actionpack (5.0.2) lib/action_controller/metal/instrumentation.rb:30:in `process_action'
actionpack (5.0.2) lib/action_controller/metal/params_wrapper.rb:248:in `process_action'
activerecord (5.0.2) lib/active_record/railties/controller_runtime.rb:18:in `process_action'
actionpack (5.0.2) lib/abstract_controller/base.rb:126:in `process'
actionview (5.0.2) lib/action_view/rendering.rb:30:in `process'
actionpack (5.0.2) lib/action_controller/metal.rb:190:in `dispatch'
actionpack (5.0.2) lib/action_controller/metal.rb:262:in `dispatch'
actionpack (5.0.2) lib/action_dispatch/routing/route_set.rb:50:in `dispatch'
actionpack (5.0.2) lib/action_dispatch/routing/route_set.rb:32:in `serve'
actionpack (5.0.2) lib/action_dispatch/journey/router.rb:39:in `block in serve'
actionpack (5.0.2) lib/action_dispatch/journey/router.rb:26:in `each'
actionpack (5.0.2) lib/action_dispatch/journey/router.rb:26:in `serve'
actionpack (5.0.2) lib/action_dispatch/routing/route_set.rb:725:in `call'
warden (1.2.7) lib/warden/manager.rb:36:in `block in call'
warden (1.2.7) lib/warden/manager.rb:35:in `catch'
warden (1.2.7) lib/warden/manager.rb:35:in `call'
rack (2.0.1) lib/rack/etag.rb:25:in `call'
rack (2.0.1) lib/rack/conditional_get.rb:25:in `call'
rack (2.0.1) lib/rack/head.rb:12:in `call'
rack (2.0.1) lib/rack/session/abstract/id.rb:222:in `context'
rack (2.0.1) lib/rack/session/abstract/id.rb:216:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/cookies.rb:613:in `call'
activerecord (5.0.2) lib/active_record/migration.rb:553:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/callbacks.rb:38:in `block in call'
activesupport (5.0.2) lib/active_support/callbacks.rb:97:in `__run_callbacks__'
activesupport (5.0.2) lib/active_support/callbacks.rb:750:in `_run_call_callbacks'
activesupport (5.0.2) lib/active_support/callbacks.rb:90:in `run_callbacks'
actionpack (5.0.2) lib/action_dispatch/middleware/callbacks.rb:36:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/executor.rb:12:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/remote_ip.rb:79:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/debug_exceptions.rb:49:in `call'
web-console (3.4.0) lib/web_console/middleware.rb:135:in `call_app'
web-console (3.4.0) lib/web_console/middleware.rb:28:in `block in call'
web-console (3.4.0) lib/web_console/middleware.rb:18:in `catch'
web-console (3.4.0) lib/web_console/middleware.rb:18:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/show_exceptions.rb:31:in `call'
railties (5.0.2) lib/rails/rack/logger.rb:36:in `call_app'
railties (5.0.2) lib/rails/rack/logger.rb:24:in `block in call'
activesupport (5.0.2) lib/active_support/tagged_logging.rb:69:in `block in tagged'
activesupport (5.0.2) lib/active_support/tagged_logging.rb:26:in `tagged'
activesupport (5.0.2) lib/active_support/tagged_logging.rb:69:in `tagged'
railties (5.0.2) lib/rails/rack/logger.rb:24:in `call'
sprockets-rails (3.2.0) lib/sprockets/rails/quiet_assets.rb:13:in `call'
request_store (1.2.0) lib/request_store/middleware.rb:8:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/request_id.rb:24:in `call'
rack (2.0.1) lib/rack/method_override.rb:22:in `call'
rack (2.0.1) lib/rack/runtime.rb:22:in `call'
activesupport (5.0.2) lib/active_support/cache/strategy/local_cache_middleware.rb:28:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/executor.rb:12:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/static.rb:136:in `call'
rack (2.0.1) lib/rack/sendfile.rb:111:in `call'
railties (5.0.2) lib/rails/engine.rb:522:in `call'
puma (3.7.1) lib/puma/configuration.rb:232:in `call'
puma (3.7.1) lib/puma/server.rb:578:in `handle_request'
puma (3.7.1) lib/puma/server.rb:415:in `process_client'
puma (3.7.1) lib/puma/server.rb:275:in `block in run'
puma (3.7.1) lib/puma/thread_pool.rb:120:in `block in spawn_thread'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (7.0ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.3ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.0ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (37.0ms)
Started GET "/expenses/1" for 127.0.0.1 at 2017-04-26 23:06:48 +0300
Processing by ExpensesController#show as HTML
  Parameters: {"id"=>"1"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.6ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 406 Not Acceptable in 67ms (ActiveRecord: 1.3ms)


  
ActionController::UnknownFormat (ExpensesController#show is missing a template for this request format and variant.

request.formats: ["text/html"]
request.variant: []

NOTE! For XHR/Ajax or API requests, this action would normally respond with 204 No Content: an empty white screen. Since you're loading it in a web browser, we assume that you expected to actually render a template, not nothing, so we're showing an error to be extra-clear. If you expect 204 No Content, carry on. That's what you'll get from an XHR or API request. Give it a shot.):
  
actionpack (5.0.2) lib/action_controller/metal/implicit_render.rb:56:in `default_render'
actionpack (5.0.2) lib/action_controller/metal/basic_implicit_render.rb:4:in `block in send_action'
actionpack (5.0.2) lib/action_controller/metal/basic_implicit_render.rb:4:in `tap'
actionpack (5.0.2) lib/action_controller/metal/basic_implicit_render.rb:4:in `send_action'
actionpack (5.0.2) lib/abstract_controller/base.rb:188:in `process_action'
actionpack (5.0.2) lib/action_controller/metal/rendering.rb:30:in `process_action'
actionpack (5.0.2) lib/abstract_controller/callbacks.rb:20:in `block in process_action'
activesupport (5.0.2) lib/active_support/callbacks.rb:126:in `call'
activesupport (5.0.2) lib/active_support/callbacks.rb:506:in `block (2 levels) in compile'
activesupport (5.0.2) lib/active_support/callbacks.rb:455:in `call'
activesupport (5.0.2) lib/active_support/callbacks.rb:448:in `block (2 levels) in around'
activesupport (5.0.2) lib/active_support/callbacks.rb:286:in `block (2 levels) in halting'
audited (4.3.0) lib/audited/sweeper.rb:10:in `around'
activesupport (5.0.2) lib/active_support/callbacks.rb:405:in `public_send'
activesupport (5.0.2) lib/active_support/callbacks.rb:405:in `block in make_lambda'
activesupport (5.0.2) lib/active_support/callbacks.rb:285:in `block in halting'
activesupport (5.0.2) lib/active_support/callbacks.rb:447:in `block in around'
activesupport (5.0.2) lib/active_support/callbacks.rb:455:in `call'
activesupport (5.0.2) lib/active_support/callbacks.rb:448:in `block (2 levels) in around'
activesupport (5.0.2) lib/active_support/callbacks.rb:286:in `block (2 levels) in halting'
audited (4.3.0) lib/audited/sweeper.rb:10:in `around'
activesupport (5.0.2) lib/active_support/callbacks.rb:405:in `public_send'
activesupport (5.0.2) lib/active_support/callbacks.rb:405:in `block in make_lambda'
activesupport (5.0.2) lib/active_support/callbacks.rb:285:in `block in halting'
activesupport (5.0.2) lib/active_support/callbacks.rb:447:in `block in around'
activesupport (5.0.2) lib/active_support/callbacks.rb:455:in `call'
activesupport (5.0.2) lib/active_support/callbacks.rb:101:in `__run_callbacks__'
activesupport (5.0.2) lib/active_support/callbacks.rb:750:in `_run_process_action_callbacks'
activesupport (5.0.2) lib/active_support/callbacks.rb:90:in `run_callbacks'
actionpack (5.0.2) lib/abstract_controller/callbacks.rb:19:in `process_action'
actionpack (5.0.2) lib/action_controller/metal/rescue.rb:20:in `process_action'
actionpack (5.0.2) lib/action_controller/metal/instrumentation.rb:32:in `block in process_action'
activesupport (5.0.2) lib/active_support/notifications.rb:164:in `block in instrument'
activesupport (5.0.2) lib/active_support/notifications/instrumenter.rb:21:in `instrument'
activesupport (5.0.2) lib/active_support/notifications.rb:164:in `instrument'
actionpack (5.0.2) lib/action_controller/metal/instrumentation.rb:30:in `process_action'
actionpack (5.0.2) lib/action_controller/metal/params_wrapper.rb:248:in `process_action'
activerecord (5.0.2) lib/active_record/railties/controller_runtime.rb:18:in `process_action'
actionpack (5.0.2) lib/abstract_controller/base.rb:126:in `process'
actionview (5.0.2) lib/action_view/rendering.rb:30:in `process'
actionpack (5.0.2) lib/action_controller/metal.rb:190:in `dispatch'
actionpack (5.0.2) lib/action_controller/metal.rb:262:in `dispatch'
actionpack (5.0.2) lib/action_dispatch/routing/route_set.rb:50:in `dispatch'
actionpack (5.0.2) lib/action_dispatch/routing/route_set.rb:32:in `serve'
actionpack (5.0.2) lib/action_dispatch/journey/router.rb:39:in `block in serve'
actionpack (5.0.2) lib/action_dispatch/journey/router.rb:26:in `each'
actionpack (5.0.2) lib/action_dispatch/journey/router.rb:26:in `serve'
actionpack (5.0.2) lib/action_dispatch/routing/route_set.rb:725:in `call'
warden (1.2.7) lib/warden/manager.rb:36:in `block in call'
warden (1.2.7) lib/warden/manager.rb:35:in `catch'
warden (1.2.7) lib/warden/manager.rb:35:in `call'
rack (2.0.1) lib/rack/etag.rb:25:in `call'
rack (2.0.1) lib/rack/conditional_get.rb:25:in `call'
rack (2.0.1) lib/rack/head.rb:12:in `call'
rack (2.0.1) lib/rack/session/abstract/id.rb:222:in `context'
rack (2.0.1) lib/rack/session/abstract/id.rb:216:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/cookies.rb:613:in `call'
activerecord (5.0.2) lib/active_record/migration.rb:553:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/callbacks.rb:38:in `block in call'
activesupport (5.0.2) lib/active_support/callbacks.rb:97:in `__run_callbacks__'
activesupport (5.0.2) lib/active_support/callbacks.rb:750:in `_run_call_callbacks'
activesupport (5.0.2) lib/active_support/callbacks.rb:90:in `run_callbacks'
actionpack (5.0.2) lib/action_dispatch/middleware/callbacks.rb:36:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/executor.rb:12:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/remote_ip.rb:79:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/debug_exceptions.rb:49:in `call'
web-console (3.4.0) lib/web_console/middleware.rb:135:in `call_app'
web-console (3.4.0) lib/web_console/middleware.rb:28:in `block in call'
web-console (3.4.0) lib/web_console/middleware.rb:18:in `catch'
web-console (3.4.0) lib/web_console/middleware.rb:18:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/show_exceptions.rb:31:in `call'
railties (5.0.2) lib/rails/rack/logger.rb:36:in `call_app'
railties (5.0.2) lib/rails/rack/logger.rb:24:in `block in call'
activesupport (5.0.2) lib/active_support/tagged_logging.rb:69:in `block in tagged'
activesupport (5.0.2) lib/active_support/tagged_logging.rb:26:in `tagged'
activesupport (5.0.2) lib/active_support/tagged_logging.rb:69:in `tagged'
railties (5.0.2) lib/rails/rack/logger.rb:24:in `call'
sprockets-rails (3.2.0) lib/sprockets/rails/quiet_assets.rb:13:in `call'
request_store (1.2.0) lib/request_store/middleware.rb:8:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/request_id.rb:24:in `call'
rack (2.0.1) lib/rack/method_override.rb:22:in `call'
rack (2.0.1) lib/rack/runtime.rb:22:in `call'
activesupport (5.0.2) lib/active_support/cache/strategy/local_cache_middleware.rb:28:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/executor.rb:12:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/static.rb:136:in `call'
rack (2.0.1) lib/rack/sendfile.rb:111:in `call'
railties (5.0.2) lib/rails/engine.rb:522:in `call'
puma (3.7.1) lib/puma/configuration.rb:232:in `call'
puma (3.7.1) lib/puma/server.rb:578:in `handle_request'
puma (3.7.1) lib/puma/server.rb:415:in `process_client'
puma (3.7.1) lib/puma/server.rb:275:in `block in run'
puma (3.7.1) lib/puma/thread_pool.rb:120:in `block in spawn_thread'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (11.3ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (4.1ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (2.3ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (43.8ms)
Started GET "/estimates/2/edit" for 127.0.0.1 at 2017-04-26 23:07:23 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"2"}
  [1m[36mProduct Load (3.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (3.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (2.9ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.5ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (1.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (3.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.5ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (1.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (3.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.7ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (1.3ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (2.1ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (1.3ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (2.1ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (2.9ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (2.1ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.5ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (4, 5, 6)[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 4]]
  [1m[36mStageProductSet Load (1.2ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 4[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 5]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 5[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (4.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 6]]
  [1m[36mStageProductSet Load (0.9ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 6[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (2.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 6]]
  [1m[36mStageProductSetValue Load (0.6ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 2[0m
  [1m[36mProductSet Load (0.6ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.1ms)
  [1m[36mClientFile Load (2.6ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (3.0ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendered estimates/_client_file_fields.html.haml (8.6ms)
  Rendered estimates/_technical_file_fields.html.haml (5.6ms)
  [1m[36mTechnicalFile Load (0.8ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.4ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendered estimates/_technical_file_fields.html.haml (5.7ms)
  Rendered estimates/_discount.html.haml (9.3ms)
  Rendered estimates/_stages.html.haml (19.2ms)
  Rendered estimates/_form.html.haml (169.2ms)
  Rendered estimates/edit.html.haml within layouts/application (181.8ms)
  Rendered layouts/_header.html.haml (9.3ms)
Completed 200 OK in 2001ms (Views: 1738.4ms | ActiveRecord: 62.3ms)


Started GET "/expenses/1.json" for 127.0.0.1 at 2017-04-26 23:07:27 +0300
Processing by ExpensesController#show as JSON
  Parameters: {"id"=>"1"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (2.2ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
No template found for ExpensesController#show, rendering head :no_content
Completed 204 No Content in 89ms (ActiveRecord: 2.8ms)


Started GET "/expenses/1.json" for 127.0.0.1 at 2017-04-26 23:07:27 +0300
Processing by ExpensesController#show as JSON
  Parameters: {"id"=>"1"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.3ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
No template found for ExpensesController#show, rendering head :no_content
Completed 204 No Content in 72ms (ActiveRecord: 0.9ms)


Started GET "/expenses/1.json" for 127.0.0.1 at 2017-04-26 23:07:28 +0300
Processing by ExpensesController#show as JSON
  Parameters: {"id"=>"1"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (1.7ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
No template found for ExpensesController#show, rendering head :no_content
Completed 204 No Content in 71ms (ActiveRecord: 2.3ms)


Started GET "/estimates/2/edit" for 127.0.0.1 at 2017-04-26 23:07:50 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"2"}
  [1m[36mProduct Load (2.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (3.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (2.0ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (6.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (6.9ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (2.3ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (1.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (1.1ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (2.3ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (1.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (1.7ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (4, 5, 6)[0m
  [1m[36mStageProduct Load (5.9ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 4]]
  [1m[36mStageProductSet Load (1.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 4[0m
  [1m[36mProduct Load (1.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (1.2ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 5]]
  [1m[36mStageProductSet Load (2.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 5[0m
  [1m[36mProduct Load (1.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 6]]
  [1m[36mStageProductSet Load (1.4ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 6[0m
  [1m[36mProduct Load (2.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 6]]
  [1m[36mStageProductSetValue Load (5.0ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 2[0m
  [1m[36mProductSet Load (0.5ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (1.2ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.5ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (14.5ms)
  [1m[36mClientFile Load (1.1ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.4ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendered estimates/_client_file_fields.html.haml (23.3ms)
  Rendered estimates/_technical_file_fields.html.haml (7.0ms)
  [1m[36mTechnicalFile Load (0.9ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.9ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendered estimates/_technical_file_fields.html.haml (8.7ms)
  Rendered estimates/_discount.html.haml (10.1ms)
  Rendered estimates/_stages.html.haml (52.3ms)
  Rendered estimates/_form.html.haml (258.5ms)
  Rendered estimates/edit.html.haml within layouts/application (263.7ms)
  Rendered layouts/_header.html.haml (28.7ms)
Completed 200 OK in 1370ms (Views: 761.5ms | ActiveRecord: 166.9ms)


Started GET "/expenses/1.json" for 127.0.0.1 at 2017-04-26 23:07:53 +0300
Processing by ExpensesController#show as JSON
  Parameters: {"id"=>"1"}
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
No template found for ExpensesController#show, rendering head :no_content
Completed 204 No Content in 95ms (ActiveRecord: 5.4ms)


Started GET "/expenses/1.json" for 127.0.0.1 at 2017-04-26 23:07:53 +0300
Processing by ExpensesController#show as JSON
  Parameters: {"id"=>"1"}
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (1.4ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
No template found for ExpensesController#show, rendering head :no_content
Completed 204 No Content in 89ms (ActiveRecord: 2.1ms)


Started GET "/expenses/1.json" for 127.0.0.1 at 2017-04-26 23:07:53 +0300
Processing by ExpensesController#show as JSON
  Parameters: {"id"=>"1"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (1.2ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
No template found for ExpensesController#show, rendering head :no_content
Completed 204 No Content in 96ms (ActiveRecord: 1.8ms)


Started GET "/estimates/2/edit" for 127.0.0.1 at 2017-04-26 23:12:55 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"2"}
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.9ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.5ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.8ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (2.1ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.4ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.4ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (4, 5, 6)[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 4]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 4[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 5]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 5[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (1.3ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 6]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 6[0m
  [1m[36mProduct Load (3.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 6]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 2[0m
  [1m[36mProductSet Load (0.9ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (7.7ms)
  [1m[36mClientFile Load (0.5ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.5ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendered estimates/_client_file_fields.html.haml (16.7ms)
  Rendered estimates/_technical_file_fields.html.haml (5.0ms)
  [1m[36mTechnicalFile Load (0.8ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.6ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendered estimates/_technical_file_fields.html.haml (6.6ms)
  Rendered estimates/_discount.html.haml (11.8ms)
  Rendered estimates/_stages.html.haml (15.0ms)
  Rendered estimates/_form.html.haml (211.9ms)
  Rendered estimates/edit.html.haml within layouts/application (215.2ms)
  Rendered layouts/_header.html.haml (22.9ms)
Completed 200 OK in 2149ms (Views: 1631.7ms | ActiveRecord: 117.0ms)


Started GET "/estimates/2/edit" for 127.0.0.1 at 2017-04-26 23:14:37 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"2"}
  [1m[36mProduct Load (3.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (3.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (5.3ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (1.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (2.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (1.3ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.8ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (2.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (1.4ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (4, 5, 6)[0m
  [1m[36mStageProduct Load (0.9ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 4]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 4[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 5]]
  [1m[36mStageProductSet Load (1.1ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 5[0m
  [1m[36mProduct Load (1.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 6]]
  [1m[36mStageProductSet Load (1.1ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 6[0m
  [1m[36mProduct Load (2.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.8ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 6]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 2[0m
  [1m[36mProductSet Load (5.7ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.9ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (4.1ms)
  [1m[36mClientFile Load (0.5ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.4ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendered estimates/_client_file_fields.html.haml (7.3ms)
  Rendered estimates/_technical_file_fields.html.haml (3.6ms)
  [1m[36mTechnicalFile Load (0.8ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.4ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendered estimates/_technical_file_fields.html.haml (7.0ms)
  Rendered estimates/_discount.html.haml (7.8ms)
  Rendered estimates/_stages.html.haml (19.9ms)
  Rendered estimates/_form.html.haml (119.0ms)
  Rendered estimates/edit.html.haml within layouts/application (123.0ms)
  Rendered layouts/_header.html.haml (10.9ms)
Completed 200 OK in 1935ms (Views: 1738.6ms | ActiveRecord: 55.8ms)


Started GET "/estimates/2/edit" for 127.0.0.1 at 2017-04-26 23:16:22 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"2"}
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (1.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.8ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (1.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.7ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mStage Load (0.9ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (4, 5, 6)[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 4]]
  [1m[36mStageProductSet Load (0.8ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 4[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (2.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 5]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 5[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 6]]
  [1m[36mStageProductSet Load (0.8ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 6[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 6]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 2[0m
  [1m[36mProductSet Load (0.8ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (1.0ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (12.5ms)
  [1m[36mClientFile Load (0.7ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.3ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendered estimates/_client_file_fields.html.haml (23.0ms)
  Rendered estimates/_technical_file_fields.html.haml (8.2ms)
  [1m[36mTechnicalFile Load (0.5ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.4ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendered estimates/_technical_file_fields.html.haml (9.8ms)
  Rendered estimates/_discount.html.haml (11.6ms)
  Rendered estimates/_stages.html.haml (28.3ms)
  Rendered estimates/_form.html.haml (242.3ms)
  Rendered estimates/edit.html.haml within layouts/application (246.4ms)
  Rendered layouts/_header.html.haml (29.8ms)
Completed 200 OK in 1462ms (Views: 858.9ms | ActiveRecord: 123.4ms)


Started GET "/estimates/2/edit" for 127.0.0.1 at 2017-04-26 23:17:30 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"2"}
  [1m[36mProduct Load (6.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (1.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.1ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.9ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (4.1ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (2.5ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (3.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (3.0ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (1.1ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mStage Load (0.6ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (4, 5, 6)[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 4]]
  [1m[36mStageProductSet Load (2.2ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 4[0m
  [1m[36mProduct Load (1.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (5.3ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 5]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 5[0m
  [1m[36mProduct Load (3.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 6]]
  [1m[36mStageProductSet Load (0.8ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 6[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 6]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 2[0m
  [1m[36mProductSet Load (0.6ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (3.6ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (5.2ms)
  [1m[36mClientFile Load (0.7ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.9ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendered estimates/_client_file_fields.html.haml (15.1ms)
  Rendered estimates/_technical_file_fields.html.haml (5.0ms)
  [1m[36mTechnicalFile Load (0.6ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (1.1ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendered estimates/_technical_file_fields.html.haml (8.6ms)
  Rendered estimates/_discount.html.haml (11.7ms)
  Rendered estimates/_stages.html.haml (29.5ms)
  Rendered estimates/_form.html.haml (162.9ms)
  Rendered estimates/edit.html.haml within layouts/application (168.0ms)
  Rendered layouts/_header.html.haml (8.2ms)
Completed 200 OK in 2026ms (Views: 1809.0ms | ActiveRecord: 60.4ms)


Started GET "/estimates/2/edit" for 127.0.0.1 at 2017-04-26 23:17:53 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"2"}
  [1m[36mProduct Load (2.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (2.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (1.4ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.9ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.9ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (3.4ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (2.4ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (4, 5, 6)[0m
  [1m[36mStageProduct Load (1.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 4]]
  [1m[36mStageProductSet Load (2.2ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 4[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 5]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 5[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 6]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 6[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 6]]
  [1m[36mStageProductSetValue Load (4.1ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 2[0m
  [1m[36mProductSet Load (0.8ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.9ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (2.4ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (4.1ms)
  [1m[36mClientFile Load (1.7ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.8ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendered estimates/_client_file_fields.html.haml (8.0ms)
  Rendered estimates/_technical_file_fields.html.haml (3.2ms)
  [1m[36mTechnicalFile Load (2.4ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.4ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendered estimates/_technical_file_fields.html.haml (7.0ms)
  Rendered estimates/_discount.html.haml (10.3ms)
  Rendered estimates/_stages.html.haml (18.1ms)
  Rendered estimates/_form.html.haml (110.7ms)
  Rendered estimates/edit.html.haml within layouts/application (113.9ms)
  Rendered layouts/_header.html.haml (8.2ms)
Completed 200 OK in 1785ms (Views: 1621.4ms | ActiveRecord: 51.1ms)


Started GET "/estimates/2/edit" for 127.0.0.1 at 2017-04-26 23:18:41 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"2"}
  [1m[36mProduct Load (2.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (2.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (1.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.9ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (1.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (8.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (1.9ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.8ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.4ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mStage Load (0.6ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mStageProduct Load (1.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (4, 5, 6)[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 4]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 4[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (2.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 5]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 5[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (2.1ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 6]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 6[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (1.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 6]]
  [1m[36mStageProductSetValue Load (0.6ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 2[0m
  [1m[36mProductSet Load (1.3ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.6ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (2.5ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (2.9ms)
  [1m[36mClientFile Load (0.6ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (1.5ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendered estimates/_client_file_fields.html.haml (7.0ms)
  Rendered estimates/_technical_file_fields.html.haml (2.8ms)
  [1m[36mTechnicalFile Load (2.3ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (1.9ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendered estimates/_technical_file_fields.html.haml (7.1ms)
  Rendered estimates/_discount.html.haml (6.2ms)
  Rendered estimates/_stages.html.haml (15.9ms)
  Rendered estimates/_form.html.haml (100.3ms)
  Rendered estimates/edit.html.haml within layouts/application (103.2ms)
  Rendered layouts/_header.html.haml (7.4ms)
Completed 200 OK in 1685ms (Views: 1534.2ms | ActiveRecord: 56.6ms)


Started GET "/estimates/2/edit" for 127.0.0.1 at 2017-04-26 23:19:01 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"2"}
  [1m[36mProduct Load (1.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.8ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (1.1ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (1.9ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (3.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (1.2ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.5ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.2ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.9ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (4, 5, 6)[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 4]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 4[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 5]]
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 5[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 6]]
  [1m[36mStageProductSet Load (1.3ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 6[0m
  [1m[36mProduct Load (1.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 6]]
  [1m[36mStageProductSetValue Load (0.6ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 2[0m
  [1m[36mProductSet Load (2.6ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.5ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (6.2ms)
  [1m[36mClientFile Load (0.6ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.3ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendered estimates/_client_file_fields.html.haml (9.2ms)
  Rendered estimates/_technical_file_fields.html.haml (3.8ms)
  [1m[36mTechnicalFile Load (0.5ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.3ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendered estimates/_technical_file_fields.html.haml (6.6ms)
  Rendered estimates/_discount.html.haml (7.7ms)
  Rendered estimates/_stages.html.haml (17.7ms)
  Rendered estimates/_form.html.haml (109.0ms)
  Rendered estimates/edit.html.haml within layouts/application (111.9ms)
  Rendered layouts/_header.html.haml (53.6ms)
Completed 200 OK in 1677ms (Views: 1513.5ms | ActiveRecord: 39.6ms)


Started GET "/estimates/2/edit" for 127.0.0.1 at 2017-04-26 23:19:44 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"2"}
  [1m[36mProduct Load (2.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (3.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (4.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.9ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (2.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.5ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.1ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mStage Load (1.4ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (4, 5, 6)[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 4]]
  [1m[36mStageProductSet Load (1.2ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 4[0m
  [1m[36mProduct Load (2.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 5]]
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 5[0m
  [1m[36mProduct Load (1.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 6]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 6[0m
  [1m[36mProduct Load (1.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 6]]
  [1m[36mStageProductSetValue Load (1.1ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 2[0m
  [1m[36mProductSet Load (0.7ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.6ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.5ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (4.1ms)
  [1m[36mClientFile Load (0.8ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (1.8ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendered estimates/_client_file_fields.html.haml (8.8ms)
  Rendered estimates/_technical_file_fields.html.haml (4.2ms)
  [1m[36mTechnicalFile Load (0.7ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.7ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendered estimates/_technical_file_fields.html.haml (14.0ms)
  Rendered estimates/_discount.html.haml (18.5ms)
  Rendered estimates/_stages.html.haml (27.2ms)
  Rendered estimates/_form.html.haml (150.6ms)
  Rendered estimates/edit.html.haml within layouts/application (153.9ms)
  Rendered layouts/_header.html.haml (11.3ms)
Completed 200 OK in 1884ms (Views: 1709.3ms | ActiveRecord: 45.1ms)


Started GET "/estimates" for 127.0.0.1 at 2017-04-26 23:27:06 +0300
Processing by EstimatesController#index as HTML
  [1m[36mUser Load (4.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/index.html.haml within layouts/application
  [1m[36mEstimate Load (0.6ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL[0m
  Rendered estimates/_listing.html.haml (8.9ms)
  Rendered estimates/_listing.html.haml (1.5ms)
  Rendered estimates/index.html.haml within layouts/application (27.9ms)
  Rendered layouts/_header.html.haml (7.9ms)
Completed 200 OK in 880ms (Views: 867.8ms | ActiveRecord: 5.2ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-26 23:27:09 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (2.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (7.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (4.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (2.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.9ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.0ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (1.4ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", nil], ["LIMIT", 1]]
Completed 404 Not Found in 104ms (ActiveRecord: 31.0ms)


  
ActiveRecord::RecordNotFound (Couldn't find Expense with 'id'=):
  
app/controllers/estimates_controller.rb:19:in `new'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (4.8ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.5ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (0.9ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (31.2ms)
Started GET "/estimates/new" for 127.0.0.1 at 2017-04-26 23:28:07 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (3.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (1.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (1.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (1.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.9ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (1.4ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (1.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.2ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.3ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", nil], ["LIMIT", 1]]
Completed 404 Not Found in 403ms (ActiveRecord: 75.2ms)


  
ActiveRecord::RecordNotFound (Couldn't find Expense with 'id'=):
  
app/controllers/estimates_controller.rb:19:in `new'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (4.7ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.0ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (0.9ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (28.9ms)
DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
Started GET "/estimates/new" for 127.0.0.1 at 2017-04-26 23:28:26 +0300
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (1.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.9ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (3.1ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (3.2ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.9ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (1.2ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (3.2ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (1.1ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.8ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (1.0ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (1793.9ms)
  Rendered estimates/_technical_file_fields.html.haml (8.1ms)
  Rendered estimates/_discount.html.haml (8.6ms)
  Rendered estimates/_stages.html.haml (18.5ms)
  Rendered estimates/_form.html.haml (1954.3ms)
  Rendered estimates/new.html.haml within layouts/application (1963.1ms)
  Rendered layouts/_header.html.haml (26.8ms)
Completed 200 OK in 2988ms (Views: 2559.5ms | ActiveRecord: 91.5ms)


Started GET "/expenses" for 127.0.0.1 at 2017-04-26 23:28:58 +0300
Processing by ExpensesController#index as HTML
  [1m[36mUser Load (1.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering expenses/index.html.haml within layouts/application
  [1m[36mExpense Load (1.9ms)[0m  [1m[34mSELECT "expenses".* FROM "expenses" ORDER BY "expenses"."id" ASC[0m
  [1m[36mExpense Load (0.6ms)[0m  [1m[34mSELECT "expenses".* FROM "expenses"[0m
  Rendered expenses/index.html.haml within layouts/application (14.2ms)
  Rendered layouts/_header.html.haml (10.8ms)
Completed 200 OK in 638ms (Views: 625.9ms | ActiveRecord: 3.6ms)


Started POST "/expenses" for 127.0.0.1 at 2017-04-26 23:29:02 +0300
Processing by ExpensesController#update as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"oy3M1qvrcyQ35RFNunaPRHSmuWSFoiSWazR6qHjG6owvnM9f8TN5RRI1jb3H9I8EDztrh6fZ1PzRG0V3a9pInQ==", "values"=>{"1"=>"5", "2"=>"0", "3"=>"0", "4"=>"0", "5"=>"0"}}
  [1m[36mUser Load (2.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (1.8ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mAudited::Audit Load (6.2ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 1], ["auditable_type", "Expense"], ["LIMIT", 1]]
  [1m[35mSQL (3.5ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 1], ["auditable_type", "Expense"], ["user_id", 1], ["user_type", "User"], ["action", "update"], ["audited_changes", "---\npercent:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.5E1\n"], ["version", 1], ["remote_address", "127.0.0.1"], ["request_uuid", "780889df-1029-4cdf-9421-ce3588967650"], ["created_at", 2017-04-26 20:29:02 UTC]]
  [1m[35mSQL (0.6ms)[0m  [1m[33mUPDATE "expenses" SET "percent" = $1, "updated_at" = $2 WHERE "expenses"."id" = $3[0m  [["percent", #<BigDecimal:561d14a9c338,'0.5E1',9(18)>], ["updated_at", 2017-04-26 20:29:02 UTC], ["id", 1]]
  [1m[35m (3.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mExpense Load (0.9ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  [1m[35m (2.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mExpense Load (1.1ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mExpense Load (0.6ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
Redirected to http://localhost:3000/expenses
Completed 302 Found in 86ms (ActiveRecord: 30.3ms)


Started GET "/expenses" for 127.0.0.1 at 2017-04-26 23:29:02 +0300
Processing by ExpensesController#index as HTML
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering expenses/index.html.haml within layouts/application
  [1m[36mExpense Load (1.1ms)[0m  [1m[34mSELECT "expenses".* FROM "expenses" ORDER BY "expenses"."id" ASC[0m
  [1m[36mExpense Load (0.6ms)[0m  [1m[34mSELECT "expenses".* FROM "expenses"[0m
  Rendered expenses/index.html.haml within layouts/application (9.1ms)
  Rendered layouts/_header.html.haml (9.9ms)
Completed 200 OK in 592ms (Views: 585.3ms | ActiveRecord: 2.7ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-26 23:29:06 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (2.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (12.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.9ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (2.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (1.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (1.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (2.4ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (2.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (2.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (2.3ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (8.7ms)
  Rendered estimates/_technical_file_fields.html.haml (3.9ms)
  Rendered estimates/_discount.html.haml (7.2ms)
  Rendered estimates/_stages.html.haml (24.8ms)
  Rendered estimates/_form.html.haml (87.6ms)
  Rendered estimates/new.html.haml within layouts/application (92.7ms)
  Rendered layouts/_header.html.haml (15.4ms)
Completed 200 OK in 813ms (Views: 693.9ms | ActiveRecord: 38.7ms)


Started GET "/estimates" for 127.0.0.1 at 2017-04-26 23:30:22 +0300
Processing by EstimatesController#index as HTML
  [1m[36mUser Load (1.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/index.html.haml within layouts/application
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL[0m
  Rendered estimates/_listing.html.haml (6.2ms)
  Rendered estimates/_listing.html.haml (1.0ms)
  Rendered estimates/index.html.haml within layouts/application (20.0ms)
  Rendered layouts/_header.html.haml (10.0ms)
Completed 200 OK in 610ms (Views: 602.3ms | ActiveRecord: 2.8ms)


Started GET "/estimates/1/edit" for 127.0.0.1 at 2017-04-26 23:30:24 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"1"}
  [1m[36mProduct Load (1.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (3.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (7.1ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.1ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (3.6ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.4ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 1]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (1, 2, 3)[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 1]]
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 1[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 2]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 2[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 3]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 3[0m
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 3]]
  [1m[36mStageProductSetValue Load (0.8ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 1[0m
  [1m[36mProductSet Load (0.7ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (1.6ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.4ms)
  [1m[36mClientFile Load (1.0ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 1]]
  Rendered estimates/_technical_file_fields.html.haml (3.2ms)
  [1m[36mTechnicalFile Load (0.8ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 1]]
  Rendered estimates/_discount.html.haml (8.2ms)
  Rendered estimates/_stages.html.haml (18.2ms)
  Rendered estimates/_form.html.haml (82.3ms)
  Rendered estimates/edit.html.haml within layouts/application (85.4ms)
  Rendered layouts/_header.html.haml (11.0ms)
Completed 200 OK in 1052ms (Views: 823.8ms | ActiveRecord: 60.3ms)


Started GET "/estimates/1/edit" for 127.0.0.1 at 2017-04-26 23:40:29 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"1"}
  [1m[36mProduct Load (3.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (3.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.9ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (1.5ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 1]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (1, 2, 3)[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 1]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 1[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 2]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 2[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 3]]
  [1m[36mStageProductSet Load (0.8ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 3[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 3]]
  [1m[36mStageProductSetValue Load (0.8ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 1[0m
  [1m[36mProductSet Load (0.6ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.6ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (4.9ms)
  [1m[36mClientFile Load (0.8ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 1]]
  Rendered estimates/_technical_file_fields.html.haml (5.2ms)
  [1m[36mTechnicalFile Load (0.6ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 1]]
  Rendered estimates/_discount.html.haml (17.9ms)
  Rendered estimates/_stages.html.haml (22.4ms)
  Rendered estimates/_form.html.haml (116.4ms)
  Rendered estimates/edit.html.haml within layouts/application (120.0ms)
  Rendered layouts/_header.html.haml (9.8ms)
Completed 200 OK in 1934ms (Views: 1774.2ms | ActiveRecord: 36.3ms)


Started GET "/estimates/1/edit" for 127.0.0.1 at 2017-04-26 23:46:28 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"1"}
  [1m[36mProduct Load (1.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (4.4ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.5ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.5ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (1.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (2.4ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (1.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (2.9ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (2.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (1.1ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (1.4ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.3ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.6ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 1]]
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (1, 2, 3)[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 1]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 1[0m
  [1m[36mProduct Load (0.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 2]]
  [1m[36mStageProductSet Load (2.8ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 2[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 3]]
  [1m[36mStageProductSet Load (2.0ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 3[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 3]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 1[0m
  [1m[36mProductSet Load (0.7ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.6ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (1.5ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.7ms)
  [1m[36mClientFile Load (0.4ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 1]]
  Rendered estimates/_technical_file_fields.html.haml (4.0ms)
  [1m[36mTechnicalFile Load (0.6ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 1]]
  Rendered estimates/_discount.html.haml (11.9ms)
  Rendered estimates/_stages.html.haml (24.8ms)
  Rendered estimates/_form.html.haml (127.9ms)
  Rendered estimates/edit.html.haml within layouts/application (132.8ms)
  Rendered layouts/_header.html.haml (9.4ms)
Completed 200 OK in 2074ms (Views: 1931.6ms | ActiveRecord: 44.8ms)


Started GET "/estimates/1/edit" for 127.0.0.1 at 2017-04-26 23:50:32 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"1"}
  [1m[36mProduct Load (1.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (4.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.5ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (1.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.8ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (1.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (2.4ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (1.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (1.5ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.9ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (1.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (1.8ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (1.2ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (2.1ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (1.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (2.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 1]]
  [1m[36mStageProduct Load (1.1ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (1, 2, 3)[0m
  [1m[36mStageProduct Load (6.4ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 1]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 1[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (2.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 2]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 2[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (2.4ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 3]]
  [1m[36mStageProductSet Load (2.3ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 3[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 3]]
  [1m[36mStageProductSetValue Load (0.5ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 1[0m
  [1m[36mProductSet Load (2.7ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.5ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.8ms)
  [1m[36mClientFile Load (0.9ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 1]]
  Rendered estimates/_technical_file_fields.html.haml (5.1ms)
  [1m[36mTechnicalFile Load (2.6ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 1]]
  Rendered estimates/_discount.html.haml (9.4ms)
  Rendered estimates/_stages.html.haml (35.2ms)
  Rendered estimates/_form.html.haml (135.8ms)
  Rendered estimates/edit.html.haml within layouts/application (144.0ms)
  Rendered layouts/_header.html.haml (7.8ms)
Completed 200 OK in 2129ms (Views: 1942.8ms | ActiveRecord: 61.8ms)


Started GET "/estimates/1/edit" for 127.0.0.1 at 2017-04-26 23:50:46 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"1"}
  [1m[36mProduct Load (1.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (2.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.1ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (1.1ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (1.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.2ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.5ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (1.0ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.5ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (1.1ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.0ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (1.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.8ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (1.5ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 1]]
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (1, 2, 3)[0m
  [1m[36mStageProduct Load (3.4ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 1]]
  [1m[36mStageProductSet Load (1.2ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 1[0m
  [1m[36mProduct Load (1.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 2]]
  [1m[36mStageProductSet Load (0.4ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 2[0m
  [1m[36mProduct Load (1.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 3]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 3[0m
  [1m[36mProduct Load (1.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (1.4ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 3]]
  [1m[36mStageProductSetValue Load (3.4ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 1[0m
  [1m[36mProductSet Load (0.6ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.6ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (5.4ms)
  [1m[36mClientFile Load (0.5ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 1]]
  Rendered estimates/_technical_file_fields.html.haml (3.3ms)
  [1m[36mTechnicalFile Load (0.6ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 1]]
  Rendered estimates/_discount.html.haml (7.4ms)
  Rendered estimates/_stages.html.haml (18.3ms)
  Rendered estimates/_form.html.haml (86.7ms)
  Rendered estimates/edit.html.haml within layouts/application (89.7ms)
  Rendered layouts/_header.html.haml (7.6ms)
Completed 200 OK in 1627ms (Views: 1487.2ms | ActiveRecord: 43.6ms)


Started GET "/estimates/1/edit" for 127.0.0.1 at 2017-04-26 23:53:46 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"1"}
  [1m[36mProduct Load (1.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (1.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (1.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (5.1ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.8ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.9ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.9ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (1.3ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.0ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (2.7ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.4ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.6ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 1]]
  [1m[36mStageProduct Load (1.9ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (1, 2, 3)[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 1]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 1[0m
  [1m[36mProduct Load (1.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.9ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 2]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 2[0m
  [1m[36mProduct Load (1.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (1.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 3]]
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 3[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 3]]
  [1m[36mStageProductSetValue Load (2.2ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 1[0m
  [1m[36mProductSet Load (0.6ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (4.6ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.0ms)
  [1m[36mClientFile Load (1.0ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 1]]
  Rendered estimates/_technical_file_fields.html.haml (4.0ms)
  [1m[36mTechnicalFile Load (0.7ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 1]]
  Rendered estimates/_discount.html.haml (6.7ms)
  Rendered estimates/_stages.html.haml (19.0ms)
  Rendered estimates/_form.html.haml (82.3ms)
  Rendered estimates/edit.html.haml within layouts/application (85.4ms)
  Rendered layouts/_header.html.haml (7.6ms)
Completed 200 OK in 1739ms (Views: 1590.7ms | ActiveRecord: 47.2ms)


Started PATCH "/estimates/1" for 127.0.0.1 at 2017-04-26 23:57:23 +0300
Processing by EstimatesController#update as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"yybAOVqonxAcgYfumf7u80o1DAMAtcWcxC5ON+1zX0VHl8OwAHCVcTlRGx7kfO6zMaje4CLONfZ+AXHo/m/9VA==", "commit"=>"Сохранить", "estimate"=>{"price"=>"3056.9", "name"=>"Название", "client_id"=>"1", "area"=>"23", "first_floor_height"=>"124124.0", "second_floor_height_min"=>"0.0", "second_floor_height_max"=>"0.0", "third_floor_height_min"=>"0.0", "third_floor_height_max"=>"0.0", "discount_title"=>"Скидка", "discount_by_stages"=>{"0"=>"1", "1"=>"2", "2"=>"3"}}, "json_stages"=>"[{\"number\":1,\"text\":{\"name\":\"Первый этап\",\"summ\":\"Итого по первому этапу:\",\"summ_dis\":\"по первому этапу\",\"discount\":\"Итого по первому этапу со скидкой:\"},\"price\":2220,\"total_price\":2197.8,\"products\":[{\"id\":1,\"name\":\"Простой продукт 1 этап\",\"unit\":\"шт\",\"custom\":false,\"profit\":100,\"price\":10,\"quantity\":222,\"sets\":[]}]},{\"number\":2,\"text\":{\"name\":\"Второй этап\",\"summ\":\"Итого по двум этапам:\",\"summ_dis\":\"по второму этапу\",\"discount\":\"Итого по первому этапу со скидкой:\"},\"price\":550,\"total_price\":539,\"products\":[{\"id\":2,\"name\":\"Простой продукт 2 этап\",\"unit\":\"м3\",\"custom\":false,\"profit\":50,\"price\":50,\"quantity\":11,\"sets\":[]}]},{\"number\":3,\"text\":{\"name\":\"Третий этап\",\"summ\":\"Итого по трем этапам:\",\"summ_dis\":\"по третьему этапу\",\"discount\":\"Итого по первому этапу со скидкой:\"},\"price\":330,\"total_price\":320.1,\"products\":[{\"id\":3,\"name\":\"Конфигурируемый продукт 3 этап\",\"unit\":\"кг\",\"custom\":true,\"profit\":150,\"price\":330,\"quantity\":1,\"sets\":[{\"id\":1,\"name\":\"Сборка 1\",\"selected\":true,\"items\":[{\"id\":1,\"name\":\"Составляющая 1\",\"quantity\":11,\"value\":{\"id\":1,\"name\":\"Примитив 1\",\"unit\":\"лист\",\"price\":10}},{\"id\":2,\"name\":\"Составляющая 2\",\"quantity\":11,\"value\":{\"id\":2,\"name\":\"Примитив 2\",\"unit\":\"шт\",\"price\":20}}]}]}]}]", "data"=>"", "id"=>"1"}
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (1.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (1.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.9ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (1.3ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (1.1ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (1.4ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (1.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Unpermitted parameters: second_floor_height_min, second_floor_height_max, third_floor_height_min, third_floor_height_max, discount_by_stages
  [1m[35m (1.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mAudited::Audit Load (1.7ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 1], ["auditable_type", "Estimate"], ["LIMIT", 1]]
  [1m[35mSQL (4.0ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 1], ["auditable_type", "Estimate"], ["user_id", 1], ["user_type", "User"], ["action", "update"], ["audited_changes", "---\narea:\n- !ruby/object:BigDecimal 18:0.1E3\n- !ruby/object:BigDecimal 18:0.23E2\ndiscount_title:\n- ''\n- Скидка\n"], ["version", 8], ["remote_address", "127.0.0.1"], ["request_uuid", "0bb42328-2aa7-4bc4-97c9-db4546755b0c"], ["created_at", 2017-04-26 20:57:23 UTC]]
  [1m[35mSQL (1.7ms)[0m  [1m[33mUPDATE "estimates" SET "area" = $1, "discount_title" = $2, "updated_at" = $3 WHERE "estimates"."id" = $4[0m  [["area", #<BigDecimal:7f1f431e5d48,'0.23E2',9(18)>], ["discount_title", "Скидка"], ["updated_at", 2017-04-26 20:57:23 UTC], ["id", 1]]
  [1m[35m (2.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (0.6ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["estimate_id", 1], ["number", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (1.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND ("stage_products"."product_id" != 1)[0m  [["stage_id", 1]]
  [1m[36mStageProduct Load (1.1ms)[0m  [1m[34mSELECT  "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND "stage_products"."product_id" = $2 LIMIT $3[0m  [["stage_id", 1], ["product_id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (0.8ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["estimate_id", 1], ["number", 2], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND ("stage_products"."product_id" != 2)[0m  [["stage_id", 2]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT  "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND "stage_products"."product_id" = $2 LIMIT $3[0m  [["stage_id", 2], ["product_id", 2], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (3.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["estimate_id", 1], ["number", 3], ["LIMIT", 1]]
  [1m[35m (1.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (1.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND ("stage_products"."product_id" != 3)[0m  [["stage_id", 3]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT  "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND "stage_products"."product_id" = $2 LIMIT $3[0m  [["stage_id", 3], ["product_id", 3], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSet Load (1.0ms)[0m  [1m[34mSELECT  "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1 AND "stage_product_sets"."product_set_id" = $2 LIMIT $3[0m  [["stage_product_id", 3], ["product_set_id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1 AND ("stage_product_set_values"."product_template_id" NOT IN (1, 2))[0m  [["stage_product_set_id", 1]]
  [1m[36mStageProductSetValue Load (0.8ms)[0m  [1m[34mSELECT  "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1 AND "stage_product_set_values"."product_template_id" = $2 LIMIT $3[0m  [["stage_product_set_id", 1], ["product_template_id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT  "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1 AND "stage_product_set_values"."product_template_id" = $2 LIMIT $3[0m  [["stage_product_set_id", 1], ["product_template_id", 2], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mAudited::Audit Load (0.8ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 1], ["auditable_type", "Estimate"], ["LIMIT", 1]]
  [1m[35mSQL (1.0ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 1], ["auditable_type", "Estimate"], ["user_id", 1], ["user_type", "User"], ["action", "update"], ["audited_changes", "---\nprice_by_area:\n- !ruby/object:BigDecimal 18:0.3057E2\n- !ruby/object:BigDecimal 36:0.13291E3\nprice_by_area_per_stage:\n- - !ruby/object:BigDecimal 18:0.222E2\n  - !ruby/object:BigDecimal 18:0.277E2\n  - !ruby/object:BigDecimal 18:0.31E2\n- - !ruby/object:BigDecimal 27:0.9652E2\n  - !ruby/object:BigDecimal 27:0.12043E3\n  - !ruby/object:BigDecimal 27:0.13478E3\nprice_by_area_per_stage_discounted:\n- - !ruby/object:BigDecimal 18:0.2198E2\n  - !ruby/object:BigDecimal 18:0.2759E2\n  - !ruby/object:BigDecimal 18:0.309E2\n- - !ruby/object:BigDecimal 36:0.9556E2\n  - !ruby/object:BigDecimal 27:0.11996E3\n  - !ruby/object:BigDecimal 36:0.13435E3\n"], ["version", 9], ["remote_address", "127.0.0.1"], ["request_uuid", "0bb42328-2aa7-4bc4-97c9-db4546755b0c"], ["created_at", 2017-04-26 20:57:23 UTC]]
  [1m[35mSQL (0.7ms)[0m  [1m[33mUPDATE "estimates" SET "price_by_area" = $1, "price_by_area_per_stage" = $2, "price_by_area_per_stage_discounted" = $3, "updated_at" = $4 WHERE "estimates"."id" = $5[0m  [["price_by_area", #<BigDecimal:7f1f41d653a0,'0.13291E3',18(45)>], ["price_by_area_per_stage", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x00561d15d1e8f8 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f1f41da2c28,'0.9652E2',18(36)>, #<BigDecimal:7f1f41da0680,'0.12043E3',18(36)>, #<BigDecimal:7f1f41d91c70,'0.13478E3',18(36)>]>], ["price_by_area_per_stage_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x00561d15d1e8f8 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f1f41da0bf8,'0.9556E2',18(45)>, #<BigDecimal:7f1f41d929e0,'0.11996E3',18(36)>, #<BigDecimal:7f1f41d87888,'0.13435E3',18(45)>]>], ["updated_at", 2017-04-26 20:57:23 UTC], ["id", 1]]
  [1m[35m (1.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
Redirected to http://localhost:3000/estimates
Completed 302 Found in 590ms (ActiveRecord: 128.4ms)


Started GET "/estimates" for 127.0.0.1 at 2017-04-26 23:57:23 +0300
Processing by EstimatesController#index as HTML
  [1m[36mUser Load (1.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/index.html.haml within layouts/application
  [1m[36mEstimate Load (2.6ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL[0m
  Rendered estimates/_listing.html.haml (3.1ms)
  Rendered estimates/_listing.html.haml (0.8ms)
  Rendered estimates/index.html.haml within layouts/application (25.0ms)
  Rendered layouts/_header.html.haml (32.3ms)
Completed 200 OK in 746ms (Views: 735.5ms | ActiveRecord: 4.5ms)


Started GET "/estimates/2/edit" for 127.0.0.1 at 2017-04-26 23:57:26 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"2"}
  [1m[36mProduct Load (1.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (3.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.9ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.5ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (1.4ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (1.4ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (1.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (1.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (2.4ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (1.3ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.5ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.3ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (4, 5, 6)[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 4]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 4[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 5]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 5[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 6]]
  [1m[36mStageProductSet Load (0.4ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 6[0m
  [1m[36mProduct Load (1.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 6]]
  [1m[36mStageProductSetValue Load (0.6ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 2[0m
  [1m[36mProductSet Load (1.0ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.6ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (8.7ms)
  [1m[36mClientFile Load (1.1ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.4ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendered estimates/_client_file_fields.html.haml (19.1ms)
  Rendered estimates/_technical_file_fields.html.haml (8.6ms)
  [1m[36mTechnicalFile Load (0.6ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.5ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendered estimates/_technical_file_fields.html.haml (8.4ms)
  Rendered estimates/_discount.html.haml (7.8ms)
  Rendered estimates/_stages.html.haml (19.1ms)
  Rendered estimates/_form.html.haml (153.1ms)
  Rendered estimates/edit.html.haml within layouts/application (156.0ms)
  Rendered layouts/_header.html.haml (9.4ms)
Completed 200 OK in 815ms (Views: 656.4ms | ActiveRecord: 54.6ms)


Started GET "/estimates" for 127.0.0.1 at 2017-04-26 23:57:31 +0300
Processing by EstimatesController#index as HTML
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/index.html.haml within layouts/application
  [1m[36mEstimate Load (0.6ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL[0m
  Rendered estimates/_listing.html.haml (3.1ms)
  Rendered estimates/_listing.html.haml (1.0ms)
  Rendered estimates/index.html.haml within layouts/application (14.0ms)
  Rendered layouts/_header.html.haml (9.0ms)
Completed 200 OK in 541ms (Views: 497.8ms | ActiveRecord: 1.2ms)


Started GET "/estimates/1/edit" for 127.0.0.1 at 2017-04-26 23:57:33 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"1"}
  [1m[36mProduct Load (1.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (3.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.5ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (1.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (2.5ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (1.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (2.3ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (1.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (1.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (1.0ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.5ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (2.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (2.8ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 1]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (1, 2, 3)[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 1]]
  [1m[36mStageProductSet Load (0.8ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 1[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 2]]
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 2[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 3]]
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 3[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.8ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 3]]
  [1m[36mStageProductSetValue Load (0.8ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 1[0m
  [1m[36mProductSet Load (0.7ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.6ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.7ms)
  [1m[36mClientFile Load (0.6ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 1]]
  Rendered estimates/_technical_file_fields.html.haml (3.4ms)
  [1m[36mTechnicalFile Load (0.9ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 1]]
  Rendered estimates/_discount.html.haml (9.1ms)
  Rendered estimates/_stages.html.haml (24.0ms)
  Rendered estimates/_form.html.haml (99.5ms)
  Rendered estimates/edit.html.haml within layouts/application (102.8ms)
  Rendered layouts/_header.html.haml (12.5ms)
Completed 200 OK in 923ms (Views: 773.0ms | ActiveRecord: 43.2ms)


Started GET "/estimates/1/edit" for 127.0.0.1 at 2017-04-26 23:58:23 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"1"}
  [1m[36mProduct Load (1.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (2.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.9ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.8ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (2.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.9ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (2.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.4ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 1]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (1, 2, 3)[0m
  [1m[36mStageProduct Load (1.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 1]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 1[0m
  [1m[36mProduct Load (1.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 2]]
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 2[0m
  [1m[36mProduct Load (2.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 3]]
  [1m[36mStageProductSet Load (1.1ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 3[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 3]]
  [1m[36mStageProductSetValue Load (0.6ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 1[0m
  [1m[36mProductSet Load (0.7ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (1.0ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.3ms)
  [1m[36mClientFile Load (0.6ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 1]]
  Rendered estimates/_technical_file_fields.html.haml (3.3ms)
  [1m[36mTechnicalFile Load (0.6ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 1]]
  Rendered estimates/_discount.html.haml (7.7ms)
  Rendered estimates/_stages.html.haml (25.2ms)
  Rendered estimates/_form.html.haml (87.2ms)
  Rendered estimates/edit.html.haml within layouts/application (90.1ms)
  Rendered layouts/_header.html.haml (14.2ms)
Completed 200 OK in 768ms (Views: 611.0ms | ActiveRecord: 41.7ms)


Started GET "/estimates/1/edit" for 127.0.0.1 at 2017-04-27 00:00:14 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"1"}
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (3.4ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (1.1ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.8ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (2.1ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (1.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.9ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (1.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.4ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.6ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 1]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (1, 2, 3)[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 1]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 1[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 2]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 2[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 3]]
  [1m[36mStageProductSet Load (1.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 3[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 3]]
  [1m[36mStageProductSetValue Load (0.8ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 1[0m
  [1m[36mProductSet Load (0.6ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.8ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.5ms)
  [1m[36mClientFile Load (0.7ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 1]]
  Rendered estimates/_technical_file_fields.html.haml (3.9ms)
  [1m[36mTechnicalFile Load (0.5ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 1]]
  Rendered estimates/_discount.html.haml (8.5ms)
  Rendered estimates/_stages.html.haml (27.7ms)
  Rendered estimates/_form.html.haml (90.2ms)
  Rendered estimates/edit.html.haml within layouts/application (92.9ms)
  Rendered layouts/_header.html.haml (31.3ms)
Completed 200 OK in 1618ms (Views: 1487.4ms | ActiveRecord: 37.3ms)


Started GET "/estimates/1/edit" for 127.0.0.1 at 2017-04-27 00:00:27 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"1"}
  [1m[36mProduct Load (1.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (1.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.0ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (1.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.9ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (1.1ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (2.1ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (2.3ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 1]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (1, 2, 3)[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 1]]
  [1m[36mStageProductSet Load (0.9ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 1[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 2]]
  [1m[36mStageProductSet Load (1.9ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 2[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 3]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 3[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (1.3ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 3]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 1[0m
  [1m[36mProductSet Load (0.6ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.6ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.5ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (8.8ms)
  [1m[36mClientFile Load (0.5ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 1]]
  Rendered estimates/_technical_file_fields.html.haml (4.0ms)
  [1m[36mTechnicalFile Load (0.7ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 1]]
  Rendered estimates/_discount.html.haml (13.5ms)
  Rendered estimates/_stages.html.haml (18.6ms)
  Rendered estimates/_form.html.haml (107.9ms)
  Rendered estimates/edit.html.haml within layouts/application (111.4ms)
  Rendered layouts/_header.html.haml (11.5ms)
Completed 200 OK in 729ms (Views: 585.1ms | ActiveRecord: 37.3ms)


Started GET "/estimates/1/edit" for 127.0.0.1 at 2017-04-27 00:01:43 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"1"}
  [1m[36mProduct Load (1.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (2.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.5ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (1.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.9ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (2.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.4ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 1]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (1, 2, 3)[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 1]]
  [1m[36mStageProductSet Load (0.9ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 1[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 2]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 2[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 3]]
  [1m[36mStageProductSet Load (0.8ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 3[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 3]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 1[0m
  [1m[36mProductSet Load (0.6ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (2.9ms)
  [1m[36mClientFile Load (0.7ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 1]]
  Rendered estimates/_technical_file_fields.html.haml (2.9ms)
  [1m[36mTechnicalFile Load (0.6ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 1]]
  Rendered estimates/_discount.html.haml (6.2ms)
  Rendered estimates/_stages.html.haml (15.0ms)
  Rendered estimates/_form.html.haml (66.0ms)
  Rendered estimates/edit.html.haml within layouts/application (68.7ms)
  Rendered layouts/_header.html.haml (8.3ms)
Completed 200 OK in 1631ms (Views: 1507.0ms | ActiveRecord: 33.7ms)


Started GET "/estimates" for 127.0.0.1 at 2017-04-27 00:02:15 +0300
Processing by EstimatesController#index as HTML
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/index.html.haml within layouts/application
  [1m[36mEstimate Load (1.8ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL[0m
  Rendered estimates/_listing.html.haml (3.7ms)
  Rendered estimates/_listing.html.haml (0.9ms)
  Rendered estimates/index.html.haml within layouts/application (19.9ms)
  Rendered layouts/_header.html.haml (22.5ms)
Completed 200 OK in 682ms (Views: 669.3ms | ActiveRecord: 2.6ms)


Started GET "/estimates" for 127.0.0.1 at 2017-04-27 00:03:13 +0300
Processing by EstimatesController#index as HTML
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Redirected to http://localhost:3000/clients
Completed 302 Found in 54ms (ActiveRecord: 9.0ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 00:03:13 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (2.4ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (16.4ms)
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (4.3ms)
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (4.5ms)
  Rendered clients/_table.html.haml (30.9ms)
  [1m[36mUserClient Load (1.0ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (134.6ms)
  Rendered layouts/_header.html.haml (59.0ms)
Completed 200 OK in 685ms (Views: 635.8ms | ActiveRecord: 21.4ms)


Started GET "/estimates?client_id=2" for 127.0.0.1 at 2017-04-27 00:03:16 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"2"}
  [1m[36mUser Load (1.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/index.html.haml within layouts/application
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered estimates/index.html.haml within layouts/application (9.7ms)
  Rendered layouts/_header.html.haml (7.2ms)
Completed 200 OK in 468ms (Views: 456.9ms | ActiveRecord: 2.4ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 00:03:20 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (1.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (4.0ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (6.8ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (3.8ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (3.2ms)
  Rendered clients/_table.html.haml (18.0ms)
  [1m[36mUserClient Load (0.7ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (35.1ms)
  Rendered layouts/_header.html.haml (8.3ms)
Completed 200 OK in 563ms (Views: 547.5ms | ActiveRecord: 9.9ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 00:03:23 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/index.html.haml within layouts/application
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered estimates/_listing.html.haml (5.4ms)
  Rendered estimates/_listing.html.haml (0.7ms)
  Rendered estimates/index.html.haml within layouts/application (19.7ms)
  Rendered layouts/_header.html.haml (8.3ms)
Completed 200 OK in 527ms (Views: 522.1ms | ActiveRecord: 1.3ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 00:05:16 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (2.9ms)
  Rendered estimates/_listing.html.haml (0.8ms)
  Rendered estimates/index.html.haml within layouts/application (11.5ms)
  Rendered layouts/_header.html.haml (48.3ms)
Completed 200 OK in 656ms (Views: 558.6ms | ActiveRecord: 20.7ms)


Started GET "/primitives" for 127.0.0.1 at 2017-04-27 00:05:27 +0300
Processing by PrimitivesController#index as HTML
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering primitives/index.html.haml within layouts/application
  [1m[36mCategory Load (1.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[35m (1.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (0.9ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 1[0m
  [1m[36mPrimitive Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 1[0m
  [1m[36mCategory Load (5.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 1[0m
  [1m[36mUnit Load (0.4ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendered primitives/_listing.html.haml (11.2ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 2[0m
  [1m[36mPrimitive Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 2[0m
  [1m[36mCategory Load (1.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 2[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 2[0m
  Rendered primitives/_listing.html.haml (3.3ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 3[0m
  [1m[36mPrimitive Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 3[0m
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendered primitives/_listing.html.haml (5.7ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 4[0m
  [1m[36mPrimitive Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 4[0m
  [1m[36mCategory Load (1.0ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 4[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 5)[0m
  Rendered primitives/_listing.html.haml (3.6ms)
  Rendered primitives/_listing.html.haml (3.3ms)
  [1m[35m (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 5[0m
  [1m[36mPrimitive Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 5[0m
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 5[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (1, 5)[0m
  Rendered primitives/_listing.html.haml (3.5ms)
  Rendered primitives/_listing.html.haml (3.2ms)
  Rendered primitives/_listing.html.haml (3.0ms)
  [1m[35m (4.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 6[0m
  [1m[36mPrimitive Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 6[0m
  [1m[36mCategory Load (0.5ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 6[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 2[0m
  Rendered primitives/_listing.html.haml (4.1ms)
  Rendered primitives/_listing.html.haml (4.7ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 7[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 8[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 9[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 10[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 11[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 12[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 13[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 14[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 15[0m
  Rendered primitives/index.html.haml within layouts/application (187.2ms)
  Rendered layouts/_header.html.haml (9.2ms)
Completed 200 OK in 650ms (Views: 595.4ms | ActiveRecord: 47.7ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 00:05:34 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (1.4ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (1.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (9.8ms)
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (4.2ms)
  [1m[35m (2.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (5.6ms)
  Rendered clients/_table.html.haml (23.8ms)
  [1m[36mUserClient Load (0.8ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (101.1ms)
  Rendered layouts/_header.html.haml (9.1ms)
Completed 200 OK in 584ms (Views: 547.8ms | ActiveRecord: 13.0ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 00:05:37 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (2.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (3.8ms)
  Rendered estimates/_listing.html.haml (1.0ms)
  Rendered estimates/index.html.haml within layouts/application (19.9ms)
  Rendered layouts/_header.html.haml (10.0ms)
Completed 200 OK in 519ms (Views: 507.1ms | ActiveRecord: 3.8ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 00:09:40 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (3.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.9ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.1ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  [1m[36mCategory Load (0.8ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", true]]
  Rendered estimates/_listing.html.haml (410.9ms)
  Rendered estimates/index.html.haml within layouts/application (423.9ms)
Completed 500 Internal Server Error in 444ms (ActiveRecord: 5.8ms)


  
ActionView::Template::Error (undefined local variable or method `primitive' for #<#<Class:0x007f1f50ffc8e8>:0x00561d113e4f20>
Did you mean?  primitive_url):
     9:       %span.glyphicon.glyphicon-duplicate{ 'aria-hidden': true }
    10:     = link_to edit_estimate_path(estimate), title: 'Редактировать', class: 'btn btn-warning' do
    11:       %span.glyphicon.glyphicon-pencil
    12:     = link_to primitive_path(primitive), method: :delete, title: 'Удалить', class: 'btn btn-danger', data: {confirm: 'Are you sure?'} do
    13:       %span.glyphicon.glyphicon-trash
  
app/views/estimates/_listing.html.haml:12:in `_app_views_estimates__listing_html_haml__2507902463935483711_69886047804760'
app/views/estimates/index.html.haml:32:in `block in _app_views_estimates_index_html_haml___2437698545141170834_47341421874860'
app/views/estimates/index.html.haml:31:in `_app_views_estimates_index_html_haml___2437698545141170834_47341421874860'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (10.6ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.4ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.5ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (40.8ms)
Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 00:09:50 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (3.3ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.8ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", true]]
  Rendered estimates/_listing.html.haml (3.6ms)
  Rendered estimates/_listing.html.haml (1.2ms)
  Rendered estimates/index.html.haml within layouts/application (16.2ms)
  Rendered layouts/_header.html.haml (9.7ms)
Completed 200 OK in 589ms (Views: 574.8ms | ActiveRecord: 6.8ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 00:10:49 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  [1m[36mCategory Load (1.5ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", true]]
  Rendered estimates/_listing.html.haml (4.4ms)
  Rendered estimates/_listing.html.haml (2.1ms)
  Rendered estimates/index.html.haml within layouts/application (31.4ms)
  Rendered layouts/_header.html.haml (8.9ms)
Completed 200 OK in 609ms (Views: 594.9ms | ActiveRecord: 3.6ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 00:12:15 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (2.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (1.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.2ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (3.3ms)
  Rendered estimates/_listing.html.haml (0.9ms)
  Rendered estimates/index.html.haml within layouts/application (13.4ms)
  Rendered layouts/_header.html.haml (11.6ms)
Completed 200 OK in 524ms (Views: 511.5ms | ActiveRecord: 5.4ms)


Started GET "/estimates/new?client_id=1" for 127.0.0.1 at 2017-04-27 00:12:29 +0300
Processing by EstimatesController#new as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mProduct Load (0.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (1.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.9ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (1.3ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (10.1ms)
  Rendered estimates/_technical_file_fields.html.haml (5.4ms)
  Rendered estimates/_discount.html.haml (7.4ms)
  Rendered estimates/_stages.html.haml (16.8ms)
  Rendered estimates/_form.html.haml (117.6ms)
  Rendered estimates/new.html.haml within layouts/application (121.7ms)
  Rendered layouts/_header.html.haml (10.1ms)
Completed 200 OK in 789ms (Views: 602.3ms | ActiveRecord: 54.2ms)


Started GET "/estimates" for 127.0.0.1 at 2017-04-27 00:12:31 +0300
Processing by EstimatesController#index as HTML
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Redirected to http://localhost:3000/clients
Completed 404 Not Found in 7ms (ActiveRecord: 0.6ms)


  
ActiveRecord::RecordNotFound (Couldn't find Client without an ID):
  
app/controllers/estimates_controller.rb:9:in `index'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (7.6ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.1ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (0.9ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (36.2ms)
Started GET "/estimates" for 127.0.0.1 at 2017-04-27 00:12:53 +0300
Processing by EstimatesController#index as HTML
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Redirected to http://localhost:3000/clients
Completed 404 Not Found in 36ms (ActiveRecord: 9.6ms)


  
ActiveRecord::RecordNotFound (Couldn't find Client without an ID):
  
app/controllers/estimates_controller.rb:9:in `index'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (4.5ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (3.0ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (0.9ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (36.1ms)
Started GET "/estimates" for 127.0.0.1 at 2017-04-27 00:13:04 +0300
Processing by EstimatesController#index as HTML
  [1m[36mUser Load (1.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Redirected to http://localhost:3000/clients
Completed 404 Not Found in 70495ms (ActiveRecord: 11.2ms)


  
ActiveRecord::RecordNotFound (Couldn't find Client without an ID):
  
app/controllers/estimates_controller.rb:10:in `index'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (4.5ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.0ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (0.9ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (30.3ms)
Started GET "/estimates" for 127.0.0.1 at 2017-04-27 00:14:46 +0300
Processing by EstimatesController#index as HTML
  [1m[36mUser Load (1.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Redirected to http://localhost:3000/clients
Completed 302 Found in 23ms (ActiveRecord: 9.3ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 00:14:46 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (1.0ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (1.6ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (7.5ms)
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (4.4ms)
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (3.9ms)
  Rendered clients/_table.html.haml (20.0ms)
  [1m[36mUserClient Load (1.2ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (105.8ms)
  Rendered layouts/_header.html.haml (51.6ms)
Completed 200 OK in 659ms (Views: 624.4ms | ActiveRecord: 20.6ms)


DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
Started GET "/clients" for 127.0.0.1 at 2017-04-27 00:15:00 +0300
  [1m[36mActiveRecord::SchemaMigration Load (1.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Processing by ClientsController#index as HTML
  [1m[36mUser Load (1.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (1.3ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.9ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (2.1ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (22.3ms)
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (6.8ms)
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (3.9ms)
  Rendered clients/_table.html.haml (38.0ms)
  [1m[36mUserClient Load (1.0ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (183.7ms)
  Rendered layouts/_header.html.haml (72.2ms)
Completed 200 OK in 2689ms (Views: 2613.4ms | ActiveRecord: 33.5ms)


Started GET "/estimates?client_id=2" for 127.0.0.1 at 2017-04-27 00:15:06 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"2"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.0ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 2[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/index.html.haml within layouts/application (11.7ms)
  Rendered layouts/_header.html.haml (13.3ms)
Completed 200 OK in 606ms (Views: 589.8ms | ActiveRecord: 2.4ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 00:15:11 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (2.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (1.2ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (10.6ms)
  [1m[35m (6.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (10.4ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (6.4ms)
  Rendered clients/_table.html.haml (33.8ms)
  [1m[36mUserClient Load (1.0ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (57.9ms)
  Rendered layouts/_header.html.haml (9.1ms)
Completed 200 OK in 611ms (Views: 587.1ms | ActiveRecord: 13.6ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 00:15:13 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (3.3ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (4.3ms)
  Rendered estimates/_listing.html.haml (1.8ms)
  Rendered estimates/index.html.haml within layouts/application (24.1ms)
  Rendered layouts/_header.html.haml (8.7ms)
Completed 200 OK in 579ms (Views: 565.4ms | ActiveRecord: 4.5ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 00:15:52 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (1.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (0.8ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (3.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (11.2ms)
  [1m[35m (3.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (7.2ms)
  [1m[35m (2.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (5.8ms)
  Rendered clients/_table.html.haml (29.5ms)
  [1m[36mUserClient Load (0.8ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (77.4ms)
  Rendered layouts/_header.html.haml (13.4ms)
Completed 200 OK in 693ms (Views: 668.3ms | ActiveRecord: 13.9ms)


Started GET "/estimates?client_id=3" for 127.0.0.1 at 2017-04-27 00:15:54 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"3"}
  [1m[36mUser Load (2.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (5.8ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 3[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/index.html.haml within layouts/application (9.2ms)
  Rendered layouts/_header.html.haml (16.0ms)
Completed 200 OK in 767ms (Views: 745.6ms | ActiveRecord: 9.6ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 00:15:58 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (0.8ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (8.8ms)
  [1m[35m (2.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (5.5ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (5.0ms)
  Rendered clients/_table.html.haml (49.0ms)
  [1m[36mUserClient Load (1.0ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (70.5ms)
  Rendered layouts/_header.html.haml (8.8ms)
Completed 200 OK in 632ms (Views: 618.8ms | ActiveRecord: 7.6ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 00:16:00 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (2.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.0ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (4.2ms)
  Rendered estimates/_listing.html.haml (2.6ms)
  Rendered estimates/index.html.haml within layouts/application (19.0ms)
  Rendered layouts/_header.html.haml (9.1ms)
Completed 200 OK in 544ms (Views: 528.8ms | ActiveRecord: 4.2ms)


Started GET "/products?utf8=%E2%9C%93&name=%D1%82%D0%B5%D1%81%D1%82" for 127.0.0.1 at 2017-04-27 00:17:02 +0300
Processing by ProductsController#index as HTML
  Parameters: {"utf8"=>"✓", "name"=>"тест"}
  [1m[36mUser Load (2.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering products/index.html.haml within layouts/application
  [1m[36mCategory Load (1.0ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", true]]
  [1m[36mProduct Load (3.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND (lower(name) like '%тест%')[0m
  Rendered products/index.html.haml within layouts/application (32.6ms)
  Rendered layouts/_header.html.haml (9.3ms)
Completed 200 OK in 697ms (Views: 592.7ms | ActiveRecord: 17.9ms)


Started GET "/products?utf8=%E2%9C%93&name=&category=" for 127.0.0.1 at 2017-04-27 00:17:13 +0300
Processing by ProductsController#index as HTML
  Parameters: {"utf8"=>"✓", "name"=>"", "category"=>""}
  [1m[36mUser Load (1.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering products/index.html.haml within layouts/application
  [1m[36mCategory Load (2.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", true]]
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" IN (9, 12, 10)[0m
  [1m[36mUnit Load (1.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (1, 3, 5)[0m
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 1[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 2[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 3[0m
  [1m[35m (3.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 4[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 5[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 6[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 7[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 8[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 9[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 9[0m
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 9[0m
  [1m[36mUnit Load (1.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  Rendered products/_listing.html.haml (4.3ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 10[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 10[0m
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 10[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  Rendered products/_listing.html.haml (1.1ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 11[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 12[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 12[0m
  [1m[36mCategory Load (2.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 12[0m
  [1m[36mUnit Load (2.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  Rendered products/_listing.html.haml (0.9ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 13[0m
  [1m[35m (1.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 14[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 15[0m
  Rendered products/index.html.haml within layouts/application (113.4ms)
  Rendered layouts/_header.html.haml (21.5ms)
Completed 200 OK in 808ms (Views: 765.7ms | ActiveRecord: 37.4ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 00:17:43 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (1.0ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (1.8ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (1.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (12.3ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (7.6ms)
  [1m[35m (3.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (6.6ms)
  Rendered clients/_table.html.haml (31.8ms)
  [1m[36mUserClient Load (0.9ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (215.3ms)
  Rendered layouts/_header.html.haml (9.6ms)
Completed 200 OK in 816ms (Views: 777.8ms | ActiveRecord: 22.7ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 00:17:45 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (3.7ms)
  Rendered estimates/_listing.html.haml (1.1ms)
  Rendered estimates/index.html.haml within layouts/application (15.4ms)
  Rendered layouts/_header.html.haml (10.3ms)
Completed 200 OK in 595ms (Views: 576.5ms | ActiveRecord: 1.9ms)


Started GET "/estimates?utf8=%E2%9C%93&name=%D1%82%D0%B5%D1%81%D1%82" for 127.0.0.1 at 2017-04-27 00:17:51 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"utf8"=>"✓", "name"=>"тест"}
  [1m[36mUser Load (2.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Redirected to http://localhost:3000/clients
Completed 302 Found in 9ms (ActiveRecord: 2.3ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 00:17:51 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (1.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (0.9ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (4.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (13.9ms)
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (4.6ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (6.4ms)
  Rendered clients/_table.html.haml (30.4ms)
  [1m[36mUserClient Load (0.9ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (53.4ms)
  Rendered layouts/_header.html.haml (9.4ms)
Completed 200 OK in 639ms (Views: 620.7ms | ActiveRecord: 11.3ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 00:18:49 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (2.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (4.7ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (1.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (8.5ms)
  [1m[35m (4.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (8.2ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (4.9ms)
  Rendered clients/_table.html.haml (26.7ms)
  [1m[36mUserClient Load (0.8ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (58.7ms)
  Rendered layouts/_header.html.haml (15.3ms)
Completed 200 OK in 747ms (Views: 726.9ms | ActiveRecord: 15.5ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 00:18:55 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (5.3ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (6.5ms)
  Rendered estimates/_listing.html.haml (1.5ms)
  Rendered estimates/index.html.haml within layouts/application (31.1ms)
  Rendered layouts/_header.html.haml (8.9ms)
Completed 200 OK in 659ms (Views: 638.6ms | ActiveRecord: 6.8ms)


Started GET "/estimates?utf8=%E2%9C%93&client_id=1&name=%D1%82%D0%B5%D1%81%D1%82" for 127.0.0.1 at 2017-04-27 00:19:02 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"utf8"=>"✓", "client_id"=>"1", "name"=>"тест"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (4.4ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  [1m[36mEstimate Load (1.1ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1 AND (lower(name) like '%тест%')[0m  [["client_id", 1]]
  Rendered estimates/_listing.html.haml (3.7ms)
  Rendered estimates/index.html.haml within layouts/application (17.0ms)
  Rendered layouts/_header.html.haml (9.6ms)
Completed 200 OK in 565ms (Views: 549.1ms | ActiveRecord: 6.6ms)


Started GET "/estimates?utf8=%E2%9C%93&client_id=1&name=%D0%BD%D0%B0%D0%B7" for 127.0.0.1 at 2017-04-27 00:19:19 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"utf8"=>"✓", "client_id"=>"1", "name"=>"наз"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  [1m[36mEstimate Load (1.2ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1 AND (lower(name) like '%наз%')[0m  [["client_id", 1]]
  Rendered estimates/_listing.html.haml (3.5ms)
  Rendered estimates/index.html.haml within layouts/application (23.9ms)
  Rendered layouts/_header.html.haml (30.7ms)
Completed 200 OK in 608ms (Views: 589.8ms | ActiveRecord: 3.0ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 00:20:12 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (1.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (0.8ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (4.9ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (1.4ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (14.4ms)
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (5.0ms)
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (5.5ms)
  Rendered clients/_table.html.haml (29.6ms)
  [1m[36mUserClient Load (1.3ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (177.5ms)
  Rendered layouts/_header.html.haml (76.7ms)
Completed 200 OK in 1073ms (Views: 1005.5ms | ActiveRecord: 29.9ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 00:20:15 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (5.6ms)
  Rendered estimates/_listing.html.haml (1.1ms)
  Rendered estimates/index.html.haml within layouts/application (20.5ms)
  Rendered layouts/_header.html.haml (10.8ms)
Completed 200 OK in 589ms (Views: 568.3ms | ActiveRecord: 2.2ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 00:20:18 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (2.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (3.4ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (1.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (3.5ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (3.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (10.1ms)
  [1m[35m (4.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (8.3ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (7.1ms)
  Rendered clients/_table.html.haml (33.4ms)
  [1m[36mUserClient Load (3.0ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (60.6ms)
  Rendered layouts/_header.html.haml (12.2ms)
Completed 200 OK in 602ms (Views: 575.2ms | ActiveRecord: 22.8ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 00:20:20 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (2.7ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (3.7ms)
  Rendered estimates/_listing.html.haml (1.0ms)
  Rendered estimates/index.html.haml within layouts/application (17.3ms)
  Rendered layouts/_header.html.haml (10.8ms)
Completed 200 OK in 547ms (Views: 533.3ms | ActiveRecord: 4.4ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 00:20:30 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (3.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (3.4ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (10.8ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (4.3ms)
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (4.4ms)
  Rendered clients/_table.html.haml (27.3ms)
  [1m[36mUserClient Load (0.8ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (50.1ms)
  Rendered layouts/_header.html.haml (13.7ms)
Completed 200 OK in 880ms (Views: 863.2ms | ActiveRecord: 11.5ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 00:20:32 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (1.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (5.0ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.2ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (4.8ms)
  Rendered estimates/_listing.html.haml (1.0ms)
  Rendered estimates/index.html.haml within layouts/application (17.9ms)
  Rendered layouts/_header.html.haml (19.8ms)
Completed 200 OK in 671ms (Views: 653.7ms | ActiveRecord: 7.8ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 00:32:34 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (1.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (2.8ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.9ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (4.6ms)
  Rendered estimates/_listing.html.haml (1.0ms)
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (25.1ms)
  Rendered layouts/_header.html.haml (9.2ms)
Completed 200 OK in 595ms (Views: 578.0ms | ActiveRecord: 6.8ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 00:33:09 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (4.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (1.0ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (3.7ms)
  Rendered estimates/_listing.html.haml (1.1ms)
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (17.0ms)
  Rendered layouts/_header.html.haml (20.6ms)
Completed 200 OK in 727ms (Views: 709.8ms | ActiveRecord: 6.4ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 00:35:40 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (1.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (1.6ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.7ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (7.6ms)
  Rendered estimates/_listing.html.haml (1.9ms)
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (1.1ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (39.7ms)
  Rendered layouts/_header.html.haml (13.3ms)
Completed 200 OK in 709ms (Views: 688.9ms | ActiveRecord: 6.7ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 00:36:05 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (1.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (2.4ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (6.7ms)
  Rendered estimates/_listing.html.haml (1.3ms)
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (34.6ms)
  Rendered layouts/_header.html.haml (10.4ms)
Completed 200 OK in 590ms (Views: 575.5ms | ActiveRecord: 5.4ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 00:36:54 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (1.8ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (4.3ms)
  Rendered estimates/_listing.html.haml (1.4ms)
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (30.8ms)
  Rendered layouts/_header.html.haml (10.9ms)
Completed 200 OK in 620ms (Views: 606.4ms | ActiveRecord: 4.0ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 00:37:45 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (3.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (3.5ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (4.0ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (4.5ms)
  Rendered estimates/_listing.html.haml (1.4ms)
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (21.4ms)
  Rendered layouts/_header.html.haml (10.0ms)
Completed 200 OK in 640ms (Views: 615.3ms | ActiveRecord: 11.6ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 00:44:48 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (4.8ms)
  Rendered estimates/_listing.html.haml (1.0ms)
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (23.4ms)
  Rendered layouts/_header.html.haml (12.4ms)
Completed 200 OK in 1754ms (Views: 1743.8ms | ActiveRecord: 3.0ms)


Started GET "/estimates/2/edit" for 127.0.0.1 at 2017-04-27 00:44:53 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"2"}
  [1m[36mProduct Load (2.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.4ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.5ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (2.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.5ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (3.3ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.5ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (1.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.9ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (1.1ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.4ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.8ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mStageProduct Load (1.3ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (4, 5, 6)[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 4]]
  [1m[36mStageProductSet Load (0.8ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 4[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 5]]
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 5[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 6]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 6[0m
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.8ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 6]]
  [1m[36mStageProductSetValue Load (0.8ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 2[0m
  [1m[36mProductSet Load (0.7ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.5ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (14.6ms)
  [1m[36mClientFile Load (0.7ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.5ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendered estimates/_client_file_fields.html.haml (24.4ms)
  Rendered estimates/_technical_file_fields.html.haml (6.6ms)
  [1m[36mTechnicalFile Load (0.7ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (1.8ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendered estimates/_technical_file_fields.html.haml (9.0ms)
  Rendered estimates/_discount.html.haml (7.8ms)
  Rendered estimates/_stages.html.haml (22.6ms)
  Rendered estimates/_form.html.haml (201.7ms)
  Rendered estimates/edit.html.haml within layouts/application (204.9ms)
  Rendered layouts/_header.html.haml (8.1ms)
Completed 200 OK in 1112ms (Views: 707.8ms | ActiveRecord: 110.2ms)


Started GET "/estimates/2/edit" for 127.0.0.1 at 2017-04-27 00:45:04 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"2"}
  [1m[36mProduct Load (5.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.8ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (2.4ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (3.1ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.0ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (2.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (1.2ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.6ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (4, 5, 6)[0m
  [1m[36mStageProduct Load (2.9ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 4]]
  [1m[36mStageProductSet Load (1.1ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 4[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 5]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 5[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 6]]
  [1m[36mStageProductSet Load (1.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 6[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.8ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 6]]
  [1m[36mStageProductSetValue Load (1.0ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 2[0m
  [1m[36mProductSet Load (2.0ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (1.1ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.4ms)
  [1m[36mClientFile Load (0.6ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.5ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendered estimates/_client_file_fields.html.haml (6.5ms)
  Rendered estimates/_technical_file_fields.html.haml (3.9ms)
  [1m[36mTechnicalFile Load (0.7ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.5ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendered estimates/_technical_file_fields.html.haml (7.0ms)
  Rendered estimates/_discount.html.haml (8.3ms)
  Rendered estimates/_stages.html.haml (18.9ms)
  Rendered estimates/_form.html.haml (102.0ms)
  Rendered estimates/edit.html.haml within layouts/application (105.2ms)
  Rendered layouts/_header.html.haml (9.7ms)
Completed 200 OK in 1744ms (Views: 1587.0ms | ActiveRecord: 48.4ms)


Started GET "/estimates/2/edit" for 127.0.0.1 at 2017-04-27 00:52:21 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"2"}
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (3.3ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (1.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.8ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.6ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mStageProduct Load (0.9ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (4, 5, 6)[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 4]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 4[0m
  [1m[36mProduct Load (3.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (1.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 5]]
  [1m[36mStageProductSet Load (2.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 5[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 6]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 6[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 6]]
  [1m[36mStageProductSetValue Load (1.0ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 2[0m
  [1m[36mProductSet Load (0.7ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (1.0ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.7ms)
  [1m[36mClientFile Load (0.6ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.5ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendered estimates/_client_file_fields.html.haml (7.9ms)
  Rendered estimates/_technical_file_fields.html.haml (3.3ms)
  [1m[36mTechnicalFile Load (0.6ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.5ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendered estimates/_technical_file_fields.html.haml (7.3ms)
  Rendered estimates/_discount.html.haml (28.9ms)
  Rendered estimates/_stages.html.haml (15.0ms)
  Rendered estimates/_form.html.haml (125.0ms)
  Rendered estimates/edit.html.haml within layouts/application (128.2ms)
  Rendered layouts/_header.html.haml (32.8ms)
Completed 200 OK in 1743ms (Views: 1606.5ms | ActiveRecord: 41.5ms)


Started GET "/estimates/2/edit" for 127.0.0.1 at 2017-04-27 00:53:21 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"2"}
  [1m[36mProduct Load (1.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.9ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.5ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.9ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (2.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (1.4ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (4.5ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.8ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (4, 5, 6)[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 4]]
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 4[0m
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 5]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 5[0m
  [1m[36mProduct Load (1.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 6]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 6[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (5.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 6]]
  [1m[36mStageProductSetValue Load (1.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 2[0m
  [1m[36mProductSet Load (0.8ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (5.7ms)
  [1m[36mClientFile Load (0.6ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.5ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendered estimates/_client_file_fields.html.haml (6.0ms)
  Rendered estimates/_technical_file_fields.html.haml (3.4ms)
  [1m[36mTechnicalFile Load (0.7ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.4ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendered estimates/_technical_file_fields.html.haml (6.3ms)
  Rendered estimates/_discount.html.haml (10.1ms)
  Rendered estimates/_stages.html.haml (23.5ms)
  Rendered estimates/_form.html.haml (112.3ms)
  Rendered estimates/edit.html.haml within layouts/application (117.2ms)
  Rendered layouts/_header.html.haml (8.1ms)
Completed 200 OK in 1789ms (Views: 1640.8ms | ActiveRecord: 44.6ms)


Started GET "/estimates/2/edit" for 127.0.0.1 at 2017-04-27 00:54:28 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"2"}
  [1m[36mProduct Load (1.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (3.5ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.3ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (1.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (2.5ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (1.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (3.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.3ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (1.2ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.9ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (1.0ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (1.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (1.9ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.4ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.4ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.5ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (4, 5, 6)[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 4]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 4[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 5]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 5[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 6]]
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 6[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 6]]
  [1m[36mStageProductSetValue Load (0.6ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 2[0m
  [1m[36mProductSet Load (0.6ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.5ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (2.9ms)
  [1m[36mClientFile Load (0.5ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.4ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendered estimates/_client_file_fields.html.haml (5.0ms)
  Rendered estimates/_technical_file_fields.html.haml (3.8ms)
  [1m[36mTechnicalFile Load (0.5ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.4ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendered estimates/_technical_file_fields.html.haml (5.4ms)
  Rendered estimates/_discount.html.haml (5.7ms)
  Rendered estimates/_stages.html.haml (14.4ms)
  Rendered estimates/_form.html.haml (81.2ms)
  Rendered estimates/edit.html.haml within layouts/application (84.4ms)
  Rendered layouts/_header.html.haml (10.4ms)
Completed 200 OK in 1608ms (Views: 1459.4ms | ActiveRecord: 44.6ms)


Started GET "/estimates/2/edit" for 127.0.0.1 at 2017-04-27 00:55:29 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"2"}
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (1.4ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (1.3ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.9ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.9ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (1.1ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (2.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (1.1ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (4, 5, 6)[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 4]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 4[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (4.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 5]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 5[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (1.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 6]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 6[0m
  [1m[36mProduct Load (1.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 6]]
  [1m[36mStageProductSetValue Load (0.6ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 2[0m
  [1m[36mProductSet Load (0.6ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (1.9ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (4.9ms)
  [1m[36mClientFile Load (0.7ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.5ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendered estimates/_client_file_fields.html.haml (8.3ms)
  Rendered estimates/_technical_file_fields.html.haml (5.3ms)
  [1m[36mTechnicalFile Load (2.8ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.4ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendered estimates/_technical_file_fields.html.haml (8.2ms)
  Rendered estimates/_discount.html.haml (10.7ms)
  Rendered estimates/_stages.html.haml (31.0ms)
  Rendered estimates/_form.html.haml (159.2ms)
  Rendered estimates/edit.html.haml within layouts/application (163.7ms)
  Rendered layouts/_header.html.haml (9.9ms)
Completed 200 OK in 1905ms (Views: 1745.9ms | ActiveRecord: 43.1ms)


Started GET "/estimates/2/edit" for 127.0.0.1 at 2017-04-27 00:56:54 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"2"}
  [1m[36mProduct Load (1.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.9ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (2.1ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.6ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mStageProduct Load (2.1ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (4, 5, 6)[0m
  [1m[36mStageProduct Load (1.4ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 4]]
  [1m[36mStageProductSet Load (1.0ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 4[0m
  [1m[36mProduct Load (2.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (2.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 5]]
  [1m[36mStageProductSet Load (0.8ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 5[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 6]]
  [1m[36mStageProductSet Load (2.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 6[0m
  [1m[36mProduct Load (1.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (2.3ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 6]]
  [1m[36mStageProductSetValue Load (0.6ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 2[0m
  [1m[36mProductSet Load (0.6ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.8ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (1.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (5.3ms)
  [1m[36mClientFile Load (3.1ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.8ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendered estimates/_client_file_fields.html.haml (8.4ms)
  Rendered estimates/_technical_file_fields.html.haml (5.1ms)
  [1m[36mTechnicalFile Load (0.5ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (2.5ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendered estimates/_technical_file_fields.html.haml (11.7ms)
  Rendered estimates/_discount.html.haml (9.1ms)
  Rendered estimates/_stages.html.haml (18.8ms)
  Rendered estimates/_form.html.haml (130.2ms)
  Rendered estimates/edit.html.haml within layouts/application (165.5ms)
  Rendered layouts/_header.html.haml (35.0ms)
Completed 200 OK in 1996ms (Views: 1839.2ms | ActiveRecord: 49.6ms)


Started GET "/estimates/2/edit" for 127.0.0.1 at 2017-04-27 00:59:08 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"2"}
  [1m[36mProduct Load (1.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (2.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (1.5ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (1.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.8ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (5.1ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (1.5ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (3.4ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.1ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (1.2ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (4.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.9ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (4.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.4ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.8ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (4, 5, 6)[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 4]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 4[0m
  [1m[36mProduct Load (3.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 5]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 5[0m
  [1m[36mProduct Load (0.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 6]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 6[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 6]]
  [1m[36mStageProductSetValue Load (1.0ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 2[0m
  [1m[36mProductSet Load (0.5ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (1.2ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.5ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (5.7ms)
  [1m[36mClientFile Load (0.6ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.3ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendered estimates/_client_file_fields.html.haml (8.1ms)
  Rendered estimates/_technical_file_fields.html.haml (2.8ms)
  [1m[36mTechnicalFile Load (0.7ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (1.5ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendered estimates/_technical_file_fields.html.haml (7.9ms)
  Rendered estimates/_discount.html.haml (11.3ms)
  Rendered estimates/_stages.html.haml (16.2ms)
  Rendered estimates/_form.html.haml (101.5ms)
  Rendered estimates/edit.html.haml within layouts/application (105.1ms)
  Rendered layouts/_header.html.haml (8.8ms)
Completed 200 OK in 1818ms (Views: 1671.1ms | ActiveRecord: 56.6ms)


Started GET "/estimates/2/edit" for 127.0.0.1 at 2017-04-27 01:01:06 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"2"}
  [1m[36mProduct Load (3.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (2.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.5ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (2.3ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (1.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (2.3ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.5ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (1.8ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (4.1ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.3ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (3.6ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mStageProduct Load (1.2ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (4, 5, 6)[0m
  [1m[36mStageProduct Load (1.2ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 4]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 4[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.9ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 5]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 5[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 6]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 6[0m
  [1m[36mProduct Load (1.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 6]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 2[0m
  [1m[36mProductSet Load (0.7ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.6ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.5ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.7ms)
  [1m[36mClientFile Load (0.6ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.7ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendered estimates/_client_file_fields.html.haml (6.0ms)
  Rendered estimates/_technical_file_fields.html.haml (3.3ms)
  [1m[36mTechnicalFile Load (0.8ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.5ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendered estimates/_technical_file_fields.html.haml (6.0ms)
  Rendered estimates/_discount.html.haml (14.2ms)
  Rendered estimates/_stages.html.haml (28.7ms)
  Rendered estimates/_form.html.haml (128.1ms)
  Rendered estimates/edit.html.haml within layouts/application (134.4ms)
  Rendered layouts/_header.html.haml (9.7ms)
Completed 200 OK in 1993ms (Views: 1845.1ms | ActiveRecord: 44.3ms)


Started GET "/estimates/2/edit" for 127.0.0.1 at 2017-04-27 01:01:41 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"2"}
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (6.4ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (2.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (1.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (1.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (3.5ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.5ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (2.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.3ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.6ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (4, 5, 6)[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 4]]
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 4[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 5]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 5[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 6]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 6[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 6]]
  [1m[36mStageProductSetValue Load (0.5ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 2[0m
  [1m[36mProductSet Load (0.5ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.6ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.5ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.3ms)
  [1m[36mClientFile Load (0.5ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.3ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendered estimates/_client_file_fields.html.haml (5.8ms)
  Rendered estimates/_technical_file_fields.html.haml (3.3ms)
  [1m[36mTechnicalFile Load (0.7ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.7ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendered estimates/_technical_file_fields.html.haml (6.3ms)
  Rendered estimates/_discount.html.haml (9.1ms)
  Rendered estimates/_stages.html.haml (16.7ms)
  Rendered estimates/_form.html.haml (112.4ms)
  Rendered estimates/edit.html.haml within layouts/application (115.7ms)
  Rendered layouts/_header.html.haml (16.8ms)
Completed 200 OK in 1787ms (Views: 1644.5ms | ActiveRecord: 41.5ms)


Started GET "/estimates/2/edit" for 127.0.0.1 at 2017-04-27 01:07:23 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"2"}
  [1m[36mProduct Load (0.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.8ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (1.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.9ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (1.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.3ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.9ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (4, 5, 6)[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 4]]
  [1m[36mStageProductSet Load (0.4ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 4[0m
  [1m[36mProduct Load (2.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 5]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 5[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 6]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 6[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.9ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 6]]
  [1m[36mStageProductSetValue Load (3.9ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 2[0m
  [1m[36mProductSet Load (0.7ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.6ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (13.7ms)
  [1m[36mClientFile Load (0.7ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (2.6ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendered estimates/_client_file_fields.html.haml (22.3ms)
  Rendered estimates/_technical_file_fields.html.haml (5.7ms)
  [1m[36mTechnicalFile Load (0.7ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.5ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendered estimates/_technical_file_fields.html.haml (7.1ms)
  Rendered estimates/_discount.html.haml (30.7ms)
  Rendered estimates/_stages.html.haml (13.5ms)
  Rendered estimates/_form.html.haml (209.1ms)
  Rendered estimates/edit.html.haml within layouts/application (212.2ms)
  Rendered layouts/_header.html.haml (23.6ms)
Completed 200 OK in 2075ms (Views: 1536.7ms | ActiveRecord: 140.7ms)


Started GET "/estimates/2/edit" for 127.0.0.1 at 2017-04-27 01:08:39 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"2"}
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (3.3ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (1.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (1.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.8ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.4ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.6ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (4, 5, 6)[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 4]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 4[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 5]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 5[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 6]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 6[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (4.0ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 6]]
  [1m[36mStageProductSetValue Load (0.8ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 2[0m
  [1m[36mProductSet Load (1.5ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (3.5ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.1ms)
  [1m[36mClientFile Load (0.6ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (1.9ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendered estimates/_client_file_fields.html.haml (6.9ms)
  Rendered estimates/_technical_file_fields.html.haml (2.7ms)
  [1m[36mTechnicalFile Load (0.7ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (2.5ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendered estimates/_technical_file_fields.html.haml (7.4ms)
  Rendered estimates/_discount.html.haml (6.8ms)
  Rendered estimates/_stages.html.haml (17.7ms)
  Rendered estimates/_form.html.haml (91.8ms)
  Rendered estimates/edit.html.haml within layouts/application (96.7ms)
  Rendered layouts/_header.html.haml (20.7ms)
Completed 200 OK in 1696ms (Views: 1547.0ms | ActiveRecord: 45.5ms)


Started GET "/estimates/2/edit" for 127.0.0.1 at 2017-04-27 01:10:17 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"2"}
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (2.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (1.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (1.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.5ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (1.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (3.9ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.4ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.6ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mStageProduct Load (1.9ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (4, 5, 6)[0m
  [1m[36mStageProduct Load (1.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 4]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 4[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 5]]
  [1m[36mStageProductSet Load (2.3ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 5[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 6]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 6[0m
  [1m[36mProduct Load (1.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 6]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 2[0m
  [1m[36mProductSet Load (0.9ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.5ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.2ms)
  [1m[36mClientFile Load (0.8ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.4ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendered estimates/_client_file_fields.html.haml (9.0ms)
  Rendered estimates/_technical_file_fields.html.haml (3.7ms)
  [1m[36mTechnicalFile Load (2.5ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.3ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendered estimates/_technical_file_fields.html.haml (5.6ms)
  Rendered estimates/_discount.html.haml (7.2ms)
  Rendered estimates/_stages.html.haml (18.4ms)
  Rendered estimates/_form.html.haml (96.3ms)
  Rendered estimates/edit.html.haml within layouts/application (100.7ms)
  Rendered layouts/_header.html.haml (10.5ms)
Completed 200 OK in 1850ms (Views: 1705.2ms | ActiveRecord: 44.4ms)


Started GET "/estimates" for 127.0.0.1 at 2017-04-27 01:10:29 +0300
Processing by EstimatesController#index as HTML
  [1m[36mUser Load (1.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Redirected to http://localhost:3000/clients
Completed 302 Found in 5ms (ActiveRecord: 1.7ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 01:10:29 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (1.1ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (1.1ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (6.7ms)
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (4.2ms)
  [1m[35m (3.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (6.1ms)
  Rendered clients/_table.html.haml (22.1ms)
  [1m[36mUserClient Load (1.1ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (56.9ms)
  Rendered layouts/_header.html.haml (8.9ms)
Completed 200 OK in 535ms (Views: 509.1ms | ActiveRecord: 14.3ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 01:10:31 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (1.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (1.3ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (2.8ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (3.3ms)
  Rendered estimates/_listing.html.haml (1.7ms)
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (19.4ms)
  Rendered layouts/_header.html.haml (8.5ms)
Completed 200 OK in 526ms (Views: 511.4ms | ActiveRecord: 6.5ms)


Started GET "/estimates/new?client_id=1" for 127.0.0.1 at 2017-04-27 01:10:46 +0300
Processing by EstimatesController#new as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mProduct Load (1.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.2ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.1ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (3.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.5ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (1.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.0ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (1.2ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (1.5ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (1.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (1.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (1.1ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.2ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (1.4ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.0ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (1.1ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.7ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (4.7ms)
  Rendered estimates/_technical_file_fields.html.haml (9.7ms)
  Rendered estimates/_discount.html.haml (12.6ms)
  Rendered estimates/_stages.html.haml (27.4ms)
  Rendered estimates/_form.html.haml (118.1ms)
  Rendered estimates/new.html.haml within layouts/application (120.8ms)
  Rendered layouts/_header.html.haml (8.6ms)
Completed 200 OK in 704ms (Views: 631.1ms | ActiveRecord: 29.5ms)


Started GET "/estimates/new?client_id=1" for 127.0.0.1 at 2017-04-27 01:12:17 +0300
Processing by EstimatesController#new as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.9ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (3.1ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (1.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (3.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (1.2ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (1.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.6ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (1.4ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (2.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (1.1ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (4.9ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (2.0ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (1.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (2.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (2.9ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (5.2ms)
  Rendered estimates/_technical_file_fields.html.haml (3.8ms)
  Rendered estimates/_discount.html.haml (13.4ms)
  Rendered estimates/_stages.html.haml (20.3ms)
  Rendered estimates/_form.html.haml (91.1ms)
  Rendered estimates/new.html.haml within layouts/application (95.8ms)
  Rendered layouts/_header.html.haml (12.2ms)
Completed 200 OK in 744ms (Views: 641.6ms | ActiveRecord: 39.0ms)


Started GET "/estimates/new?client_id=1" for 127.0.0.1 at 2017-04-27 01:13:29 +0300
Processing by EstimatesController#new as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mProduct Load (1.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (1.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (1.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.5ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (2.8ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.0ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (2.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.6ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (4.2ms)
  Rendered estimates/_technical_file_fields.html.haml (21.7ms)
  Rendered estimates/_discount.html.haml (7.8ms)
  Rendered estimates/_stages.html.haml (19.1ms)
  Rendered estimates/_form.html.haml (104.3ms)
  Rendered estimates/new.html.haml within layouts/application (107.9ms)
  Rendered layouts/_header.html.haml (9.0ms)
Completed 200 OK in 686ms (Views: 586.7ms | ActiveRecord: 24.4ms)


Started GET "/estimates" for 127.0.0.1 at 2017-04-27 01:14:02 +0300
Processing by EstimatesController#index as HTML
  [1m[36mUser Load (5.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Redirected to http://localhost:3000/clients
Completed 302 Found in 8ms (ActiveRecord: 5.3ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 01:14:02 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (3.7ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (8.9ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (3.7ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (3.8ms)
  Rendered clients/_table.html.haml (21.4ms)
  [1m[36mUserClient Load (0.7ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (40.5ms)
  Rendered layouts/_header.html.haml (11.6ms)
Completed 200 OK in 612ms (Views: 599.7ms | ActiveRecord: 8.5ms)


Started GET "/composites" for 127.0.0.1 at 2017-04-27 01:20:46 +0300
Processing by CompositesController#index as HTML
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering composites/index.html.haml within layouts/application
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mComposite Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Composite') AND "constructor_objects"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (0.8ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (1, 3)[0m
  Rendered composites/_listing.html.haml (5.7ms)
  Rendered composites/_listing.html.haml (1.8ms)
  Rendered composites/index.html.haml within layouts/application (51.8ms)
  Rendered layouts/_header.html.haml (9.4ms)
Completed 200 OK in 549ms (Views: 530.9ms | ActiveRecord: 8.2ms)


Started GET "/primitives" for 127.0.0.1 at 2017-04-27 01:20:49 +0300
Processing by PrimitivesController#index as HTML
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering primitives/index.html.haml within layouts/application
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (1.0ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL[0m
  [1m[35m (2.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 1[0m
  [1m[36mPrimitive Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 1[0m
  [1m[36mCategory Load (1.3ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 1[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendered primitives/_listing.html.haml (17.4ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 2[0m
  [1m[36mPrimitive Load (2.4ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 2[0m
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 2[0m
  [1m[36mUnit Load (2.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 2[0m
  Rendered primitives/_listing.html.haml (3.3ms)
  [1m[35m (1.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 3[0m
  [1m[36mPrimitive Load (2.4ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 3[0m
  [1m[36mCategory Load (0.5ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendered primitives/_listing.html.haml (5.5ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 4[0m
  [1m[36mPrimitive Load (1.4ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 4[0m
  [1m[36mCategory Load (2.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 4[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 5)[0m
  Rendered primitives/_listing.html.haml (3.5ms)
  Rendered primitives/_listing.html.haml (3.3ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 5[0m
  [1m[36mPrimitive Load (0.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 5[0m
  [1m[36mCategory Load (0.8ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 5[0m
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (1, 5)[0m
  Rendered primitives/_listing.html.haml (5.0ms)
  Rendered primitives/_listing.html.haml (4.0ms)
  Rendered primitives/_listing.html.haml (4.1ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 6[0m
  [1m[36mPrimitive Load (0.5ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 6[0m
  [1m[36mCategory Load (3.3ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 6[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 2[0m
  Rendered primitives/_listing.html.haml (3.7ms)
  Rendered primitives/_listing.html.haml (3.8ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 7[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 8[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 9[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 10[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 11[0m
  [1m[35m (5.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 12[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 13[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 14[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 15[0m
  Rendered primitives/index.html.haml within layouts/application (158.0ms)
  Rendered layouts/_header.html.haml (8.9ms)
Completed 200 OK in 679ms (Views: 629.6ms | ActiveRecord: 42.1ms)


Started GET "/composites" for 127.0.0.1 at 2017-04-27 01:20:57 +0300
Processing by CompositesController#index as HTML
  [1m[36mUser Load (2.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering composites/index.html.haml within layouts/application
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mComposite Load (1.4ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Composite') AND "constructor_objects"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (2.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (1, 3)[0m
  Rendered composites/_listing.html.haml (4.7ms)
  Rendered composites/_listing.html.haml (0.6ms)
  Rendered composites/index.html.haml within layouts/application (26.3ms)
  Rendered layouts/_header.html.haml (12.1ms)
Completed 200 OK in 514ms (Views: 496.7ms | ActiveRecord: 7.4ms)


DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
  [1m[35m (2.9ms)[0m  [1m[34mSELECT pg_try_advisory_lock(6572146483646705745);[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.3ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Migrating to AddWithoutWorkPriceToConstructorObject (20170426222257)
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (65.0ms)[0m  [1m[35mALTER TABLE "constructor_objects" ADD "price_without_work" decimal DEFAULT 0[0m
  [1m[35m (30.6ms)[0m  [1m[35mALTER TABLE "products" ADD "price_without_work" decimal DEFAULT 0[0m
  [1m[35m (24.0ms)[0m  [1m[35mALTER TABLE "stage_products" ADD "with_work" boolean DEFAULT 't'[0m
  [1m[35m (18.9ms)[0m  [1m[35mALTER TABLE "stage_products" ADD "price_without_work" decimal DEFAULT 0[0m
  [1m[35mSQL (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20170426222257"]]
  [1m[35m (5.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (3.9ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT pg_advisory_unlock(6572146483646705745)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
Started GET "/composites" for 127.0.0.1 at 2017-04-27 03:20:07 +0300
  [1m[36mActiveRecord::SchemaMigration Load (1.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Processing by CompositesController#index as HTML
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started GET "/composites" for 127.0.0.1 at 2017-04-27 03:20:07 +0300
  Rendering composites/index.html.haml within layouts/application
Processing by CompositesController#index as HTML
  [1m[36mUser Load (1.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCategory Load (6.4ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  Rendering composites/index.html.haml within layouts/application
  [1m[36mComposite Load (2.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Composite') AND "constructor_objects"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (2.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mComposite Load (23.5ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Composite') AND "constructor_objects"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (2.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" IN (2, 1)[0m
  [1m[36mCategory Load (3.9ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" IN (2, 1)[0m
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (3, 1)[0m
  Rendered composites/_listing.html.haml (4.3ms)
  [1m[36mUnit Load (5.4ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (3, 1)[0m
  Rendered composites/_listing.html.haml (0.8ms)
  Rendered composites/_listing.html.haml (0.8ms)
  Rendered composites/index.html.haml within layouts/application (147.8ms)
  Rendered composites/_listing.html.haml (1.0ms)
  Rendered composites/index.html.haml within layouts/application (119.6ms)
  Rendered layouts/_header.html.haml (21.7ms)
Completed 200 OK in 4395ms (Views: 4332.9ms | ActiveRecord: 56.5ms)


  Rendered layouts/_header.html.haml (4.8ms)
Completed 200 OK in 4625ms (Views: 4433.0ms | ActiveRecord: 31.5ms)


Started GET "/composites/new" for 127.0.0.1 at 2017-04-27 03:21:24 +0300
Processing by CompositesController#new as HTML
  [1m[36mUser Load (1.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering composites/new.html.haml within layouts/application
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (0.8ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  Rendered composites/_composition_fields.html.haml (9.1ms)
  Rendered composites/_form.html.haml (114.5ms)
  Rendered composites/new.html.haml within layouts/application (122.7ms)
  Rendered layouts/_header.html.haml (16.7ms)
Completed 200 OK in 814ms (Views: 797.1ms | ActiveRecord: 8.1ms)


Started GET "/constructor_objects/autocomplete_constructor_object_name?term=Ghb" for 127.0.0.1 at 2017-04-27 03:21:35 +0300
Processing by ConstructorObjectsController#autocomplete_constructor_object_name as JSON
  Parameters: {"term"=>"Ghb"}
  [1m[36mConstructorObject Load (3.0ms)[0m  [1m[34mSELECT  constructor_objects.id, constructor_objects.name FROM "constructor_objects" WHERE (LOWER(constructor_objects.name) ILIKE 'ghb%') ORDER BY constructor_objects.name ASC LIMIT $1[0m  [["LIMIT", 10]]
Completed 200 OK in 10ms (Views: 0.2ms | ActiveRecord: 3.0ms)


Started GET "/constructor_objects/autocomplete_constructor_object_name?term=%D0%9F%D1%80%D0%B8" for 127.0.0.1 at 2017-04-27 03:21:37 +0300
Processing by ConstructorObjectsController#autocomplete_constructor_object_name as JSON
  Parameters: {"term"=>"При"}
  [1m[36mConstructorObject Load (2.5ms)[0m  [1m[34mSELECT  constructor_objects.id, constructor_objects.name FROM "constructor_objects" WHERE (LOWER(constructor_objects.name) ILIKE 'при%') ORDER BY constructor_objects.name ASC LIMIT $1[0m  [["LIMIT", 10]]
Completed 200 OK in 7ms (Views: 0.9ms | ActiveRecord: 2.5ms)


Started GET "/constructor_objects/info?id=1" for 127.0.0.1 at 2017-04-27 03:21:40 +0300
Processing by ConstructorObjectsController#info as JSON
  Parameters: {"id"=>"1"}
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
Completed 200 OK in 20ms (Views: 0.2ms | ActiveRecord: 1.7ms)


Started POST "/composites" for 127.0.0.1 at 2017-04-27 03:21:42 +0300
Processing by CompositesController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"pLFQ0itKvw2RnrsczFwGYSFkwVQ0IF3yhtRF8Br51VwoAFNbcZK1bLROJ+yx3gYhWvkTtxZbrZg8+3ovCeV3TQ==", "commit"=>"Сохранить", "composite"=>{"name"=>"123", "unit_id"=>"1", "category_id"=>"1", "divisibility"=>"0", "compositions_attributes"=>{"1493252500193"=>{"children_id"=>"1", "value"=>"12", "_destroy"=>"false"}}}, "search_id"=>"1", "search"=>""}
  [1m[36mUser Load (1.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mConstructorObject Load (3.2ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (2.4ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" INNER JOIN "compositions" ON "constructor_objects"."id" = "compositions"."children_id" WHERE "compositions"."parent_id" = $1[0m  [["parent_id", 1]]
  [1m[36mConstructorObject Load (0.5ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" INNER JOIN "compositions" ON "constructor_objects"."id" = "compositions"."parent_id" WHERE "compositions"."children_id" = $1[0m  [["children_id", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" INNER JOIN "compositions" ON "constructor_objects"."id" = "compositions"."parent_id" WHERE "compositions"."children_id" = $1[0m  [["children_id", 11]]
  [1m[35mSQL (3.2ms)[0m  [1m[32mINSERT INTO "constructor_objects" ("name", "unit_id", "category_id", "date", "created_at", "updated_at", "type") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["name", "123"], ["unit_id", 1], ["category_id", 1], ["date", 2017-04-27 00:21:42 UTC], ["created_at", 2017-04-27 00:21:42 UTC], ["updated_at", 2017-04-27 00:21:42 UTC], ["type", "Composite"]]
  [1m[35mSQL (2.1ms)[0m  [1m[32mINSERT INTO "compositions" ("parent_id", "children_id", "value") VALUES ($1, $2, $3) RETURNING "id"[0m  [["parent_id", 13], ["children_id", 1], ["value", 12]]
  [1m[36mAudited::Audit Load (2.9ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 13], ["auditable_type", "ConstructorObject"], ["LIMIT", 1]]
  [1m[35mSQL (1.5ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 13], ["auditable_type", "ConstructorObject"], ["user_id", 1], ["user_type", "User"], ["action", "create"], ["audited_changes", "---\nname: '123'\nunit_id: 1\ncategory_id: 1\ndate: !ruby/object:ActiveSupport::TimeWithZone\n  utc: 2017-04-27 00:21:42.479386792 Z\n  zone: !ruby/object:ActiveSupport::TimeZone\n    name: Etc/UTC\n  time: 2017-04-27 00:21:42.479386792 Z\ndivisibility: false\ndeleted_at: \nprice_without_work: !ruby/object:BigDecimal 18:0.0\n"], ["version", 1], ["remote_address", "127.0.0.1"], ["request_uuid", "abbdb55a-c4cd-4d38-9e9f-db532fc235a1"], ["created_at", 2017-04-27 00:21:42 UTC]]
  [1m[35m (1.5ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] Enqueued PriceUpdateJob (Job ID: d6d2d5a3-0f34-4ac7-8a32-40f83ed3e22e) to Sidekiq(update_price) with arguments: #<GlobalID:0x00562b04f9b408 @uri=#<URI::GID gid://constructor/Composite/13>>
Redirected to http://localhost:3000/composites
Completed 302 Found in 217ms (ActiveRecord: 26.4ms)


Started GET "/composites" for 127.0.0.1 at 2017-04-27 03:21:42 +0300
Processing by CompositesController#index as HTML
  [1m[36mUser Load (1.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering composites/index.html.haml within layouts/application
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mComposite Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Composite') AND "constructor_objects"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (2.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" IN (2, 1)[0m
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (3, 1)[0m
  Rendered composites/_listing.html.haml (4.6ms)
  Rendered composites/_listing.html.haml (1.1ms)
  Rendered composites/_listing.html.haml (0.7ms)
  Rendered composites/index.html.haml within layouts/application (63.6ms)
  Rendered layouts/_header.html.haml (10.4ms)
Completed 200 OK in 854ms (Views: 841.4ms | ActiveRecord: 6.0ms)


DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
Started GET "/primitives" for 127.0.0.1 at 2017-04-27 03:28:34 +0300
Processing by PrimitivesController#index as HTML
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering primitives/index.html.haml within layouts/application
  [1m[36mCategory Load (2.0ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 1[0m
  [1m[36mPrimitive Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 1[0m
  [1m[36mCategory Load (2.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 1[0m
  [1m[36mUnit Load (1.4ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendered primitives/_listing.html.haml (10.5ms)
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 2[0m
  [1m[36mPrimitive Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 2[0m
  [1m[36mCategory Load (1.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 2[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 2[0m
  Rendered primitives/_listing.html.haml (4.6ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 3[0m
  [1m[36mPrimitive Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 3[0m
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 3[0m
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendered primitives/_listing.html.haml (8.0ms)
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 4[0m
  [1m[36mPrimitive Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 4[0m
  [1m[36mCategory Load (1.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 4[0m
  [1m[36mUnit Load (1.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 5)[0m
  Rendered primitives/_listing.html.haml (4.5ms)
  Rendered primitives/_listing.html.haml (4.7ms)
  [1m[35m (1.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 5[0m
  [1m[36mPrimitive Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 5[0m
  [1m[36mCategory Load (1.1ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 5[0m
  [1m[36mUnit Load (1.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (1, 5)[0m
  Rendered primitives/_listing.html.haml (4.5ms)
  Rendered primitives/_listing.html.haml (4.2ms)
  Rendered primitives/_listing.html.haml (4.2ms)
  [1m[35m (1.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 6[0m
  [1m[36mPrimitive Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 6[0m
  [1m[36mCategory Load (3.0ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 6[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 2[0m
  Rendered primitives/_listing.html.haml (3.5ms)
  Rendered primitives/_listing.html.haml (3.6ms)
  [1m[35m (1.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 7[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 8[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 9[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 10[0m
  [1m[35m (1.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 11[0m
  [1m[35m (1.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 12[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 13[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 14[0m
  [1m[35m (1.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 15[0m
  Rendered primitives/index.html.haml within layouts/application (212.5ms)
  Rendered layouts/_header.html.haml (11.7ms)
Completed 200 OK in 993ms (Views: 839.8ms | ActiveRecord: 38.9ms)


Started GET "/composites" for 127.0.0.1 at 2017-04-27 03:29:32 +0300
Processing by CompositesController#index as HTML
  [1m[36mUser Load (5.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering composites/index.html.haml within layouts/application
  [1m[36mCategory Load (6.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mComposite Load (3.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Composite') AND "constructor_objects"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (1.4ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" IN (2, 1)[0m
  [1m[36mUnit Load (3.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (3, 1)[0m
  Rendered composites/_listing.html.haml (3.4ms)
  Rendered composites/_listing.html.haml (0.7ms)
  Rendered composites/_listing.html.haml (0.5ms)
  Rendered composites/index.html.haml within layouts/application (46.5ms)
  Rendered layouts/_header.html.haml (9.0ms)
Completed 200 OK in 641ms (Views: 606.4ms | ActiveRecord: 24.4ms)


Started DELETE "/composites/13" for 127.0.0.1 at 2017-04-27 03:29:35 +0300
Processing by CompositesController#destroy as HTML
  Parameters: {"authenticity_token"=>"ofVB65Ucf8+9vPJ3Kb1+Wja3jtv97NsrCDQZTs5lyKUtREJiz8R1rphsbodUP34aTSpcON+XK0GyGyaR3XlqtA==", "id"=>"13"}
  [1m[36mComposite Load (6.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Composite') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 13], ["LIMIT", 1]]
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mAudited::Audit Load (1.2ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 13], ["auditable_type", "ConstructorObject"], ["LIMIT", 1]]
  [1m[35mSQL (1.0ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 13], ["auditable_type", "ConstructorObject"], ["user_id", 1], ["user_type", "User"], ["action", "destroy"], ["audited_changes", "---\nname: '123'\nunit_id: 1\ncategory_id: 1\ndate: !ruby/object:ActiveSupport::TimeWithZone\n  utc: 2017-04-27 00:21:42.479386000 Z\n  zone: !ruby/object:ActiveSupport::TimeZone\n    name: Etc/UTC\n  time: 2017-04-27 00:21:42.479386000 Z\ndivisibility: false\ndeleted_at: \nprice_without_work: !ruby/object:BigDecimal 18:0.0\n"], ["version", 2], ["remote_address", "127.0.0.1"], ["request_uuid", "b73802af-a78a-460a-912f-e7b647002667"], ["created_at", 2017-04-27 00:29:35 UTC]]
  [1m[35mSQL (0.9ms)[0m  [1m[33mUPDATE "constructor_objects" SET "deleted_at" = '2017-04-27 00:29:35.941524', "updated_at" = '2017-04-27 00:29:35.941618' WHERE "constructor_objects"."type" IN ('Composite') AND "constructor_objects"."id" = $1[0m  [["id", 13]]
  [1m[35m (3.7ms)[0m  [1m[35mCOMMIT[0m
Redirected to http://localhost:3000/composites
Completed 302 Found in 50ms (ActiveRecord: 14.7ms)


Started GET "/composites" for 127.0.0.1 at 2017-04-27 03:29:35 +0300
Processing by CompositesController#index as HTML
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering composites/index.html.haml within layouts/application
  [1m[36mCategory Load (0.8ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mComposite Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Composite') AND "constructor_objects"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (0.8ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" IN (2, 1)[0m
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (3, 1)[0m
  Rendered composites/_listing.html.haml (3.7ms)
  Rendered composites/_listing.html.haml (1.0ms)
  Rendered composites/index.html.haml within layouts/application (25.8ms)
  Rendered layouts/_header.html.haml (10.7ms)
Completed 200 OK in 827ms (Views: 813.3ms | ActiveRecord: 3.8ms)


DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
  [1m[36mComposite Load (1.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Composite') AND "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 13], ["LIMIT", 1]]
[ActiveJob] [PriceUpdateJob] [d6d2d5a3-0f34-4ac7-8a32-40f83ed3e22e] Performing PriceUpdateJob from Sidekiq(update_price) with arguments: #<GlobalID:0x0055737af99000 @uri=#<URI::GID gid://constructor/Composite/13>>
[ActiveJob] [PriceUpdateJob] [d6d2d5a3-0f34-4ac7-8a32-40f83ed3e22e]   [1m[36mComposition Load (1.0ms)[0m  [1m[34mSELECT "compositions".* FROM "compositions" WHERE "compositions"."deleted_at" IS NULL AND "compositions"."parent_id" = $1[0m  [["parent_id", 13]]
[ActiveJob] [PriceUpdateJob] [d6d2d5a3-0f34-4ac7-8a32-40f83ed3e22e]   [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] [PriceUpdateJob] [d6d2d5a3-0f34-4ac7-8a32-40f83ed3e22e]   [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [PriceUpdateJob] [d6d2d5a3-0f34-4ac7-8a32-40f83ed3e22e]   [1m[36mAudited::Audit Load (3.5ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 13], ["auditable_type", "ConstructorObject"], ["LIMIT", 1]]
[ActiveJob] [PriceUpdateJob] [d6d2d5a3-0f34-4ac7-8a32-40f83ed3e22e]   [1m[35mSQL (1.0ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "action", "audited_changes", "version", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["auditable_id", 13], ["auditable_type", "ConstructorObject"], ["action", "update"], ["audited_changes", "---\nprice_without_work:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.12E3\n"], ["version", 3], ["request_uuid", "666d3678-c8e6-40c6-b8a0-de90c08b9d5a"], ["created_at", 2017-04-27 00:29:55 UTC]]
[ActiveJob] [PriceUpdateJob] [d6d2d5a3-0f34-4ac7-8a32-40f83ed3e22e]   [1m[35mSQL (0.8ms)[0m  [1m[33mUPDATE "constructor_objects" SET "price" = $1, "price_without_work" = $2, "updated_at" = $3 WHERE "constructor_objects"."id" = $4[0m  [["price", #<BigDecimal:55737b5e3208,'0.12E3',9(18)>], ["price_without_work", #<BigDecimal:55737b5e2fb0,'0.12E3',9(18)>], ["updated_at", 2017-04-27 00:29:55 UTC], ["id", 13]]
[ActiveJob] [PriceUpdateJob] [d6d2d5a3-0f34-4ac7-8a32-40f83ed3e22e]   [1m[35m (2.6ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [PriceUpdateJob] [d6d2d5a3-0f34-4ac7-8a32-40f83ed3e22e]   [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" INNER JOIN "compositions" ON "constructor_objects"."id" = "compositions"."parent_id" WHERE "compositions"."children_id" = $1[0m  [["children_id", 13]]
[ActiveJob] [PriceUpdateJob] [d6d2d5a3-0f34-4ac7-8a32-40f83ed3e22e] Performed PriceUpdateJob from Sidekiq(update_price) in 172.92ms
Started GET "/composites/new" for 127.0.0.1 at 2017-04-27 03:29:58 +0300
Processing by CompositesController#new as HTML
  [1m[36mUser Load (1.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering composites/new.html.haml within layouts/application
  [1m[36mUnit Load (3.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (0.9ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  Rendered composites/_composition_fields.html.haml (7.7ms)
  Rendered composites/_form.html.haml (68.4ms)
  Rendered composites/new.html.haml within layouts/application (75.5ms)
  Rendered layouts/_header.html.haml (13.6ms)
Completed 200 OK in 810ms (Views: 787.6ms | ActiveRecord: 9.7ms)


Started GET "/constructor_objects/autocomplete_constructor_object_name?term=%D0%9F%D1%80" for 127.0.0.1 at 2017-04-27 03:30:13 +0300
Processing by ConstructorObjectsController#autocomplete_constructor_object_name as JSON
  Parameters: {"term"=>"Пр"}
  [1m[36mConstructorObject Load (1.7ms)[0m  [1m[34mSELECT  constructor_objects.id, constructor_objects.name FROM "constructor_objects" WHERE (LOWER(constructor_objects.name) ILIKE 'пр%') ORDER BY constructor_objects.name ASC LIMIT $1[0m  [["LIMIT", 10]]
Completed 200 OK in 6ms (Views: 0.8ms | ActiveRecord: 1.7ms)


Started GET "/constructor_objects/info?id=6" for 127.0.0.1 at 2017-04-27 03:30:15 +0300
Processing by ConstructorObjectsController#info as JSON
  Parameters: {"id"=>"6"}
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUnit Load (2.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
Completed 200 OK in 13ms (Views: 0.2ms | ActiveRecord: 3.5ms)


Started POST "/composites" for 127.0.0.1 at 2017-04-27 03:30:18 +0300
Processing by CompositesController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"1C8kcbGLF54eFWJAAuUUAgIKK9SOcdPTsPWLl0gxsX9Ynif461Md/zvF/rB/ZxRCeZf5N6wKI7kK2rRIWy0Tbg==", "commit"=>"Сохранить", "composite"=>{"name"=>"Объект 3", "unit_id"=>"2", "category_id"=>"3", "divisibility"=>"0", "compositions_attributes"=>{"1493253015513"=>{"children_id"=>"6", "value"=>"10", "_destroy"=>"false"}}}, "search_id"=>"6", "search"=>""}
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mConstructorObject Load (1.2ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" INNER JOIN "compositions" ON "constructor_objects"."id" = "compositions"."children_id" WHERE "compositions"."parent_id" = $1[0m  [["parent_id", 6]]
  [1m[36mConstructorObject Load (0.5ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" INNER JOIN "compositions" ON "constructor_objects"."id" = "compositions"."parent_id" WHERE "compositions"."children_id" = $1[0m  [["children_id", 6]]
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "constructor_objects" ("name", "unit_id", "category_id", "date", "created_at", "updated_at", "type") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["name", "Объект 3"], ["unit_id", 2], ["category_id", 3], ["date", 2017-04-27 00:30:18 UTC], ["created_at", 2017-04-27 00:30:18 UTC], ["updated_at", 2017-04-27 00:30:18 UTC], ["type", "Composite"]]
  [1m[35mSQL (1.1ms)[0m  [1m[32mINSERT INTO "compositions" ("parent_id", "children_id", "value") VALUES ($1, $2, $3) RETURNING "id"[0m  [["parent_id", 14], ["children_id", 6], ["value", 10]]
  [1m[36mAudited::Audit Load (1.2ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 14], ["auditable_type", "ConstructorObject"], ["LIMIT", 1]]
  [1m[35mSQL (1.5ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 14], ["auditable_type", "ConstructorObject"], ["user_id", 1], ["user_type", "User"], ["action", "create"], ["audited_changes", "---\nname: Объект 3\nunit_id: 2\ncategory_id: 3\ndate: !ruby/object:ActiveSupport::TimeWithZone\n  utc: 2017-04-27 00:30:18.233926348 Z\n  zone: !ruby/object:ActiveSupport::TimeZone\n    name: Etc/UTC\n  time: 2017-04-27 00:30:18.233926348 Z\ndivisibility: false\ndeleted_at: \nprice_without_work: !ruby/object:BigDecimal 18:0.0\n"], ["version", 1], ["remote_address", "127.0.0.1"], ["request_uuid", "867babcc-6bd0-4a0f-8dd4-9934a843e1c9"], ["created_at", 2017-04-27 00:30:18 UTC]]
  [1m[35m (16.0ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] Enqueued PriceUpdateJob (Job ID: 4c36b6c2-3c9e-4dec-8969-10a8bbfa7221) to Sidekiq(update_price) with arguments: #<GlobalID:0x00562b08ce4cd8 @uri=#<URI::GID gid://constructor/Composite/14>>
Redirected to http://localhost:3000/composites
Completed 302 Found in 101ms (ActiveRecord: 23.8ms)


  [1m[36mComposite Load (0.5ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Composite') AND "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 14], ["LIMIT", 1]]
[ActiveJob] [PriceUpdateJob] [4c36b6c2-3c9e-4dec-8969-10a8bbfa7221] Performing PriceUpdateJob from Sidekiq(update_price) with arguments: #<GlobalID:0x0055737bf2caa8 @uri=#<URI::GID gid://constructor/Composite/14>>
[ActiveJob] [PriceUpdateJob] [4c36b6c2-3c9e-4dec-8969-10a8bbfa7221]   [1m[36mComposition Load (1.3ms)[0m  [1m[34mSELECT "compositions".* FROM "compositions" WHERE "compositions"."deleted_at" IS NULL AND "compositions"."parent_id" = $1[0m  [["parent_id", 14]]
[ActiveJob] [PriceUpdateJob] [4c36b6c2-3c9e-4dec-8969-10a8bbfa7221]   [1m[36mConstructorObject Load (2.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
[ActiveJob] [PriceUpdateJob] [4c36b6c2-3c9e-4dec-8969-10a8bbfa7221]   [1m[35m (1.2ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [PriceUpdateJob] [4c36b6c2-3c9e-4dec-8969-10a8bbfa7221]   [1m[36mAudited::Audit Load (1.9ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 14], ["auditable_type", "ConstructorObject"], ["LIMIT", 1]]
[ActiveJob] [PriceUpdateJob] [4c36b6c2-3c9e-4dec-8969-10a8bbfa7221]   [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "action", "audited_changes", "version", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["auditable_id", 14], ["auditable_type", "ConstructorObject"], ["action", "update"], ["audited_changes", "---\nprice_without_work:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.6E3\n"], ["version", 2], ["request_uuid", "8233f572-2218-480e-a6ab-881ef01be25b"], ["created_at", 2017-04-27 00:30:18 UTC]]
Started GET "/composites" for 127.0.0.1 at 2017-04-27 03:30:18 +0300
Processing by CompositesController#index as HTML
[ActiveJob] [PriceUpdateJob] [4c36b6c2-3c9e-4dec-8969-10a8bbfa7221]   [1m[35mSQL (4.4ms)[0m  [1m[33mUPDATE "constructor_objects" SET "price" = $1, "price_without_work" = $2, "updated_at" = $3 WHERE "constructor_objects"."id" = $4[0m  [["price", #<BigDecimal:7fe88c0c3ba0,'0.6E3',9(18)>], ["price_without_work", #<BigDecimal:7fe88c0c3ad8,'0.6E3',9(18)>], ["updated_at", 2017-04-27 00:30:18 UTC], ["id", 14]]
[ActiveJob] [PriceUpdateJob] [4c36b6c2-3c9e-4dec-8969-10a8bbfa7221]   [1m[35m (1.4ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [PriceUpdateJob] [4c36b6c2-3c9e-4dec-8969-10a8bbfa7221]   [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" INNER JOIN "compositions" ON "constructor_objects"."id" = "compositions"."parent_id" WHERE "compositions"."children_id" = $1[0m  [["children_id", 14]]
[ActiveJob] [PriceUpdateJob] [4c36b6c2-3c9e-4dec-8969-10a8bbfa7221] Performed PriceUpdateJob from Sidekiq(update_price) in 42.59ms
  [1m[36mUser Load (15.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering composites/index.html.haml within layouts/application
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mComposite Load (0.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Composite') AND "constructor_objects"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" IN (2, 1, 3)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (3, 1, 2)[0m
  Rendered composites/_listing.html.haml (3.6ms)
  Rendered composites/_listing.html.haml (0.7ms)
  Rendered composites/_listing.html.haml (0.6ms)
  Rendered composites/index.html.haml within layouts/application (25.7ms)
  Rendered layouts/_header.html.haml (10.6ms)
Completed 200 OK in 618ms (Views: 592.9ms | ActiveRecord: 18.1ms)


Started GET "/composites/14/edit" for 127.0.0.1 at 2017-04-27 03:30:22 +0300
Processing by CompositesController#edit as HTML
  Parameters: {"id"=>"14"}
  [1m[36mComposite Load (3.5ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Composite') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 14], ["LIMIT", 1]]
  [1m[36mUser Load (2.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering composites/edit.html.haml within layouts/application
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  Rendered composites/_composition_fields.html.haml (10.0ms)
  [1m[36mComposition Load (0.6ms)[0m  [1m[34mSELECT "compositions".* FROM "compositions" WHERE "compositions"."deleted_at" IS NULL AND "compositions"."parent_id" = $1[0m  [["parent_id", 14]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  Rendered composites/_composition_fields.html.haml (11.6ms)
  Rendered composites/_form.html.haml (66.6ms)
  Rendered composites/edit.html.haml within layouts/application (73.3ms)
  Rendered layouts/_header.html.haml (23.3ms)
Completed 200 OK in 825ms (Views: 804.9ms | ActiveRecord: 9.1ms)


  [1m[36mComposite Load (1.3ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Composite') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 14], ["LIMIT", 1]]
Started PATCH "/composites/14" for 127.0.0.1 at 2017-04-27 03:31:37 +0300
Processing by CompositesController#update as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"FrBF5IVKI23UfVW1+1+7H3dkbJ9fROsb+zXN4gxLFXuaAUZt35IpDPGtyUWG3btfDPm+fH0/G3FBGvI9H1e3ag==", "commit"=>"Сохранить", "composite"=>{"name"=>"Объект 3", "unit_id"=>"2", "category_id"=>"3", "divisibility"=>"0", "compositions_attributes"=>{"0"=>{"children_id"=>"6", "value"=>"10", "_destroy"=>"1", "id"=>"4"}}}, "search_id"=>"", "search"=>"", "id"=>"14"}
  [1m[36mComposite Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Composite') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 14], ["LIMIT", 1]]
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mComposition Load (0.9ms)[0m  [1m[34mSELECT "compositions".* FROM "compositions" WHERE "compositions"."deleted_at" IS NULL AND "compositions"."parent_id" = $1 AND "compositions"."id" = 4[0m  [["parent_id", 14]]
  [1m[35mSQL (0.8ms)[0m  [1m[33mUPDATE "compositions" SET "deleted_at" = '2017-04-27 00:31:38.150639' WHERE "compositions"."id" = $1[0m  [["id", 4]]
  [1m[35m (1.6ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] Enqueued PriceUpdateJob (Job ID: b3785914-d2df-4ae8-b0be-82e8976de055) to Sidekiq(update_price) with arguments: #<GlobalID:0x007f22e8eb61a0 @uri=#<URI::GID gid://constructor/Composite/14>>
Redirected to http://localhost:3000/composites
Completed 302 Found in 193ms (ActiveRecord: 26.9ms)


Started GET "/composites" for 127.0.0.1 at 2017-04-27 03:31:38 +0300
Processing by CompositesController#index as HTML
  [1m[36mUser Load (1.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering composites/index.html.haml within layouts/application
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mComposite Load (6.4ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Composite') AND "constructor_objects"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (5.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" IN (2, 1, 3)[0m
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (3, 1, 2)[0m
  [1m[36mComposite Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Composite') AND "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 14], ["LIMIT", 1]]
[ActiveJob] [PriceUpdateJob] [b3785914-d2df-4ae8-b0be-82e8976de055] Performing PriceUpdateJob from Sidekiq(update_price) with arguments: #<GlobalID:0x007fe88c7522a0 @uri=#<URI::GID gid://constructor/Composite/14>>
  Rendered composites/_listing.html.haml (9.5ms)
  Rendered composites/_listing.html.haml (0.7ms)
  Rendered composites/_listing.html.haml (0.7ms)
  Rendered composites/index.html.haml within layouts/application (93.6ms)
[ActiveJob] [PriceUpdateJob] [b3785914-d2df-4ae8-b0be-82e8976de055]   [1m[36mComposition Load (0.5ms)[0m  [1m[34mSELECT "compositions".* FROM "compositions" WHERE "compositions"."deleted_at" IS NULL AND "compositions"."parent_id" = $1[0m  [["parent_id", 14]]
[ActiveJob] [PriceUpdateJob] [b3785914-d2df-4ae8-b0be-82e8976de055]   [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [PriceUpdateJob] [b3785914-d2df-4ae8-b0be-82e8976de055]   [1m[36mAudited::Audit Load (1.3ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 14], ["auditable_type", "ConstructorObject"], ["LIMIT", 1]]
[ActiveJob] [PriceUpdateJob] [b3785914-d2df-4ae8-b0be-82e8976de055]   [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "action", "audited_changes", "version", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["auditable_id", 14], ["auditable_type", "ConstructorObject"], ["action", "update"], ["audited_changes", "---\nprice_without_work:\n- !ruby/object:BigDecimal 18:0.6E3\n- !ruby/object:BigDecimal 18:0.0\n"], ["version", 3], ["request_uuid", "7569e54d-2128-4321-a248-49c60b3e5074"], ["created_at", 2017-04-27 00:31:38 UTC]]
[ActiveJob] [PriceUpdateJob] [b3785914-d2df-4ae8-b0be-82e8976de055]   [1m[35mSQL (0.6ms)[0m  [1m[33mUPDATE "constructor_objects" SET "price" = $1, "price_without_work" = $2, "updated_at" = $3 WHERE "constructor_objects"."id" = $4[0m  [["price", #<BigDecimal:55737946c318,'0.0',9(27)>], ["price_without_work", #<BigDecimal:7fe88c7d3ee0,'0.0',9(27)>], ["updated_at", 2017-04-27 00:31:38 UTC], ["id", 14]]
[ActiveJob] [PriceUpdateJob] [b3785914-d2df-4ae8-b0be-82e8976de055]   [1m[35m (7.7ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [PriceUpdateJob] [b3785914-d2df-4ae8-b0be-82e8976de055]   [1m[36mConstructorObject Load (1.1ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" INNER JOIN "compositions" ON "constructor_objects"."id" = "compositions"."parent_id" WHERE "compositions"."children_id" = $1[0m  [["children_id", 14]]
[ActiveJob] [PriceUpdateJob] [b3785914-d2df-4ae8-b0be-82e8976de055] Performed PriceUpdateJob from Sidekiq(update_price) in 59.22ms
  Rendered layouts/_header.html.haml (18.3ms)
Completed 200 OK in 723ms (Views: 687.7ms | ActiveRecord: 27.7ms)


Started GET "/composites" for 127.0.0.1 at 2017-04-27 03:31:51 +0300
Processing by CompositesController#index as HTML
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering composites/index.html.haml within layouts/application
  [1m[36mCategory Load (0.8ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mComposite Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Composite') AND "constructor_objects"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" IN (2, 1, 3)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (3, 1, 2)[0m
  Rendered composites/_listing.html.haml (4.0ms)
  Rendered composites/_listing.html.haml (0.7ms)
  Rendered composites/_listing.html.haml (0.8ms)
  Rendered composites/index.html.haml within layouts/application (25.7ms)
  Rendered layouts/_header.html.haml (8.2ms)
Completed 200 OK in 637ms (Views: 627.2ms | ActiveRecord: 3.6ms)


Started GET "/composites/14/edit" for 127.0.0.1 at 2017-04-27 03:31:55 +0300
Processing by CompositesController#edit as HTML
  Parameters: {"id"=>"14"}
  [1m[36mComposite Load (1.3ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Composite') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 14], ["LIMIT", 1]]
  [1m[36mUser Load (1.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering composites/edit.html.haml within layouts/application
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (2.3ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  Rendered composites/_composition_fields.html.haml (10.2ms)
  [1m[36mComposition Load (2.1ms)[0m  [1m[34mSELECT "compositions".* FROM "compositions" WHERE "compositions"."deleted_at" IS NULL AND "compositions"."parent_id" = $1[0m  [["parent_id", 14]]
  Rendered composites/_form.html.haml (44.6ms)
  Rendered composites/edit.html.haml within layouts/application (48.5ms)
  Rendered layouts/_header.html.haml (8.9ms)
Completed 200 OK in 624ms (Views: 610.1ms | ActiveRecord: 8.1ms)


Started GET "/constructor_objects/autocomplete_constructor_object_name?term=Ghb" for 127.0.0.1 at 2017-04-27 03:32:13 +0300
Processing by ConstructorObjectsController#autocomplete_constructor_object_name as JSON
  Parameters: {"term"=>"Ghb"}
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  constructor_objects.id, constructor_objects.name FROM "constructor_objects" WHERE (LOWER(constructor_objects.name) ILIKE 'ghb%') ORDER BY constructor_objects.name ASC LIMIT $1[0m  [["LIMIT", 10]]
Completed 200 OK in 29ms (Views: 0.2ms | ActiveRecord: 5.8ms)


Started GET "/constructor_objects/autocomplete_constructor_object_name?term=%D0%9F%D1%80" for 127.0.0.1 at 2017-04-27 03:32:14 +0300
Processing by ConstructorObjectsController#autocomplete_constructor_object_name as JSON
  Parameters: {"term"=>"Пр"}
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  constructor_objects.id, constructor_objects.name FROM "constructor_objects" WHERE (LOWER(constructor_objects.name) ILIKE 'пр%') ORDER BY constructor_objects.name ASC LIMIT $1[0m  [["LIMIT", 10]]
Completed 200 OK in 14ms (Views: 0.5ms | ActiveRecord: 0.8ms)


Started GET "/constructor_objects/autocomplete_constructor_object_name?term=%D0%9F%D1%80%D0%B8" for 127.0.0.1 at 2017-04-27 03:32:15 +0300
Processing by ConstructorObjectsController#autocomplete_constructor_object_name as JSON
  Parameters: {"term"=>"При"}
  [1m[36mConstructorObject Load (1.6ms)[0m  [1m[34mSELECT  constructor_objects.id, constructor_objects.name FROM "constructor_objects" WHERE (LOWER(constructor_objects.name) ILIKE 'при%') ORDER BY constructor_objects.name ASC LIMIT $1[0m  [["LIMIT", 10]]
Completed 200 OK in 6ms (Views: 0.8ms | ActiveRecord: 1.6ms)


Started GET "/constructor_objects/info?id=6" for 127.0.0.1 at 2017-04-27 03:32:18 +0300
Processing by ConstructorObjectsController#info as JSON
  Parameters: {"id"=>"6"}
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
Completed 200 OK in 41ms (Views: 0.3ms | ActiveRecord: 1.4ms)


Started PATCH "/composites/14" for 127.0.0.1 at 2017-04-27 03:32:20 +0300
Processing by CompositesController#update as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"1df/D7BAtsKCtGCzn5pvr6dzLrjMlEPTGKtipz9pJE9ZZvyG6pi8o6dk/EPiGG/v3O78W+7vs7mihF14LHWGXg==", "commit"=>"Сохранить", "composite"=>{"name"=>"Объект 3", "unit_id"=>"2", "category_id"=>"3", "divisibility"=>"0", "compositions_attributes"=>{"1493253138207"=>{"children_id"=>"6", "value"=>"10", "_destroy"=>"false"}}}, "search_id"=>"6", "search"=>"", "id"=>"14"}
  [1m[36mComposite Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Composite') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 14], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (10.9ms)[0m  [1m[35mBEGIN[0m
  [1m[36mConstructorObject Load (1.1ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.4ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" INNER JOIN "compositions" ON "constructor_objects"."id" = "compositions"."children_id" WHERE "compositions"."parent_id" = $1[0m  [["parent_id", 6]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" INNER JOIN "compositions" ON "constructor_objects"."id" = "compositions"."parent_id" WHERE "compositions"."children_id" = $1[0m  [["children_id", 6]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" INNER JOIN "compositions" ON "constructor_objects"."id" = "compositions"."parent_id" WHERE "compositions"."children_id" = $1[0m  [["children_id", 14]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 14], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "compositions" ("parent_id", "children_id", "value") VALUES ($1, $2, $3) RETURNING "id"[0m  [["parent_id", 14], ["children_id", 6], ["value", 10]]
  [1m[35m (4.3ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] Enqueued PriceUpdateJob (Job ID: a7e2ac6f-65dc-4456-907a-5488fab28d9a) to Sidekiq(update_price) with arguments: #<GlobalID:0x007f22df194138 @uri=#<URI::GID gid://constructor/Composite/14>>
Redirected to http://localhost:3000/composites
Completed 302 Found in 181ms (ActiveRecord: 29.9ms)


Started GET "/composites" for 127.0.0.1 at 2017-04-27 03:32:20 +0300
Processing by CompositesController#index as HTML
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering composites/index.html.haml within layouts/application
  [1m[36mCategory Load (3.4ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mComposite Load (4.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Composite') AND "constructor_objects"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" IN (2, 1, 3)[0m
  [1m[36mUnit Load (4.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (3, 1, 2)[0m
  Rendered composites/_listing.html.haml (6.0ms)
  Rendered composites/_listing.html.haml (0.8ms)
  Rendered composites/_listing.html.haml (0.7ms)
  Rendered composites/index.html.haml within layouts/application (80.7ms)
  [1m[36mComposite Load (1.0ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Composite') AND "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 14], ["LIMIT", 1]]
[ActiveJob] [PriceUpdateJob] [a7e2ac6f-65dc-4456-907a-5488fab28d9a] Performing PriceUpdateJob from Sidekiq(update_price) with arguments: #<GlobalID:0x007fe88012ccb0 @uri=#<URI::GID gid://constructor/Composite/14>>
  Rendered layouts/_header.html.haml (16.5ms)
Completed 200 OK in 841ms (Views: 818.1ms | ActiveRecord: 13.7ms)


[ActiveJob] [PriceUpdateJob] [a7e2ac6f-65dc-4456-907a-5488fab28d9a]   [1m[36mComposition Load (654.9ms)[0m  [1m[34mSELECT "compositions".* FROM "compositions" WHERE "compositions"."deleted_at" IS NULL AND "compositions"."parent_id" = $1[0m  [["parent_id", 14]]
[ActiveJob] [PriceUpdateJob] [a7e2ac6f-65dc-4456-907a-5488fab28d9a]   [1m[36mConstructorObject Load (78.3ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
[ActiveJob] [PriceUpdateJob] [a7e2ac6f-65dc-4456-907a-5488fab28d9a]   [1m[35m (4.7ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [PriceUpdateJob] [a7e2ac6f-65dc-4456-907a-5488fab28d9a]   [1m[36mAudited::Audit Load (1.9ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 14], ["auditable_type", "ConstructorObject"], ["LIMIT", 1]]
[ActiveJob] [PriceUpdateJob] [a7e2ac6f-65dc-4456-907a-5488fab28d9a]   [1m[35mSQL (3.1ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "action", "audited_changes", "version", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["auditable_id", 14], ["auditable_type", "ConstructorObject"], ["action", "update"], ["audited_changes", "---\nprice_without_work:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.6E3\n"], ["version", 4], ["request_uuid", "4de3275e-3874-43f5-8ea3-122eb67f0dee"], ["created_at", 2017-04-27 00:34:58 UTC]]
[ActiveJob] [PriceUpdateJob] [a7e2ac6f-65dc-4456-907a-5488fab28d9a]   [1m[35mSQL (0.6ms)[0m  [1m[33mUPDATE "constructor_objects" SET "price" = $1, "price_without_work" = $2, "updated_at" = $3 WHERE "constructor_objects"."id" = $4[0m  [["price", #<BigDecimal:557378c884a8,'0.6E3',9(18)>], ["price_without_work", #<BigDecimal:557378c87eb8,'0.6E3',9(18)>], ["updated_at", 2017-04-27 00:34:58 UTC], ["id", 14]]
[ActiveJob] [PriceUpdateJob] [a7e2ac6f-65dc-4456-907a-5488fab28d9a]   [1m[35m (1.3ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [PriceUpdateJob] [a7e2ac6f-65dc-4456-907a-5488fab28d9a]   [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" INNER JOIN "compositions" ON "constructor_objects"."id" = "compositions"."parent_id" WHERE "compositions"."children_id" = $1[0m  [["children_id", 14]]
[ActiveJob] [PriceUpdateJob] [a7e2ac6f-65dc-4456-907a-5488fab28d9a] Performed PriceUpdateJob from Sidekiq(update_price) in 157660.29ms
Started GET "/composites" for 127.0.0.1 at 2017-04-27 03:35:09 +0300
Processing by CompositesController#index as HTML
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering composites/index.html.haml within layouts/application
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mComposite Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Composite') AND "constructor_objects"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" IN (2, 1, 3)[0m
  [1m[36mUnit Load (1.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (3, 1, 2)[0m
  Rendered composites/_listing.html.haml (4.3ms)
  Rendered composites/_listing.html.haml (1.1ms)
  Rendered composites/_listing.html.haml (0.8ms)
  Rendered composites/index.html.haml within layouts/application (79.0ms)
  Rendered layouts/_header.html.haml (15.4ms)
Completed 200 OK in 797ms (Views: 682.5ms | ActiveRecord: 22.8ms)


Started GET "/composites" for 127.0.0.1 at 2017-04-27 03:35:19 +0300
Processing by CompositesController#index as HTML
  [1m[36mUser Load (2.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering composites/index.html.haml within layouts/application
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mComposite Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Composite') AND "constructor_objects"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (0.8ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" IN (2, 1, 3)[0m
  [1m[36mUnit Load (2.4ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (3, 1, 2)[0m
  Rendered composites/_listing.html.haml (5.7ms)
  Rendered composites/_listing.html.haml (0.7ms)
  Rendered composites/_listing.html.haml (0.6ms)
  Rendered composites/index.html.haml within layouts/application (59.5ms)
  Rendered layouts/_header.html.haml (11.6ms)
Completed 200 OK in 783ms (Views: 697.8ms | ActiveRecord: 6.7ms)


Started GET "/composites/14/edit" for 127.0.0.1 at 2017-04-27 03:35:21 +0300
Processing by CompositesController#edit as HTML
  Parameters: {"id"=>"14"}
  [1m[36mComposite Load (1.4ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Composite') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 14], ["LIMIT", 1]]
  [1m[36mUser Load (1.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering composites/edit.html.haml within layouts/application
  [1m[36mUnit Load (1.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (2.4ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  Rendered composites/_composition_fields.html.haml (4.9ms)
  [1m[36mComposition Load (0.6ms)[0m  [1m[34mSELECT "compositions".* FROM "compositions" WHERE "compositions"."deleted_at" IS NULL AND "compositions"."parent_id" = $1[0m  [["parent_id", 14]]
  [1m[36mConstructorObject Load (11.0ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  Rendered composites/_composition_fields.html.haml (34.2ms)
  Rendered composites/_form.html.haml (106.2ms)
  Rendered composites/edit.html.haml within layouts/application (112.8ms)
  Rendered layouts/_header.html.haml (8.6ms)
Completed 200 OK in 759ms (Views: 722.5ms | ActiveRecord: 25.4ms)


Started PATCH "/composites/14" for 127.0.0.1 at 2017-04-27 03:35:26 +0300
Processing by CompositesController#update as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"Gk7zZ+aLzCkajn6eUp8p5MWXN+p7zEOhWPtr5m6JwaiW//DuvFPGSD9e4m4vHSmkvgrlCVm3s8vi1FQ5fZVjuQ==", "commit"=>"Сохранить", "composite"=>{"name"=>"Объект 3", "unit_id"=>"2", "category_id"=>"3", "divisibility"=>"0", "compositions_attributes"=>{"0"=>{"children_id"=>"6", "value"=>"5", "_destroy"=>"false", "id"=>"5"}}}, "search_id"=>"", "search"=>"", "id"=>"14"}
  [1m[36mComposite Load (3.5ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Composite') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 14], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mComposition Load (0.9ms)[0m  [1m[34mSELECT "compositions".* FROM "compositions" WHERE "compositions"."deleted_at" IS NULL AND "compositions"."parent_id" = $1 AND "compositions"."id" = 5[0m  [["parent_id", 14]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" INNER JOIN "compositions" ON "constructor_objects"."id" = "compositions"."children_id" WHERE "compositions"."parent_id" = $1[0m  [["parent_id", 6]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" INNER JOIN "compositions" ON "constructor_objects"."id" = "compositions"."parent_id" WHERE "compositions"."children_id" = $1[0m  [["children_id", 6]]
  [1m[36mConstructorObject Load (2.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" INNER JOIN "compositions" ON "constructor_objects"."id" = "compositions"."parent_id" WHERE "compositions"."children_id" = $1[0m  [["children_id", 14]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" INNER JOIN "compositions" ON "constructor_objects"."id" = "compositions"."parent_id" WHERE "compositions"."children_id" = $1[0m  [["children_id", 14]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 14], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[33mUPDATE "compositions" SET "value" = $1 WHERE "compositions"."id" = $2[0m  [["value", 5], ["id", 5]]
  [1m[35m (1.3ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] Enqueued PriceUpdateJob (Job ID: b3cc1bbb-ed8c-4e5a-aa61-2e91fcbbf1ad) to Sidekiq(update_price) with arguments: #<GlobalID:0x007f22dd508a28 @uri=#<URI::GID gid://constructor/Composite/14>>
Redirected to http://localhost:3000/composites
Completed 302 Found in 78ms (ActiveRecord: 12.9ms)


Started GET "/composites" for 127.0.0.1 at 2017-04-27 03:35:26 +0300
Processing by CompositesController#index as HTML
  [1m[36mUser Load (2.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering composites/index.html.haml within layouts/application
  [1m[36mCategory Load (2.3ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mComposite Load (1.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Composite') AND "constructor_objects"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (0.8ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" IN (2, 1, 3)[0m
  [1m[36mUnit Load (1.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (3, 1, 2)[0m
  Rendered composites/_listing.html.haml (7.7ms)
  Rendered composites/_listing.html.haml (0.7ms)
  Rendered composites/_listing.html.haml (0.8ms)
  Rendered composites/index.html.haml within layouts/application (42.3ms)
  [1m[36mComposite Load (3.5ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Composite') AND "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 14], ["LIMIT", 1]]
[ActiveJob] [PriceUpdateJob] [b3cc1bbb-ed8c-4e5a-aa61-2e91fcbbf1ad] Performing PriceUpdateJob from Sidekiq(update_price) with arguments: #<GlobalID:0x007fe8b12db210 @uri=#<URI::GID gid://constructor/Composite/14>>
[ActiveJob] [PriceUpdateJob] [b3cc1bbb-ed8c-4e5a-aa61-2e91fcbbf1ad]   [1m[36mComposition Load (1.0ms)[0m  [1m[34mSELECT "compositions".* FROM "compositions" WHERE "compositions"."deleted_at" IS NULL AND "compositions"."parent_id" = $1[0m  [["parent_id", 14]]
[ActiveJob] [PriceUpdateJob] [b3cc1bbb-ed8c-4e5a-aa61-2e91fcbbf1ad]   [1m[36mConstructorObject Load (1.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
[ActiveJob] [PriceUpdateJob] [b3cc1bbb-ed8c-4e5a-aa61-2e91fcbbf1ad]   [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] [PriceUpdateJob] [b3cc1bbb-ed8c-4e5a-aa61-2e91fcbbf1ad]   [1m[36mAudited::Audit Load (0.8ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 14], ["auditable_type", "ConstructorObject"], ["LIMIT", 1]]
[ActiveJob] [PriceUpdateJob] [b3cc1bbb-ed8c-4e5a-aa61-2e91fcbbf1ad]   [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "action", "audited_changes", "version", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["auditable_id", 14], ["auditable_type", "ConstructorObject"], ["action", "update"], ["audited_changes", "---\nprice_without_work:\n- !ruby/object:BigDecimal 18:0.6E3\n- !ruby/object:BigDecimal 18:0.0\n"], ["version", 5], ["request_uuid", "34337a85-3fb3-486d-893c-fa543bc66f01"], ["created_at", 2017-04-27 00:35:26 UTC]]
[ActiveJob] [PriceUpdateJob] [b3cc1bbb-ed8c-4e5a-aa61-2e91fcbbf1ad]   [1m[35mSQL (0.5ms)[0m  [1m[33mUPDATE "constructor_objects" SET "price" = $1, "price_without_work" = $2, "updated_at" = $3 WHERE "constructor_objects"."id" = $4[0m  [["price", #<BigDecimal:7fe8b110b6d8,'0.3E3',9(18)>], ["price_without_work", #<BigDecimal:7fe8b110b598,'0.0',9(27)>], ["updated_at", 2017-04-27 00:35:26 UTC], ["id", 14]]
[ActiveJob] [PriceUpdateJob] [b3cc1bbb-ed8c-4e5a-aa61-2e91fcbbf1ad]   [1m[35m (1.5ms)[0m  [1m[35mCOMMIT[0m
[ActiveJob] [PriceUpdateJob] [b3cc1bbb-ed8c-4e5a-aa61-2e91fcbbf1ad]   [1m[36mConstructorObject Load (0.5ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" INNER JOIN "compositions" ON "constructor_objects"."id" = "compositions"."parent_id" WHERE "compositions"."children_id" = $1[0m  [["children_id", 14]]
[ActiveJob] [PriceUpdateJob] [b3cc1bbb-ed8c-4e5a-aa61-2e91fcbbf1ad] Performed PriceUpdateJob from Sidekiq(update_price) in 77.39ms
  Rendered layouts/_header.html.haml (17.7ms)
Completed 200 OK in 677ms (Views: 664.1ms | ActiveRecord: 8.9ms)


Started GET "/composites" for 127.0.0.1 at 2017-04-27 03:35:31 +0300
Processing by CompositesController#index as HTML
  [1m[36mUser Load (4.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering composites/index.html.haml within layouts/application
  [1m[36mCategory Load (2.4ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mComposite Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Composite') AND "constructor_objects"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" IN (2, 1, 3)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (3, 1, 2)[0m
  Rendered composites/_listing.html.haml (3.3ms)
  Rendered composites/_listing.html.haml (0.7ms)
  Rendered composites/_listing.html.haml (0.8ms)
  Rendered composites/index.html.haml within layouts/application (35.9ms)
  Rendered layouts/_header.html.haml (9.9ms)
Completed 200 OK in 672ms (Views: 658.2ms | ActiveRecord: 8.4ms)


  [1m[36mComposite Load (1.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Composite') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 14], ["LIMIT", 1]]
Started GET "/products" for 127.0.0.1 at 2017-04-27 03:36:38 +0300
Processing by ProductsController#index as HTML
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering products/index.html.haml within layouts/application
  [1m[36mCategory Load (1.1ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", true]]
  [1m[36mProduct Load (8.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" IN (9, 12, 10)[0m
  [1m[36mUnit Load (1.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (1, 3, 5)[0m
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 1[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 2[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 3[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 4[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 5[0m
  [1m[35m (1.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 6[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 7[0m
  [1m[35m (2.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 8[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 9[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 9[0m
  [1m[36mCategory Load (0.9ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 9[0m
  [1m[36mUnit Load (1.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  Rendered products/_listing.html.haml (11.3ms)
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 10[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 10[0m
  [1m[36mCategory Load (2.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 10[0m
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  Rendered products/_listing.html.haml (1.3ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 11[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 12[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 12[0m
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 12[0m
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  Rendered products/_listing.html.haml (1.0ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 13[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 14[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 15[0m
  Rendered products/index.html.haml within layouts/application (124.8ms)
  Rendered layouts/_header.html.haml (11.1ms)
Completed 200 OK in 735ms (Views: 685.6ms | ActiveRecord: 37.9ms)


Started GET "/products/1/edit" for 127.0.0.1 at 2017-04-27 03:36:43 +0300
Processing by ProductsController#edit as HTML
  Parameters: {"id"=>"1"}
  [1m[36mProduct Load (2.1ms)[0m  [1m[34mSELECT  "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (3.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mProductComposition Load (3.1ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  Rendering products/edit.html.haml within layouts/application
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", true]]
  Rendered products/_custom_product_false.haml (7.4ms)
  Rendered products/_custom_product_templates.haml (14.2ms)
  Rendered products/_custom_product_sets.haml (9.3ms)
  Rendered products/_custom_product_true.haml (29.1ms)
  Rendered products/_form.html.haml (74.0ms)
  Rendered products/edit.html.haml within layouts/application (79.6ms)
  Rendered layouts/_header.html.haml (11.0ms)
Completed 200 OK in 675ms (Views: 609.4ms | ActiveRecord: 15.1ms)


Started GET "/products" for 127.0.0.1 at 2017-04-27 03:36:46 +0300
Processing by ProductsController#index as HTML
  [1m[36mUser Load (3.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering products/index.html.haml within layouts/application
  [1m[36mCategory Load (0.8ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", true]]
  [1m[36mProduct Load (1.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (2.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" IN (9, 12, 10)[0m
  [1m[36mUnit Load (1.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (1, 3, 5)[0m
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 1[0m
  [1m[35m (2.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 2[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 3[0m
  [1m[35m (1.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 4[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 5[0m
  [1m[35m (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 6[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 7[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 8[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 9[0m
  [1m[36mProduct Load (0.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 9[0m
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 9[0m
  [1m[36mUnit Load (2.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  Rendered products/_listing.html.haml (3.0ms)
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 10[0m
  [1m[36mProduct Load (3.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 10[0m
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 10[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  Rendered products/_listing.html.haml (2.6ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 11[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 12[0m
  [1m[36mProduct Load (0.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 12[0m
  [1m[36mCategory Load (2.8ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 12[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  Rendered products/_listing.html.haml (0.9ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 13[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 14[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 15[0m
  Rendered products/index.html.haml within layouts/application (96.5ms)
  Rendered layouts/_header.html.haml (10.3ms)
Completed 200 OK in 721ms (Views: 679.4ms | ActiveRecord: 33.8ms)


Started GET "/products/new" for 127.0.0.1 at 2017-04-27 03:36:47 +0300
Processing by ProductsController#new as HTML
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering products/new.html.haml within layouts/application
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (4.5ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", true]]
  Rendered products/_custom_product_false.haml (3.8ms)
  Rendered products/_custom_product_templates.haml (7.3ms)
  Rendered products/_custom_product_sets.haml (10.3ms)
  Rendered products/_custom_product_true.haml (21.7ms)
  Rendered products/_form.html.haml (76.2ms)
  Rendered products/new.html.haml within layouts/application (79.7ms)
  Rendered layouts/_header.html.haml (10.8ms)
Completed 200 OK in 676ms (Views: 663.7ms | ActiveRecord: 6.2ms)


Started GET "/constructor_objects/autocomplete_constructor_object_name?term=Gh" for 127.0.0.1 at 2017-04-27 03:37:06 +0300
Processing by ConstructorObjectsController#autocomplete_constructor_object_name as JSON
  Parameters: {"term"=>"Gh"}
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  constructor_objects.id, constructor_objects.name FROM "constructor_objects" WHERE (LOWER(constructor_objects.name) ILIKE 'gh%') ORDER BY constructor_objects.name ASC LIMIT $1[0m  [["LIMIT", 10]]
Completed 200 OK in 10ms (Views: 0.3ms | ActiveRecord: 0.8ms)


Started GET "/constructor_objects/autocomplete_constructor_object_name?term=%D0%9F%D1%80%D0%B8" for 127.0.0.1 at 2017-04-27 03:37:10 +0300
Processing by ConstructorObjectsController#autocomplete_constructor_object_name as JSON
  Parameters: {"term"=>"При"}
  [1m[36mConstructorObject Load (1.5ms)[0m  [1m[34mSELECT  constructor_objects.id, constructor_objects.name FROM "constructor_objects" WHERE (LOWER(constructor_objects.name) ILIKE 'при%') ORDER BY constructor_objects.name ASC LIMIT $1[0m  [["LIMIT", 10]]
Completed 200 OK in 7ms (Views: 0.6ms | ActiveRecord: 1.5ms)


Started POST "/constructor_objects/info" for 127.0.0.1 at 2017-04-27 03:37:14 +0300
Processing by ConstructorObjectsController#info as HTML
  Parameters: {"id"=>"6", "constructor_object"=>{"id"=>"6"}}
  [1m[36mConstructorObject Load (3.0ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUnit Load (1.3ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
Completed 200 OK in 20ms (Views: 0.3ms | ActiveRecord: 4.3ms)


Started GET "/constructor_objects/autocomplete_constructor_object_name?term=%D0%9F%D1%80%D0%B8%D0%BC%D0%B8" for 127.0.0.1 at 2017-04-27 03:37:20 +0300
Processing by ConstructorObjectsController#autocomplete_constructor_object_name as JSON
  Parameters: {"term"=>"Прими"}
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  constructor_objects.id, constructor_objects.name FROM "constructor_objects" WHERE (LOWER(constructor_objects.name) ILIKE 'прими%') ORDER BY constructor_objects.name ASC LIMIT $1[0m  [["LIMIT", 10]]
Completed 200 OK in 5ms (Views: 0.6ms | ActiveRecord: 0.7ms)


Started POST "/constructor_objects/info" for 127.0.0.1 at 2017-04-27 03:37:22 +0300
Processing by ConstructorObjectsController#info as HTML
  Parameters: {"id"=>"2", "constructor_object"=>{"id"=>"2"}}
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 200 OK in 9ms (Views: 0.2ms | ActiveRecord: 1.2ms)


  [1m[36mProduct Load (2.6ms)[0m  [1m[34mSELECT  "products".* FROM "products" WHERE "products"."deleted_at" IS NULL ORDER BY "products"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (1.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(6572146483646705745);[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Migrating to AddWithoutWorkPriceToConstructorObject (20170426222257)
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (5.7ms)[0m  [1m[35mALTER TABLE "stage_products" DROP "price_without_work"[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "stage_products" DROP "with_work"[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "products" DROP "price_without_work"[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "constructor_objects" DROP "price_without_work"[0m
  [1m[35mSQL (1.4ms)[0m  [1m[31mDELETE FROM "schema_migrations" WHERE "schema_migrations"."version" = $1[0m  [["version", "20170426222257"]]
  [1m[35m (2.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT pg_advisory_unlock(6572146483646705745)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
  [1m[35m (0.8ms)[0m  [1m[34mSELECT pg_try_advisory_lock(6572146483646705745);[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Migrating to AddWithoutWorkPriceToConstructorObject (20170426222257)
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (34.9ms)[0m  [1m[35mALTER TABLE "constructor_objects" ADD "price_without_work" decimal DEFAULT 0[0m
  [1m[35m (18.4ms)[0m  [1m[35mALTER TABLE "stage_products" ADD "with_work" boolean DEFAULT 't'[0m
  [1m[35m (19.6ms)[0m  [1m[35mALTER TABLE "stage_products" ADD "price_without_work" decimal DEFAULT 0[0m
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20170426222257"]]
  [1m[35m (7.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.3ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT pg_advisory_unlock(6572146483646705745)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
Started GET "/products" for 127.0.0.1 at 2017-04-27 03:45:34 +0300
  [1m[36mActiveRecord::SchemaMigration Load (0.9ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Processing by ProductsController#index as HTML
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering products/index.html.haml within layouts/application
  [1m[36mCategory Load (0.8ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", true]]
  [1m[36mProduct Load (2.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (1.0ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" IN (9, 12, 10)[0m
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (1, 3, 5)[0m
  [1m[36mCategory Load (1.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL[0m
  [1m[35m (1.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 1[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 2[0m
  [1m[35m (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 3[0m
  [1m[35m (2.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 4[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 5[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 6[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 7[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 8[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 9[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 9[0m
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 9[0m
  [1m[36mUnit Load (1.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  Rendered products/_listing.html.haml (4.8ms)
  [1m[35m (2.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 10[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 10[0m
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 10[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  Rendered products/_listing.html.haml (0.9ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 11[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 12[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 12[0m
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 12[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  Rendered products/_listing.html.haml (0.7ms)
  [1m[35m (4.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 13[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 14[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 15[0m
  Rendered products/index.html.haml within layouts/application (182.5ms)
  Rendered layouts/_header.html.haml (11.7ms)
Completed 200 OK in 2258ms (Views: 2088.2ms | ActiveRecord: 58.8ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 03:46:03 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (2.4ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.9ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (1.4ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (1.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (15.1ms)
  [1m[35m (3.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (7.7ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (4.4ms)
  Rendered clients/_table.html.haml (35.0ms)
  [1m[36mUserClient Load (0.8ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (197.9ms)
  Rendered layouts/_header.html.haml (70.7ms)
Completed 200 OK in 985ms (Views: 883.6ms | ActiveRecord: 38.2ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 03:46:05 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.2ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (6.6ms)
  Rendered estimates/_listing.html.haml (0.9ms)
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (26.7ms)
  Rendered layouts/_header.html.haml (10.9ms)
Completed 200 OK in 664ms (Views: 637.7ms | ActiveRecord: 3.1ms)


Started DELETE "/primitives/1" for 127.0.0.1 at 2017-04-27 03:46:09 +0300
Processing by PrimitivesController#destroy as HTML
  Parameters: {"authenticity_token"=>"1rG8I0/z27dcaqI9ri2tS31deRMyJSmKqQZ/eR6RMQlaAL+qFSvR1nm6Ps3Tr60LBsCr8BBe2eATKUCmDY2TGA==", "id"=>"1"}
  [1m[36mPrimitive Load (1.4ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mAudited::Audit Load (1.2ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 1], ["auditable_type", "ConstructorObject"], ["LIMIT", 1]]
  [1m[35mSQL (1.0ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 1], ["auditable_type", "ConstructorObject"], ["user_id", 1], ["user_type", "User"], ["action", "destroy"], ["audited_changes", "---\nname: Примитив 1\nunit_id: 6\ncategory_id: 3\nprice: !ruby/object:BigDecimal 18:0.1E2\ndate: !ruby/object:ActiveSupport::TimeWithZone\n  utc: 2017-04-26 00:00:00.000000000 Z\n  zone: !ruby/object:ActiveSupport::TimeZone\n    name: Etc/UTC\n  time: 2017-04-26 00:00:00.000000000 Z\ndivisibility: false\ndeleted_at: \nprice_without_work: !ruby/object:BigDecimal 18:0.0\n"], ["version", 1], ["remote_address", "127.0.0.1"], ["request_uuid", "2a5ab093-aee6-46a1-85d8-771cb22f3e19"], ["created_at", 2017-04-27 00:46:09 UTC]]
  [1m[35mSQL (1.0ms)[0m  [1m[33mUPDATE "constructor_objects" SET "deleted_at" = '2017-04-27 00:46:09.747439', "updated_at" = '2017-04-27 00:46:09.748525' WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."id" = $1[0m  [["id", 1]]
  [1m[35m (2.6ms)[0m  [1m[35mCOMMIT[0m
Redirected to http://localhost:3000/primitives
Completed 302 Found in 102ms (ActiveRecord: 16.6ms)


Started GET "/primitives" for 127.0.0.1 at 2017-04-27 03:46:09 +0300
Processing by PrimitivesController#index as HTML
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering primitives/index.html.haml within layouts/application
  [1m[36mCategory Load (0.8ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (0.9ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 1[0m
  [1m[36mPrimitive Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 1[0m
  [1m[36mCategory Load (1.1ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 1[0m
  [1m[36mUnit Load (2.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendered primitives/_listing.html.haml (37.5ms)
  [1m[35m (3.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 2[0m
  [1m[36mPrimitive Load (1.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 2[0m
  [1m[36mCategory Load (1.3ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 2[0m
  [1m[36mUnit Load (1.4ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 2[0m
  Rendered primitives/_listing.html.haml (4.5ms)
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 3[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 4[0m
  [1m[36mPrimitive Load (2.1ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 4[0m
  [1m[36mCategory Load (1.3ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 4[0m
  [1m[36mUnit Load (1.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 5)[0m
  Rendered primitives/_listing.html.haml (4.0ms)
  Rendered primitives/_listing.html.haml (3.8ms)
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 5[0m
  [1m[36mPrimitive Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 5[0m
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 5[0m
  [1m[36mUnit Load (3.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (1, 5)[0m
  Rendered primitives/_listing.html.haml (4.2ms)
  Rendered primitives/_listing.html.haml (3.8ms)
  Rendered primitives/_listing.html.haml (4.8ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 6[0m
  [1m[36mPrimitive Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 6[0m
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 6[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 2[0m
  Rendered primitives/_listing.html.haml (4.3ms)
  Rendered primitives/_listing.html.haml (3.9ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 7[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 8[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 9[0m
  [1m[35m (3.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 10[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 11[0m
  [1m[35m (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 12[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 13[0m
  [1m[35m (2.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 14[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 15[0m
  Rendered primitives/index.html.haml within layouts/application (220.2ms)
  Rendered layouts/_header.html.haml (9.7ms)
Completed 200 OK in 858ms (Views: 805.8ms | ActiveRecord: 47.4ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 03:47:04 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (0.8ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (6.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (18.3ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (5.7ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (4.0ms)
  Rendered clients/_table.html.haml (33.1ms)
  [1m[36mUserClient Load (0.8ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (122.0ms)
  Rendered layouts/_header.html.haml (83.5ms)
Completed 200 OK in 961ms (Views: 895.1ms | ActiveRecord: 29.4ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 03:47:06 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (1.0ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (2.0ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (7.0ms)
  Rendered estimates/_listing.html.haml (1.2ms)
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (59.4ms)
  Rendered layouts/_header.html.haml (10.1ms)
Completed 200 OK in 812ms (Views: 788.7ms | ActiveRecord: 4.3ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 03:47:38 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (3.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.9ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (5.2ms)
  Rendered estimates/_listing.html.haml (2.3ms)
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (25.3ms)
  Rendered layouts/_header.html.haml (14.0ms)
Completed 200 OK in 666ms (Views: 650.3ms | ActiveRecord: 6.2ms)


Started DELETE "/estimates/1" for 127.0.0.1 at 2017-04-27 03:47:42 +0300
Processing by EstimatesController#destroy as HTML
  Parameters: {"authenticity_token"=>"1TCU3Mf/XW85BliWa3iZnaJnAy80HEWnWDqmqKMlGHBZgZdVnSdXDhzWxGYW+pnd2frRzBZntc3iFZl3sDm6YQ==", "id"=>"1"}
  [1m[36mEstimate Load (2.6ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (2.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mAudited::Audit Load (0.9ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 1], ["auditable_type", "Estimate"], ["LIMIT", 1]]
  [1m[35mSQL (0.9ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 1], ["auditable_type", "Estimate"], ["user_id", 1], ["user_type", "User"], ["action", "destroy"], ["audited_changes", "---\nname: Название\nclient_id: 1\nfloors: !ruby/object:BigDecimal 18:0.1E1\nfirst_floor_height: !ruby/object:BigDecimal 18:0.124124E6\nsecond_floor_height_min: !ruby/object:BigDecimal 18:0.0\nsecond_floor_height_max: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_min: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_max: !ruby/object:BigDecimal 18:0.0\nprice: !ruby/object:BigDecimal 18:0.30569E4\narea: !ruby/object:BigDecimal 18:0.23E2\nprice_by_area: !ruby/object:BigDecimal 18:0.13291E3\nprice_by_stage:\n- !ruby/object:BigDecimal 18:0.222E4\n- !ruby/object:BigDecimal 18:0.55E3\n- !ruby/object:BigDecimal 18:0.33E3\nprice_by_stage_aggregated:\n- !ruby/object:BigDecimal 18:0.222E4\n- !ruby/object:BigDecimal 18:0.277E4\n- !ruby/object:BigDecimal 18:0.31E4\nprice_by_area_per_stage:\n- !ruby/object:BigDecimal 18:0.9652E2\n- !ruby/object:BigDecimal 18:0.12043E3\n- !ruby/object:BigDecimal 18:0.13478E3\ndiscount_title: Скидка\ndiscount_by_stages:\n- !ruby/object:BigDecimal 18:0.1E1\n- !ruby/object:BigDecimal 18:0.2E1\n- !ruby/object:BigDecimal 18:0.3E1\ndiscount_amount:\n- !ruby/object:BigDecimal 18:0.222E2\n- !ruby/object:BigDecimal 18:0.11E2\n- !ruby/object:BigDecimal 18:0.99E1\nprice_by_stage_aggregated_discounted:\n- !ruby/object:BigDecimal 18:0.21978E4\n- !ruby/object:BigDecimal 18:0.2759E4\n- !ruby/object:BigDecimal 18:0.30901E4\nprice_by_area_per_stage_discounted:\n- !ruby/object:BigDecimal 18:0.9556E2\n- !ruby/object:BigDecimal 18:0.11996E3\n- !ruby/object:BigDecimal 18:0.13435E3\nsigned: false\ndeleted_at: \nsigning_date: \nuser_id: \n"], ["version", 10], ["remote_address", "127.0.0.1"], ["request_uuid", "8ba0ad73-dcc3-43ba-847e-f0dc76636f86"], ["created_at", 2017-04-27 00:47:42 UTC]]
  [1m[35mSQL (0.8ms)[0m  [1m[33mUPDATE "estimates" SET "deleted_at" = '2017-04-27 00:47:42.613744', "updated_at" = '2017-04-27 00:47:42.613820' WHERE "estimates"."id" = $1[0m  [["id", 1]]
  [1m[35m (1.4ms)[0m  [1m[35mCOMMIT[0m
Redirected to http://localhost:3000/estimates?client_id=1
Completed 302 Found in 85ms (ActiveRecord: 9.2ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 03:47:42 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (5.3ms)
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (25.2ms)
  Rendered layouts/_header.html.haml (12.9ms)
Completed 200 OK in 596ms (Views: 584.5ms | ActiveRecord: 3.0ms)


Started GET "/estimates/2/edit" for 127.0.0.1 at 2017-04-27 03:47:45 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"2"}
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (3.3ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (3.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (0.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (1.4ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (1.4ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (3.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (3.2ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (4.0ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (1.7ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (1.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (1.5ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (1.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (2.1ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (2.4ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mStageProduct Load (0.9ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (4, 5, 6)[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 4]]
  [1m[36mStageProductSet Load (2.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 4[0m
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (1.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 5]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 5[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (3.4ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 6]]
  [1m[36mStageProductSet Load (1.2ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 6[0m
  [1m[36mProduct Load (1.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 6]]
  [1m[36mStageProductSetValue Load (2.2ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 2[0m
  [1m[36mProductSet Load (0.6ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.5ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (1.3ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (12.9ms)
  [1m[36mClientFile Load (2.1ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (1.0ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendered estimates/_client_file_fields.html.haml (21.1ms)
  Rendered estimates/_technical_file_fields.html.haml (8.6ms)
  [1m[36mTechnicalFile Load (1.6ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.7ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendered estimates/_technical_file_fields.html.haml (9.1ms)
  Rendered estimates/_discount.html.haml (11.0ms)
  Rendered estimates/_stages.html.haml (16.7ms)
  Rendered estimates/_form.html.haml (185.0ms)
  Rendered estimates/edit.html.haml within layouts/application (189.6ms)
  Rendered layouts/_header.html.haml (11.9ms)
Completed 200 OK in 1193ms (Views: 678.5ms | ActiveRecord: 137.2ms)


Started GET "/estimates" for 127.0.0.1 at 2017-04-27 03:49:49 +0300
Processing by EstimatesController#index as HTML
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Redirected to http://localhost:3000/clients
Completed 302 Found in 31ms (ActiveRecord: 9.3ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 03:49:49 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (0.9ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (3.9ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (9.9ms)
  [1m[35m (1.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (6.8ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (3.6ms)
  Rendered clients/_table.html.haml (26.1ms)
  [1m[36mUserClient Load (2.6ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (120.3ms)
  Rendered layouts/_header.html.haml (95.7ms)
Completed 200 OK in 999ms (Views: 947.8ms | ActiveRecord: 31.0ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 03:49:52 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (6.9ms)
  [1m[36mClient Load (2.5ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (31.8ms)
  Rendered layouts/_header.html.haml (14.5ms)
Completed 200 OK in 686ms (Views: 658.7ms | ActiveRecord: 4.6ms)


Started GET "/estimates/new?client_id=1" for 127.0.0.1 at 2017-04-27 03:49:55 +0300
Processing by EstimatesController#new as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mProduct Load (3.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (1.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (1.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (1.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (1.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.8ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (1.3ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (1.2ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (1.3ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (1.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (2.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (8.1ms)
  Rendered estimates/_technical_file_fields.html.haml (6.4ms)
  Rendered estimates/_discount.html.haml (9.3ms)
  Rendered estimates/_stages.html.haml (19.6ms)
  Rendered estimates/_form.html.haml (128.5ms)
  Rendered estimates/new.html.haml within layouts/application (132.0ms)
  Rendered layouts/_header.html.haml (9.7ms)
Completed 200 OK in 970ms (Views: 691.6ms | ActiveRecord: 73.7ms)


Started GET "/estimates" for 127.0.0.1 at 2017-04-27 03:49:58 +0300
Processing by EstimatesController#index as HTML
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Redirected to http://localhost:3000/clients
Completed 302 Found in 4ms (ActiveRecord: 0.6ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 03:49:58 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (8.3ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (10.6ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (6.8ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (8.7ms)
  Rendered clients/_table.html.haml (31.0ms)
  [1m[36mUserClient Load (1.0ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (60.2ms)
  Rendered layouts/_header.html.haml (11.6ms)
Completed 200 OK in 691ms (Views: 673.4ms | ActiveRecord: 13.0ms)


Started GET "/estimates/new?client_id=1" for 127.0.0.1 at 2017-04-27 03:50:29 +0300
Processing by EstimatesController#new as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (1.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.8ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (1.1ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.9ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (5.2ms)
  Rendered estimates/_technical_file_fields.html.haml (3.0ms)
  Rendered estimates/_discount.html.haml (6.5ms)
  Rendered estimates/_stages.html.haml (16.7ms)
  Rendered estimates/_form.html.haml (71.5ms)
  Rendered estimates/new.html.haml within layouts/application (74.7ms)
  Rendered layouts/_header.html.haml (11.2ms)
Completed 200 OK in 982ms (Views: 870.4ms | ActiveRecord: 20.2ms)


Started GET "/estimates/new?client_id=1" for 127.0.0.1 at 2017-04-27 03:51:30 +0300
Processing by EstimatesController#new as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mProduct Load (6.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (2.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (6.4ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (2.3ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mProduct Load (1.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (1.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (2.2ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (1.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (1.4ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (3.4ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (3.0ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (1.1ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (1.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (1.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (4.3ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (2.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (4.4ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.9ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.7ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (1.5ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (4.1ms)
  Rendered estimates/_technical_file_fields.html.haml (3.7ms)
  Rendered estimates/_discount.html.haml (7.7ms)
  Rendered estimates/_stages.html.haml (23.4ms)
  Rendered estimates/_form.html.haml (87.6ms)
  Rendered estimates/new.html.haml within layouts/application (91.7ms)
  Rendered layouts/_header.html.haml (8.2ms)
Completed 200 OK in 2014ms (Views: 1879.3ms | ActiveRecord: 55.1ms)


Started GET "/products" for 127.0.0.1 at 2017-04-27 03:51:57 +0300
Processing by ProductsController#index as HTML
  [1m[36mUser Load (2.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering products/index.html.haml within layouts/application
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", true]]
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (1.0ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" IN (9, 12, 10)[0m
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (1, 3, 5)[0m
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 1[0m
  [1m[35m (1.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 2[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 3[0m
  [1m[35m (1.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 4[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 5[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 6[0m
  [1m[35m (1.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 7[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 8[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 9[0m
  [1m[36mProduct Load (0.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 9[0m
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 9[0m
  [1m[36mUnit Load (1.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  Rendered products/_listing.html.haml (39.1ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 10[0m
  [1m[36mProduct Load (3.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 10[0m
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 10[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  Rendered products/_listing.html.haml (0.8ms)
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 11[0m
  [1m[35m (1.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 12[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 12[0m
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 12[0m
  [1m[36mUnit Load (1.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  Rendered products/_listing.html.haml (0.8ms)
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 13[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 14[0m
  [1m[35m (2.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 15[0m
  Rendered products/index.html.haml within layouts/application (130.1ms)
  Rendered layouts/_header.html.haml (13.5ms)
Completed 200 OK in 844ms (Views: 796.1ms | ActiveRecord: 36.2ms)


Started GET "/products/1/edit" for 127.0.0.1 at 2017-04-27 03:52:00 +0300
Processing by ProductsController#edit as HTML
  Parameters: {"id"=>"1"}
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT  "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (5.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mProductComposition Load (4.2ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.1ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = 1[0m
  [1m[36mUnit Load (2.2ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  Rendering products/edit.html.haml within layouts/application
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (0.8ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", true]]
  Rendered products/_custom_product_false.haml (4.9ms)
  Rendered products/_custom_product_templates.haml (10.1ms)
  Rendered products/_custom_product_sets.haml (10.3ms)
  Rendered products/_custom_product_true.haml (25.8ms)
  Rendered products/_form.html.haml (86.5ms)
  Rendered products/edit.html.haml within layouts/application (91.9ms)
  Rendered layouts/_header.html.haml (10.4ms)
Completed 200 OK in 734ms (Views: 695.4ms | ActiveRecord: 15.5ms)


Started GET "/constructor_objects/autocomplete_constructor_object_name?term=Ghb" for 127.0.0.1 at 2017-04-27 03:52:05 +0300
Processing by ConstructorObjectsController#autocomplete_constructor_object_name as JSON
  Parameters: {"term"=>"Ghb"}
  [1m[36mConstructorObject Load (2.1ms)[0m  [1m[34mSELECT  constructor_objects.id, constructor_objects.name FROM "constructor_objects" WHERE (LOWER(constructor_objects.name) ILIKE 'ghb%') ORDER BY constructor_objects.name ASC LIMIT $1[0m  [["LIMIT", 10]]
Completed 200 OK in 5ms (Views: 0.3ms | ActiveRecord: 2.1ms)


Started GET "/constructor_objects/autocomplete_constructor_object_name?term=%D0%9F%D1%80%D0%B8%D0%BC%D0%B8" for 127.0.0.1 at 2017-04-27 03:52:07 +0300
Processing by ConstructorObjectsController#autocomplete_constructor_object_name as JSON
  Parameters: {"term"=>"Прими"}
  [1m[36mConstructorObject Load (2.0ms)[0m  [1m[34mSELECT  constructor_objects.id, constructor_objects.name FROM "constructor_objects" WHERE (LOWER(constructor_objects.name) ILIKE 'прими%') ORDER BY constructor_objects.name ASC LIMIT $1[0m  [["LIMIT", 10]]
Completed 200 OK in 9ms (Views: 2.9ms | ActiveRecord: 2.0ms)


Started POST "/constructor_objects/info" for 127.0.0.1 at 2017-04-27 03:52:11 +0300
Processing by ConstructorObjectsController#info as HTML
  Parameters: {"id"=>"6", "constructor_object"=>{"id"=>"6"}}
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
Completed 200 OK in 10ms (Views: 0.2ms | ActiveRecord: 1.2ms)


Started PATCH "/products/1" for 127.0.0.1 at 2017-04-27 03:52:14 +0300
Processing by ProductsController#update as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"IXp22GDDy0dEnOHCsi7YksgOpaUk3ZjPyBcZQ5rs0uety3VROhvBJmFMfTLPrNjSs5N3RgamaKVyOCacifBw9g==", "commit"=>"Сохранить", "product"=>{"name"=>"Простой продукт 1 этап", "description"=>"", "hint"=>"", "unit_id"=>"1", "category_id"=>"9", "stage"=>"1", "profit"=>"100.0", "display_components"=>"0", "custom"=>"0"}, "product_compositions"=>"[{\"id\":1,\"name\":\"Примитив 1\",\"unit\":\"лист\",\"quantity\":10,\"$$hashKey\":\"object:23\"},{\"id\":\"6\",\"name\":\"Примитив 6\",\"quantity\":\"5\",\"unit\":\"лист\",\"$$hashKey\":\"object:27\"}]", "product_templates"=>"[]", "product_sets"=>"[]", "autocomplete_composition_id"=>"6", "search"=>"Примитив 6", "template_name"=>"", "set_name"=>"", "id"=>"1"}
  [1m[36mProduct Load (1.6ms)[0m  [1m[34mSELECT  "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Unpermitted parameter: display_components
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mProductComposition Load (2.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1 AND ("product_compositions"."id" NOT IN (1, 6))[0m  [["product_id", 1]]
  [1m[36mProductComposition Load (1.4ms)[0m  [1m[34mSELECT  "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1 AND "product_compositions"."constructor_object_id" = $2 LIMIT $3[0m  [["product_id", 1], ["constructor_object_id", 1], ["LIMIT", 1]]
  [1m[35m (1.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mConstructorObject Load (2.1ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mProductComposition Load (0.8ms)[0m  [1m[34mSELECT  "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1 AND "product_compositions"."constructor_object_id" = $2 LIMIT $3[0m  [["product_id", 1], ["constructor_object_id", 6], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[35mSQL (2.4ms)[0m  [1m[32mINSERT INTO "product_compositions" ("product_id", "constructor_object_id", "value") VALUES ($1, $2, $3) RETURNING "id"[0m  [["product_id", 1], ["constructor_object_id", 6], ["value", 5]]
  [1m[35m (1.6ms)[0m  [1m[35mCOMMIT[0m
Redirected to http://localhost:3000/products
Completed 302 Found in 46ms (ActiveRecord: 16.7ms)


Started GET "/products" for 127.0.0.1 at 2017-04-27 03:52:14 +0300
Processing by ProductsController#index as HTML
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering products/index.html.haml within layouts/application
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", true]]
  [1m[36mProduct Load (2.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" IN (9, 12, 10)[0m
  [1m[36mUnit Load (3.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (1, 3, 5)[0m
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 2[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 3[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 4[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 5[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 6[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 7[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 8[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 9[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 9[0m
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 9[0m
  [1m[36mUnit Load (1.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  Rendered products/_listing.html.haml (3.6ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 10[0m
  [1m[36mProduct Load (2.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 10[0m
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 10[0m
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  Rendered products/_listing.html.haml (0.7ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 11[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 12[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 12[0m
  [1m[36mCategory Load (1.0ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 12[0m
  [1m[36mUnit Load (1.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  Rendered products/_listing.html.haml (1.0ms)
  [1m[35m (1.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 13[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 14[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 15[0m
  Rendered products/index.html.haml within layouts/application (128.3ms)
  Rendered layouts/_header.html.haml (13.0ms)
Completed 200 OK in 854ms (Views: 820.6ms | ActiveRecord: 27.9ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 03:52:19 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (2.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.5ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (9.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (2.4ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.5ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (1.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (2.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.3ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (3.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (1.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (1.1ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (2.2ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.8ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.9ms)
  Rendered estimates/_technical_file_fields.html.haml (3.4ms)
  Rendered estimates/_discount.html.haml (7.9ms)
  Rendered estimates/_stages.html.haml (22.6ms)
  Rendered estimates/_form.html.haml (88.1ms)
  Rendered estimates/new.html.haml within layouts/application (92.2ms)
  Rendered layouts/_header.html.haml (10.9ms)
Completed 200 OK in 844ms (Views: 722.5ms | ActiveRecord: 38.3ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 03:52:57 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (3.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (2.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.8ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (1.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (2.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.6ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (2.0ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (37.2ms)
  Rendered estimates/_technical_file_fields.html.haml (3.5ms)
  Rendered estimates/_discount.html.haml (7.3ms)
  Rendered estimates/_stages.html.haml (20.9ms)
  Rendered estimates/_form.html.haml (128.7ms)
  Rendered estimates/new.html.haml within layouts/application (132.7ms)
  Rendered layouts/_header.html.haml (10.5ms)
Completed 200 OK in 1692ms (Views: 1603.7ms | ActiveRecord: 25.6ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 03:53:47 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.5ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.0ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (3.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.5ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.3ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (7.5ms)
  Rendered estimates/_technical_file_fields.html.haml (9.3ms)
  Rendered estimates/_discount.html.haml (8.1ms)
  Rendered estimates/_stages.html.haml (22.7ms)
  Rendered estimates/_form.html.haml (141.0ms)
  Rendered estimates/new.html.haml within layouts/application (144.9ms)
  Rendered layouts/_header.html.haml (26.2ms)
Completed 200 OK in 1408ms (Views: 1017.3ms | ActiveRecord: 79.8ms)


Started GET "/products" for 127.0.0.1 at 2017-04-27 03:54:20 +0300
Processing by ProductsController#index as HTML
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering products/index.html.haml within layouts/application
  [1m[36mCategory Load (2.0ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", true]]
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (0.9ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" IN (9, 12, 10)[0m
  [1m[36mUnit Load (3.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (1, 3, 5)[0m
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL[0m
  [1m[35m (5.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 1[0m
  [1m[35m (1.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 2[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 3[0m
  [1m[35m (1.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 4[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 5[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 6[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 7[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 8[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 9[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 9[0m
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 9[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  Rendered products/_listing.html.haml (4.2ms)
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 10[0m
  [1m[36mProduct Load (1.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 10[0m
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 10[0m
  [1m[36mUnit Load (1.4ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  Rendered products/_listing.html.haml (0.9ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 11[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 12[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 12[0m
  [1m[36mCategory Load (1.1ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 12[0m
  [1m[36mUnit Load (1.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  Rendered products/_listing.html.haml (0.8ms)
  [1m[35m (1.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 13[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 14[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 15[0m
  Rendered products/index.html.haml within layouts/application (111.6ms)
  Rendered layouts/_header.html.haml (13.7ms)
Completed 200 OK in 900ms (Views: 856.2ms | ActiveRecord: 38.2ms)


Started GET "/products/1/edit" for 127.0.0.1 at 2017-04-27 03:54:26 +0300
Processing by ProductsController#edit as HTML
  Parameters: {"id"=>"1"}
  [1m[36mProduct Load (1.8ms)[0m  [1m[34mSELECT  "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.1ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (1.9ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  Rendering products/edit.html.haml within layouts/application
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (0.9ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", true]]
  Rendered products/_custom_product_false.haml (3.3ms)
  Rendered products/_custom_product_templates.haml (7.6ms)
  Rendered products/_custom_product_sets.haml (9.5ms)
  Rendered products/_custom_product_true.haml (20.4ms)
  Rendered products/_form.html.haml (53.3ms)
  Rendered products/edit.html.haml within layouts/application (56.8ms)
  Rendered layouts/_header.html.haml (12.2ms)
Completed 200 OK in 716ms (Views: 681.6ms | ActiveRecord: 7.7ms)


Started GET "/primitives" for 127.0.0.1 at 2017-04-27 03:54:46 +0300
Processing by PrimitivesController#index as HTML
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering primitives/index.html.haml within layouts/application
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 1[0m
  [1m[36mPrimitive Load (1.1ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 1[0m
  [1m[36mCategory Load (0.5ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 1[0m
  [1m[36mUnit Load (2.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendered primitives/_listing.html.haml (12.5ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 2[0m
  [1m[36mPrimitive Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 2[0m
  [1m[36mCategory Load (0.5ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 2[0m
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 2[0m
  Rendered primitives/_listing.html.haml (8.5ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 3[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 4[0m
  [1m[36mPrimitive Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 4[0m
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 4[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 5)[0m
  Rendered primitives/_listing.html.haml (5.1ms)
  Rendered primitives/_listing.html.haml (6.1ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 5[0m
  [1m[36mPrimitive Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 5[0m
  [1m[36mCategory Load (2.5ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 5[0m
  [1m[36mUnit Load (2.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (1, 5)[0m
  Rendered primitives/_listing.html.haml (4.4ms)
  Rendered primitives/_listing.html.haml (34.5ms)
  Rendered primitives/_listing.html.haml (3.6ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 6[0m
  [1m[36mPrimitive Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 6[0m
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 6[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 2[0m
  Rendered primitives/_listing.html.haml (6.0ms)
  Rendered primitives/_listing.html.haml (7.9ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 7[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 8[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 9[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 10[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 11[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 12[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 13[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 14[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 15[0m
  Rendered primitives/index.html.haml within layouts/application (205.1ms)
  Rendered layouts/_header.html.haml (15.5ms)
Completed 200 OK in 891ms (Views: 852.4ms | ActiveRecord: 27.2ms)


Started GET "/products/1/edit" for 127.0.0.1 at 2017-04-27 03:55:11 +0300
Processing by ProductsController#edit as HTML
  Parameters: {"id"=>"1"}
  [1m[36mProduct Load (2.7ms)[0m  [1m[34mSELECT  "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (1.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  Rendering products/edit.html.haml within layouts/application
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (0.9ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", true]]
  Rendered products/_custom_product_false.haml (7.2ms)
  Rendered products/_custom_product_templates.haml (22.9ms)
  Rendered products/_custom_product_sets.haml (44.0ms)
  Rendered products/_custom_product_true.haml (71.5ms)
  Rendered products/_form.html.haml (126.3ms)
  Rendered products/edit.html.haml within layouts/application (130.2ms)
  Rendered layouts/_header.html.haml (13.5ms)
Completed 200 OK in 859ms (Views: 827.9ms | ActiveRecord: 8.0ms)


Started PATCH "/products/1" for 127.0.0.1 at 2017-04-27 03:55:18 +0300
Processing by ProductsController#update as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"ys0owqQ0LuNKshEWGFyy1ekPeFKmWl24s6zhUYxUsU9GfCtL/uwkgm9ijeZl3rKVkpKqsYQhrdIJg96On0gTXg==", "commit"=>"Сохранить", "product"=>{"name"=>"Простой продукт 1 этап", "description"=>"", "hint"=>"", "unit_id"=>"1", "category_id"=>"9", "stage"=>"1", "profit"=>"100.0", "display_components"=>"0", "custom"=>"0"}, "product_compositions"=>"[{\"id\":1,\"name\":\"Примитив 1\",\"unit\":\"лист\",\"quantity\":10},{\"id\":6,\"name\":\"Примитив 6\",\"unit\":\"лист\",\"quantity\":5}]", "product_templates"=>"[]", "product_sets"=>"[]", "autocomplete_composition_id"=>"", "search"=>"", "template_name"=>"", "set_name"=>"", "id"=>"1"}
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT  "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Unpermitted parameter: display_components
  [1m[35m (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mProductComposition Load (1.9ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1 AND ("product_compositions"."id" NOT IN (1, 6))[0m  [["product_id", 1]]
  [1m[35m (0.6ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.6ms)[0m  [1m[33mUPDATE "product_compositions" SET "deleted_at" = '2017-04-27 00:55:18.459515' WHERE "product_compositions"."id" = $1[0m  [["id", 4]]
  [1m[35m (3.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT  "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1 AND "product_compositions"."constructor_object_id" = $2 LIMIT $3[0m  [["product_id", 1], ["constructor_object_id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mConstructorObject Load (0.5ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mProductComposition Load (2.6ms)[0m  [1m[34mSELECT  "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1 AND "product_compositions"."constructor_object_id" = $2 LIMIT $3[0m  [["product_id", 1], ["constructor_object_id", 6], ["LIMIT", 1]]
  [1m[35m (2.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[35mSQL (2.4ms)[0m  [1m[32mINSERT INTO "product_compositions" ("product_id", "constructor_object_id", "value") VALUES ($1, $2, $3) RETURNING "id"[0m  [["product_id", 1], ["constructor_object_id", 6], ["value", 5]]
  [1m[35m (1.1ms)[0m  [1m[35mCOMMIT[0m
Redirected to http://localhost:3000/products
Completed 302 Found in 63ms (ActiveRecord: 20.7ms)


Started GET "/products" for 127.0.0.1 at 2017-04-27 03:55:18 +0300
Processing by ProductsController#index as HTML
  [1m[36mUser Load (2.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering products/index.html.haml within layouts/application
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", true]]
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" IN (9, 12, 10)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (1, 3, 5)[0m
  [1m[36mCategory Load (2.8ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 1[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 2[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 3[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 4[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 5[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 6[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 7[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 8[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 9[0m
  [1m[36mProduct Load (3.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 9[0m
  [1m[36mCategory Load (1.0ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 9[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  Rendered products/_listing.html.haml (4.3ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 10[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 10[0m
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 10[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  Rendered products/_listing.html.haml (0.9ms)
  [1m[35m (4.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 11[0m
  [1m[35m (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 12[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 12[0m
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 12[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  Rendered products/_listing.html.haml (0.9ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 13[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 14[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 15[0m
  Rendered products/index.html.haml within layouts/application (133.6ms)
  Rendered layouts/_header.html.haml (10.1ms)
Completed 200 OK in 731ms (Views: 693.6ms | ActiveRecord: 32.2ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 03:56:11 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.9ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 03:57:55 +0300
Completed 500 Internal Server Error in 104051ms (ActiveRecord: 23.4ms)


  
SystemExit (exit):
  
app/models/product.rb:142:in `block in price_without_work'
app/models/product.rb:139:in `price_without_work'
app/models/product.rb:31:in `block in map_for_estimate'
app/models/product.rb:22:in `map_for_estimate'
app/controllers/estimates_controller.rb:137:in `get_products'
DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 03:58:07 +0300
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (1.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.1ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.4ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (1.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (1.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (2.4ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.9ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (2.9ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (2.6ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.9ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (2.1ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (1.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.9ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (1918.3ms)
  Rendered estimates/_technical_file_fields.html.haml (5.5ms)
  Rendered estimates/_discount.html.haml (8.7ms)
  Rendered estimates/_stages.html.haml (18.4ms)
  Rendered estimates/_form.html.haml (2076.4ms)
  Rendered estimates/new.html.haml within layouts/application (2094.4ms)
  Rendered layouts/_header.html.haml (25.3ms)
Completed 200 OK in 3175ms (Views: 2703.0ms | ActiveRecord: 90.9ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 04:06:54 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (2.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.3ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (4.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (1.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (1.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.0ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (1.1ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (1.0ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (1.1ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.8ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (4.1ms)
  Rendered estimates/_technical_file_fields.html.haml (3.5ms)
  Rendered estimates/_discount.html.haml (12.5ms)
  Rendered estimates/_stages.html.haml (24.0ms)
  Rendered estimates/_form.html.haml (115.8ms)
  Rendered estimates/new.html.haml within layouts/application (119.2ms)
Completed 500 Internal Server Error in 1203ms (ActiveRecord: 25.8ms)


  
ActionView::Template::Error (SyntaxError: [stdin]:126:57: unexpected :):
     5:     %title Конструктор сметы - Арт СИП Строй
     6:     = csrf_meta_tags
     7:     = stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track': 'reload'
     8:     = javascript_include_tag 'application', 'data-turbolinks-track': 'reload'
     9: 
    10:   %body
    11:     = render 'layouts/header'
  
app/views/layouts/application.html.haml:8:in `_app_views_layouts_application_html_haml__1006556645182813273_69964319661260'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (9.7ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (3.1ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.2ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (40.3ms)
Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 04:07:51 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.2ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.9ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (1.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (1.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (1.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.9ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (3.2ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.6ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (4.3ms)
  Rendered estimates/_technical_file_fields.html.haml (4.2ms)
  Rendered estimates/_discount.html.haml (6.9ms)
  Rendered estimates/_stages.html.haml (16.4ms)
  Rendered estimates/_form.html.haml (103.4ms)
  Rendered estimates/new.html.haml within layouts/application (106.4ms)
  Rendered layouts/_header.html.haml (18.6ms)
Completed 200 OK in 1637ms (Views: 1530.1ms | ActiveRecord: 22.5ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 04:08:35 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.5ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.5ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.9ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (2.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.5ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.2ms)
  Rendered estimates/_technical_file_fields.html.haml (3.3ms)
  Rendered estimates/_discount.html.haml (6.8ms)
  Rendered estimates/_stages.html.haml (16.1ms)
  Rendered estimates/_form.html.haml (96.8ms)
  Rendered estimates/new.html.haml within layouts/application (100.0ms)
  Rendered layouts/_header.html.haml (41.2ms)
Completed 200 OK in 1696ms (Views: 1570.5ms | ActiveRecord: 18.9ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 04:09:34 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (3.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (4.4ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (1.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (1.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (2.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (1.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (2.4ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.0ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (1.5ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (1.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (1.5ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (1.7ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (4.4ms)
  Rendered estimates/_technical_file_fields.html.haml (3.2ms)
  Rendered estimates/_discount.html.haml (9.6ms)
  Rendered estimates/_stages.html.haml (20.6ms)
  Rendered estimates/_form.html.haml (90.2ms)
  Rendered estimates/new.html.haml within layouts/application (94.6ms)
  Rendered layouts/_header.html.haml (10.0ms)
Completed 200 OK in 1921ms (Views: 1808.4ms | ActiveRecord: 33.2ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 04:09:55 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (2.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.9ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (2.4ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (3.3ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (2.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (4.5ms)
  Rendered estimates/_technical_file_fields.html.haml (3.5ms)
  Rendered estimates/_discount.html.haml (6.7ms)
  Rendered estimates/_stages.html.haml (16.5ms)
  Rendered estimates/_form.html.haml (79.5ms)
  Rendered estimates/new.html.haml within layouts/application (82.5ms)
  Rendered layouts/_header.html.haml (12.9ms)
Completed 200 OK in 1661ms (Views: 1559.1ms | ActiveRecord: 25.9ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 04:10:30 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.9ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (1.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.9ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (1.1ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (1.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (3.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.5ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.5ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (8.3ms)
  Rendered estimates/_technical_file_fields.html.haml (6.8ms)
  Rendered estimates/_discount.html.haml (7.3ms)
  Rendered estimates/_stages.html.haml (43.3ms)
  Rendered estimates/_form.html.haml (170.4ms)
  Rendered estimates/new.html.haml within layouts/application (173.4ms)
  Rendered layouts/_header.html.haml (28.3ms)
Completed 200 OK in 1348ms (Views: 926.1ms | ActiveRecord: 87.9ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 04:10:43 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.9ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.4ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (4.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (2.6ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (2.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (1.2ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (1.3ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.5ms)
  Rendered estimates/_technical_file_fields.html.haml (3.6ms)
  Rendered estimates/_discount.html.haml (8.9ms)
  Rendered estimates/_stages.html.haml (23.0ms)
  Rendered estimates/_form.html.haml (89.3ms)
  Rendered estimates/new.html.haml within layouts/application (96.2ms)
  Rendered layouts/_header.html.haml (9.9ms)
Completed 200 OK in 816ms (Views: 704.5ms | ActiveRecord: 27.6ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 04:10:59 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (1.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (3.1ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.5ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.9ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.9ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (2.4ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (2.2ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (2.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.6ms)
  Rendered estimates/_technical_file_fields.html.haml (3.8ms)
  Rendered estimates/_discount.html.haml (6.7ms)
  Rendered estimates/_stages.html.haml (25.3ms)
  Rendered estimates/_form.html.haml (89.8ms)
  Rendered estimates/new.html.haml within layouts/application (93.6ms)
  Rendered layouts/_header.html.haml (17.9ms)
Completed 200 OK in 787ms (Views: 684.7ms | ActiveRecord: 26.1ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 04:11:25 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (1.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (2.2ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (2.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (2.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.0ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (4.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (1.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.1ms)
  Rendered estimates/_technical_file_fields.html.haml (4.0ms)
  Rendered estimates/_discount.html.haml (6.4ms)
  Rendered estimates/_stages.html.haml (15.3ms)
  Rendered estimates/_form.html.haml (76.9ms)
  Rendered estimates/new.html.haml within layouts/application (82.8ms)
  Rendered layouts/_header.html.haml (18.6ms)
Completed 200 OK in 1644ms (Views: 1539.0ms | ActiveRecord: 29.6ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 04:12:49 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (1.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (1.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (1.4ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (2.4ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (1.0ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (1.1ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (1.1ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (1.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (4.2ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (5.8ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (3.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (4.5ms)
  Rendered estimates/_technical_file_fields.html.haml (4.5ms)
  Rendered estimates/_discount.html.haml (9.1ms)
  Rendered estimates/_stages.html.haml (21.7ms)
  Rendered estimates/_form.html.haml (115.5ms)
  Rendered estimates/new.html.haml within layouts/application (121.9ms)
  Rendered layouts/_header.html.haml (8.0ms)
Completed 200 OK in 1991ms (Views: 1851.1ms | ActiveRecord: 34.9ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 04:13:39 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (1.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.3ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (1.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.9ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (4.9ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (1.1ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.9ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (1.2ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.7ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.9ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (4.5ms)
  Rendered estimates/_technical_file_fields.html.haml (5.5ms)
  Rendered estimates/_discount.html.haml (8.6ms)
  Rendered estimates/_stages.html.haml (17.5ms)
  Rendered estimates/_form.html.haml (82.8ms)
  Rendered estimates/new.html.haml within layouts/application (87.0ms)
  Rendered layouts/_header.html.haml (10.5ms)
Completed 200 OK in 1714ms (Views: 1596.8ms | ActiveRecord: 26.8ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 04:14:16 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (1.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.2ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (1.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (2.5ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.9ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (1.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (4.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.7ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (1.0ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.2ms)
  Rendered estimates/_technical_file_fields.html.haml (3.3ms)
  Rendered estimates/_discount.html.haml (7.0ms)
  Rendered estimates/_stages.html.haml (16.1ms)
  Rendered estimates/_form.html.haml (78.9ms)
  Rendered estimates/new.html.haml within layouts/application (84.6ms)
  Rendered layouts/_header.html.haml (8.2ms)
Completed 200 OK in 642ms (Views: 545.1ms | ActiveRecord: 28.0ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 04:15:14 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.8ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.5ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.0ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.9ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.6ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.0ms)
  Rendered estimates/_technical_file_fields.html.haml (3.1ms)
  Rendered estimates/_discount.html.haml (5.9ms)
  Rendered estimates/_stages.html.haml (16.4ms)
  Rendered estimates/_form.html.haml (65.9ms)
  Rendered estimates/new.html.haml within layouts/application (68.8ms)
  Rendered layouts/_header.html.haml (35.1ms)
Completed 200 OK in 780ms (Views: 695.6ms | ActiveRecord: 17.4ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 04:16:14 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (1.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (3.1ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (2.2ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.7ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (4.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (1.5ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.7ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (1.0ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (4.9ms)
  Rendered estimates/_technical_file_fields.html.haml (4.5ms)
  Rendered estimates/_discount.html.haml (8.9ms)
  Rendered estimates/_stages.html.haml (26.2ms)
  Rendered estimates/_form.html.haml (99.1ms)
  Rendered estimates/new.html.haml within layouts/application (103.7ms)
  Rendered layouts/_header.html.haml (7.6ms)
Completed 200 OK in 1867ms (Views: 1750.1ms | ActiveRecord: 29.4ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 04:16:42 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (1.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.1ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.3ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (3.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (1.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (2.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (2.3ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.9ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.3ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (1.1ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (2.3ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.8ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.9ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (4.0ms)
  Rendered estimates/_technical_file_fields.html.haml (2.7ms)
  Rendered estimates/_discount.html.haml (5.6ms)
  Rendered estimates/_stages.html.haml (14.0ms)
  Rendered estimates/_form.html.haml (66.1ms)
  Rendered estimates/new.html.haml within layouts/application (73.7ms)
  Rendered layouts/_header.html.haml (8.1ms)
Completed 200 OK in 1589ms (Views: 1490.2ms | ActiveRecord: 31.6ms)


Started GET "/products" for 127.0.0.1 at 2017-04-27 04:17:35 +0300
Processing by ProductsController#index as HTML
  [1m[36mUser Load (3.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering products/index.html.haml within layouts/application
  [1m[36mCategory Load (0.9ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", true]]
  [1m[36mProduct Load (2.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (2.5ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" IN (9, 12, 10)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (1, 3, 5)[0m
  [1m[36mCategory Load (1.0ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL[0m
  [1m[35m (1.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 1[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 2[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 3[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 4[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 5[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 6[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 7[0m
  [1m[35m (3.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 8[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 9[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 9[0m
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 9[0m
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  Rendered products/_listing.html.haml (3.4ms)
  [1m[35m (2.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 10[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 10[0m
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 10[0m
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  Rendered products/_listing.html.haml (0.6ms)
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 11[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 12[0m
  [1m[36mProduct Load (1.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 12[0m
  [1m[36mCategory Load (0.5ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 12[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  Rendered products/_listing.html.haml (0.6ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 13[0m
  [1m[35m (1.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 14[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 15[0m
  Rendered products/index.html.haml within layouts/application (95.7ms)
  Rendered layouts/_header.html.haml (20.6ms)
Completed 200 OK in 726ms (Views: 677.4ms | ActiveRecord: 41.9ms)


Started GET "/products/3/edit" for 127.0.0.1 at 2017-04-27 04:17:43 +0300
Processing by ProductsController#edit as HTML
  Parameters: {"id"=>"3"}
  [1m[36mProduct Load (1.0ms)[0m  [1m[34mSELECT  "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mUser Load (4.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.9ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" INNER JOIN "product_template_sets" ON "product_templates"."id" = "product_template_sets"."product_template_id" WHERE "product_templates"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductSet Load (0.8ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.9ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.0ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering products/edit.html.haml within layouts/application
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (2.9ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", true]]
  Rendered products/_custom_product_false.haml (4.6ms)
  Rendered products/_custom_product_templates.haml (15.0ms)
  Rendered products/_custom_product_sets.haml (12.4ms)
  Rendered products/_custom_product_true.haml (32.8ms)
  Rendered products/_form.html.haml (91.8ms)
  Rendered products/edit.html.haml within layouts/application (100.7ms)
  Rendered layouts/_header.html.haml (11.5ms)
Completed 200 OK in 764ms (Views: 675.5ms | ActiveRecord: 19.4ms)


Started GET "/constructor_objects/autocomplete_constructor_object_name?term=%D0%9F%D1%80%D0%B8%D0%BC%D0%B8%D1%82%D0%B8%D0%B2+6" for 127.0.0.1 at 2017-04-27 04:17:50 +0300
Processing by ConstructorObjectsController#autocomplete_constructor_object_name as JSON
  Parameters: {"term"=>"Примитив 6"}
  [1m[36mConstructorObject Load (2.9ms)[0m  [1m[34mSELECT  constructor_objects.id, constructor_objects.name FROM "constructor_objects" WHERE (LOWER(constructor_objects.name) ILIKE 'примитив 6%') ORDER BY constructor_objects.name ASC LIMIT $1[0m  [["LIMIT", 10]]
Completed 200 OK in 6ms (Views: 0.3ms | ActiveRecord: 2.9ms)


Started PATCH "/products/3" for 127.0.0.1 at 2017-04-27 04:17:53 +0300
Processing by ProductsController#update as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"PAaB4fzO/WKS8h/KOaxePqgv2EXIJ6pBZwzgxgtsTPywt4Jophb3A7cigzpELl5+07IKpupcWivdI98ZGHDu7Q==", "commit"=>"Сохранить", "product"=>{"name"=>"Конфигурируемый продукт 3 этап", "description"=>"", "hint"=>"", "unit_id"=>"5", "category_id"=>"10", "stage"=>"3", "profit"=>"150.0", "display_components"=>"0", "custom"=>"1"}, "product_compositions"=>"[]", "product_templates"=>"[{\"id\":1,\"name\":\"Составляющая 1\"},{\"id\":2,\"name\":\"Составляющая 2\"}]", "product_sets"=>"[{\"id\":1,\"name\":\"Сборка 1\",\"items\":[{\"id\":1,\"name\":\"Составляющая 1\",\"value\":{\"id\":1,\"name\":\"Примитив 1\",\"unit\":\"лист\",\"price\":\"10.0\"},\"$$hashKey\":\"object:40\"},{\"id\":2,\"name\":\"Составляющая 2\",\"value\":{\"id\":2,\"name\":\"Примитив 6\",\"unit\":\"шт\",\"price\":\"20.0\"},\"$$hashKey\":\"object:41\"}],\"$$hashKey\":\"object:34\"}]", "autocomplete_composition_id"=>"", "search"=>"Примитив 6", "template_name"=>"Составляющая 2", "set_name"=>"Сборка 1", "search_id"=>"6", "id"=>"3"}
  [1m[36mProduct Load (2.2ms)[0m  [1m[34mSELECT  "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mUser Load (2.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Unpermitted parameter: display_components
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mProductSet Load (0.6ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mProductTemplateSet Load (1.4ms)[0m  [1m[34mSELECT  "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1 AND "product_template_sets"."product_template_id" = 1 AND "product_template_sets"."product_set_id" = 1 LIMIT $2[0m  [["product_id", 3], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT  "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1 AND "product_template_sets"."product_template_id" = 2 AND "product_template_sets"."product_set_id" = 1 LIMIT $2[0m  [["product_id", 3], ["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1 AND ("product_template_sets"."id" NOT IN (1, 2))[0m  [["product_id", 3]]
Redirected to http://localhost:3000/products
Completed 302 Found in 53ms (ActiveRecord: 15.5ms)


Started GET "/products" for 127.0.0.1 at 2017-04-27 04:17:53 +0300
Processing by ProductsController#index as HTML
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering products/index.html.haml within layouts/application
  [1m[36mCategory Load (2.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", true]]
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" IN (9, 12, 10)[0m
  [1m[36mUnit Load (2.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (1, 3, 5)[0m
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL[0m
  [1m[35m (1.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 1[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 2[0m
  [1m[35m (1.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 3[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 4[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 5[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 6[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 7[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 8[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 9[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 9[0m
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 9[0m
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  Rendered products/_listing.html.haml (3.1ms)
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 10[0m
  [1m[36mProduct Load (0.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 10[0m
  [1m[36mCategory Load (0.5ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 10[0m
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  Rendered products/_listing.html.haml (0.8ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 11[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 12[0m
  [1m[36mProduct Load (0.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 12[0m
  [1m[36mCategory Load (0.5ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 12[0m
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  Rendered products/_listing.html.haml (0.8ms)
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 13[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 14[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 15[0m
  Rendered products/index.html.haml within layouts/application (70.2ms)
  Rendered layouts/_header.html.haml (8.8ms)
Completed 200 OK in 704ms (Views: 675.3ms | ActiveRecord: 22.9ms)


Started GET "/products/3/edit" for 127.0.0.1 at 2017-04-27 04:17:59 +0300
Processing by ProductsController#edit as HTML
  Parameters: {"id"=>"3"}
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT  "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" INNER JOIN "product_template_sets" ON "product_templates"."id" = "product_template_sets"."product_template_id" WHERE "product_templates"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductSet Load (0.8ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering products/edit.html.haml within layouts/application
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (1.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", true]]
  Rendered products/_custom_product_false.haml (3.4ms)
  Rendered products/_custom_product_templates.haml (6.7ms)
  Rendered products/_custom_product_sets.haml (9.5ms)
  Rendered products/_custom_product_true.haml (19.8ms)
  Rendered products/_form.html.haml (59.3ms)
  Rendered products/edit.html.haml within layouts/application (62.3ms)
  Rendered layouts/_header.html.haml (7.6ms)
Completed 200 OK in 697ms (Views: 624.4ms | ActiveRecord: 11.4ms)


Started GET "/constructor_objects/autocomplete_constructor_object_name?term=%D0%9F%D1%80%D0%B8%D0%BC%D0%B8%D1%82%D0%B8%D0%B2+6" for 127.0.0.1 at 2017-04-27 04:18:06 +0300
Processing by ConstructorObjectsController#autocomplete_constructor_object_name as JSON
  Parameters: {"term"=>"Примитив 6"}
  [1m[36mConstructorObject Load (2.5ms)[0m  [1m[34mSELECT  constructor_objects.id, constructor_objects.name FROM "constructor_objects" WHERE (LOWER(constructor_objects.name) ILIKE 'примитив 6%') ORDER BY constructor_objects.name ASC LIMIT $1[0m  [["LIMIT", 10]]
Completed 200 OK in 7ms (Views: 0.3ms | ActiveRecord: 2.5ms)


Started GET "/constructor_objects/autocomplete_constructor_object_name?term=%D0%9F%D1%80%D0%B8" for 127.0.0.1 at 2017-04-27 04:18:24 +0300
Processing by ConstructorObjectsController#autocomplete_constructor_object_name as JSON
  Parameters: {"term"=>"При"}
  [1m[36mConstructorObject Load (1.7ms)[0m  [1m[34mSELECT  constructor_objects.id, constructor_objects.name FROM "constructor_objects" WHERE (LOWER(constructor_objects.name) ILIKE 'при%') ORDER BY constructor_objects.name ASC LIMIT $1[0m  [["LIMIT", 10]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 1.7ms)


Started GET "/constructor_objects/autocomplete_constructor_object_name?term=%D0%9F%D1%80%D0%B8%D0%BC%D0%B8%D1%82%D0%B8" for 127.0.0.1 at 2017-04-27 04:18:25 +0300
Processing by ConstructorObjectsController#autocomplete_constructor_object_name as JSON
  Parameters: {"term"=>"Примити"}
  [1m[36mConstructorObject Load (1.1ms)[0m  [1m[34mSELECT  constructor_objects.id, constructor_objects.name FROM "constructor_objects" WHERE (LOWER(constructor_objects.name) ILIKE 'примити%') ORDER BY constructor_objects.name ASC LIMIT $1[0m  [["LIMIT", 10]]
Completed 200 OK in 8ms (Views: 0.6ms | ActiveRecord: 1.1ms)


Started GET "/constructor_objects/autocomplete_constructor_object_name?term=%D0%9F%D1%80%D0%B8%D0%BC%D0%B8%D1%82%D0%B8%D0%B2" for 127.0.0.1 at 2017-04-27 04:18:25 +0300
Processing by ConstructorObjectsController#autocomplete_constructor_object_name as JSON
  Parameters: {"term"=>"Примитив"}
  [1m[36mConstructorObject Load (1.3ms)[0m  [1m[34mSELECT  constructor_objects.id, constructor_objects.name FROM "constructor_objects" WHERE (LOWER(constructor_objects.name) ILIKE 'примитив%') ORDER BY constructor_objects.name ASC LIMIT $1[0m  [["LIMIT", 10]]
Completed 200 OK in 4ms (Views: 0.6ms | ActiveRecord: 1.3ms)


Started GET "/constructor_objects/autocomplete_constructor_object_name?term=%D0%9F%D1%80%D0%B8%D0%BC%D0%B8%D1%82%D0%B8%D0%B2" for 127.0.0.1 at 2017-04-27 04:18:28 +0300
Processing by ConstructorObjectsController#autocomplete_constructor_object_name as JSON
  Parameters: {"term"=>"Примитив"}
  [1m[36mConstructorObject Load (1.0ms)[0m  [1m[34mSELECT  constructor_objects.id, constructor_objects.name FROM "constructor_objects" WHERE (LOWER(constructor_objects.name) ILIKE 'примитив%') ORDER BY constructor_objects.name ASC LIMIT $1[0m  [["LIMIT", 10]]
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 1.0ms)


Started PATCH "/products/3" for 127.0.0.1 at 2017-04-27 04:18:49 +0300
Processing by ProductsController#update as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"nLWYshsvQJmGetD1mCwHm7YDrkpFpfvWKTwm5WcSUbUQBJs7QfdK+KOqTAXlrgfbzZ58qWfeC7yTExk6dA7zpA==", "commit"=>"Сохранить", "product"=>{"name"=>"Конфигурируемый продукт 3 этап", "description"=>"", "hint"=>"", "unit_id"=>"5", "category_id"=>"10", "stage"=>"3", "profit"=>"150.0", "display_components"=>"0", "custom"=>"1"}, "product_compositions"=>"[]", "product_templates"=>"[{\"id\":1,\"name\":\"Составляющая 1\"},{\"id\":2,\"name\":\"Составляющая 2\"}]", "product_sets"=>"[{\"id\":1493255912976,\"name\":\"Сборка 1\",\"items\":[{\"id\":1,\"name\":\"Составляющая 1\",\"value\":{\"name\":\"Примитив 1\",\"id\":\"1\"}},{\"id\":2,\"name\":\"Составляющая 2\",\"value\":{\"name\":\"Примитив 6\",\"id\":\"6\"}}]}]", "autocomplete_composition_id"=>"", "search"=>"Примитив 6", "template_name"=>"Составляющая 2", "set_name"=>"Сборка 1", "search_id"=>"", "id"=>"3"}
  [1m[36mProduct Load (1.9ms)[0m  [1m[34mSELECT  "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mUser Load (4.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Unpermitted parameter: display_components
  [1m[35m (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mProductSet Load (0.7ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."name" = $1 LIMIT $2[0m  [["name", "Сборка 1"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mProductTemplateSet Load (1.1ms)[0m  [1m[34mSELECT  "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1 AND "product_template_sets"."product_template_id" = 1 AND "product_template_sets"."product_set_id" = 1 LIMIT $2[0m  [["product_id", 3], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT  "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1 AND "product_template_sets"."product_template_id" = 2 AND "product_template_sets"."product_set_id" = 1 LIMIT $2[0m  [["product_id", 3], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (2.6ms)[0m  [1m[33mUPDATE "product_template_sets" SET "constructor_object_id" = $1 WHERE "product_template_sets"."id" = $2[0m  [["constructor_object_id", 6], ["id", 2]]
  [1m[35m (1.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mProductTemplateSet Load (1.4ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1 AND ("product_template_sets"."id" NOT IN (1, 2))[0m  [["product_id", 3]]
Redirected to http://localhost:3000/products
Completed 302 Found in 62ms (ActiveRecord: 23.1ms)


Started GET "/products" for 127.0.0.1 at 2017-04-27 04:18:49 +0300
Processing by ProductsController#index as HTML
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering products/index.html.haml within layouts/application
  [1m[36mCategory Load (1.0ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", true]]
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" IN (9, 12, 10)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (1, 3, 5)[0m
  [1m[36mCategory Load (1.5ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 1[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 2[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 3[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 4[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 5[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 6[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 7[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 8[0m
  [1m[35m (2.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 9[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 9[0m
  [1m[36mCategory Load (0.4ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 9[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  Rendered products/_listing.html.haml (2.4ms)
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 10[0m
  [1m[36mProduct Load (1.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 10[0m
  [1m[36mCategory Load (0.9ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 10[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  Rendered products/_listing.html.haml (0.7ms)
  [1m[35m (1.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 11[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 12[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 12[0m
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 12[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  Rendered products/_listing.html.haml (0.8ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 13[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 14[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."category_id" = 15[0m
  Rendered products/index.html.haml within layouts/application (70.5ms)
  Rendered layouts/_header.html.haml (9.9ms)
Completed 200 OK in 598ms (Views: 570.4ms | ActiveRecord: 23.9ms)


Started GET "/products/3/edit" for 127.0.0.1 at 2017-04-27 04:18:55 +0300
Processing by ProductsController#edit as HTML
  Parameters: {"id"=>"3"}
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT  "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mUser Load (1.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" INNER JOIN "product_template_sets" ON "product_templates"."id" = "product_template_sets"."product_template_id" WHERE "product_templates"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductSet Load (0.7ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.5ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  Rendering products/edit.html.haml within layouts/application
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (0.9ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", true]]
  Rendered products/_custom_product_false.haml (6.1ms)
  Rendered products/_custom_product_templates.haml (13.7ms)
  Rendered products/_custom_product_sets.haml (8.1ms)
  Rendered products/_custom_product_true.haml (29.5ms)
  Rendered products/_form.html.haml (71.5ms)
  Rendered products/edit.html.haml within layouts/application (74.2ms)
  Rendered layouts/_header.html.haml (8.2ms)
Completed 200 OK in 662ms (Views: 616.2ms | ActiveRecord: 10.5ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 04:19:02 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (2.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (5.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (1.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.8ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (8.0ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (1.2ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (2.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (1.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (1.4ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (2.1ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (1.0ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (2.1ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (1.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (4.1ms)
  Rendered estimates/_technical_file_fields.html.haml (4.0ms)
  Rendered estimates/_discount.html.haml (7.5ms)
  Rendered estimates/_stages.html.haml (24.2ms)
  Rendered estimates/_form.html.haml (92.7ms)
  Rendered estimates/new.html.haml within layouts/application (96.1ms)
  Rendered layouts/_header.html.haml (11.7ms)
Completed 200 OK in 675ms (Views: 569.1ms | ActiveRecord: 38.3ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 04:20:24 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (1.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (4.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.9ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (2.3ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (1.0ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (5.3ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (4.1ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (2.0ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.3ms)
  Rendered estimates/_technical_file_fields.html.haml (3.0ms)
  Rendered estimates/_discount.html.haml (6.5ms)
  Rendered estimates/_stages.html.haml (28.6ms)
  Rendered estimates/_form.html.haml (88.8ms)
  Rendered estimates/new.html.haml within layouts/application (91.9ms)
  Rendered layouts/_header.html.haml (8.3ms)
Completed 200 OK in 2400ms (Views: 2296.8ms | ActiveRecord: 32.6ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 04:20:49 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.3ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (1.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.1ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.1ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (4.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.6ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.3ms)
  Rendered estimates/_technical_file_fields.html.haml (3.3ms)
  Rendered estimates/_discount.html.haml (5.8ms)
  Rendered estimates/_stages.html.haml (15.4ms)
  Rendered estimates/_form.html.haml (68.8ms)
  Rendered estimates/new.html.haml within layouts/application (72.2ms)
  Rendered layouts/_header.html.haml (8.1ms)
Completed 200 OK in 1545ms (Views: 1459.9ms | ActiveRecord: 21.5ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 04:21:25 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (4.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (4.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.5ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (1.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (1.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (1.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (2.9ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (3.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (2.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (1.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.0ms)
  Rendered estimates/_technical_file_fields.html.haml (2.8ms)
  Rendered estimates/_discount.html.haml (5.7ms)
  Rendered estimates/_stages.html.haml (15.7ms)
  Rendered estimates/_form.html.haml (72.9ms)
  Rendered estimates/new.html.haml within layouts/application (78.5ms)
  Rendered layouts/_header.html.haml (10.4ms)
Completed 200 OK in 1654ms (Views: 1574.2ms | ActiveRecord: 32.4ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 04:23:40 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (1.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.2ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (1.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (1.5ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.9ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (1.0ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (1.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (4.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.9ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (1.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (1.8ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (1.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (1.9ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (1.2ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (7.3ms)
  Rendered estimates/_technical_file_fields.html.haml (4.3ms)
  Rendered estimates/_discount.html.haml (5.5ms)
  Rendered estimates/_stages.html.haml (30.3ms)
  Rendered estimates/_form.html.haml (146.2ms)
  Rendered estimates/new.html.haml within layouts/application (149.6ms)
  Rendered layouts/_header.html.haml (29.6ms)
Completed 200 OK in 1096ms (Views: 806.4ms | ActiveRecord: 28.4ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 04:24:40 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.2ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.1ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (2.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (1.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.1ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.9ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.9ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (1.9ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (1.6ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (5.4ms)
  Rendered estimates/_technical_file_fields.html.haml (3.3ms)
  Rendered estimates/_discount.html.haml (5.9ms)
  Rendered estimates/_stages.html.haml (15.2ms)
  Rendered estimates/_form.html.haml (77.5ms)
  Rendered estimates/new.html.haml within layouts/application (81.9ms)
  Rendered layouts/_header.html.haml (8.0ms)
Completed 200 OK in 668ms (Views: 576.6ms | ActiveRecord: 23.9ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 04:25:19 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (3.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (2.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.9ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.9ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (1.4ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (3.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (2.7ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (1.7ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (5.3ms)
  Rendered estimates/_technical_file_fields.html.haml (4.3ms)
  Rendered estimates/_discount.html.haml (10.7ms)
  Rendered estimates/_stages.html.haml (25.1ms)
  Rendered estimates/_form.html.haml (93.5ms)
  Rendered estimates/new.html.haml within layouts/application (96.5ms)
  Rendered layouts/_header.html.haml (12.0ms)
Completed 200 OK in 707ms (Views: 618.3ms | ActiveRecord: 27.3ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 04:27:47 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (1.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (1.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.5ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.0ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (1.3ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (3.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (3.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.9ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.4ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (8.2ms)
  Rendered estimates/_technical_file_fields.html.haml (5.6ms)
  Rendered estimates/_discount.html.haml (6.4ms)
  Rendered estimates/_stages.html.haml (25.4ms)
  Rendered estimates/_form.html.haml (123.4ms)
  Rendered estimates/new.html.haml within layouts/application (126.3ms)
  Rendered layouts/_header.html.haml (23.9ms)
Completed 200 OK in 1794ms (Views: 1518.2ms | ActiveRecord: 25.2ms)


Started GET "/estimates" for 127.0.0.1 at 2017-04-27 04:29:01 +0300
Processing by EstimatesController#index as HTML
  [1m[36mUser Load (5.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Redirected to http://localhost:3000/clients
Completed 302 Found in 9ms (ActiveRecord: 5.1ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 04:29:01 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (2.0ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (3.0ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (13.8ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (4.1ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (3.5ms)
  Rendered clients/_table.html.haml (26.3ms)
  [1m[36mUserClient Load (0.8ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (86.4ms)
  Rendered layouts/_header.html.haml (10.7ms)
Completed 200 OK in 726ms (Views: 695.3ms | ActiveRecord: 22.2ms)


Started GET "/clients/1/edit" for 127.0.0.1 at 2017-04-27 04:29:04 +0300
Processing by ClientsController#edit as HTML
  Parameters: {"id"=>"1"}
  [1m[36mClient Load (1.3ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (1.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUserClient Exists (1.2ms)[0m  [1m[34mSELECT  1 AS one FROM "user_clients" WHERE "user_clients"."user_id" = 1 AND "user_clients"."client_id" = 1 LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUserClient Load (1.1ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" WHERE "user_clients"."client_id" = 1 AND ("user_clients"."user_id" != 1)[0m
  Rendering clients/edit.html.haml within layouts/application
  [1m[36mUserClient Load (0.7ms)[0m  [1m[34mSELECT  "user_clients".* FROM "user_clients" WHERE "user_clients"."user_id" = 1 AND "user_clients"."client_id" = 1 LIMIT $1[0m  [["LIMIT", 1]]
  Rendered clients/_form.html.haml (20.8ms)
  Rendered clients/edit.html.haml within layouts/application (24.7ms)
  Rendered layouts/_header.html.haml (43.1ms)
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE ("users"."id" != $1)[0m  [["id", 1]]
Completed 200 OK in 607ms (Views: 584.3ms | ActiveRecord: 6.3ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 04:29:07 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (6.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (3.5ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (2.1ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (1.1ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (7.0ms)
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (5.4ms)
  [1m[35m (2.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (8.6ms)
  Rendered clients/_table.html.haml (28.5ms)
  [1m[36mUserClient Load (0.8ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (54.2ms)
  Rendered layouts/_header.html.haml (11.1ms)
Completed 200 OK in 532ms (Views: 505.6ms | ActiveRecord: 17.8ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 04:29:08 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (2.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (2.2ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.0ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (8.2ms)
  [1m[36mClient Load (1.2ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (22.9ms)
  Rendered layouts/_header.html.haml (9.0ms)
Completed 200 OK in 582ms (Views: 566.4ms | ActiveRecord: 6.8ms)


Started GET "/estimates/2/edit" for 127.0.0.1 at 2017-04-27 04:29:11 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"2"}
  [1m[36mProduct Load (1.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (4.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (1.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (1.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (1.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.8ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (1.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (1.2ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (1.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (2.3ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (2.0ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.3ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (2.0ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.9ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.8ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mStageProduct Load (1.1ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (4, 5, 6)[0m
  [1m[36mStageProduct Load (2.2ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 4]]
  [1m[36mStageProductSet Load (1.2ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 4[0m
  [1m[36mProduct Load (12.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 5]]
  [1m[36mStageProductSet Load (1.1ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 5[0m
  [1m[36mProduct Load (1.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (2.4ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 6]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 6[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 6]]
  [1m[36mStageProductSetValue Load (1.1ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 2[0m
  [1m[36mProductSet Load (0.5ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.5ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 2)[0m
  [1m[36mUnit Load (1.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 1)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.9ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (8.0ms)
  [1m[36mClientFile Load (1.4ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.5ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendered estimates/_client_file_fields.html.haml (19.3ms)
  Rendered estimates/_technical_file_fields.html.haml (3.3ms)
  [1m[36mTechnicalFile Load (0.8ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 2]]
  [1m[36mAssetFile Load (0.6ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendered estimates/_technical_file_fields.html.haml (6.4ms)
  Rendered estimates/_discount.html.haml (6.0ms)
  Rendered estimates/_stages.html.haml (30.6ms)
  Rendered estimates/_form.html.haml (135.7ms)
  Rendered estimates/edit.html.haml within layouts/application (139.9ms)
  Rendered layouts/_header.html.haml (10.7ms)
Completed 200 OK in 941ms (Views: 653.8ms | ActiveRecord: 89.7ms)


Started GET "/estimates" for 127.0.0.1 at 2017-04-27 04:29:28 +0300
Processing by EstimatesController#index as HTML
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Redirected to http://localhost:3000/clients
Completed 302 Found in 5ms (ActiveRecord: 1.0ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 04:29:28 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (6.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (0.9ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (1.1ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (7.8ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (3.8ms)
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (4.9ms)
  Rendered clients/_table.html.haml (25.8ms)
  [1m[36mUserClient Load (0.9ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (43.9ms)
  Rendered layouts/_header.html.haml (51.0ms)
Completed 200 OK in 648ms (Views: 630.5ms | ActiveRecord: 12.4ms)


Started GET "/clients/1/edit" for 127.0.0.1 at 2017-04-27 04:29:33 +0300
Processing by ClientsController#edit as HTML
  Parameters: {"id"=>"1"}
  [1m[36mClient Load (5.6ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (2.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUserClient Exists (1.0ms)[0m  [1m[34mSELECT  1 AS one FROM "user_clients" WHERE "user_clients"."user_id" = 1 AND "user_clients"."client_id" = 1 LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUserClient Load (1.0ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" WHERE "user_clients"."client_id" = 1 AND ("user_clients"."user_id" != 1)[0m
  Rendering clients/edit.html.haml within layouts/application
  [1m[36mUserClient Load (4.7ms)[0m  [1m[34mSELECT  "user_clients".* FROM "user_clients" WHERE "user_clients"."user_id" = 1 AND "user_clients"."client_id" = 1 LIMIT $1[0m  [["LIMIT", 1]]
  Rendered clients/_form.html.haml (22.1ms)
  Rendered clients/edit.html.haml within layouts/application (27.0ms)
  Rendered layouts/_header.html.haml (9.4ms)
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE ("users"."id" != $1)[0m  [["id", 1]]
Completed 200 OK in 515ms (Views: 492.3ms | ActiveRecord: 15.3ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 04:29:35 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (1.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (1.0ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (4.6ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (0.6ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (8.6ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (6.5ms)
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (4.0ms)
  Rendered clients/_table.html.haml (23.3ms)
  [1m[36mUserClient Load (2.4ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (44.8ms)
  Rendered layouts/_header.html.haml (8.1ms)
Completed 200 OK in 609ms (Views: 588.3ms | ActiveRecord: 12.8ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 04:29:36 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (1.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (3.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.1ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (4.3ms)
  [1m[36mClient Load (1.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (24.0ms)
  Rendered layouts/_header.html.haml (11.2ms)
Completed 200 OK in 617ms (Views: 598.3ms | ActiveRecord: 6.9ms)


Started GET "/estimates/new?client_id=1" for 127.0.0.1 at 2017-04-27 04:29:42 +0300
Processing by EstimatesController#new as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mProduct Load (2.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (3.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.5ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.4ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (2.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (9.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (1.2ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (1.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.8ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (2.9ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (2.5ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.0ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (3.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (2.8ms)
  Rendered estimates/_technical_file_fields.html.haml (2.9ms)
  Rendered estimates/_discount.html.haml (8.0ms)
  Rendered estimates/_stages.html.haml (20.8ms)
  Rendered estimates/_form.html.haml (76.8ms)
  Rendered estimates/new.html.haml within layouts/application (80.1ms)
  Rendered layouts/_header.html.haml (8.4ms)
Completed 200 OK in 663ms (Views: 568.0ms | ActiveRecord: 40.0ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 04:35:37 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.5ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 40ms (ActiveRecord: 1.1ms)


  
SyntaxError (/home/g1nc/Development/ruby/constructor/app/models/estimate.rb:171: syntax error, unexpected tIDENTIFIER, expecting '}'
              work_primitive: item.constructor_object.work_primitive?
                            ^
/home/g1nc/Development/ruby/constructor/app/models/estimate.rb:172: syntax error, unexpected '}', expecting keyword_end
            },
             ^
/home/g1nc/Development/ruby/constructor/app/models/estimate.rb:226: syntax error, unexpected end-of-input, expecting '}'):
  
app/models/estimate.rb:171: syntax error, unexpected tIDENTIFIER, expecting '}'
app/models/estimate.rb:172: syntax error, unexpected '}', expecting keyword_end
app/models/estimate.rb:226: syntax error, unexpected end-of-input, expecting '}'
app/controllers/estimates_controller.rb:9:in `index'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (11.9ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (3.5ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.2ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (52.6ms)
Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 04:35:45 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (4.2ms)
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (17.2ms)
  Rendered layouts/_header.html.haml (46.9ms)
Completed 200 OK in 1571ms (Views: 1497.8ms | ActiveRecord: 3.3ms)


Started DELETE "/estimates/2" for 127.0.0.1 at 2017-04-27 04:35:50 +0300
Processing by EstimatesController#destroy as HTML
  Parameters: {"authenticity_token"=>"isd3vdrCwh9cdxQ/iF67vBnDGEBukvmLpM/SEwlFnpEGdnQ0gBrIfnmniM/13Lv8Yl7Ko0zpCeEe4O3MGlk8gA==", "id"=>"2"}
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (1.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[36mAudited::Audit Load (2.3ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 2], ["auditable_type", "Estimate"], ["LIMIT", 1]]
  [1m[35mSQL (1.9ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 2], ["auditable_type", "Estimate"], ["user_id", 1], ["user_type", "User"], ["action", "destroy"], ["audited_changes", "---\nname: Тестовая смета\nclient_id: 1\nfloors: !ruby/object:BigDecimal 18:0.1E1\nfirst_floor_height: !ruby/object:BigDecimal 18:0.18E4\nsecond_floor_height_min: !ruby/object:BigDecimal 18:0.0\nsecond_floor_height_max: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_min: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_max: !ruby/object:BigDecimal 18:0.0\nprice: !ruby/object:BigDecimal 18:0.20594E4\narea: !ruby/object:BigDecimal 18:0.1E3\nprice_by_area: !ruby/object:BigDecimal 18:0.2059E2\nprice_by_stage:\n- !ruby/object:BigDecimal 18:0.11E3\n- !ruby/object:BigDecimal 18:0.105E4\n- !ruby/object:BigDecimal 18:0.95E3\nprice_by_stage_aggregated:\n- !ruby/object:BigDecimal 18:0.11E3\n- !ruby/object:BigDecimal 18:0.116E4\n- !ruby/object:BigDecimal 18:0.211E4\nprice_by_area_per_stage:\n- !ruby/object:BigDecimal 18:0.11E1\n- !ruby/object:BigDecimal 18:0.116E2\n- !ruby/object:BigDecimal 18:0.211E2\ndiscount_title: Скидка\ndiscount_by_stages:\n- !ruby/object:BigDecimal 18:0.1E1\n- !ruby/object:BigDecimal 18:0.2E1\n- !ruby/object:BigDecimal 18:0.3E1\ndiscount_amount:\n- !ruby/object:BigDecimal 18:0.11E1\n- !ruby/object:BigDecimal 18:0.21E2\n- !ruby/object:BigDecimal 18:0.285E2\nprice_by_stage_aggregated_discounted:\n- !ruby/object:BigDecimal 18:0.1089E3\n- !ruby/object:BigDecimal 18:0.1139E4\n- !ruby/object:BigDecimal 18:0.20815E4\nprice_by_area_per_stage_discounted:\n- !ruby/object:BigDecimal 18:0.109E1\n- !ruby/object:BigDecimal 18:0.1139E2\n- !ruby/object:BigDecimal 18:0.2082E2\nsigned: false\ndeleted_at: \nsigning_date: \nuser_id: \n"], ["version", 3], ["remote_address", "127.0.0.1"], ["request_uuid", "bd3d485c-5fed-45e9-b54f-cdddd63a216b"], ["created_at", 2017-04-27 01:35:50 UTC]]
  [1m[35mSQL (4.3ms)[0m  [1m[33mUPDATE "estimates" SET "deleted_at" = '2017-04-27 01:35:50.760128', "updated_at" = '2017-04-27 01:35:50.760210' WHERE "estimates"."id" = $1[0m  [["id", 2]]
  [1m[35m (1.5ms)[0m  [1m[35mCOMMIT[0m
Redirected to http://localhost:3000/estimates?client_id=1
Completed 302 Found in 171ms (ActiveRecord: 16.8ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 04:35:50 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/index.html.haml within layouts/application (17.3ms)
  Rendered layouts/_header.html.haml (17.4ms)
Completed 200 OK in 742ms (Views: 731.7ms | ActiveRecord: 2.3ms)


Started GET "/estimates/new?client_id=1" for 127.0.0.1 at 2017-04-27 04:35:52 +0300
Processing by EstimatesController#new as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.1ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (1.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (1.2ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (1.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (2.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.9ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (3.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.4ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (2.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (11.0ms)
  Rendered estimates/_technical_file_fields.html.haml (8.1ms)
  Rendered estimates/_discount.html.haml (11.6ms)
  Rendered estimates/_stages.html.haml (32.0ms)
  Rendered estimates/_form.html.haml (158.0ms)
  Rendered estimates/new.html.haml within layouts/application (161.1ms)
  Rendered layouts/_header.html.haml (14.3ms)
Completed 200 OK in 1056ms (Views: 758.9ms | ActiveRecord: 72.7ms)


Started POST "/estimates" for 127.0.0.1 at 2017-04-27 04:36:58 +0300
Processing by EstimatesController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"IRB5vWeE56fozqg+UH1A4xwegU/f91liqYHGEbtEBjetoXo0PVztxs0eNM4t/0CjZ4NTrP2MqQgTrvnOqFikJg==", "commit"=>"Сохранить", "estimate"=>{"price"=>"568.22744", "name"=>"Тестовая смета", "client_id"=>"1", "area"=>"100", "first_floor_height"=>"1800", "second_floor_height_min"=>"0.0", "second_floor_height_max"=>"0.0", "third_floor_height_min"=>"0.0", "third_floor_height_max"=>"0.0", "discount_title"=>"Скидка", "discount_by_stages"=>{"0"=>"1", "1"=>"2", "2"=>"3"}}, "json_stages"=>"[{\"number\":1,\"text\":{\"name\":\"Первый этап\",\"summ\":\"Итого по первому этапу:\",\"summ_dis\":\"по первому этапу\",\"discount\":\"Итого по первому этапу со скидкой:\"},\"products\":[{\"id\":1,\"name\":\"Простой продукт 1 этап\",\"unit\":\"шт\",\"custom\":false,\"sets\":[],\"profit\":\"100.0\",\"price_with_work\":\"70.0\",\"price_without_work\":\"10.0\",\"$$hashKey\":\"object:21\",\"quantity\":\"1\",\"with_work\":false,\"price\":\"10.0510\"}],\"price\":10.051,\"total_price\":9.95049,\"aggregated_price\":10.051,\"$$hashKey\":\"object:4\"},{\"number\":2,\"text\":{\"name\":\"Второй этап\",\"summ\":\"Итого по двум этапам:\",\"summ_dis\":\"по второму этапу\",\"discount\":\"Итого по двум этапам со скидкой:\"},\"products\":[{\"id\":2,\"name\":\"Простой продукт 2 этап\",\"unit\":\"м3\",\"custom\":false,\"sets\":[],\"profit\":\"50.0\",\"price_with_work\":\"50.0\",\"price_without_work\":\"50.0\",\"$$hashKey\":\"object:27\",\"quantity\":\"1\",\"with_work\":true,\"price\":\"50.0275\"}],\"price\":50.0275,\"total_price\":49.02695000000001,\"aggregated_price\":60.078500000000005,\"$$hashKey\":\"object:5\"},{\"number\":3,\"text\":{\"name\":\"Третий этап\",\"summ\":\"Итого по трем этапам:\",\"summ_dis\":\"по третьему этапу\",\"discount\":\"Итого по трем этапам со скидкой:\"},\"products\":[{\"id\":3,\"name\":\"Конфигурируемый продукт 3 этап\",\"unit\":\"кг\",\"custom\":true,\"sets\":[{\"id\":1,\"name\":\"Сборка 1\",\"items\":[{\"id\":1,\"name\":\"Составляющая 1\",\"value\":{\"id\":1,\"name\":\"Примитив 1\",\"unit\":\"лист\",\"price\":\"10.0\",\"work_primitive\":false},\"$$hashKey\":\"object:36\",\"quantity\":\"1\"},{\"id\":2,\"name\":\"Составляющая 2\",\"value\":{\"id\":6,\"name\":\"Примитив 6\",\"unit\":\"лист\",\"price\":\"60.0\",\"work_primitive\":true},\"$$hashKey\":\"object:37\",\"quantity\":\"1\"}],\"$$hashKey\":\"object:33\",\"selected\":true}],\"profit\":\"150.0\",\"price_with_work\":70,\"price_without_work\":10,\"$$hashKey\":\"object:31\",\"quantity\":1,\"with_work\":false,\"price\":525}],\"price\":525,\"total_price\":509.25,\"aggregated_price\":585.0785,\"$$hashKey\":\"object:6\"}]", "data"=>""}
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.2ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (2.9ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Unpermitted parameters: second_floor_height_min, second_floor_height_max, third_floor_height_min, third_floor_height_max, discount_by_stages
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (1.7ms)[0m  [1m[32mINSERT INTO "estimates" ("name", "client_id", "first_floor_height", "price", "area", "discount_title", "discount_by_stages", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["name", "Тестовая смета"], ["client_id", 1], ["first_floor_height", #<BigDecimal:7f438b43df48,'0.18E4',9(18)>], ["price", #<BigDecimal:7f438b43e2e0,'0.56822744E3',18(18)>], ["area", #<BigDecimal:7f438b43e178,'0.1E3',9(18)>], ["discount_title", "Скидка"], ["discount_by_stages", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x0055cdd81852a8 "decimal[]"  elements_type=nil needs quotation>, values=["1", "2", "3"]>], ["created_at", 2017-04-27 01:36:58 UTC], ["updated_at", 2017-04-27 01:36:58 UTC]]
  [1m[36mAudited::Audit Load (1.4ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 3], ["auditable_type", "Estimate"], ["LIMIT", 1]]
  [1m[35mSQL (1.1ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 3], ["auditable_type", "Estimate"], ["user_id", 1], ["user_type", "User"], ["action", "create"], ["audited_changes", "---\nname: Тестовая смета\nclient_id: 1\nfloors: \nfirst_floor_height: !ruby/object:BigDecimal 18:0.18E4\nsecond_floor_height_min: !ruby/object:BigDecimal 18:0.0\nsecond_floor_height_max: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_min: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_max: !ruby/object:BigDecimal 18:0.0\nprice: !ruby/object:BigDecimal 18:0.56822744E3\narea: !ruby/object:BigDecimal 18:0.1E3\nprice_by_area: \nprice_by_stage:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_area_per_stage:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\ndiscount_title: Скидка\ndiscount_by_stages:\n- '1'\n- '2'\n- '3'\ndiscount_amount:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated_discounted:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_area_per_stage_discounted:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nsigned: false\ndeleted_at: \nsigning_date: \nuser_id: \n"], ["version", 1], ["remote_address", "127.0.0.1"], ["request_uuid", "85eeee68-cfa4-4829-993f-47b5d1445ee6"], ["created_at", 2017-04-27 01:36:58 UTC]]
  [1m[35m (2.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (1.6ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["estimate_id", 3], ["number", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (1.5ms)[0m  [1m[32mINSERT INTO "stages" ("estimate_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["estimate_id", 3], ["number", 1], ["price", #<BigDecimal:7f438af0e6f8,'0.10051E2',18(36)>], ["total_price", #<BigDecimal:7f438af0e518,'0.995E1',18(36)>], ["created_at", 2017-04-27 01:36:58 UTC], ["updated_at", 2017-04-27 01:36:58 UTC]]
  [1m[35m (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.9ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND ("stage_products"."product_id" != 1)[0m  [["stage_id", 7]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT  "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND "stage_products"."product_id" = $2 LIMIT $3[0m  [["stage_id", 7], ["product_id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
Completed 500 Internal Server Error in 239ms (ActiveRecord: 45.1ms)


  
ActiveModel::UnknownAttributeError (unknown attribute 'price_with_work' for StageProduct.):
  
app/models/estimate.rb:73:in `block (2 levels) in update_json_values'
app/models/estimate.rb:71:in `each'
app/models/estimate.rb:71:in `block in update_json_values'
app/models/estimate.rb:59:in `each'
app/models/estimate.rb:59:in `update_json_values'
app/controllers/estimates_controller.rb:45:in `create'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (6.0ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (3.7ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (4.5ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (37.6ms)
DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
  [1m[36mActiveRecord::SchemaMigration Load (1.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT pg_try_advisory_lock(6572146483646705745);[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Migrating to AddWithoutWorkPriceToConstructorObject (20170426222257)
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.2ms)[0m  [1m[35mALTER TABLE "stage_products" DROP "price_without_work"[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "stage_products" DROP "with_work"[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "constructor_objects" DROP "price_without_work"[0m
  [1m[35mSQL (2.6ms)[0m  [1m[31mDELETE FROM "schema_migrations" WHERE "schema_migrations"."version" = $1[0m  [["version", "20170426222257"]]
  [1m[35m (4.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (3.4ms)[0m  [1m[34mSELECT pg_advisory_unlock(6572146483646705745)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
  [1m[35m (0.5ms)[0m  [1m[34mSELECT pg_try_advisory_lock(6572146483646705745);[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Migrating to AddWithoutWorkPriceToConstructorObject (20170426222257)
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (32.9ms)[0m  [1m[35mALTER TABLE "constructor_objects" ADD "price_without_work" decimal DEFAULT 0[0m
  [1m[35m (19.1ms)[0m  [1m[35mALTER TABLE "stage_products" ADD "with_work" boolean DEFAULT 't'[0m
  [1m[35m (20.9ms)[0m  [1m[35mALTER TABLE "stage_products" ADD "price_without_work" decimal DEFAULT 0[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "stage_products" RENAME COLUMN "price" TO "price_with_work"[0m
  [1m[35mSQL (2.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20170426222257"]]
  [1m[35m (4.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (1.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT pg_advisory_unlock(6572146483646705745)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
Started GET "/estimates" for 127.0.0.1 at 2017-04-27 04:40:10 +0300
  [1m[36mActiveRecord::SchemaMigration Load (0.9ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Processing by EstimatesController#index as HTML
  [1m[36mUser Load (1.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Redirected to http://localhost:3000/clients
Completed 302 Found in 54ms (ActiveRecord: 7.4ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 04:40:10 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (2.9ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (2.3ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (14.1ms)
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (5.0ms)
  [1m[35m (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (8.8ms)
  Rendered clients/_table.html.haml (32.7ms)
  [1m[36mUserClient Load (1.7ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (189.3ms)
  Rendered layouts/_header.html.haml (71.3ms)
Completed 200 OK in 2821ms (Views: 2776.4ms | ActiveRecord: 26.0ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 04:40:16 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (4.4ms)
  [1m[36mClient Load (0.5ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (17.6ms)
  Rendered layouts/_header.html.haml (15.4ms)
Completed 200 OK in 558ms (Views: 545.1ms | ActiveRecord: 2.8ms)


Started DELETE "/estimates/3" for 127.0.0.1 at 2017-04-27 04:40:22 +0300
Processing by EstimatesController#destroy as HTML
  Parameters: {"authenticity_token"=>"6MNI607QG2CWjJjNKF1PN+iUzddn3nd91tHNUGb2HvpkcktiFAgRAbNcBD1V3093kwkfNEWlhxds/vKPdeq86w==", "id"=>"3"}
  [1m[36mEstimate Load (3.7ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mAudited::Audit Load (1.7ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 3], ["auditable_type", "Estimate"], ["LIMIT", 1]]
  [1m[35mSQL (1.0ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 3], ["auditable_type", "Estimate"], ["user_id", 1], ["user_type", "User"], ["action", "destroy"], ["audited_changes", "---\nname: Тестовая смета\nclient_id: 1\nfloors: \nfirst_floor_height: !ruby/object:BigDecimal 18:0.18E4\nsecond_floor_height_min: !ruby/object:BigDecimal 18:0.0\nsecond_floor_height_max: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_min: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_max: !ruby/object:BigDecimal 18:0.0\nprice: !ruby/object:BigDecimal 18:0.56822744E3\narea: !ruby/object:BigDecimal 18:0.1E3\nprice_by_area: \nprice_by_stage:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_area_per_stage:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\ndiscount_title: Скидка\ndiscount_by_stages:\n- !ruby/object:BigDecimal 18:0.1E1\n- !ruby/object:BigDecimal 18:0.2E1\n- !ruby/object:BigDecimal 18:0.3E1\ndiscount_amount:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated_discounted:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_area_per_stage_discounted:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nsigned: false\ndeleted_at: \nsigning_date: \nuser_id: \n"], ["version", 2], ["remote_address", "127.0.0.1"], ["request_uuid", "d282304c-65de-4f2f-9674-58e827fc5af5"], ["created_at", 2017-04-27 01:40:22 UTC]]
  [1m[35mSQL (0.8ms)[0m  [1m[33mUPDATE "estimates" SET "deleted_at" = '2017-04-27 01:40:22.805815', "updated_at" = '2017-04-27 01:40:22.805882' WHERE "estimates"."id" = $1[0m  [["id", 3]]
  [1m[35m (3.1ms)[0m  [1m[35mCOMMIT[0m
Redirected to http://localhost:3000/estimates?client_id=1
Completed 302 Found in 96ms (ActiveRecord: 14.9ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 04:40:22 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (1.9ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.8ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/index.html.haml within layouts/application (14.6ms)
  Rendered layouts/_header.html.haml (10.2ms)
Completed 200 OK in 692ms (Views: 678.9ms | ActiveRecord: 4.7ms)


Started GET "/estimates/new?client_id=1" for 127.0.0.1 at 2017-04-27 04:40:24 +0300
Processing by EstimatesController#new as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.2ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (2.4ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (3.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (4.0ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (2.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (4.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (1.1ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (1.2ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.4ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (1.9ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (20.7ms)
  Rendered estimates/_technical_file_fields.html.haml (7.8ms)
  Rendered estimates/_discount.html.haml (10.4ms)
  Rendered estimates/_stages.html.haml (22.4ms)
  Rendered estimates/_form.html.haml (181.4ms)
  Rendered estimates/new.html.haml within layouts/application (186.3ms)
  Rendered layouts/_header.html.haml (11.1ms)
Completed 200 OK in 1067ms (Views: 772.5ms | ActiveRecord: 73.1ms)


Started POST "/estimates" for 127.0.0.1 at 2017-04-27 04:41:07 +0300
Processing by EstimatesController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"XUmV/Ifn5hAuc4oajBDmGGz85LwNxA9uwVkPc/o0gF7R+JZ13T/scQujFurxkuZYF2E2Xy+//wR7djCs6SgiTw==", "commit"=>"Сохранить", "estimate"=>{"price"=>"568.22744", "name"=>"Тестовая смета", "client_id"=>"1", "area"=>"100", "first_floor_height"=>"1800", "second_floor_height_min"=>"0.0", "second_floor_height_max"=>"0.0", "third_floor_height_min"=>"0.0", "third_floor_height_max"=>"0.0", "discount_title"=>"Скидка", "discount_by_stages"=>{"0"=>"1", "1"=>"2", "2"=>"3"}}, "json_stages"=>"[{\"number\":1,\"text\":{\"name\":\"Первый этап\",\"summ\":\"Итого по первому этапу:\",\"summ_dis\":\"по первому этапу\",\"discount\":\"Итого по первому этапу со скидкой:\"},\"products\":[{\"id\":1,\"name\":\"Простой продукт 1 этап\",\"unit\":\"шт\",\"custom\":false,\"sets\":[],\"profit\":\"100.0\",\"price_with_work\":\"70.0\",\"price_without_work\":\"10.0\",\"$$hashKey\":\"object:21\",\"quantity\":\"1\",\"with_work\":false,\"price\":\"10.0510\"}],\"price\":10.051,\"total_price\":9.95049,\"aggregated_price\":10.051,\"$$hashKey\":\"object:4\"},{\"number\":2,\"text\":{\"name\":\"Второй этап\",\"summ\":\"Итого по двум этапам:\",\"summ_dis\":\"по второму этапу\",\"discount\":\"Итого по двум этапам со скидкой:\"},\"products\":[{\"id\":2,\"name\":\"Простой продукт 2 этап\",\"unit\":\"м3\",\"custom\":false,\"sets\":[],\"profit\":\"50.0\",\"price_with_work\":\"50.0\",\"price_without_work\":\"50.0\",\"$$hashKey\":\"object:27\",\"quantity\":\"1\",\"with_work\":true,\"price\":\"50.0275\"}],\"price\":50.0275,\"total_price\":49.02695000000001,\"aggregated_price\":60.078500000000005,\"$$hashKey\":\"object:5\"},{\"number\":3,\"text\":{\"name\":\"Третий этап\",\"summ\":\"Итого по трем этапам:\",\"summ_dis\":\"по третьему этапу\",\"discount\":\"Итого по трем этапам со скидкой:\"},\"products\":[{\"id\":3,\"name\":\"Конфигурируемый продукт 3 этап\",\"unit\":\"кг\",\"custom\":true,\"sets\":[{\"id\":1,\"name\":\"Сборка 1\",\"items\":[{\"id\":1,\"name\":\"Составляющая 1\",\"value\":{\"id\":1,\"name\":\"Примитив 1\",\"unit\":\"лист\",\"price\":\"10.0\",\"work_primitive\":false},\"$$hashKey\":\"object:36\",\"quantity\":\"1\"},{\"id\":2,\"name\":\"Составляющая 2\",\"value\":{\"id\":6,\"name\":\"Примитив 6\",\"unit\":\"лист\",\"price\":\"60.0\",\"work_primitive\":true},\"$$hashKey\":\"object:37\",\"quantity\":\"1\"}],\"$$hashKey\":\"object:33\",\"selected\":true}],\"profit\":\"150.0\",\"price_with_work\":70,\"price_without_work\":10,\"$$hashKey\":\"object:31\",\"quantity\":1,\"with_work\":false,\"price\":525}],\"price\":525,\"total_price\":509.25,\"aggregated_price\":585.0785,\"$$hashKey\":\"object:6\"}]", "data"=>""}
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (1.1ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.8ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.9ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (1.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (1.2ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (2.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.0ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Unpermitted parameters: second_floor_height_min, second_floor_height_max, third_floor_height_min, third_floor_height_max, discount_by_stages
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (1.0ms)[0m  [1m[32mINSERT INTO "estimates" ("name", "client_id", "first_floor_height", "price", "area", "discount_title", "discount_by_stages", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["name", "Тестовая смета"], ["client_id", 1], ["first_floor_height", #<BigDecimal:7fe5fa5cab60,'0.18E4',9(18)>], ["price", #<BigDecimal:7fe5fa5cadb8,'0.56822744E3',18(18)>], ["area", #<BigDecimal:7fe5fa5caca0,'0.1E3',9(18)>], ["discount_title", "Скидка"], ["discount_by_stages", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x00558408c0a788 "decimal[]"  elements_type=nil needs quotation>, values=["1", "2", "3"]>], ["created_at", 2017-04-27 01:41:07 UTC], ["updated_at", 2017-04-27 01:41:07 UTC]]
  [1m[36mAudited::Audit Load (0.7ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 4], ["auditable_type", "Estimate"], ["LIMIT", 1]]
  [1m[35mSQL (3.9ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 4], ["auditable_type", "Estimate"], ["user_id", 1], ["user_type", "User"], ["action", "create"], ["audited_changes", "---\nname: Тестовая смета\nclient_id: 1\nfloors: \nfirst_floor_height: !ruby/object:BigDecimal 18:0.18E4\nsecond_floor_height_min: !ruby/object:BigDecimal 18:0.0\nsecond_floor_height_max: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_min: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_max: !ruby/object:BigDecimal 18:0.0\nprice: !ruby/object:BigDecimal 18:0.56822744E3\narea: !ruby/object:BigDecimal 18:0.1E3\nprice_by_area: \nprice_by_stage:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_area_per_stage:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\ndiscount_title: Скидка\ndiscount_by_stages:\n- '1'\n- '2'\n- '3'\ndiscount_amount:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated_discounted:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_area_per_stage_discounted:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nsigned: false\ndeleted_at: \nsigning_date: \nuser_id: \n"], ["version", 1], ["remote_address", "127.0.0.1"], ["request_uuid", "8cf7743e-bc89-44a5-b47f-d97c6465cd62"], ["created_at", 2017-04-27 01:41:07 UTC]]
  [1m[35m (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["estimate_id", 4], ["number", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "stages" ("estimate_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["estimate_id", 4], ["number", 1], ["price", #<BigDecimal:7fe5fa93da90,'0.10051E2',18(36)>], ["total_price", #<BigDecimal:7fe5fa93d860,'0.995E1',18(36)>], ["created_at", 2017-04-27 01:41:07 UTC], ["updated_at", 2017-04-27 01:41:07 UTC]]
  [1m[35m (1.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (1.3ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND ("stage_products"."product_id" != 1)[0m  [["stage_id", 8]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT  "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND "stage_products"."product_id" = $2 LIMIT $3[0m  [["stage_id", 8], ["product_id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (1.1ms)[0m  [1m[32mINSERT INTO "stage_products" ("product_id", "stage_id", "quantity", "price_with_work", "created_at", "updated_at", "with_work", "price_without_work") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["product_id", 1], ["stage_id", 8], ["quantity", 1], ["price_with_work", #<BigDecimal:7fe5fb29bb28,'0.7E2',9(18)>], ["created_at", 2017-04-27 01:41:07 UTC], ["updated_at", 2017-04-27 01:41:07 UTC], ["with_work", false], ["price_without_work", #<BigDecimal:7fe5fb29aea8,'0.1E2',9(18)>]]
  [1m[35m (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["estimate_id", 4], ["number", 2], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (1.2ms)[0m  [1m[32mINSERT INTO "stages" ("estimate_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["estimate_id", 4], ["number", 2], ["price", #<BigDecimal:7fe5fb2396d0,'0.500275E2',18(36)>], ["total_price", #<BigDecimal:7fe5fb239478,'0.4903E2',18(36)>], ["created_at", 2017-04-27 01:41:07 UTC], ["updated_at", 2017-04-27 01:41:07 UTC]]
  [1m[35m (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (1.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND ("stage_products"."product_id" != 2)[0m  [["stage_id", 9]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT  "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND "stage_products"."product_id" = $2 LIMIT $3[0m  [["stage_id", 9], ["product_id", 2], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "stage_products" ("product_id", "stage_id", "quantity", "price_with_work", "created_at", "updated_at", "price_without_work") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["product_id", 2], ["stage_id", 9], ["quantity", 1], ["price_with_work", #<BigDecimal:7fe608eaa650,'0.5E2',9(18)>], ["created_at", 2017-04-27 01:41:07 UTC], ["updated_at", 2017-04-27 01:41:07 UTC], ["price_without_work", #<BigDecimal:7fe608ea8fa8,'0.5E2',9(18)>]]
  [1m[35m (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (0.6ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["estimate_id", 4], ["number", 3], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "stages" ("estimate_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["estimate_id", 4], ["number", 3], ["price", #<BigDecimal:7fe5fb36f540,'0.525E3',9(27)>], ["total_price", #<BigDecimal:7fe5fb36f450,'0.50925E3',18(36)>], ["created_at", 2017-04-27 01:41:07 UTC], ["updated_at", 2017-04-27 01:41:07 UTC]]
  [1m[35m (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND ("stage_products"."product_id" != 3)[0m  [["stage_id", 10]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT  "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND "stage_products"."product_id" = $2 LIMIT $3[0m  [["stage_id", 10], ["product_id", 3], ["LIMIT", 1]]
  [1m[35m (0.9ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "stage_products" ("product_id", "stage_id", "quantity", "price_with_work", "created_at", "updated_at", "with_work", "price_without_work") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["product_id", 3], ["stage_id", 10], ["quantity", 1], ["price_with_work", #<BigDecimal:7fe5fb5c5150,'0.7E2',9(27)>], ["created_at", 2017-04-27 01:41:07 UTC], ["updated_at", 2017-04-27 01:41:07 UTC], ["with_work", false], ["price_without_work", #<BigDecimal:7fe5fb5c4638,'0.1E2',9(27)>]]
  [1m[35m (1.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSet Load (1.2ms)[0m  [1m[34mSELECT  "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1 AND "stage_product_sets"."product_set_id" = $2 LIMIT $3[0m  [["stage_product_id", 9], ["product_set_id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (4.2ms)[0m  [1m[32mINSERT INTO "stage_product_sets" ("stage_product_id", "product_set_id", "selected", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["stage_product_id", 9], ["product_set_id", 1], ["selected", true], ["created_at", 2017-04-27 01:41:07 UTC], ["updated_at", 2017-04-27 01:41:07 UTC]]
  [1m[35m (1.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSetValue Load (0.8ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1 AND ("stage_product_set_values"."product_template_id" NOT IN (1, 2))[0m  [["stage_product_set_id", 3]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT  "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1 AND "stage_product_set_values"."product_template_id" = $2 LIMIT $3[0m  [["stage_product_set_id", 3], ["product_template_id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (2.1ms)[0m  [1m[32mINSERT INTO "stage_product_set_values" ("stage_product_set_id", "product_template_id", "constructor_object_id", "quantity", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["stage_product_set_id", 3], ["product_template_id", 1], ["constructor_object_id", 1], ["quantity", 1], ["created_at", 2017-04-27 01:41:07 UTC], ["updated_at", 2017-04-27 01:41:07 UTC]]
  [1m[35m (2.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSetValue Load (0.5ms)[0m  [1m[34mSELECT  "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1 AND "stage_product_set_values"."product_template_id" = $2 LIMIT $3[0m  [["stage_product_set_id", 3], ["product_template_id", 2], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (1.0ms)[0m  [1m[32mINSERT INTO "stage_product_set_values" ("stage_product_set_id", "product_template_id", "constructor_object_id", "quantity", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["stage_product_set_id", 3], ["product_template_id", 2], ["constructor_object_id", 6], ["quantity", 1], ["created_at", 2017-04-27 01:41:07 UTC], ["updated_at", 2017-04-27 01:41:07 UTC]]
  [1m[35m (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mAudited::Audit Load (0.9ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 4], ["auditable_type", "Estimate"], ["LIMIT", 1]]
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 4], ["auditable_type", "Estimate"], ["user_id", 1], ["user_type", "User"], ["action", "update"], ["audited_changes", "---\nfloors:\n- \n- !ruby/object:BigDecimal 18:0.1E1\nprice_by_area:\n- \n- !ruby/object:BigDecimal 18:0.568E1\nprice_by_stage:\n- - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n- - !ruby/object:BigDecimal 27:0.10051E2\n  - !ruby/object:BigDecimal 27:0.500275E2\n  - !ruby/object:BigDecimal 18:0.525E3\nprice_by_stage_aggregated:\n- - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n- - !ruby/object:BigDecimal 27:0.10051E2\n  - !ruby/object:BigDecimal 18:0.600785E2\n  - !ruby/object:BigDecimal 18:0.5850785E3\nprice_by_area_per_stage:\n- - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n- - !ruby/object:BigDecimal 18:0.1E0\n  - !ruby/object:BigDecimal 18:0.6E0\n  - !ruby/object:BigDecimal 18:0.585E1\ndiscount_amount:\n- - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n- - !ruby/object:BigDecimal 18:0.1E0\n  - !ruby/object:BigDecimal 18:0.1E1\n  - !ruby/object:BigDecimal 18:0.1575E2\nprice_by_stage_aggregated_discounted:\n- - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n- - !ruby/object:BigDecimal 27:0.9951E1\n  - !ruby/object:BigDecimal 18:0.590785E2\n  - !ruby/object:BigDecimal 18:0.5693285E3\nprice_by_area_per_stage_discounted:\n- - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n- - !ruby/object:BigDecimal 18:0.1E0\n  - !ruby/object:BigDecimal 18:0.59E0\n  - !ruby/object:BigDecimal 18:0.569E1\n"], ["version", 2], ["remote_address", "127.0.0.1"], ["request_uuid", "8cf7743e-bc89-44a5-b47f-d97c6465cd62"], ["created_at", 2017-04-27 01:41:07 UTC]]
  [1m[35mSQL (1.1ms)[0m  [1m[33mUPDATE "estimates" SET "floors" = $1, "price_by_area" = $2, "price_by_stage" = $3, "price_by_stage_aggregated" = $4, "price_by_area_per_stage" = $5, "discount_amount" = $6, "price_by_stage_aggregated_discounted" = $7, "price_by_area_per_stage_discounted" = $8, "updated_at" = $9 WHERE "estimates"."id" = $10[0m  [["floors", #<BigDecimal:7fe608e83758,'0.1E1',9(27)>], ["price_by_area", #<BigDecimal:7fe608e83668,'0.568E1',18(27)>], ["price_by_stage", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x00558408c0a788 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fe5fb0cba00,'0.10051E2',18(36)>, #<BigDecimal:7fe5fb0cb820,'0.500275E2',18(36)>, #<BigDecimal:7fe5fb0cb618,'0.525E3',9(27)>]>], ["price_by_stage_aggregated", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x00558408c0a788 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fe5fb0cba00,'0.10051E2',18(36)>, #<BigDecimal:7fe5fb0cb5a0,'0.600785E2',18(27)>, #<BigDecimal:7fe5fb0cb550,'0.5850785E3',18(27)>]>], ["price_by_area_per_stage", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x00558408c0a788 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fe5fb0cb258,'0.1E0',9(18)>, #<BigDecimal:7fe5fb0ca740,'0.6E0',9(18)>, #<BigDecimal:7fe5fb0ca150,'0.585E1',18(27)>]>], ["discount_amount", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x00558408c0a788 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fe5fb0cac40,'0.1E0',9(18)>, #<BigDecimal:7fe5fb0ca420,'0.1E1',9(27)>, #<BigDecimal:7fe5fb0c9e08,'0.1575E2',18(27)>]>], ["price_by_stage_aggregated_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x00558408c0a788 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fe5fb0caad8,'0.9951E1',18(36)>, #<BigDecimal:7fe5fb0ca3d0,'0.590785E2',18(27)>, #<BigDecimal:7fe5fb0c9db8,'0.5693285E3',18(27)>]>], ["price_by_area_per_stage_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x00558408c0a788 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fe5fb0ca8d0,'0.1E0',9(18)>, #<BigDecimal:7fe5fb0ca2b8,'0.59E0',9(18)>, #<BigDecimal:7fe5fb0c9ca0,'0.569E1',18(27)>]>], ["updated_at", 2017-04-27 01:41:07 UTC], ["id", 4]]
  [1m[35m (4.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
Redirected to http://localhost:3000/estimates
Completed 302 Found in 466ms (ActiveRecord: 96.9ms)


Started GET "/estimates" for 127.0.0.1 at 2017-04-27 04:41:07 +0300
Processing by EstimatesController#index as HTML
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Redirected to http://localhost:3000/clients
Completed 302 Found in 4ms (ActiveRecord: 0.7ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 04:41:07 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (1.1ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (2.1ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (8.7ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (4.2ms)
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (4.5ms)
  Rendered clients/_table.html.haml (22.1ms)
  [1m[36mUserClient Load (1.0ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (44.2ms)
  Rendered layouts/_header.html.haml (18.6ms)
Completed 200 OK in 770ms (Views: 755.9ms | ActiveRecord: 8.1ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 04:41:11 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (5.5ms)
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (57.4ms)
  Rendered layouts/_header.html.haml (16.2ms)
Completed 200 OK in 708ms (Views: 688.7ms | ActiveRecord: 2.9ms)


Started GET "/estimates/4/edit" for 127.0.0.1 at 2017-04-27 04:41:16 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"4"}
  [1m[36mProduct Load (1.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (2.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (1.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (2.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (2.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (3.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (6.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.8ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.5ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.4ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.5ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 4]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (8, 9, 10)[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 8]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 7[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.9ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 9]]
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 8[0m
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 10]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 9[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 9]]
  [1m[36mStageProductSetValue Load (0.6ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 3[0m
  [1m[36mProductSet Load (0.7ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (1.0ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 3]]
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.4ms)
  [1m[36mClientFile Load (0.7ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 4]]
  Rendered estimates/_technical_file_fields.html.haml (3.5ms)
  [1m[36mTechnicalFile Load (0.8ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 4]]
  Rendered estimates/_discount.html.haml (9.2ms)
  Rendered estimates/_stages.html.haml (19.6ms)
  Rendered estimates/_form.html.haml (82.1ms)
  Rendered estimates/edit.html.haml within layouts/application (85.1ms)
  Rendered layouts/_header.html.haml (10.1ms)
Completed 200 OK in 814ms (Views: 655.4ms | ActiveRecord: 42.3ms)


Started GET "/estimates/4/edit" for 127.0.0.1 at 2017-04-27 04:41:53 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"4"}
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.1ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.8ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (2.4ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (4.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (2.9ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.1ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.1ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (3.6ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.6ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 4]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (8, 9, 10)[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 8]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 7[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 9]]
  [1m[36mStageProductSet Load (0.8ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 8[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 10]]
  [1m[36mStageProductSet Load (3.8ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 9[0m
  [1m[36mProduct Load (2.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 9]]
  [1m[36mStageProductSetValue Load (1.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 3[0m
  [1m[36mProductSet Load (0.7ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.6ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 3]]
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (4.1ms)
  [1m[36mClientFile Load (0.6ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 4]]
  Rendered estimates/_technical_file_fields.html.haml (3.3ms)
  [1m[36mTechnicalFile Load (0.7ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 4]]
  Rendered estimates/_discount.html.haml (8.1ms)
  Rendered estimates/_stages.html.haml (17.2ms)
  Rendered estimates/_form.html.haml (84.3ms)
  Rendered estimates/edit.html.haml within layouts/application (87.6ms)
  Rendered layouts/_header.html.haml (35.5ms)
Completed 200 OK in 1973ms (Views: 1750.7ms | ActiveRecord: 46.1ms)


Started GET "/primitives" for 127.0.0.1 at 2017-04-27 04:42:58 +0300
Processing by PrimitivesController#index as HTML
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering primitives/index.html.haml within layouts/application
  [1m[36mCategory Load (0.9ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL[0m
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 1[0m
  [1m[36mPrimitive Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 1[0m
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 1[0m
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendered primitives/_listing.html.haml (9.2ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 2[0m
  [1m[36mPrimitive Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 2[0m
  [1m[36mCategory Load (0.5ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 2[0m
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 2[0m
  Rendered primitives/_listing.html.haml (4.7ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 3[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 4[0m
  [1m[36mPrimitive Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 4[0m
  [1m[36mCategory Load (0.5ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 4[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (6, 5)[0m
  Rendered primitives/_listing.html.haml (4.2ms)
  Rendered primitives/_listing.html.haml (6.4ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 5[0m
  [1m[36mPrimitive Load (1.3ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 5[0m
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 5[0m
  [1m[36mUnit Load (1.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" IN (1, 5)[0m
  Rendered primitives/_listing.html.haml (4.5ms)
  Rendered primitives/_listing.html.haml (4.1ms)
  Rendered primitives/_listing.html.haml (5.3ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 6[0m
  [1m[36mPrimitive Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 6[0m
  [1m[36mCategory Load (1.0ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."id" = 6[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 2[0m
  Rendered primitives/_listing.html.haml (4.4ms)
  Rendered primitives/_listing.html.haml (6.1ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 7[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 8[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 9[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 10[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 11[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 12[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 13[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 14[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL AND "constructor_objects"."category_id" = 15[0m
  Rendered primitives/index.html.haml within layouts/application (154.3ms)
  Rendered layouts/_header.html.haml (12.9ms)
Completed 200 OK in 891ms (Views: 853.1ms | ActiveRecord: 25.8ms)


Started GET "/estimates/4/edit" for 127.0.0.1 at 2017-04-27 04:43:36 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"4"}
  [1m[36mProduct Load (1.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (3.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (6.4ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (3.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.9ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (3.2ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (1.4ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
  [1m[36mUser Load (1.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.6ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 4]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (8, 9, 10)[0m
  [1m[36mStageProduct Load (1.1ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 8]]
  [1m[36mStageProductSet Load (0.8ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 7[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 9]]
  [1m[36mStageProductSet Load (2.8ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 8[0m
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.9ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 10]]
  [1m[36mStageProductSet Load (0.8ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 9[0m
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 9]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 3[0m
  [1m[36mProductSet Load (0.7ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (2.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.9ms)
  [1m[36mClientFile Load (0.6ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 4]]
  Rendered estimates/_technical_file_fields.html.haml (3.5ms)
  [1m[36mTechnicalFile Load (0.7ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 4]]
  Rendered estimates/_discount.html.haml (7.4ms)
  Rendered estimates/_stages.html.haml (19.4ms)
  Rendered estimates/_form.html.haml (94.9ms)
  Rendered estimates/edit.html.haml within layouts/application (98.5ms)
  Rendered layouts/_header.html.haml (13.6ms)
Completed 200 OK in 1866ms (Views: 1685.6ms | ActiveRecord: 50.7ms)


Started GET "/estimates/4/edit" for 127.0.0.1 at 2017-04-27 04:44:46 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"4"}
  [1m[36mProduct Load (7.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.9ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (3.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (1.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.5ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.5ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (1.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.1ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.9ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (2.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (4.2ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (4.2ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (2.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (1.4ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.5ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 4]]
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (8, 9, 10)[0m
  [1m[36mStageProduct Load (1.9ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 8]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 7[0m
  [1m[36mProduct Load (1.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (1.2ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 9]]
  [1m[36mStageProductSet Load (1.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 8[0m
  [1m[36mProduct Load (3.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 10]]
  [1m[36mStageProductSet Load (2.3ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 9[0m
  [1m[36mProduct Load (1.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 9]]
  [1m[36mStageProductSetValue Load (1.4ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 3[0m
  [1m[36mProductSet Load (1.3ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (1.6ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (2.5ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (11.4ms)
  [1m[36mClientFile Load (1.7ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 4]]
  Rendered estimates/_technical_file_fields.html.haml (10.1ms)
  [1m[36mTechnicalFile Load (1.3ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 4]]
  Rendered estimates/_discount.html.haml (9.7ms)
  Rendered estimates/_stages.html.haml (22.0ms)
  Rendered estimates/_form.html.haml (194.6ms)
  Rendered estimates/edit.html.haml within layouts/application (198.9ms)
  Rendered layouts/_header.html.haml (28.0ms)
Completed 200 OK in 1708ms (Views: 1062.5ms | ActiveRecord: 141.1ms)


Started GET "/estimates/4/edit" for 127.0.0.1 at 2017-04-27 04:45:45 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"4"}
  [1m[36mProduct Load (1.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (4.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.5ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.5ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (2.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (3.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.8ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (3.3ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (1.6ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (3.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (4.2ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (2.9ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.4ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.5ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 4]]
  [1m[36mStageProduct Load (2.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (8, 9, 10)[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 8]]
  [1m[36mStageProductSet Load (3.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 7[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (2.3ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 9]]
  [1m[36mStageProductSet Load (3.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 8[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (3.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 10]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 9[0m
  [1m[36mProduct Load (2.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 9]]
  [1m[36mStageProductSetValue Load (0.5ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 3[0m
  [1m[36mProductSet Load (0.6ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (3.0ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.5ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (6.2ms)
  [1m[36mClientFile Load (0.5ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 4]]
  Rendered estimates/_technical_file_fields.html.haml (3.5ms)
  [1m[36mTechnicalFile Load (2.0ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 4]]
  Rendered estimates/_discount.html.haml (8.5ms)
  Rendered estimates/_stages.html.haml (32.8ms)
  Rendered estimates/_form.html.haml (121.7ms)
  Rendered estimates/edit.html.haml within layouts/application (124.8ms)
  Rendered layouts/_header.html.haml (11.3ms)
Completed 200 OK in 2171ms (Views: 1980.1ms | ActiveRecord: 63.1ms)


Started GET "/estimates/4/edit" for 127.0.0.1 at 2017-04-27 04:45:59 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"4"}
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.1ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (2.1ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (3.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (3.0ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (1.2ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (1.6ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (1.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (1.3ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (1.3ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (1.4ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.6ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
  [1m[36mUser Load (2.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.4ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (2.8ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 4]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (8, 9, 10)[0m
  [1m[36mStageProduct Load (1.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 8]]
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 7[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 9]]
  [1m[36mStageProductSet Load (2.8ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 8[0m
  [1m[36mProduct Load (1.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 10]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 9[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 9]]
  [1m[36mStageProductSetValue Load (0.6ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 3[0m
  [1m[36mProductSet Load (0.8ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.8ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.5ms)
  [1m[36mClientFile Load (0.5ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 4]]
  Rendered estimates/_technical_file_fields.html.haml (3.3ms)
  [1m[36mTechnicalFile Load (0.5ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 4]]
  Rendered estimates/_discount.html.haml (8.0ms)
  Rendered estimates/_stages.html.haml (21.7ms)
  Rendered estimates/_form.html.haml (83.0ms)
  Rendered estimates/edit.html.haml within layouts/application (87.7ms)
  Rendered layouts/_header.html.haml (17.1ms)
Completed 200 OK in 799ms (Views: 619.7ms | ActiveRecord: 48.2ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 04:46:50 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.4ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.5ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.3ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.3ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.5ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (7.9ms)
  Rendered estimates/_technical_file_fields.html.haml (5.2ms)
  Rendered estimates/_discount.html.haml (8.8ms)
  Rendered estimates/_stages.html.haml (15.5ms)
  Rendered estimates/_form.html.haml (136.4ms)
  Rendered estimates/new.html.haml within layouts/application (139.4ms)
  Rendered layouts/_header.html.haml (28.0ms)
Completed 200 OK in 1162ms (Views: 809.5ms | ActiveRecord: 72.0ms)


Started POST "/estimates" for 127.0.0.1 at 2017-04-27 04:47:49 +0300
Processing by EstimatesController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"6wzkcq0GI5HoGm7xAPDskRI4NMTaiamNPQ0sgmzVOnNnvef7994p8M3K8gF9cuzRaaXmJ/jyWeeHIhNdf8mYYg==", "commit"=>"Сохранить", "estimate"=>{"price"=>"3795.0631999999996", "name"=>"Тестовая смета", "client_id"=>"1", "area"=>"100", "first_floor_height"=>"1800", "second_floor_height_min"=>"0.0", "second_floor_height_max"=>"0.0", "third_floor_height_min"=>"0.0", "third_floor_height_max"=>"0.0", "discount_title"=>"", "discount_by_stages"=>{"0"=>"0", "1"=>"0", "2"=>"0"}}, "json_stages"=>"[{\"number\":1,\"text\":{\"name\":\"Первый этап\",\"summ\":\"Итого по первому этапу:\",\"summ_dis\":\"по первому этапу\",\"discount\":\"Итого по первому этапу со скидкой:\"},\"products\":[{\"id\":1,\"name\":\"Простой продукт 1 этап\",\"unit\":\"шт\",\"custom\":false,\"sets\":[],\"profit\":\"100.0\",\"price_with_work\":\"70.0\",\"price_without_work\":\"10.0\",\"$$hashKey\":\"object:36\",\"quantity\":\"1\",\"with_work\":true,\"price\":\"70.03570\"}],\"price\":70.0357,\"total_price\":70.0357,\"aggregated_price\":70.0357,\"$$hashKey\":\"object:25\"},{\"number\":2,\"text\":{\"name\":\"Второй этап\",\"summ\":\"Итого по двум этапам:\",\"summ_dis\":\"по второму этапу\",\"discount\":\"Итого по двум этапам со скидкой:\"},\"products\":[{\"id\":2,\"name\":\"Простой продукт 2 этап\",\"unit\":\"м3\",\"custom\":false,\"sets\":[],\"profit\":\"50.0\",\"price_with_work\":\"50.0\",\"price_without_work\":\"50.0\",\"$$hashKey\":\"object:43\",\"quantity\":\"1\",\"with_work\":true,\"price\":\"50.0275\"}],\"price\":50.0275,\"total_price\":50.0275,\"aggregated_price\":120.06320000000001,\"$$hashKey\":\"object:26\"},{\"number\":3,\"text\":{\"name\":\"Третий этап\",\"summ\":\"Итого по трем этапам:\",\"summ_dis\":\"по третьему этапу\",\"discount\":\"Итого по трем этапам со скидкой:\"},\"products\":[{\"id\":3,\"name\":\"Конфигурируемый продукт 3 этап\",\"unit\":\"кг\",\"custom\":true,\"sets\":[{\"id\":1,\"name\":\"Сборка 1\",\"items\":[{\"id\":1,\"name\":\"Составляющая 1\",\"value\":{\"id\":1,\"name\":\"Примитив 1\",\"unit\":\"лист\",\"price\":\"10.0\",\"work_primitive\":false},\"$$hashKey\":\"object:52\",\"quantity\":\"1\"},{\"id\":2,\"name\":\"Составляющая 2\",\"value\":{\"id\":6,\"name\":\"Примитив 6\",\"unit\":\"лист\",\"price\":\"60.0\",\"work_primitive\":true},\"$$hashKey\":\"object:53\",\"quantity\":\"1\"}],\"$$hashKey\":\"object:49\",\"selected\":true}],\"profit\":\"150.0\",\"price_with_work\":70,\"price_without_work\":10,\"$$hashKey\":\"object:47\",\"quantity\":1,\"with_work\":true,\"price\":3674.9999999999995}],\"price\":3674.9999999999995,\"total_price\":3674.9999999999995,\"aggregated_price\":3795.0631999999996,\"$$hashKey\":\"object:27\"}]", "data"=>""}
  [1m[36mProduct Load (4.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.9ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.9ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (1.1ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (1.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (2.2ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (2.0ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (1.5ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.1ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (3.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Unpermitted parameters: second_floor_height_min, second_floor_height_max, third_floor_height_min, third_floor_height_max, discount_by_stages
  [1m[35m (0.9ms)[0m  [1m[35mBEGIN[0m
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (3.2ms)[0m  [1m[32mINSERT INTO "estimates" ("name", "client_id", "first_floor_height", "price", "area", "discount_title", "discount_by_stages", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["name", "Тестовая смета"], ["client_id", 1], ["first_floor_height", #<BigDecimal:7fe5f8b8e378,'0.18E4',9(18)>], ["price", #<BigDecimal:7fe5f8b8e800,'0.3795063199 9999996E4',27(27)>], ["area", #<BigDecimal:7fe5f8b8e558,'0.1E3',9(18)>], ["discount_title", ""], ["discount_by_stages", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x00558408c0a788 "decimal[]"  elements_type=nil needs quotation>, values=["0", "0", "0"]>], ["created_at", 2017-04-27 01:47:49 UTC], ["updated_at", 2017-04-27 01:47:49 UTC]]
  [1m[36mAudited::Audit Load (0.9ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 5], ["auditable_type", "Estimate"], ["LIMIT", 1]]
  [1m[35mSQL (4.4ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 5], ["auditable_type", "Estimate"], ["user_id", 1], ["user_type", "User"], ["action", "create"], ["audited_changes", "---\nname: Тестовая смета\nclient_id: 1\nfloors: \nfirst_floor_height: !ruby/object:BigDecimal 18:0.18E4\nsecond_floor_height_min: !ruby/object:BigDecimal 18:0.0\nsecond_floor_height_max: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_min: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_max: !ruby/object:BigDecimal 18:0.0\nprice: !ruby/object:BigDecimal 27:0.37950631999999996E4\narea: !ruby/object:BigDecimal 18:0.1E3\nprice_by_area: \nprice_by_stage:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_area_per_stage:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\ndiscount_title: ''\ndiscount_by_stages:\n- '0'\n- '0'\n- '0'\ndiscount_amount:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated_discounted:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_area_per_stage_discounted:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nsigned: false\ndeleted_at: \nsigning_date: \nuser_id: \n"], ["version", 1], ["remote_address", "127.0.0.1"], ["request_uuid", "8eaabb55-7d03-4dbc-9839-4c681bcccaa7"], ["created_at", 2017-04-27 01:47:49 UTC]]
  [1m[35m (1.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["estimate_id", 5], ["number", 1], ["LIMIT", 1]]
  [1m[35m (1.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "stages" ("estimate_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["estimate_id", 5], ["number", 1], ["price", #<BigDecimal:55840d2df9b0,'0.700357E2',18(36)>], ["total_price", #<BigDecimal:55840d2dea88,'0.7004E2',18(36)>], ["created_at", 2017-04-27 01:47:49 UTC], ["updated_at", 2017-04-27 01:47:49 UTC]]
  [1m[35m (1.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND ("stage_products"."product_id" != 1)[0m  [["stage_id", 11]]
  [1m[36mStageProduct Load (0.9ms)[0m  [1m[34mSELECT  "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND "stage_products"."product_id" = $2 LIMIT $3[0m  [["stage_id", 11], ["product_id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (5.4ms)[0m  [1m[32mINSERT INTO "stage_products" ("product_id", "stage_id", "quantity", "price_with_work", "created_at", "updated_at", "price_without_work") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["product_id", 1], ["stage_id", 11], ["quantity", 1], ["price_with_work", #<BigDecimal:7fe608d9ee28,'0.7E2',9(18)>], ["created_at", 2017-04-27 01:48:19 UTC], ["updated_at", 2017-04-27 01:48:19 UTC], ["price_without_work", #<BigDecimal:7fe608d9ddc0,'0.1E2',9(18)>]]
  [1m[35m (3.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (2.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["estimate_id", 5], ["number", 2], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "stages" ("estimate_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["estimate_id", 5], ["number", 2], ["price", #<BigDecimal:7fe5fa93dd60,'0.500275E2',18(36)>], ["total_price", #<BigDecimal:7fe5fa93da90,'0.5003E2',18(36)>], ["created_at", 2017-04-27 01:48:19 UTC], ["updated_at", 2017-04-27 01:48:19 UTC]]
  [1m[35m (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND ("stage_products"."product_id" != 2)[0m  [["stage_id", 12]]
  [1m[36mStageProduct Load (1.1ms)[0m  [1m[34mSELECT  "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND "stage_products"."product_id" = $2 LIMIT $3[0m  [["stage_id", 12], ["product_id", 2], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.9ms)[0m  [1m[32mINSERT INTO "stage_products" ("product_id", "stage_id", "quantity", "price_with_work", "created_at", "updated_at", "price_without_work") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["product_id", 2], ["stage_id", 12], ["quantity", 1], ["price_with_work", #<BigDecimal:7fe5f50e3548,'0.5E2',9(18)>], ["created_at", 2017-04-27 01:48:32 UTC], ["updated_at", 2017-04-27 01:48:32 UTC], ["price_without_work", #<BigDecimal:7fe5f50e2ad0,'0.5E2',9(18)>]]
  [1m[35m (4.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (0.6ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["estimate_id", 5], ["number", 3], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "stages" ("estimate_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["estimate_id", 5], ["number", 3], ["price", #<BigDecimal:7fe5f4dee540,'0.3675E4',9(36)>], ["total_price", #<BigDecimal:7fe5f4dee2e8,'0.3675E4',9(36)>], ["created_at", 2017-04-27 01:48:32 UTC], ["updated_at", 2017-04-27 01:48:32 UTC]]
  [1m[35m (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND ("stage_products"."product_id" != 3)[0m  [["stage_id", 13]]
  [1m[36mStageProduct Load (1.2ms)[0m  [1m[34mSELECT  "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND "stage_products"."product_id" = $2 LIMIT $3[0m  [["stage_id", 13], ["product_id", 3], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (1.2ms)[0m  [1m[32mINSERT INTO "stage_products" ("product_id", "stage_id", "quantity", "price_with_work", "created_at", "updated_at", "price_without_work") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["product_id", 3], ["stage_id", 13], ["quantity", 1], ["price_with_work", #<BigDecimal:7fe5f63ea650,'0.7E2',9(27)>], ["created_at", 2017-04-27 01:49:36 UTC], ["updated_at", 2017-04-27 01:49:36 UTC], ["price_without_work", #<BigDecimal:7fe5f63e9bd8,'0.1E2',9(27)>]]
  [1m[35m (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSet Load (0.8ms)[0m  [1m[34mSELECT  "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1 AND "stage_product_sets"."product_set_id" = $2 LIMIT $3[0m  [["stage_product_id", 12], ["product_set_id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "stage_product_sets" ("stage_product_id", "product_set_id", "selected", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["stage_product_id", 12], ["product_set_id", 1], ["selected", true], ["created_at", 2017-04-27 01:49:36 UTC], ["updated_at", 2017-04-27 01:49:36 UTC]]
  [1m[35m (1.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSetValue Load (1.2ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1 AND ("stage_product_set_values"."product_template_id" NOT IN (1, 2))[0m  [["stage_product_set_id", 4]]
  [1m[36mStageProductSetValue Load (1.6ms)[0m  [1m[34mSELECT  "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1 AND "stage_product_set_values"."product_template_id" = $2 LIMIT $3[0m  [["stage_product_set_id", 4], ["product_template_id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (1.0ms)[0m  [1m[32mINSERT INTO "stage_product_set_values" ("stage_product_set_id", "product_template_id", "constructor_object_id", "quantity", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["stage_product_set_id", 4], ["product_template_id", 1], ["constructor_object_id", 1], ["quantity", 1], ["created_at", 2017-04-27 01:49:36 UTC], ["updated_at", 2017-04-27 01:49:36 UTC]]
  [1m[35m (1.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSetValue Load (0.5ms)[0m  [1m[34mSELECT  "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1 AND "stage_product_set_values"."product_template_id" = $2 LIMIT $3[0m  [["stage_product_set_id", 4], ["product_template_id", 2], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "stage_product_set_values" ("stage_product_set_id", "product_template_id", "constructor_object_id", "quantity", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["stage_product_set_id", 4], ["product_template_id", 2], ["constructor_object_id", 6], ["quantity", 1], ["created_at", 2017-04-27 01:49:36 UTC], ["updated_at", 2017-04-27 01:49:36 UTC]]
  [1m[35m (4.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mAudited::Audit Load (0.8ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 5], ["auditable_type", "Estimate"], ["LIMIT", 1]]
  [1m[35mSQL (2.2ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 5], ["auditable_type", "Estimate"], ["user_id", 1], ["user_type", "User"], ["action", "update"], ["audited_changes", "---\nfloors:\n- \n- !ruby/object:BigDecimal 18:0.1E1\nprice_by_area:\n- \n- !ruby/object:BigDecimal 27:0.3795E2\nprice_by_stage:\n- - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n- - !ruby/object:BigDecimal 27:0.700357E2\n  - !ruby/object:BigDecimal 27:0.500275E2\n  - !ruby/object:BigDecimal 27:0.3675E4\nprice_by_stage_aggregated:\n- - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n- - !ruby/object:BigDecimal 27:0.700357E2\n  - !ruby/object:BigDecimal 18:0.1200632E3\n  - !ruby/object:BigDecimal 18:0.37950632E4\nprice_by_area_per_stage:\n- - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n- - !ruby/object:BigDecimal 18:0.7E0\n  - !ruby/object:BigDecimal 18:0.12E1\n  - !ruby/object:BigDecimal 18:0.3795E2\nprice_by_stage_aggregated_discounted:\n- - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n- - !ruby/object:BigDecimal 18:0.700357E2\n  - !ruby/object:BigDecimal 18:0.1200632E3\n  - !ruby/object:BigDecimal 18:0.37950632E4\nprice_by_area_per_stage_discounted:\n- - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n- - !ruby/object:BigDecimal 18:0.7E0\n  - !ruby/object:BigDecimal 18:0.12E1\n  - !ruby/object:BigDecimal 18:0.3795E2\n"], ["version", 2], ["remote_address", "127.0.0.1"], ["request_uuid", "8eaabb55-7d03-4dbc-9839-4c681bcccaa7"], ["created_at", 2017-04-27 01:49:36 UTC]]
  [1m[35mSQL (0.8ms)[0m  [1m[33mUPDATE "estimates" SET "floors" = $1, "price_by_area" = $2, "price_by_stage" = $3, "price_by_stage_aggregated" = $4, "price_by_area_per_stage" = $5, "price_by_stage_aggregated_discounted" = $6, "price_by_area_per_stage_discounted" = $7, "updated_at" = $8 WHERE "estimates"."id" = $9[0m  [["floors", #<BigDecimal:7fe5e51b8168,'0.1E1',9(27)>], ["price_by_area", #<BigDecimal:7fe5e51b80c8,'0.3795E2',18(36)>], ["price_by_stage", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x00558408c0a788 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fe5e51a02e8,'0.700357E2',18(36)>, #<BigDecimal:7fe5e51a0130,'0.500275E2',18(36)>, #<BigDecimal:7fe5e51bbed0,'0.3675E4',9(36)>]>], ["price_by_stage_aggregated", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x00558408c0a788 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fe5e51a02e8,'0.700357E2',18(36)>, #<BigDecimal:7fe5e51bbcc8,'0.1200632E3',18(27)>, #<BigDecimal:7fe5e51bbc78,'0.37950632E4',18(27)>]>], ["price_by_area_per_stage", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x00558408c0a788 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fe5e51bb980,'0.7E0',9(18)>, #<BigDecimal:7fe5e51bae68,'0.12E1',18(27)>, #<BigDecimal:7fe5e51ba850,'0.3795E2',18(27)>]>], ["price_by_stage_aggregated_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x00558408c0a788 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fe5e51bb1d8,'0.700357E2',18(27)>, #<BigDecimal:7fe5e51baad0,'0.1200632E3',18(27)>, #<BigDecimal:7fe5e51ba4b8,'0.37950632E4',18(27)>]>], ["price_by_area_per_stage_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x00558408c0a788 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fe5e51bafa8,'0.7E0',9(18)>, #<BigDecimal:7fe5e51ba9b8,'0.12E1',18(27)>, #<BigDecimal:7fe5e51ba3c8,'0.3795E2',18(27)>]>], ["updated_at", 2017-04-27 01:49:36 UTC], ["id", 5]]
  [1m[35m (3.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mCOMMIT[0m
Redirected to http://localhost:3000/estimates
Completed 302 Found in 107540ms (ActiveRecord: 113.9ms)


Started GET "/estimates" for 127.0.0.1 at 2017-04-27 04:49:36 +0300
Processing by EstimatesController#index as HTML
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Redirected to http://localhost:3000/clients
Completed 302 Found in 4ms (ActiveRecord: 0.7ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 04:49:36 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (1.3ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (11.4ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (4.7ms)
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (4.5ms)
  Rendered clients/_table.html.haml (26.2ms)
  [1m[36mUserClient Load (2.1ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (64.3ms)
  Rendered layouts/_header.html.haml (14.0ms)
Completed 200 OK in 700ms (Views: 675.5ms | ActiveRecord: 14.0ms)


Started GET "/clients/1/edit" for 127.0.0.1 at 2017-04-27 04:50:09 +0300
Processing by ClientsController#edit as HTML
  Parameters: {"id"=>"1"}
  [1m[36mClient Load (3.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUserClient Exists (1.5ms)[0m  [1m[34mSELECT  1 AS one FROM "user_clients" WHERE "user_clients"."user_id" = 1 AND "user_clients"."client_id" = 1 LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUserClient Load (0.5ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" WHERE "user_clients"."client_id" = 1 AND ("user_clients"."user_id" != 1)[0m
  Rendering clients/edit.html.haml within layouts/application
  [1m[36mUserClient Load (0.6ms)[0m  [1m[34mSELECT  "user_clients".* FROM "user_clients" WHERE "user_clients"."user_id" = 1 AND "user_clients"."client_id" = 1 LIMIT $1[0m  [["LIMIT", 1]]
  Rendered clients/_form.html.haml (32.7ms)
  Rendered clients/edit.html.haml within layouts/application (36.0ms)
  Rendered layouts/_header.html.haml (8.8ms)
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE ("users"."id" != $1)[0m  [["id", 1]]
Completed 200 OK in 723ms (Views: 575.9ms | ActiveRecord: 20.5ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 04:50:12 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (11.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (0.8ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (8.5ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (5.6ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (3.8ms)
  Rendered clients/_table.html.haml (23.1ms)
  [1m[36mUserClient Load (1.1ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (82.3ms)
  Rendered layouts/_header.html.haml (12.8ms)
Completed 200 OK in 729ms (Views: 701.7ms | ActiveRecord: 21.2ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 04:50:13 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.5ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (5.0ms)
  Rendered estimates/_listing.html.haml (1.1ms)
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (24.4ms)
  Rendered layouts/_header.html.haml (10.5ms)
Completed 200 OK in 617ms (Views: 598.9ms | ActiveRecord: 2.5ms)


Started GET "/estimates/5/edit" for 127.0.0.1 at 2017-04-27 04:50:26 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"5"}
  [1m[36mProduct Load (1.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.9ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (6.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (1.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.8ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.0ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 5], ["LIMIT", 1]]
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (1.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 5]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (11, 12, 13)[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 11]]
  [1m[36mStageProductSet Load (2.4ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 10[0m
  [1m[36mProduct Load (4.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 12]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 11[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 13]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 12[0m
  [1m[36mProduct Load (1.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 12]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 4[0m
  [1m[36mProductSet Load (0.6ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.5ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 4]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
Started GET "/estimates/5/edit" for 127.0.0.1 at 2017-04-27 04:52:19 +0300
  [1m[36mExpense Load (0.4ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 5]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (11, 12, 13)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 11]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 10[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 12]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 11[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 13]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 12[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
Processing by EstimatesController#edit as HTML
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 12]]
  Parameters: {"id"=>"5"}
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 4[0m
  [1m[36mProduct Load (1.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 4]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mUnit Load (6.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mProductComposition Load (24.9ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mClient Load (4.1ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  [1m[36mConstructorObject Load (9.3ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.9ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (1.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (1.0ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (6.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (2.5ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 5], ["LIMIT", 1]]
  [1m[36mUser Load (6.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.8ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (1.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 5]]
  [1m[36mStageProduct Load (1.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (11, 12, 13)[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 11]]
  [1m[36mStageProductSet Load (0.9ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 10[0m
  [1m[36mProduct Load (2.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 12]]
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 11[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 13]]
  [1m[36mStageProductSet Load (0.4ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 12[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (1.0ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 12]]
  [1m[36mStageProductSetValue Load (1.2ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 4[0m
  [1m[36mProductSet Load (0.6ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.9ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 4]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (1.0ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (23.8ms)
  Rendered estimates/_client_file_fields.html.haml (14.5ms)
  [1m[36mClientFile Load (3.4ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 5]]
  [1m[36mClientFile Load (3.1ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 5]]
  Rendered estimates/_technical_file_fields.html.haml (5.6ms)
  Rendered estimates/_technical_file_fields.html.haml (1.6ms)
  [1m[36mTechnicalFile Load (2.6ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 5]]
  Rendered estimates/_discount.html.haml (8.0ms)
  Rendered estimates/_stages.html.haml (21.1ms)
  [1m[36mTechnicalFile Load (39.6ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 5]]
  Rendered estimates/_form.html.haml (150.5ms)
  Rendered estimates/_discount.html.haml (2.7ms)
  Rendered estimates/edit.html.haml within layouts/application (156.2ms)
  Rendered estimates/_stages.html.haml (2.1ms)
  Rendered estimates/_form.html.haml (2545.5ms)
  Rendered estimates/edit.html.haml within layouts/application (2582.2ms)
  Rendered layouts/_header.html.haml (10.9ms)
Completed 200 OK in 3719ms (Views: 1288.6ms | ActiveRecord: 107.3ms)


  Rendered layouts/_header.html.haml (3.1ms)
Completed 200 OK in 117160ms (Views: 3659.9ms | ActiveRecord: 157.6ms)


Started GET "/estimates/5/edit" for 127.0.0.1 at 2017-04-27 04:54:07 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"5"}
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.4ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (3.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (1.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.8ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (2.5ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 5], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.8ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.8ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 5]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (11, 12, 13)[0m
  [1m[36mStageProduct Load (1.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 11]]
  [1m[36mStageProductSet Load (3.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 10[0m
  [1m[36mProduct Load (1.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 12]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 11[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 13]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 12[0m
  [1m[36mProduct Load (1.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (1.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 12]]
  [1m[36mStageProductSetValue Load (1.5ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 4[0m
  [1m[36mProductSet Load (0.6ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.8ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 4]]
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.5ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.6ms)
  [1m[36mClientFile Load (0.7ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 5]]
  Rendered estimates/_technical_file_fields.html.haml (3.8ms)
  [1m[36mTechnicalFile Load (0.5ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 5]]
  Rendered estimates/_discount.html.haml (7.4ms)
  Rendered estimates/_stages.html.haml (18.3ms)
  Rendered estimates/_form.html.haml (99.9ms)
  Rendered estimates/edit.html.haml within layouts/application (103.0ms)
  Rendered layouts/_header.html.haml (9.6ms)
Completed 200 OK in 23113ms (Views: 1519.6ms | ActiveRecord: 41.9ms)


Started GET "/estimates/5/edit" for 127.0.0.1 at 2017-04-27 04:55:05 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"5"}
  [1m[36mProduct Load (1.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (4.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.2ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.7ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (1.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (1.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.2ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 5], ["LIMIT", 1]]
  [1m[36mUser Load (3.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.7ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (1.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 5]]
  [1m[36mStageProduct Load (1.4ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (11, 12, 13)[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 11]]
  [1m[36mStageProductSet Load (1.2ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 10[0m
  [1m[36mProduct Load (1.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 12]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 11[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 13]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 12[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 12]]
  [1m[36mStageProductSetValue Load (10.6ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 4[0m
  [1m[36mProductSet Load (7.8ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 4]]
  [1m[36mCACHE (0.2ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (3.3ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (6.0ms)
  [1m[36mClientFile Load (0.9ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 5]]
  Rendered estimates/_technical_file_fields.html.haml (3.5ms)
  [1m[36mTechnicalFile Load (0.8ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 5]]
  Rendered estimates/_discount.html.haml (6.8ms)
  Rendered estimates/_stages.html.haml (18.5ms)
  Rendered estimates/_form.html.haml (97.7ms)
  Rendered estimates/edit.html.haml within layouts/application (101.8ms)
  Rendered layouts/_header.html.haml (10.9ms)
Completed 200 OK in 10598ms (Views: 1542.6ms | ActiveRecord: 65.5ms)


Started GET "/estimates/5/edit" for 127.0.0.1 at 2017-04-27 04:56:55 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"5"}
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.0ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (2.1ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (2.2ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 5], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.8ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 5]]
  [1m[36mStageProduct Load (1.4ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (11, 12, 13)[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 11]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 10[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 12]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 11[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 13]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 12[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 12]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 4[0m
  [1m[36mProductSet Load (0.5ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.8ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 4]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.6ms)
  [1m[36mClientFile Load (0.7ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 5]]
  Rendered estimates/_technical_file_fields.html.haml (3.6ms)
  [1m[36mTechnicalFile Load (0.6ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 5]]
  Rendered estimates/_discount.html.haml (7.4ms)
  Rendered estimates/_stages.html.haml (15.7ms)
  Rendered estimates/_form.html.haml (82.5ms)
  Rendered estimates/edit.html.haml within layouts/application (88.2ms)
  Rendered layouts/_header.html.haml (9.8ms)
Completed 200 OK in 9386ms (Views: 1579.8ms | ActiveRecord: 31.4ms)


Started GET "/estimates/5/edit" for 127.0.0.1 at 2017-04-27 04:59:13 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"5"}
  [1m[36mProduct Load (1.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (4.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (2.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (3.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (3.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.9ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (5.5ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (1.9ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (2.2ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.5ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (1.3ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (2.3ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 5], ["LIMIT", 1]]
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 04:59:44 +0300
Started GET "/estimates/5/edit" for 127.0.0.1 at 2017-04-27 04:59:44 +0300
Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 04:59:44 +0300
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Processing by EstimatesController#new as HTML
Processing by EstimatesController#edit as HTML
Processing by EstimatesController#new as HTML
  [1m[36mStage Load (5.5ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 5]]
  Parameters: {"id"=>"5"}
  [1m[36mProduct Load (45.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mProduct Load (5.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mStageProduct Load (11.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (11, 12, 13)[0m
  [1m[36mProduct Load (51.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (11.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mUnit Load (20.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProductComposition Load (18.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mStageProduct Load (27.9ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 11]]
  [1m[36mConstructorObject Load (3.1ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mStageProductSet Load (3.4ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 10[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (9.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mProductComposition Load (12.2ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProduct Load (12.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mConstructorObject Load (8.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProductComposition Load (11.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mUnit Load (6.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProduct Load (1.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mStageProduct Load (9.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 12]]
  [1m[36mConstructorObject Load (7.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mStageProductSet Load (1.1ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 11[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mUnit Load (3.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProduct Load (3.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 13]]
  [1m[36mProductComposition Load (24.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 12[0m
  [1m[36mConstructorObject Load (4.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mProduct Load (3.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mUnit Load (9.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProductComposition Load (16.5ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 12]]
  [1m[36mProductSet Load (8.2ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mConstructorObject Load (5.1ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mStageProductSetValue Load (6.3ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 4[0m
  [1m[36mProductTemplateSet Load (4.3ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProductTemplate Load (1.7ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProductSet Load (8.7ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mProduct Load (25.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mProduct Load (2.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mStageProductSetValue Load (3.6ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 4]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mUnit Load (7.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mUnit Load (4.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mUnit Load (12.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (2.3ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductSet Load (10.0ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductSet Load (14.7ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplate Load (8.4ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mProductTemplateSet Load (6.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplateSet Load (10.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mConstructorObject Load (10.9ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (4.8ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mUnit Load (5.2ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  [1m[36mUnit Load (33.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplate Load (50.7ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (21.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  Rendered estimates/_client_file_fields.html.haml (3.7ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplateSet Load (10.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mUnit Load (8.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mUser Load (10.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClientFile Load (15.1ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 5]]
  [1m[36mProductTemplateSet Load (8.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (22.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (15.7ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.5ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (5.3ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendered estimates/_technical_file_fields.html.haml (4.1ms)
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mUnit Load (4.5ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (11.9ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTechnicalFile Load (12.8ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 5]]
  [1m[36mProductTemplate Load (7.2ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendered estimates/_discount.html.haml (12.4ms)
  [1m[36mClient Load (20.5ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  [1m[36mConstructorObject Load (30.2ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  Rendered estimates/_stages.html.haml (42.3ms)
  [1m[36mUnit Load (61.2ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  Rendered estimates/_client_file_fields.html.haml (2.5ms)
  Rendered estimates/_form.html.haml (221.2ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (6.4ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  Rendered estimates/_technical_file_fields.html.haml (1.6ms)
  Rendered estimates/edit.html.haml within layouts/application (243.1ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (10.6ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 5], ["LIMIT", 1]]
  Rendered estimates/_discount.html.haml (9.1ms)
  Rendered estimates/_stages.html.haml (4.2ms)
  [1m[36mUser Load (13.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (40.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendered estimates/_form.html.haml (172.9ms)
Started GET "/estimates/5/edit" for 127.0.0.1 at 2017-04-27 04:59:58 +0300
  Rendered estimates/new.html.haml within layouts/application (13225.8ms)
  [1m[36mExpense Load (3.3ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (80.7ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (33.2ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 5]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mStageProduct Load (5.1ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (11, 12, 13)[0m
  [1m[36mStageProduct Load (173.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 11]]
  [1m[36mClient Load (46.4ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  [1m[36mStageProductSet Load (35.9ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 10[0m
  Rendered estimates/_client_file_fields.html.haml (4.7ms)
  [1m[36mProduct Load (26.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  Rendered estimates/_technical_file_fields.html.haml (19.7ms)
  Rendered estimates/_discount.html.haml (12.9ms)
  [1m[36mStageProduct Load (51.9ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 12]]
  [1m[36mStageProductSet Load (4.3ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 11[0m
  [1m[36mProduct Load (4.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  Rendered estimates/_stages.html.haml (33.0ms)
  Rendered estimates/_form.html.haml (407.5ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  Rendered estimates/new.html.haml within layouts/application (571.0ms)
  [1m[36mStageProduct Load (8.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 13]]
  [1m[36mStageProductSet Load (18.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 12[0m
  [1m[36mProduct Load (3.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (22.4ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 12]]
  [1m[36mStageProductSetValue Load (14.2ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 4[0m
  [1m[36mProductSet Load (33.2ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (14.8ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 4]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (14.4ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (1.5ms)
  [1m[36mClientFile Load (29.3ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 5]]
  Rendered estimates/_technical_file_fields.html.haml (1.4ms)
  [1m[36mTechnicalFile Load (1.2ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 5]]
  Rendered estimates/_discount.html.haml (50.5ms)
  Rendered estimates/_stages.html.haml (3.0ms)
  Rendered estimates/_form.html.haml (368.9ms)
  Rendered estimates/edit.html.haml within layouts/application (406.7ms)
  Rendered layouts/_header.html.haml (58.8ms)
Completed 200 OK in 18260ms (Views: 17839.0ms | ActiveRecord: 219.3ms)


  Rendered layouts/_header.html.haml (48.9ms)
Completed 200 OK in 49761ms (Views: 18000.3ms | ActiveRecord: 181.5ms)


  Rendered layouts/_header.html.haml (67.9ms)
Completed 200 OK in 18290ms (Views: 4560.3ms | ActiveRecord: 494.1ms)


  Rendered layouts/_header.html.haml (3.7ms)
Completed 200 OK in 18378ms (Views: 3822.5ms | ActiveRecord: 754.2ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 05:00:03 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"5"}
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (1.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (2.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.0ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (1.0ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.9ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.9ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (1.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (2.3ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 5], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.6ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 5]]
  [1m[36mStageProduct Load (1.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (11, 12, 13)[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 11]]
  [1m[36mStageProductSet Load (0.9ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 10[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 12]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 11[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 13]]
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 12[0m
  [1m[36mProduct Load (3.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 12]]
  [1m[36mStageProductSetValue Load (1.4ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 4[0m
  [1m[36mProductSet Load (0.7ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.9ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 4]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (12.0ms)
  [1m[36mClientFile Load (0.7ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 5]]
  Rendered estimates/_technical_file_fields.html.haml (5.8ms)
  [1m[36mTechnicalFile Load (0.7ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 5]]
  Rendered estimates/_discount.html.haml (8.3ms)
  Rendered estimates/_stages.html.haml (16.9ms)
  Rendered estimates/_form.html.haml (156.7ms)
  Rendered estimates/edit.html.haml within layouts/application (163.1ms)
  Rendered layouts/_header.html.haml (27.6ms)
Completed 200 OK in 1261ms (Views: 701.0ms | ActiveRecord: 119.0ms)


Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (9.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (2.2ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (3.5ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (1.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (5.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (3.1ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (1.5ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (2.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (3.1ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (1.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (2.2ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (2.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (1.4ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (8.6ms)
  Rendered estimates/_technical_file_fields.html.haml (4.6ms)
  Rendered estimates/_discount.html.haml (9.0ms)
  Rendered estimates/_stages.html.haml (23.2ms)
  Rendered estimates/_form.html.haml (149.1ms)
  Rendered estimates/new.html.haml within layouts/application (203.7ms)
  Rendered layouts/_header.html.haml (33.3ms)
Completed 200 OK in 1176ms (Views: 817.2ms | ActiveRecord: 46.7ms)


Started GET "/estimates/5/edit" for 127.0.0.1 at 2017-04-27 05:00:51 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"5"}
  [1m[36mProduct Load (1.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.5ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (1.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.9ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (1.1ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.0ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 5], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.7ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (1.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 5]]
  [1m[36mStageProduct Load (1.2ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (11, 12, 13)[0m
  [1m[36mStageProduct Load (1.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 11]]
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 10[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 12]]
  [1m[36mStageProductSet Load (0.9ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 11[0m
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 13]]
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 12[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 12]]
  [1m[36mStageProductSetValue Load (0.6ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 4[0m
  [1m[36mProductSet Load (2.8ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (2.4ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 4]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (6.2ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.4ms)
  [1m[36mClientFile Load (2.7ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 5]]
  Rendered estimates/_technical_file_fields.html.haml (3.3ms)
  [1m[36mTechnicalFile Load (2.9ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 5]]
  Rendered estimates/_discount.html.haml (7.2ms)
  Rendered estimates/_stages.html.haml (18.6ms)
  Rendered estimates/_form.html.haml (101.6ms)
  Rendered estimates/edit.html.haml within layouts/application (104.8ms)
  Rendered layouts/_header.html.haml (10.4ms)
Completed 200 OK in 2217ms (Views: 1887.3ms | ActiveRecord: 80.7ms)


Started GET "/estimates/5/edit" for 127.0.0.1 at 2017-04-27 05:01:17 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"5"}
  [1m[36mProduct Load (3.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (1.4ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.0ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (3.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (1.1ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (2.3ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (2.7ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 5], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.8ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 5]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (11, 12, 13)[0m
  [1m[36mStageProduct Load (1.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 11]]
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 10[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 12]]
  [1m[36mStageProductSet Load (1.3ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 11[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 13]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 12[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 12]]
  [1m[36mStageProductSetValue Load (1.3ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 4[0m
  [1m[36mProductSet Load (0.7ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.9ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 4]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.3ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (4.4ms)
  [1m[36mClientFile Load (0.5ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 5]]
  Rendered estimates/_technical_file_fields.html.haml (4.2ms)
  [1m[36mTechnicalFile Load (0.5ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 5]]
  Rendered estimates/_discount.html.haml (8.5ms)
  Rendered estimates/_stages.html.haml (21.9ms)
  Rendered estimates/_form.html.haml (99.7ms)
  Rendered estimates/edit.html.haml within layouts/application (106.4ms)
  Rendered layouts/_header.html.haml (10.6ms)
Completed 200 OK in 906ms (Views: 740.0ms | ActiveRecord: 41.8ms)


Started GET "/estimates/5/edit" for 127.0.0.1 at 2017-04-27 05:01:49 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"5"}
  [1m[36mProduct Load (1.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (2.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (2.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.8ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (1.1ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (1.1ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.2ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (1.9ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (2.1ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 5], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.6ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.6ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 5]]
  [1m[36mStageProduct Load (2.1ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (11, 12, 13)[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 11]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 10[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (5.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 12]]
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 11[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 13]]
  [1m[36mStageProductSet Load (1.2ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 12[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 12]]
  [1m[36mStageProductSetValue Load (0.6ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 4[0m
  [1m[36mProductSet Load (0.7ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 4]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (4.9ms)
  [1m[36mClientFile Load (0.8ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 5]]
  Rendered estimates/_technical_file_fields.html.haml (3.4ms)
  [1m[36mTechnicalFile Load (0.6ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 5]]
  Rendered estimates/_discount.html.haml (7.7ms)
  Rendered estimates/_stages.html.haml (16.2ms)
  Rendered estimates/_form.html.haml (85.9ms)
  Rendered estimates/edit.html.haml within layouts/application (89.6ms)
  Rendered layouts/_header.html.haml (10.7ms)
Completed 200 OK in 1813ms (Views: 1646.8ms | ActiveRecord: 44.4ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 05:02:54 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (1.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (2.5ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.1ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (1.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (1.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (1.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.0ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (2.5ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (1.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.5ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (1.1ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (3.1ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (1.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (1.3ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (5.4ms)
  Rendered estimates/_technical_file_fields.html.haml (3.9ms)
  Rendered estimates/_discount.html.haml (8.8ms)
  Rendered estimates/_stages.html.haml (24.9ms)
  Rendered estimates/_form.html.haml (98.4ms)
  Rendered estimates/new.html.haml within layouts/application (102.3ms)
  Rendered layouts/_header.html.haml (14.2ms)
Completed 200 OK in 900ms (Views: 798.6ms | ActiveRecord: 29.2ms)


Started GET "/estimates/5/edit" for 127.0.0.1 at 2017-04-27 05:05:41 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"5"}
  [1m[36mProduct Load (1.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (6.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (2.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (5.2ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.9ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (1.4ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (2.7ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 5], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.6ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 5]]
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (11, 12, 13)[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 11]]
  [1m[36mStageProductSet Load (0.9ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 10[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 12]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 11[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 13]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 12[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 12]]
  [1m[36mStageProductSetValue Load (5.8ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 4[0m
  [1m[36mProductSet Load (1.4ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 4]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.6ms)
  [1m[36mClientFile Load (0.7ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 5]]
  Rendered estimates/_technical_file_fields.html.haml (3.7ms)
  [1m[36mTechnicalFile Load (0.6ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 5]]
  Rendered estimates/_discount.html.haml (8.0ms)
  Rendered estimates/_stages.html.haml (24.9ms)
  Rendered estimates/_form.html.haml (91.5ms)
  Rendered estimates/edit.html.haml within layouts/application (97.5ms)
  Rendered layouts/_header.html.haml (8.4ms)
Completed 200 OK in 1830ms (Views: 1593.1ms | ActiveRecord: 50.4ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 05:08:49 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (7.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (2.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (5.9ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (2.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (2.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (1.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (1.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (1.4ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (2.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (1.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (2.5ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (2.3ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (2.1ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (1.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (2.1ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (2.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (1.1ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.0ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (1.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.6ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (1.4ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.2ms)
  Rendered estimates/_technical_file_fields.html.haml (3.4ms)
  Rendered estimates/_discount.html.haml (6.9ms)
  Rendered estimates/_stages.html.haml (16.9ms)
  Rendered estimates/_form.html.haml (89.8ms)
  Rendered estimates/new.html.haml within layouts/application (93.1ms)
  Rendered layouts/_header.html.haml (9.5ms)
Completed 200 OK in 1913ms (Views: 1794.7ms | ActiveRecord: 49.9ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 05:11:14 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (4.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (2.1ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.6ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (2.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.6ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.5ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.6ms)
  Rendered estimates/_technical_file_fields.html.haml (3.9ms)
  Rendered estimates/_discount.html.haml (7.6ms)
  Rendered estimates/_stages.html.haml (20.2ms)
  Rendered estimates/_form.html.haml (102.1ms)
  Rendered estimates/new.html.haml within layouts/application (105.8ms)
  Rendered layouts/_header.html.haml (8.7ms)
Completed 200 OK in 1870ms (Views: 1772.8ms | ActiveRecord: 23.2ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 05:11:27 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (2.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (3.5ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (1.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (1.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.2ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (1.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.6ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (4.7ms)
  Rendered estimates/_technical_file_fields.html.haml (3.5ms)
  Rendered estimates/_discount.html.haml (8.8ms)
  Rendered estimates/_stages.html.haml (16.1ms)
  Rendered estimates/_form.html.haml (84.2ms)
  Rendered estimates/new.html.haml within layouts/application (87.7ms)
  Rendered layouts/_header.html.haml (12.4ms)
Completed 200 OK in 752ms (Views: 653.1ms | ActiveRecord: 23.3ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 05:11:37 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (4.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (3.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (2.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.7ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (1.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (4.5ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (2.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (1.1ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.1ms)
  Rendered estimates/_technical_file_fields.html.haml (3.0ms)
  Rendered estimates/_discount.html.haml (36.7ms)
  Rendered estimates/_stages.html.haml (18.9ms)
  Rendered estimates/_form.html.haml (112.1ms)
  Rendered estimates/new.html.haml within layouts/application (118.9ms)
  Rendered layouts/_header.html.haml (11.6ms)
Completed 200 OK in 1692ms (Views: 1584.6ms | ActiveRecord: 31.4ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 05:12:52 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (4.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (5.2ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (2.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (3.1ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (1.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (2.6ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (5.5ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (1.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (1.0ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.3ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (2.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.9ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (1.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (1.0ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (2.3ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (5.3ms)
  Rendered estimates/_technical_file_fields.html.haml (7.3ms)
  Rendered estimates/_discount.html.haml (11.1ms)
  Rendered estimates/_stages.html.haml (28.8ms)
  Rendered estimates/_form.html.haml (113.9ms)
  Rendered estimates/new.html.haml within layouts/application (121.5ms)
  Rendered layouts/_header.html.haml (16.5ms)
Completed 200 OK in 2941ms (Views: 2824.4ms | ActiveRecord: 43.4ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 05:13:23 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (3.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (3.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (1.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (2.1ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (1.1ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (1.3ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (2.1ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (1.0ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.0ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.5ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (3.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (2.1ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.5ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (7.4ms)
  Rendered estimates/_technical_file_fields.html.haml (7.4ms)
  Rendered estimates/_discount.html.haml (6.4ms)
  Rendered estimates/_stages.html.haml (21.6ms)
  Rendered estimates/_form.html.haml (96.7ms)
  Rendered estimates/new.html.haml within layouts/application (101.2ms)
  Rendered layouts/_header.html.haml (15.3ms)
Completed 200 OK in 2043ms (Views: 1925.5ms | ActiveRecord: 31.3ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 05:13:58 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (1.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (5.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (4.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (1.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (1.3ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (1.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.1ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (1.2ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (1.4ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (1.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (2.0ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (1.1ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.5ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (2.2ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.3ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (2.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (1.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.5ms)
  Rendered estimates/_technical_file_fields.html.haml (3.9ms)
  Rendered estimates/_discount.html.haml (7.8ms)
  Rendered estimates/_stages.html.haml (19.1ms)
  Rendered estimates/_form.html.haml (90.4ms)
  Rendered estimates/new.html.haml within layouts/application (93.5ms)
  Rendered layouts/_header.html.haml (13.5ms)
Completed 200 OK in 2049ms (Views: 1948.7ms | ActiveRecord: 35.3ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-27 05:14:40 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (3.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.3ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (3.8ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (2.4ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (1.2ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (2.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (2.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (1.0ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (3.5ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (2.9ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (8.1ms)
  Rendered estimates/_technical_file_fields.html.haml (5.8ms)
  Rendered estimates/_discount.html.haml (13.5ms)
  Rendered estimates/_stages.html.haml (26.2ms)
  Rendered estimates/_form.html.haml (136.9ms)
  Rendered estimates/new.html.haml within layouts/application (141.5ms)
  Rendered layouts/_header.html.haml (10.1ms)
Completed 200 OK in 2670ms (Views: 2550.9ms | ActiveRecord: 35.5ms)


Started POST "/estimates" for 127.0.0.1 at 2017-04-27 05:16:28 +0300
Processing by EstimatesController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"ROlULlUoIFbtSjOjXFBHe0XjzAvrGFPdZWA9EYzZI+XIWFenD/AqN8iar1Mh0kc7Pn4e6Mljo7ffTwLOn8WB9A==", "commit"=>"Сохранить", "estimate"=>{"price"=>"302", "name"=>"124124", "client_id"=>"1", "area"=>"4214", "first_floor_height"=>"124124", "second_floor_height_min"=>"0.0", "second_floor_height_max"=>"0.0", "third_floor_height_min"=>"0.0", "third_floor_height_max"=>"0.0", "discount_title"=>"", "discount_by_stages"=>{"0"=>"0", "1"=>"0", "2"=>"0"}}, "json_stages"=>"[{\"number\":1,\"text\":{\"name\":\"Первый этап\",\"summ\":\"Итого по первому этапу:\",\"summ_dis\":\"по первому этапу\",\"discount\":\"Итого по первому этапу со скидкой:\"},\"products\":[{\"id\":1,\"name\":\"Простой продукт 1 этап\",\"unit\":\"шт\",\"custom\":false,\"sets\":[],\"profit\":100,\"price_with_work\":70,\"price_without_work\":10,\"$$hashKey\":\"object:14\",\"quantity\":\"1\",\"with_work\":false,\"price\":20.5}],\"price\":20.5,\"total_price\":20.5,\"aggregated_price\":20.5,\"$$hashKey\":\"object:3\"},{\"number\":2,\"text\":{\"name\":\"Второй этап\",\"summ\":\"Итого по двум этапам:\",\"summ_dis\":\"по второму этапу\",\"discount\":\"Итого по двум этапам со скидкой:\"},\"products\":[{\"id\":2,\"name\":\"Простой продукт 2 этап\",\"unit\":\"м3\",\"custom\":false,\"sets\":[],\"profit\":50,\"price_with_work\":50,\"price_without_work\":50,\"$$hashKey\":\"object:21\",\"quantity\":\"1\",\"with_work\":true,\"price\":77.5}],\"price\":77.5,\"total_price\":77.5,\"aggregated_price\":98,\"$$hashKey\":\"object:4\"},{\"number\":3,\"text\":{\"name\":\"Третий этап\",\"summ\":\"Итого по трем этапам:\",\"summ_dis\":\"по третьему этапу\",\"discount\":\"Итого по трем этапам со скидкой:\"},\"products\":[{\"id\":3,\"name\":\"Конфигурируемый продукт 3 этап\",\"unit\":\"кг\",\"custom\":true,\"sets\":[{\"id\":1,\"name\":\"Сборка 1\",\"items\":[{\"id\":1,\"name\":\"Составляющая 1\",\"value\":{\"id\":1,\"name\":\"Примитив 1\",\"unit\":\"лист\",\"price\":10,\"work_primitive\":false},\"$$hashKey\":\"object:31\",\"quantity\":\"2\"},{\"id\":2,\"name\":\"Составляющая 2\",\"value\":{\"id\":6,\"name\":\"Примитив 6\",\"unit\":\"лист\",\"price\":60,\"work_primitive\":true},\"$$hashKey\":\"object:32\",\"quantity\":\"1\"}],\"$$hashKey\":\"object:28\",\"selected\":true}],\"profit\":150,\"price_with_work\":80,\"price_without_work\":20,\"$$hashKey\":\"object:26\",\"quantity\":1,\"with_work\":true,\"price\":204}],\"price\":204,\"total_price\":204,\"aggregated_price\":302,\"$$hashKey\":\"object:5\"}]", "data"=>""}
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.1ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (1.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.0ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (2.9ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.5ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (3.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Unpermitted parameters: second_floor_height_min, second_floor_height_max, third_floor_height_min, third_floor_height_max, discount_by_stages
  [1m[35m (2.5ms)[0m  [1m[35mBEGIN[0m
  [1m[36mClient Load (1.6ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (9.1ms)[0m  [1m[32mINSERT INTO "estimates" ("name", "client_id", "first_floor_height", "price", "area", "discount_title", "discount_by_stages", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["name", "124124"], ["client_id", 1], ["first_floor_height", #<BigDecimal:7fe5e6b60390,'0.124124E6',9(18)>], ["price", #<BigDecimal:7fe5e6b60570,'0.302E3',9(18)>], ["area", #<BigDecimal:7fe5e6b60480,'0.4214E4',9(18)>], ["discount_title", ""], ["discount_by_stages", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x00558408c0a788 "decimal[]"  elements_type=nil needs quotation>, values=["0", "0", "0"]>], ["created_at", 2017-04-27 02:16:28 UTC], ["updated_at", 2017-04-27 02:16:28 UTC]]
  [1m[36mAudited::Audit Load (2.6ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 6], ["auditable_type", "Estimate"], ["LIMIT", 1]]
  [1m[35mSQL (1.7ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 6], ["auditable_type", "Estimate"], ["user_id", 1], ["user_type", "User"], ["action", "create"], ["audited_changes", "---\nname: '124124'\nclient_id: 1\nfloors: \nfirst_floor_height: !ruby/object:BigDecimal 18:0.124124E6\nsecond_floor_height_min: !ruby/object:BigDecimal 18:0.0\nsecond_floor_height_max: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_min: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_max: !ruby/object:BigDecimal 18:0.0\nprice: !ruby/object:BigDecimal 18:0.302E3\narea: !ruby/object:BigDecimal 18:0.4214E4\nprice_by_area: \nprice_by_stage:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_area_per_stage:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\ndiscount_title: ''\ndiscount_by_stages:\n- '0'\n- '0'\n- '0'\ndiscount_amount:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated_discounted:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_area_per_stage_discounted:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nsigned: false\ndeleted_at: \nsigning_date: \nuser_id: \n"], ["version", 1], ["remote_address", "127.0.0.1"], ["request_uuid", "da3c7e8a-3d12-4d5f-a80e-9ee0257aa193"], ["created_at", 2017-04-27 02:16:28 UTC]]
  [1m[35m (1.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["estimate_id", 6], ["number", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "stages" ("estimate_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["estimate_id", 6], ["number", 1], ["price", #<BigDecimal:7fe5e5c97020,'0.205E2',18(36)>], ["total_price", #<BigDecimal:7fe5e5c96dc8,'0.205E2',18(36)>], ["created_at", 2017-04-27 02:16:28 UTC], ["updated_at", 2017-04-27 02:16:28 UTC]]
  [1m[35m (1.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (1.1ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND ("stage_products"."product_id" != 1)[0m  [["stage_id", 14]]
  [1m[36mStageProduct Load (1.0ms)[0m  [1m[34mSELECT  "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND "stage_products"."product_id" = $2 LIMIT $3[0m  [["stage_id", 14], ["product_id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "stage_products" ("product_id", "stage_id", "quantity", "price_with_work", "created_at", "updated_at", "with_work", "price_without_work") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["product_id", 1], ["stage_id", 14], ["quantity", 1], ["price_with_work", #<BigDecimal:7fe5f5591860,'0.7E2',9(27)>], ["created_at", 2017-04-27 02:16:34 UTC], ["updated_at", 2017-04-27 02:16:34 UTC], ["with_work", false], ["price_without_work", #<BigDecimal:7fe5f5590d98,'0.1E2',9(27)>]]
  [1m[35m (1.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (0.8ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["estimate_id", 6], ["number", 2], ["LIMIT", 1]]
  [1m[35m (1.7ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (3.1ms)[0m  [1m[32mINSERT INTO "stages" ("estimate_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["estimate_id", 6], ["number", 2], ["price", #<BigDecimal:7fe5f54fc148,'0.775E2',18(36)>], ["total_price", #<BigDecimal:7fe5f54c7f10,'0.775E2',18(36)>], ["created_at", 2017-04-27 02:16:34 UTC], ["updated_at", 2017-04-27 02:16:34 UTC]]
  [1m[35m (2.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND ("stage_products"."product_id" != 2)[0m  [["stage_id", 15]]
  [1m[36mStageProduct Load (1.5ms)[0m  [1m[34mSELECT  "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND "stage_products"."product_id" = $2 LIMIT $3[0m  [["stage_id", 15], ["product_id", 2], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "stage_products" ("product_id", "stage_id", "quantity", "price_with_work", "created_at", "updated_at", "price_without_work") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["product_id", 2], ["stage_id", 15], ["quantity", 1], ["price_with_work", #<BigDecimal:7fe5e67509f8,'0.5E2',9(27)>], ["created_at", 2017-04-27 02:16:35 UTC], ["updated_at", 2017-04-27 02:16:35 UTC], ["price_without_work", #<BigDecimal:7fe5e674fe40,'0.5E2',9(27)>]]
  [1m[35m (2.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (3.3ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["estimate_id", 6], ["number", 3], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (1.1ms)[0m  [1m[32mINSERT INTO "stages" ("estimate_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["estimate_id", 6], ["number", 3], ["price", #<BigDecimal:7fe5e66e3448,'0.204E3',9(27)>], ["total_price", #<BigDecimal:7fe5e66e33a8,'0.204E3',9(36)>], ["created_at", 2017-04-27 02:16:35 UTC], ["updated_at", 2017-04-27 02:16:35 UTC]]
  [1m[35m (4.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND ("stage_products"."product_id" != 3)[0m  [["stage_id", 16]]
  [1m[36mStageProduct Load (1.3ms)[0m  [1m[34mSELECT  "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND "stage_products"."product_id" = $2 LIMIT $3[0m  [["stage_id", 16], ["product_id", 3], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (1.1ms)[0m  [1m[32mINSERT INTO "stage_products" ("product_id", "stage_id", "quantity", "price_with_work", "created_at", "updated_at", "price_without_work") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["product_id", 3], ["stage_id", 16], ["quantity", 1], ["price_with_work", #<BigDecimal:7fe5e5ac8ac8,'0.8E2',9(27)>], ["created_at", 2017-04-27 02:16:36 UTC], ["updated_at", 2017-04-27 02:16:36 UTC], ["price_without_work", #<BigDecimal:7fe5e5abbf08,'0.2E2',9(27)>]]
  [1m[35m (2.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSet Load (2.1ms)[0m  [1m[34mSELECT  "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1 AND "stage_product_sets"."product_set_id" = $2 LIMIT $3[0m  [["stage_product_id", 15], ["product_set_id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "stage_product_sets" ("stage_product_id", "product_set_id", "selected", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["stage_product_id", 15], ["product_set_id", 1], ["selected", true], ["created_at", 2017-04-27 02:16:36 UTC], ["updated_at", 2017-04-27 02:16:36 UTC]]
  [1m[35m (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1 AND ("stage_product_set_values"."product_template_id" NOT IN (1, 2))[0m  [["stage_product_set_id", 5]]
  [1m[36mStageProductSetValue Load (0.9ms)[0m  [1m[34mSELECT  "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1 AND "stage_product_set_values"."product_template_id" = $2 LIMIT $3[0m  [["stage_product_set_id", 5], ["product_template_id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "stage_product_set_values" ("stage_product_set_id", "product_template_id", "constructor_object_id", "quantity", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["stage_product_set_id", 5], ["product_template_id", 1], ["constructor_object_id", 1], ["quantity", 2], ["created_at", 2017-04-27 02:16:36 UTC], ["updated_at", 2017-04-27 02:16:36 UTC]]
  [1m[35m (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSetValue Load (0.8ms)[0m  [1m[34mSELECT  "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1 AND "stage_product_set_values"."product_template_id" = $2 LIMIT $3[0m  [["stage_product_set_id", 5], ["product_template_id", 2], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "stage_product_set_values" ("stage_product_set_id", "product_template_id", "constructor_object_id", "quantity", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["stage_product_set_id", 5], ["product_template_id", 2], ["constructor_object_id", 6], ["quantity", 1], ["created_at", 2017-04-27 02:16:36 UTC], ["updated_at", 2017-04-27 02:16:36 UTC]]
  [1m[35m (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mAudited::Audit Load (1.3ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 6], ["auditable_type", "Estimate"], ["LIMIT", 1]]
  [1m[35mSQL (3.2ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 6], ["auditable_type", "Estimate"], ["user_id", 1], ["user_type", "User"], ["action", "update"], ["audited_changes", "---\nfloors:\n- \n- !ruby/object:BigDecimal 18:0.1E1\nprice_by_area:\n- \n- !ruby/object:BigDecimal 18:0.7E-1\nprice_by_stage:\n- - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n- - !ruby/object:BigDecimal 27:0.205E2\n  - !ruby/object:BigDecimal 27:0.775E2\n  - !ruby/object:BigDecimal 18:0.204E3\nprice_by_stage_aggregated:\n- - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n- - !ruby/object:BigDecimal 27:0.205E2\n  - !ruby/object:BigDecimal 18:0.98E2\n  - !ruby/object:BigDecimal 18:0.302E3\nprice_by_area_per_stage:\n- - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n- - !ruby/object:BigDecimal 27:0.0\n  - !ruby/object:BigDecimal 18:0.2E-1\n  - !ruby/object:BigDecimal 18:0.7E-1\nprice_by_stage_aggregated_discounted:\n- - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n- - !ruby/object:BigDecimal 18:0.205E2\n  - !ruby/object:BigDecimal 18:0.98E2\n  - !ruby/object:BigDecimal 18:0.302E3\nprice_by_area_per_stage_discounted:\n- - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n- - !ruby/object:BigDecimal 27:0.0\n  - !ruby/object:BigDecimal 18:0.2E-1\n  - !ruby/object:BigDecimal 18:0.7E-1\n"], ["version", 2], ["remote_address", "127.0.0.1"], ["request_uuid", "da3c7e8a-3d12-4d5f-a80e-9ee0257aa193"], ["created_at", 2017-04-27 02:16:36 UTC]]
  [1m[35mSQL (2.2ms)[0m  [1m[33mUPDATE "estimates" SET "floors" = $1, "price_by_area" = $2, "price_by_stage" = $3, "price_by_stage_aggregated" = $4, "price_by_area_per_stage" = $5, "price_by_stage_aggregated_discounted" = $6, "price_by_area_per_stage_discounted" = $7, "updated_at" = $8 WHERE "estimates"."id" = $9[0m  [["floors", #<BigDecimal:7fe5e59829e8,'0.1E1',9(27)>], ["price_by_area", #<BigDecimal:7fe5e5982948,'0.7E-1',9(27)>], ["price_by_stage", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x00558408c0a788 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fe5e598a490,'0.205E2',18(36)>, #<BigDecimal:7fe5e598a2d8,'0.775E2',18(36)>, #<BigDecimal:7fe5e598a0f8,'0.204E3',9(27)>]>], ["price_by_stage_aggregated", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x00558408c0a788 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fe5e598a490,'0.205E2',18(36)>, #<BigDecimal:7fe5e598a058,'0.98E2',9(27)>, #<BigDecimal:7fe5e598a008,'0.302E3',9(18)>]>], ["price_by_area_per_stage", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x00558408c0a788 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fe5e5989d10,'0.0',9(36)>, #<BigDecimal:7fe5e5989108,'0.2E-1',9(27)>, #<BigDecimal:7fe5e5988aa0,'0.7E-1',9(27)>]>], ["price_by_stage_aggregated_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x00558408c0a788 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fe5e59894f0,'0.205E2',18(27)>, #<BigDecimal:7fe5e5988d20,'0.98E2',9(18)>, #<BigDecimal:7fe5e5988780,'0.302E3',9(18)>]>], ["price_by_area_per_stage_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x00558408c0a788 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fe5e5989298,'0.0',9(36)>, #<BigDecimal:7fe5e5988c08,'0.2E-1',9(27)>, #<BigDecimal:7fe5e5988690,'0.7E-1',9(27)>]>], ["updated_at", 2017-04-27 02:16:36 UTC], ["id", 6]]
  [1m[35m (1.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.4ms)[0m  [1m[35mCOMMIT[0m
Redirected to http://localhost:3000/estimates
Completed 302 Found in 7862ms (ActiveRecord: 100.7ms)


Started GET "/estimates" for 127.0.0.1 at 2017-04-27 05:16:36 +0300
Processing by EstimatesController#index as HTML
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Redirected to http://localhost:3000/clients
Completed 302 Found in 3ms (ActiveRecord: 0.8ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 05:16:36 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (1.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (1.3ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (1.0ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (12.2ms)
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (6.1ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (9.8ms)
  Rendered clients/_table.html.haml (33.3ms)
  [1m[36mUserClient Load (0.9ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (80.4ms)
  Rendered layouts/_header.html.haml (10.7ms)
Completed 200 OK in 584ms (Views: 556.9ms | ActiveRecord: 15.1ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 05:16:41 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (1.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (5.0ms)
  Rendered estimates/_listing.html.haml (1.1ms)
  Rendered estimates/_listing.html.haml (1.9ms)
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (34.1ms)
  Rendered layouts/_header.html.haml (13.1ms)
Completed 200 OK in 633ms (Views: 616.2ms | ActiveRecord: 3.8ms)


Started GET "/estimates/6/edit" for 127.0.0.1 at 2017-04-27 05:16:47 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"6"}
  [1m[36mProduct Load (3.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (2.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.4ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (3.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (1.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.8ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.5ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (2.5ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (1.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.4ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.6ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 6]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (14, 15, 16)[0m
  [1m[36mStageProduct Load (1.1ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 14]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 13[0m
  [1m[36mProduct Load (3.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 15]]
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 14[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (1.4ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 16]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 15[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 15]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 5[0m
  [1m[36mProductSet Load (0.7ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 5]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.6ms)
  [1m[36mClientFile Load (0.8ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 6]]
  Rendered estimates/_technical_file_fields.html.haml (3.9ms)
  [1m[36mTechnicalFile Load (0.6ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 6]]
  Rendered estimates/_discount.html.haml (7.5ms)
  Rendered estimates/_stages.html.haml (18.8ms)
  Rendered estimates/_form.html.haml (81.8ms)
  Rendered estimates/edit.html.haml within layouts/application (85.6ms)
  Rendered layouts/_header.html.haml (12.3ms)
Completed 200 OK in 908ms (Views: 748.8ms | ActiveRecord: 42.0ms)


Started GET "/estimates/6/edit" for 127.0.0.1 at 2017-04-27 05:18:02 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"6"}
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.9ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.2ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.8ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 6]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (14, 15, 16)[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 14]]
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 13[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 15]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 14[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 16]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 15[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 15]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 5[0m
  [1m[36mProductSet Load (0.8ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.8ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 5]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (10.2ms)
  [1m[36mClientFile Load (0.7ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 6]]
  Rendered estimates/_technical_file_fields.html.haml (6.6ms)
  [1m[36mTechnicalFile Load (0.6ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 6]]
  Rendered estimates/_discount.html.haml (7.7ms)
  Rendered estimates/_stages.html.haml (25.2ms)
  Rendered estimates/_form.html.haml (153.2ms)
  Rendered estimates/edit.html.haml within layouts/application (156.7ms)
  Rendered layouts/_header.html.haml (29.3ms)
Completed 200 OK in 2075ms (Views: 1605.6ms | ActiveRecord: 29.5ms)


Started PATCH "/estimates/6" for 127.0.0.1 at 2017-04-27 05:18:17 +0300
Processing by EstimatesController#update as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"SMdSbOGOwegQBqGAuQ/2Oq8qFJJ44xts9raK8VVg5uDEdlHlu1bLiTXWPXDEjfZ61LfGcVqY6wZMmbUuRnxE8Q==", "commit"=>"Сохранить", "estimate"=>{"price"=>"272", "name"=>"Тестовая смета 2", "client_id"=>"1", "area"=>"4214", "first_floor_height"=>"124124.0", "second_floor_height_min"=>"0.0", "second_floor_height_max"=>"0.0", "third_floor_height_min"=>"0.0", "third_floor_height_max"=>"0.0", "discount_title"=>"", "discount_by_stages"=>{"0"=>"0", "1"=>"0", "2"=>"0"}}, "json_stages"=>"[{\"number\":1,\"text\":{\"name\":\"Первый этап\",\"summ\":\"Итого по первому этапу:\",\"summ_dis\":\"по первому этапу\",\"discount\":\"Итого по первому этапу со скидкой:\"},\"price\":143.5,\"total_price\":143.5,\"products\":[{\"id\":1,\"name\":\"Простой продукт 1 этап\",\"unit\":\"шт\",\"custom\":false,\"profit\":100,\"price_with_work\":70,\"price_without_work\":10,\"with_work\":true,\"quantity\":1,\"sets\":[],\"price\":143.5,\"$$hashKey\":\"object:14\"}],\"aggregated_price\":143.5,\"$$hashKey\":\"object:3\"},{\"number\":2,\"text\":{\"name\":\"Второй этап\",\"summ\":\"Итого по двум этапам:\",\"summ_dis\":\"по второму этапу\",\"discount\":\"Итого по двум этапам со скидкой:\"},\"price\":77.5,\"total_price\":77.5,\"products\":[{\"id\":2,\"name\":\"Простой продукт 2 этап\",\"unit\":\"м3\",\"custom\":false,\"profit\":50,\"price_with_work\":50,\"price_without_work\":50,\"with_work\":true,\"quantity\":1,\"sets\":[],\"price\":77.5,\"$$hashKey\":\"object:17\"}],\"aggregated_price\":221,\"$$hashKey\":\"object:4\"},{\"number\":3,\"text\":{\"name\":\"Третий этап\",\"summ\":\"Итого по трем этапам:\",\"summ_dis\":\"по третьему этапу\",\"discount\":\"Итого по трем этапам со скидкой:\"},\"price\":51,\"total_price\":51,\"products\":[{\"id\":3,\"name\":\"Конфигурируемый продукт 3 этап\",\"unit\":\"кг\",\"custom\":true,\"profit\":150,\"price_with_work\":80,\"price_without_work\":20,\"with_work\":false,\"quantity\":1,\"sets\":[{\"id\":1,\"name\":\"Сборка 1\",\"selected\":true,\"items\":[{\"id\":1,\"name\":\"Составляющая 1\",\"quantity\":2,\"value\":{\"id\":1,\"name\":\"Примитив 1\",\"unit\":\"лист\",\"price\":10,\"work_primitive\":false}},{\"id\":2,\"name\":\"Составляющая 2\",\"quantity\":1,\"value\":{\"id\":6,\"name\":\"Примитив 6\",\"unit\":\"лист\",\"price\":60,\"work_primitive\":true}}]}],\"price\":51,\"$$hashKey\":\"object:20\"}],\"aggregated_price\":272,\"$$hashKey\":\"object:5\"}]", "data"=>"", "id"=>"6"}
  [1m[36mProduct Load (2.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (2.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (3.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.9ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (2.7ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.9ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (7.8ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (2.9ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.0ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Unpermitted parameters: second_floor_height_min, second_floor_height_max, third_floor_height_min, third_floor_height_max, discount_by_stages
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mAudited::Audit Load (1.5ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 6], ["auditable_type", "Estimate"], ["LIMIT", 1]]
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 6], ["auditable_type", "Estimate"], ["user_id", 1], ["user_type", "User"], ["action", "update"], ["audited_changes", "---\nname:\n- '124124'\n- Тестовая смета 2\nprice:\n- !ruby/object:BigDecimal 18:0.302E3\n- !ruby/object:BigDecimal 18:0.272E3\n"], ["version", 3], ["remote_address", "127.0.0.1"], ["request_uuid", "318dc768-f538-447b-8d16-6e3c2822ead6"], ["created_at", 2017-04-27 02:18:18 UTC]]
  [1m[35mSQL (0.8ms)[0m  [1m[33mUPDATE "estimates" SET "name" = $1, "price" = $2, "updated_at" = $3 WHERE "estimates"."id" = $4[0m  [["name", "Тестовая смета 2"], ["price", #<BigDecimal:7fe5f8927e90,'0.272E3',9(18)>], ["updated_at", 2017-04-27 02:18:18 UTC], ["id", 6]]
  [1m[35m (1.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (2.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["estimate_id", 6], ["number", 1], ["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.7ms)[0m  [1m[33mUPDATE "stages" SET "price" = $1, "total_price" = $2, "updated_at" = $3 WHERE "stages"."id" = $4[0m  [["price", #<BigDecimal:7fe5f8647720,'0.1435E3',18(36)>], ["total_price", #<BigDecimal:7fe5f86473d8,'0.1435E3',18(36)>], ["updated_at", 2017-04-27 02:18:18 UTC], ["id", 14]]
  [1m[35m (1.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (3.9ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND ("stage_products"."product_id" != 1)[0m  [["stage_id", 14]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT  "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND "stage_products"."product_id" = $2 LIMIT $3[0m  [["stage_id", 14], ["product_id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (2.7ms)[0m  [1m[33mUPDATE "stage_products" SET "with_work" = $1, "updated_at" = $2 WHERE "stage_products"."id" = $3[0m  [["with_work", true], ["updated_at", 2017-04-27 02:18:18 UTC], ["id", 13]]
  [1m[35m (2.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (1.7ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["estimate_id", 6], ["number", 2], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (2.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND ("stage_products"."product_id" != 2)[0m  [["stage_id", 15]]
  [1m[36mStageProduct Load (3.2ms)[0m  [1m[34mSELECT  "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND "stage_products"."product_id" = $2 LIMIT $3[0m  [["stage_id", 15], ["product_id", 2], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["estimate_id", 6], ["number", 3], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (1.2ms)[0m  [1m[33mUPDATE "stages" SET "price" = $1, "total_price" = $2, "updated_at" = $3 WHERE "stages"."id" = $4[0m  [["price", #<BigDecimal:55840d9c75c0,'0.51E2',9(27)>], ["total_price", #<BigDecimal:55840d9c7390,'0.51E2',9(36)>], ["updated_at", 2017-04-27 02:18:18 UTC], ["id", 16]]
  [1m[35m (1.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND ("stage_products"."product_id" != 3)[0m  [["stage_id", 16]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT  "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND "stage_products"."product_id" = $2 LIMIT $3[0m  [["stage_id", 16], ["product_id", 3], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (3.4ms)[0m  [1m[33mUPDATE "stage_products" SET "with_work" = $1, "updated_at" = $2 WHERE "stage_products"."id" = $3[0m  [["with_work", false], ["updated_at", 2017-04-27 02:18:18 UTC], ["id", 15]]
  [1m[35m (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSet Load (2.1ms)[0m  [1m[34mSELECT  "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1 AND "stage_product_sets"."product_set_id" = $2 LIMIT $3[0m  [["stage_product_id", 15], ["product_set_id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSetValue Load (2.0ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1 AND ("stage_product_set_values"."product_template_id" NOT IN (1, 2))[0m  [["stage_product_set_id", 5]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT  "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1 AND "stage_product_set_values"."product_template_id" = $2 LIMIT $3[0m  [["stage_product_set_id", 5], ["product_template_id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT  "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1 AND "stage_product_set_values"."product_template_id" = $2 LIMIT $3[0m  [["stage_product_set_id", 5], ["product_template_id", 2], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[36mAudited::Audit Load (0.7ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 6], ["auditable_type", "Estimate"], ["LIMIT", 1]]
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 6], ["auditable_type", "Estimate"], ["user_id", 1], ["user_type", "User"], ["action", "update"], ["audited_changes", "---\nprice_by_area:\n- !ruby/object:BigDecimal 18:0.7E-1\n- !ruby/object:BigDecimal 18:0.6E-1\nprice_by_stage:\n- - !ruby/object:BigDecimal 18:0.205E2\n  - !ruby/object:BigDecimal 18:0.775E2\n  - !ruby/object:BigDecimal 18:0.204E3\n- - !ruby/object:BigDecimal 27:0.1435E3\n  - !ruby/object:BigDecimal 27:0.775E2\n  - !ruby/object:BigDecimal 18:0.51E2\nprice_by_stage_aggregated:\n- - !ruby/object:BigDecimal 18:0.205E2\n  - !ruby/object:BigDecimal 18:0.98E2\n  - !ruby/object:BigDecimal 18:0.302E3\n- - !ruby/object:BigDecimal 27:0.1435E3\n  - !ruby/object:BigDecimal 18:0.221E3\n  - !ruby/object:BigDecimal 18:0.272E3\nprice_by_area_per_stage:\n- - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.2E-1\n  - !ruby/object:BigDecimal 18:0.7E-1\n- - !ruby/object:BigDecimal 27:0.3E-1\n  - !ruby/object:BigDecimal 18:0.5E-1\n  - !ruby/object:BigDecimal 18:0.6E-1\nprice_by_stage_aggregated_discounted:\n- - !ruby/object:BigDecimal 18:0.205E2\n  - !ruby/object:BigDecimal 18:0.98E2\n  - !ruby/object:BigDecimal 18:0.302E3\n- - !ruby/object:BigDecimal 18:0.1435E3\n  - !ruby/object:BigDecimal 18:0.221E3\n  - !ruby/object:BigDecimal 18:0.272E3\nprice_by_area_per_stage_discounted:\n- - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.2E-1\n  - !ruby/object:BigDecimal 18:0.7E-1\n- - !ruby/object:BigDecimal 27:0.3E-1\n  - !ruby/object:BigDecimal 18:0.5E-1\n  - !ruby/object:BigDecimal 18:0.6E-1\n"], ["version", 4], ["remote_address", "127.0.0.1"], ["request_uuid", "318dc768-f538-447b-8d16-6e3c2822ead6"], ["created_at", 2017-04-27 02:18:18 UTC]]
  [1m[35mSQL (2.0ms)[0m  [1m[33mUPDATE "estimates" SET "price_by_area" = $1, "price_by_stage" = $2, "price_by_stage_aggregated" = $3, "price_by_area_per_stage" = $4, "price_by_stage_aggregated_discounted" = $5, "price_by_area_per_stage_discounted" = $6, "updated_at" = $7 WHERE "estimates"."id" = $8[0m  [["price_by_area", #<BigDecimal:55840d80fb88,'0.6E-1',9(27)>], ["price_by_stage", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x00558408c0a788 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:55840d842718,'0.1435E3',18(36)>, #<BigDecimal:55840d8407b0,'0.775E2',18(36)>, #<BigDecimal:55840d83fa40,'0.51E2',9(27)>]>], ["price_by_stage_aggregated", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x00558408c0a788 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:55840d842718,'0.1435E3',18(36)>, #<BigDecimal:55840d83f7e8,'0.221E3',9(27)>, #<BigDecimal:55840d83f798,'0.272E3',9(18)>]>], ["price_by_area_per_stage", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x00558408c0a788 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:55840d83e6e0,'0.3E-1',9(36)>, #<BigDecimal:55840d83b238,'0.5E-1',9(27)>, #<BigDecimal:55840d839460,'0.6E-1',9(27)>]>], ["price_by_stage_aggregated_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x00558408c0a788 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:55840d83c070,'0.1435E3',18(27)>, #<BigDecimal:55840d83a4c8,'0.221E3',9(18)>, #<BigDecimal:55840d82bdb0,'0.272E3',9(18)>]>], ["price_by_area_per_stage_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x00558408c0a788 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:55840d83b5f8,'0.3E-1',9(36)>, #<BigDecimal:55840d839fa0,'0.5E-1',9(27)>, #<BigDecimal:55840d82b9c8,'0.6E-1',9(27)>]>], ["updated_at", 2017-04-27 02:18:18 UTC], ["id", 6]]
  [1m[35m (3.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[35mCOMMIT[0m
Redirected to http://localhost:3000/estimates
Completed 302 Found in 325ms (ActiveRecord: 91.0ms)


Started GET "/estimates" for 127.0.0.1 at 2017-04-27 05:18:18 +0300
Processing by EstimatesController#index as HTML
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Redirected to http://localhost:3000/clients
Completed 302 Found in 7ms (ActiveRecord: 0.8ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 05:18:18 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (1.2ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (2.8ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (1.1ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (1.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (11.5ms)
  [1m[35m (2.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (6.5ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (5.3ms)
  Rendered clients/_table.html.haml (28.2ms)
  [1m[36mUserClient Load (1.0ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (71.9ms)
  Rendered layouts/_header.html.haml (18.1ms)
Completed 200 OK in 831ms (Views: 797.5ms | ActiveRecord: 17.7ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 05:18:58 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.0ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (9.6ms)
  Rendered estimates/_listing.html.haml (1.4ms)
  Rendered estimates/_listing.html.haml (3.1ms)
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (42.5ms)
  Rendered layouts/_header.html.haml (65.9ms)
Completed 200 OK in 925ms (Views: 757.8ms | ActiveRecord: 24.5ms)


Started GET "/estimates/6/edit" for 127.0.0.1 at 2017-04-27 05:19:03 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"6"}
  [1m[36mProduct Load (1.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (1.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (2.4ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.9ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (1.0ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (1.2ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (4.5ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 6]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (14, 15, 16)[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 14]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 13[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (3.4ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 15]]
  [1m[36mStageProductSet Load (1.2ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 14[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 16]]
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 15[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 15]]
  [1m[36mStageProductSetValue Load (0.9ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 5[0m
  [1m[36mProductSet Load (1.5ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 5]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (1.1ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (14.4ms)
  [1m[36mClientFile Load (0.8ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 6]]
  Rendered estimates/_technical_file_fields.html.haml (5.9ms)
  [1m[36mTechnicalFile Load (0.7ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 6]]
  Rendered estimates/_discount.html.haml (7.2ms)
  Rendered estimates/_stages.html.haml (21.1ms)
  Rendered estimates/_form.html.haml (128.9ms)
  Rendered estimates/edit.html.haml within layouts/application (132.2ms)
  Rendered layouts/_header.html.haml (10.3ms)
Completed 200 OK in 1155ms (Views: 719.4ms | ActiveRecord: 116.5ms)


Started PATCH "/estimates/6" for 127.0.0.1 at 2017-04-27 05:19:15 +0300
Processing by EstimatesController#update as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"pGy0V4Lbi0uJg42zHKnmGxwA5EL2n/lKkQIFGGj8YRQo3bfe2AOBKqxTEUNhK+ZbZ502odTkCSArLTrHe+DDBQ==", "commit"=>"Сохранить", "estimate"=>{"price"=>"425", "name"=>"Тестовая смета 2", "client_id"=>"1", "area"=>"4214", "first_floor_height"=>"124124.0", "second_floor_height_min"=>"0.0", "second_floor_height_max"=>"0.0", "third_floor_height_min"=>"0.0", "third_floor_height_max"=>"0.0", "discount_title"=>"", "discount_by_stages"=>{"0"=>"0", "1"=>"0", "2"=>"0"}}, "json_stages"=>"[{\"number\":1,\"text\":{\"name\":\"Первый этап\",\"summ\":\"Итого по первому этапу:\",\"summ_dis\":\"по первому этапу\",\"discount\":\"Итого по первому этапу со скидкой:\"},\"price\":143.5,\"total_price\":143.5,\"products\":[{\"id\":1,\"name\":\"Простой продукт 1 этап\",\"unit\":\"шт\",\"custom\":false,\"profit\":100,\"price_with_work\":70,\"price_without_work\":10,\"with_work\":true,\"quantity\":1,\"sets\":[],\"price\":143.5,\"$$hashKey\":\"object:15\"}],\"aggregated_price\":143.5,\"$$hashKey\":\"object:4\"},{\"number\":2,\"text\":{\"name\":\"Второй этап\",\"summ\":\"Итого по двум этапам:\",\"summ_dis\":\"по второму этапу\",\"discount\":\"Итого по двум этапам со скидкой:\"},\"price\":77.5,\"total_price\":77.5,\"products\":[{\"id\":2,\"name\":\"Простой продукт 2 этап\",\"unit\":\"м3\",\"custom\":false,\"profit\":50,\"price_with_work\":50,\"price_without_work\":50,\"with_work\":true,\"quantity\":1,\"sets\":[],\"price\":77.5,\"$$hashKey\":\"object:18\"}],\"aggregated_price\":221,\"$$hashKey\":\"object:5\"},{\"number\":3,\"text\":{\"name\":\"Третий этап\",\"summ\":\"Итого по трем этапам:\",\"summ_dis\":\"по третьему этапу\",\"discount\":\"Итого по трем этапам со скидкой:\"},\"price\":204,\"total_price\":204,\"products\":[{\"id\":3,\"name\":\"Конфигурируемый продукт 3 этап\",\"unit\":\"кг\",\"custom\":true,\"profit\":150,\"price_with_work\":80,\"price_without_work\":20,\"with_work\":true,\"quantity\":1,\"sets\":[{\"id\":1,\"name\":\"Сборка 1\",\"selected\":true,\"items\":[{\"id\":1,\"name\":\"Составляющая 1\",\"quantity\":2,\"value\":{\"id\":1,\"name\":\"Примитив 1\",\"unit\":\"лист\",\"price\":10,\"work_primitive\":false}},{\"id\":2,\"name\":\"Составляющая 2\",\"quantity\":1,\"value\":{\"id\":6,\"name\":\"Примитив 6\",\"unit\":\"лист\",\"price\":60,\"work_primitive\":true}}]}],\"price\":204,\"$$hashKey\":\"object:21\"}],\"aggregated_price\":425,\"$$hashKey\":\"object:6\"}]", "data"=>"", "id"=>"6"}
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.2ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (1.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.2ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.5ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (1.1ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.9ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (5.3ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (4.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Unpermitted parameters: second_floor_height_min, second_floor_height_max, third_floor_height_min, third_floor_height_max, discount_by_stages
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mClient Load (0.9ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mAudited::Audit Load (2.3ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 6], ["auditable_type", "Estimate"], ["LIMIT", 1]]
  [1m[35mSQL (0.9ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 6], ["auditable_type", "Estimate"], ["user_id", 1], ["user_type", "User"], ["action", "update"], ["audited_changes", "---\nprice:\n- !ruby/object:BigDecimal 18:0.272E3\n- !ruby/object:BigDecimal 18:0.425E3\n"], ["version", 5], ["remote_address", "127.0.0.1"], ["request_uuid", "c4b49c5b-73e6-48fe-979b-68cb51b42de2"], ["created_at", 2017-04-27 02:19:15 UTC]]
  [1m[35mSQL (1.0ms)[0m  [1m[33mUPDATE "estimates" SET "price" = $1, "updated_at" = $2 WHERE "estimates"."id" = $3[0m  [["price", #<BigDecimal:7fe5e51a0928,'0.425E3',9(18)>], ["updated_at", 2017-04-27 02:19:15 UTC], ["id", 6]]
  [1m[35m (4.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (0.9ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["estimate_id", 6], ["number", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (1.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND ("stage_products"."product_id" != 1)[0m  [["stage_id", 14]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT  "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND "stage_products"."product_id" = $2 LIMIT $3[0m  [["stage_id", 14], ["product_id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (1.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["estimate_id", 6], ["number", 2], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND ("stage_products"."product_id" != 2)[0m  [["stage_id", 15]]
  [1m[36mStageProduct Load (5.1ms)[0m  [1m[34mSELECT  "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND "stage_products"."product_id" = $2 LIMIT $3[0m  [["stage_id", 15], ["product_id", 2], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["estimate_id", 6], ["number", 3], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.7ms)[0m  [1m[33mUPDATE "stages" SET "price" = $1, "total_price" = $2, "updated_at" = $3 WHERE "stages"."id" = $4[0m  [["price", #<BigDecimal:7fe5e590a150,'0.204E3',9(27)>], ["total_price", #<BigDecimal:7fe5e5909f98,'0.204E3',9(36)>], ["updated_at", 2017-04-27 02:19:15 UTC], ["id", 16]]
  [1m[35m (3.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND ("stage_products"."product_id" != 3)[0m  [["stage_id", 16]]
  [1m[36mStageProduct Load (1.1ms)[0m  [1m[34mSELECT  "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND "stage_products"."product_id" = $2 LIMIT $3[0m  [["stage_id", 16], ["product_id", 3], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.7ms)[0m  [1m[33mUPDATE "stage_products" SET "with_work" = $1, "updated_at" = $2 WHERE "stage_products"."id" = $3[0m  [["with_work", true], ["updated_at", 2017-04-27 02:19:15 UTC], ["id", 15]]
  [1m[35m (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSet Load (0.8ms)[0m  [1m[34mSELECT  "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1 AND "stage_product_sets"."product_set_id" = $2 LIMIT $3[0m  [["stage_product_id", 15], ["product_set_id", 1], ["LIMIT", 1]]
  [1m[35m (1.6ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSetValue Load (1.1ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1 AND ("stage_product_set_values"."product_template_id" NOT IN (1, 2))[0m  [["stage_product_set_id", 5]]
  [1m[36mStageProductSetValue Load (0.8ms)[0m  [1m[34mSELECT  "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1 AND "stage_product_set_values"."product_template_id" = $2 LIMIT $3[0m  [["stage_product_set_id", 5], ["product_template_id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSetValue Load (1.0ms)[0m  [1m[34mSELECT  "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1 AND "stage_product_set_values"."product_template_id" = $2 LIMIT $3[0m  [["stage_product_set_id", 5], ["product_template_id", 2], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (2.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mAudited::Audit Load (1.0ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 6], ["auditable_type", "Estimate"], ["LIMIT", 1]]
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 6], ["auditable_type", "Estimate"], ["user_id", 1], ["user_type", "User"], ["action", "update"], ["audited_changes", "---\nprice_by_area:\n- !ruby/object:BigDecimal 18:0.6E-1\n- !ruby/object:BigDecimal 18:0.1E0\nprice_by_stage:\n- - !ruby/object:BigDecimal 18:0.1435E3\n  - !ruby/object:BigDecimal 18:0.775E2\n  - !ruby/object:BigDecimal 18:0.51E2\n- - !ruby/object:BigDecimal 27:0.1435E3\n  - !ruby/object:BigDecimal 27:0.775E2\n  - !ruby/object:BigDecimal 18:0.204E3\nprice_by_stage_aggregated:\n- - !ruby/object:BigDecimal 18:0.1435E3\n  - !ruby/object:BigDecimal 18:0.221E3\n  - !ruby/object:BigDecimal 18:0.272E3\n- - !ruby/object:BigDecimal 27:0.1435E3\n  - !ruby/object:BigDecimal 18:0.221E3\n  - !ruby/object:BigDecimal 18:0.425E3\nprice_by_area_per_stage:\n- - !ruby/object:BigDecimal 18:0.3E-1\n  - !ruby/object:BigDecimal 18:0.5E-1\n  - !ruby/object:BigDecimal 18:0.6E-1\n- - !ruby/object:BigDecimal 27:0.3E-1\n  - !ruby/object:BigDecimal 18:0.5E-1\n  - !ruby/object:BigDecimal 18:0.1E0\nprice_by_stage_aggregated_discounted:\n- - !ruby/object:BigDecimal 18:0.1435E3\n  - !ruby/object:BigDecimal 18:0.221E3\n  - !ruby/object:BigDecimal 18:0.272E3\n- - !ruby/object:BigDecimal 18:0.1435E3\n  - !ruby/object:BigDecimal 18:0.221E3\n  - !ruby/object:BigDecimal 18:0.425E3\nprice_by_area_per_stage_discounted:\n- - !ruby/object:BigDecimal 18:0.3E-1\n  - !ruby/object:BigDecimal 18:0.5E-1\n  - !ruby/object:BigDecimal 18:0.6E-1\n- - !ruby/object:BigDecimal 27:0.3E-1\n  - !ruby/object:BigDecimal 18:0.5E-1\n  - !ruby/object:BigDecimal 18:0.1E0\n"], ["version", 6], ["remote_address", "127.0.0.1"], ["request_uuid", "c4b49c5b-73e6-48fe-979b-68cb51b42de2"], ["created_at", 2017-04-27 02:19:15 UTC]]
  [1m[35mSQL (0.9ms)[0m  [1m[33mUPDATE "estimates" SET "price_by_area" = $1, "price_by_stage" = $2, "price_by_stage_aggregated" = $3, "price_by_area_per_stage" = $4, "price_by_stage_aggregated_discounted" = $5, "price_by_area_per_stage_discounted" = $6, "updated_at" = $7 WHERE "estimates"."id" = $8[0m  [["price_by_area", #<BigDecimal:7fe5e5917ee0,'0.1E0',9(27)>], ["price_by_stage", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x00558408c0a788 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fe5e5fb3ab0,'0.1435E3',18(36)>, #<BigDecimal:7fe5e5fb38d0,'0.775E2',18(36)>, #<BigDecimal:7fe5e5fb36f0,'0.204E3',9(27)>]>], ["price_by_stage_aggregated", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x00558408c0a788 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fe5e5fb3ab0,'0.1435E3',18(36)>, #<BigDecimal:7fe5e5fb3678,'0.221E3',9(27)>, #<BigDecimal:7fe5e5fb3600,'0.425E3',9(18)>]>], ["price_by_area_per_stage", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x00558408c0a788 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fe5e5fb3358,'0.3E-1',9(36)>, #<BigDecimal:7fe5e5fb29a8,'0.5E-1',9(27)>, #<BigDecimal:7fe5e5fb23b8,'0.1E0',9(27)>]>], ["price_by_stage_aggregated_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x00558408c0a788 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fe5e5fb2d40,'0.1435E3',18(27)>, #<BigDecimal:7fe5e5fb2638,'0.221E3',9(18)>, #<BigDecimal:7fe5e5fb2020,'0.425E3',9(18)>]>], ["price_by_area_per_stage_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x00558408c0a788 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fe5e5fb2b10,'0.3E-1',9(36)>, #<BigDecimal:7fe5e5fb2520,'0.5E-1',9(27)>, #<BigDecimal:7fe5e5fb1f08,'0.1E0',9(27)>]>], ["updated_at", 2017-04-27 02:19:15 UTC], ["id", 6]]
  [1m[35m (3.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.6ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
Redirected to http://localhost:3000/estimates?client_id=1
Completed 302 Found in 329ms (ActiveRecord: 76.5ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 05:19:15 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (2.3ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (4.8ms)
  Rendered estimates/_listing.html.haml (1.4ms)
  Rendered estimates/_listing.html.haml (2.3ms)
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (27.8ms)
  Rendered layouts/_header.html.haml (8.7ms)
Completed 200 OK in 597ms (Views: 580.4ms | ActiveRecord: 4.4ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 05:21:54 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (3.3ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.8ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (4.9ms)
  Rendered estimates/_listing.html.haml (1.4ms)
  Rendered estimates/_listing.html.haml (3.6ms)
  [1m[36mClient Load (2.5ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (34.2ms)
Completed 500 Internal Server Error in 294ms (ActiveRecord: 8.7ms)


  
ActionView::Template::Error (SyntaxError: [stdin]:10:26: missing )):
     5:     %title Конструктор сметы - Арт СИП Строй
     6:     = csrf_meta_tags
     7:     = stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track': 'reload'
     8:     = javascript_include_tag 'application', 'data-turbolinks-track': 'reload'
     9: 
    10:   %body
    11:     = render 'layouts/header'
  
app/views/layouts/application.html.haml:8:in `_app_views_layouts_application_html_haml__2534857530032057850_70312850740520'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (9.5ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (3.6ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.2ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (42.0ms)
Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 05:22:20 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (1.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (2.0ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.3ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (7.2ms)
  Rendered estimates/_listing.html.haml (1.3ms)
  Rendered estimates/_listing.html.haml (1.2ms)
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (39.2ms)
Completed 500 Internal Server Error in 314ms (ActiveRecord: 5.3ms)


  
ActionView::Template::Error (SyntaxError: [stdin]:15:15: unexpected end of input):
     5:     %title Конструктор сметы - Арт СИП Строй
     6:     = csrf_meta_tags
     7:     = stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track': 'reload'
     8:     = javascript_include_tag 'application', 'data-turbolinks-track': 'reload'
     9: 
    10:   %body
    11:     = render 'layouts/header'
  
app/views/layouts/application.html.haml:8:in `_app_views_layouts_application_html_haml__2534857530032057850_70312825161180'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (7.4ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (3.0ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.1ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (32.4ms)
Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 05:24:04 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.0ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (4.4ms)
  Rendered estimates/_listing.html.haml (1.0ms)
  Rendered estimates/_listing.html.haml (1.0ms)
  [1m[36mClient Load (5.8ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (30.3ms)
Completed 500 Internal Server Error in 299ms (ActiveRecord: 8.1ms)


  
ActionView::Template::Error (SyntaxError: [stdin]:47:35: reserved word 'function'):
     5:     %title Конструктор сметы - Арт СИП Строй
     6:     = csrf_meta_tags
     7:     = stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track': 'reload'
     8:     = javascript_include_tag 'application', 'data-turbolinks-track': 'reload'
     9: 
    10:   %body
    11:     = render 'layouts/header'
  
app/views/layouts/application.html.haml:8:in `_app_views_layouts_application_html_haml__2534857530032057850_70312984558600'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (8.7ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (3.2ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.1ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (33.8ms)
Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 05:24:43 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.5ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (4.9ms)
  Rendered estimates/_listing.html.haml (1.1ms)
  Rendered estimates/_listing.html.haml (1.1ms)
  [1m[36mClient Load (1.8ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (31.3ms)
Completed 500 Internal Server Error in 287ms (ActiveRecord: 3.8ms)


  
ActionView::Template::Error (SyntaxError: [stdin]:43:5: reserved word 'var'):
     5:     %title Конструктор сметы - Арт СИП Строй
     6:     = csrf_meta_tags
     7:     = stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track': 'reload'
     8:     = javascript_include_tag 'application', 'data-turbolinks-track': 'reload'
     9: 
    10:   %body
    11:     = render 'layouts/header'
  
app/views/layouts/application.html.haml:8:in `_app_views_layouts_application_html_haml__2534857530032057850_70312821343800'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (7.9ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (3.1ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.1ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (33.0ms)
Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 05:25:05 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (1.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (1.0ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.9ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (3.8ms)
  Rendered estimates/_listing.html.haml (1.0ms)
  Rendered estimates/_listing.html.haml (0.9ms)
  [1m[36mClient Load (0.5ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (25.1ms)
Completed 500 Internal Server Error in 292ms (ActiveRecord: 5.1ms)


  
ActionView::Template::Error (SyntaxError: [stdin]:55:16: reserved word 'function'):
     5:     %title Конструктор сметы - Арт СИП Строй
     6:     = csrf_meta_tags
     7:     = stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track': 'reload'
     8:     = javascript_include_tag 'application', 'data-turbolinks-track': 'reload'
     9: 
    10:   %body
    11:     = render 'layouts/header'
  
app/views/layouts/application.html.haml:8:in `_app_views_layouts_application_html_haml__2534857530032057850_70312687176360'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (9.1ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (5.2ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.1ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (37.6ms)
Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 05:25:30 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (1.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.0ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (3.9ms)
  Rendered estimates/_listing.html.haml (1.1ms)
  Rendered estimates/_listing.html.haml (1.0ms)
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (28.0ms)
Completed 500 Internal Server Error in 309ms (ActiveRecord: 3.7ms)


  
ActionView::Template::Error (SyntaxError: [stdin]:42:6: unexpected ():
     5:     %title Конструктор сметы - Арт СИП Строй
     6:     = csrf_meta_tags
     7:     = stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track': 'reload'
     8:     = javascript_include_tag 'application', 'data-turbolinks-track': 'reload'
     9: 
    10:   %body
    11:     = render 'layouts/header'
  
app/views/layouts/application.html.haml:8:in `_app_views_layouts_application_html_haml__2534857530032057850_47012818414960'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (7.9ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (3.0ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.1ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (32.6ms)
Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 05:26:08 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.5ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (3.8ms)
  Rendered estimates/_listing.html.haml (1.0ms)
  Rendered estimates/_listing.html.haml (1.1ms)
  [1m[36mClient Load (0.5ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (28.9ms)
Completed 500 Internal Server Error in 361ms (ActiveRecord: 2.9ms)


  
ActionView::Template::Error (SyntaxError: [stdin]:56:10: unexpected ():
     5:     %title Конструктор сметы - Арт СИП Строй
     6:     = csrf_meta_tags
     7:     = stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track': 'reload'
     8:     = javascript_include_tag 'application', 'data-turbolinks-track': 'reload'
     9: 
    10:   %body
    11:     = render 'layouts/header'
  
app/views/layouts/application.html.haml:8:in `_app_views_layouts_application_html_haml__2534857530032057850_70312690617400'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (7.8ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (3.1ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.3ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (33.8ms)
Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 05:27:17 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (1.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (1.3ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.1ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (6.0ms)
  Rendered estimates/_listing.html.haml (1.6ms)
  Rendered estimates/_listing.html.haml (1.1ms)
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (34.9ms)
  Rendered layouts/_header.html.haml (14.4ms)
Completed 200 OK in 392ms (Views: 371.0ms | ActiveRecord: 4.5ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 05:27:36 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (1.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (1.9ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.0ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (3.5ms)
  Rendered estimates/_listing.html.haml (0.9ms)
  Rendered estimates/_listing.html.haml (0.9ms)
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (24.4ms)
  Rendered layouts/_header.html.haml (16.7ms)
Completed 200 OK in 363ms (Views: 346.5ms | ActiveRecord: 5.3ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 05:28:11 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (2.9ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (5.5ms)
  Rendered estimates/_listing.html.haml (0.9ms)
  Rendered estimates/_listing.html.haml (1.0ms)
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (26.6ms)
  Rendered layouts/_header.html.haml (9.0ms)
Completed 200 OK in 1202ms (Views: 1186.1ms | ActiveRecord: 4.9ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 05:28:34 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (1.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (1.1ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (2.0ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (4.0ms)
  Rendered estimates/_listing.html.haml (1.1ms)
  Rendered estimates/_listing.html.haml (1.3ms)
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (24.3ms)
  Rendered layouts/_header.html.haml (8.9ms)
Completed 200 OK in 1136ms (Views: 1123.0ms | ActiveRecord: 5.8ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 05:29:16 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (1.2ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.4ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (4.9ms)
  Rendered estimates/_listing.html.haml (2.4ms)
  Rendered estimates/_listing.html.haml (1.0ms)
  [1m[36mClient Load (2.2ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (35.3ms)
  Rendered layouts/_header.html.haml (19.5ms)
Completed 200 OK in 1501ms (Views: 1487.9ms | ActiveRecord: 5.8ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 05:29:29 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (3.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (2.0ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (3.2ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (3.6ms)
  Rendered estimates/_listing.html.haml (1.0ms)
  Rendered estimates/_listing.html.haml (1.2ms)
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (30.4ms)
  Rendered layouts/_header.html.haml (9.3ms)
Completed 200 OK in 1583ms (Views: 1560.8ms | ActiveRecord: 9.5ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 05:30:50 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (1.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (5.0ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.1ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (9.3ms)
  Rendered estimates/_listing.html.haml (0.9ms)
  Rendered estimates/_listing.html.haml (0.9ms)
  [1m[36mClient Load (1.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (39.7ms)
  Rendered layouts/_header.html.haml (10.9ms)
Completed 200 OK in 1353ms (Views: 1329.8ms | ActiveRecord: 8.3ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 05:31:33 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (1.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (6.6ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (1.6ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (2.8ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (1.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (20.2ms)
  [1m[35m (6.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (10.0ms)
  [1m[35m (1.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (5.0ms)
  Rendered clients/_table.html.haml (40.2ms)
  [1m[36mUserClient Load (0.7ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (81.3ms)
  Rendered layouts/_header.html.haml (11.8ms)
Completed 200 OK in 766ms (Views: 723.3ms | ActiveRecord: 31.2ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 05:31:51 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (1.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (2.5ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (3.9ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (7.0ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (3.6ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (4.1ms)
  Rendered clients/_table.html.haml (19.4ms)
  [1m[36mUserClient Load (4.5ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (47.6ms)
  Rendered layouts/_header.html.haml (7.8ms)
Completed 200 OK in 521ms (Views: 498.2ms | ActiveRecord: 15.4ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 05:31:52 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (2.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (2.9ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (1.6ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (2.3ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (23.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (29.6ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (4.3ms)
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (4.3ms)
  Rendered clients/_table.html.haml (45.4ms)
  [1m[36mUserClient Load (0.8ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (65.0ms)
  Rendered layouts/_header.html.haml (14.5ms)
Completed 200 OK in 605ms (Views: 563.0ms | ActiveRecord: 34.6ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 05:32:01 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (1.4ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.6ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (4.5ms)
  Rendered estimates/_listing.html.haml (1.3ms)
  Rendered estimates/_listing.html.haml (45.7ms)
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (74.5ms)
  Rendered layouts/_header.html.haml (8.0ms)
Completed 200 OK in 595ms (Views: 577.5ms | ActiveRecord: 4.8ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 05:32:06 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (2.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (0.9ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (1.7ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (1.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (9.0ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (3.6ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (4.8ms)
  Rendered clients/_table.html.haml (21.8ms)
  [1m[36mUserClient Load (2.4ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (47.3ms)
  Rendered layouts/_header.html.haml (10.5ms)
Completed 200 OK in 611ms (Views: 596.1ms | ActiveRecord: 10.5ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 05:32:08 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (0.9ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (3.4ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (1.2ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (10.8ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (3.6ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (3.8ms)
  Rendered clients/_table.html.haml (29.3ms)
  [1m[36mUserClient Load (0.8ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (52.0ms)
  Rendered layouts/_header.html.haml (9.4ms)
Completed 200 OK in 639ms (Views: 623.9ms | ActiveRecord: 9.1ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 05:32:38 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (2.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (1.0ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (1.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (9.7ms)
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (5.3ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (3.6ms)
  Rendered clients/_table.html.haml (23.4ms)
  [1m[36mUserClient Load (3.8ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (52.2ms)
  Rendered layouts/_header.html.haml (10.4ms)
Completed 200 OK in 662ms (Views: 642.8ms | ActiveRecord: 11.5ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 05:32:45 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (1.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (3.7ms)
  Rendered estimates/_listing.html.haml (1.0ms)
  Rendered estimates/_listing.html.haml (0.9ms)
  [1m[36mClient Load (0.5ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (21.6ms)
  Rendered layouts/_header.html.haml (8.8ms)
Completed 200 OK in 614ms (Views: 601.0ms | ActiveRecord: 3.5ms)


Started GET "/estimates?utf8=%E2%9C%93&client_id=1&name=2" for 127.0.0.1 at 2017-04-27 05:33:00 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"utf8"=>"✓", "client_id"=>"1", "name"=>"2"}
  [1m[36mUser Load (3.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (2.0ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.0ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  [1m[36mEstimate Load (3.8ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1 AND (lower(name) like '%2%')[0m  [["client_id", 1]]
  Rendered estimates/_listing.html.haml (3.9ms)
  [1m[36mClient Load (0.5ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (26.2ms)
  Rendered layouts/_header.html.haml (9.2ms)
Completed 200 OK in 611ms (Views: 590.6ms | ActiveRecord: 10.4ms)


DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
  [1m[36mClient Load (3.5ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL ORDER BY "clients"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (4.2ms)[0m  [1m[32mINSERT INTO "clients" ("first_name", "last_name", "middle_name", "crm", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["first_name", "Имя"], ["last_name", "Фамилия"], ["middle_name", "Отчество"], ["crm", "1"], ["created_at", 2017-04-27 19:43:57 UTC], ["updated_at", 2017-04-27 19:43:57 UTC]]
  [1m[36mAudited::Audit Load (8.3ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 4], ["auditable_type", "Client"], ["LIMIT", 1]]
  [1m[35mSQL (1.9ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "action", "audited_changes", "version", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["auditable_id", 4], ["auditable_type", "Client"], ["action", "create"], ["audited_changes", "---\nfirst_name: Имя\nlast_name: Фамилия\nmiddle_name: Отчество\ncrm: '1'\narchived: false\ndeleted_at: \n"], ["version", 1], ["request_uuid", "5219279c-579f-4ac2-9d00-a7f39b2d01eb"], ["created_at", 2017-04-27 19:43:57 UTC]]
  [1m[35m (1.5ms)[0m  [1m[35mCOMMIT[0m
DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
Started GET "/" for 127.0.0.1 at 2017-04-27 22:48:29 +0300
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Processing by HomeController#index as HTML
Completed 401 Unauthorized in 38ms (ActiveRecord: 0.0ms)


Started GET "/signin" for 127.0.0.1 at 2017-04-27 22:48:29 +0300
Processing by Devise::SessionsController#new as HTML
  Rendering devise/sessions/new.html.haml within layouts/application
Started GET "/" for 127.0.0.1 at 2017-04-27 22:48:30 +0300
Processing by HomeController#index as HTML
Completed 401 Unauthorized in 2ms (ActiveRecord: 0.0ms)


Started GET "/signin" for 127.0.0.1 at 2017-04-27 22:48:30 +0300
Processing by Devise::SessionsController#new as HTML
  Rendering devise/sessions/new.html.haml within layouts/application
  Rendered devise/sessions/new.html.haml within layouts/application (2733.0ms)
  Rendered devise/sessions/new.html.haml within layouts/application (1863.8ms)
Completed 500 Internal Server Error in 2338ms (ActiveRecord: 0.0ms)


  
ActionView::Template::Error (can't add a new key into hash during iteration):
     5:     %title Конструктор сметы - Арт СИП Строй
     6:     = csrf_meta_tags
     7:     = stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track': 'reload'
     8:     = javascript_include_tag 'application', 'data-turbolinks-track': 'reload'
     9: 
    10:   %body
    11:     = render 'layouts/header'
  
app/views/layouts/application.html.haml:8:in `_app_views_layouts_application_html_haml___4463987671054879223_70086836779980'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (7.0ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (3.6ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.0ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (67.3ms)
  Rendered layouts/_header.html.haml (11.0ms)
Completed 200 OK in 4115ms (Views: 4089.4ms | ActiveRecord: 6.2ms)


Started POST "/__web_console/repl_sessions/1d44449c330b0bc314b9fb23c4e7a467/trace" for 127.0.0.1 at 2017-04-27 22:49:07 +0300
Started GET "/signin" for 127.0.0.1 at 2017-04-27 22:49:17 +0300
Processing by Devise::SessionsController#new as HTML
  Rendering devise/sessions/new.html.haml within layouts/application
  Rendered devise/sessions/new.html.haml within layouts/application (7.5ms)
  Rendered layouts/_header.html.haml (9.0ms)
Completed 200 OK in 552ms (Views: 550.5ms | ActiveRecord: 0.0ms)


Started POST "/signin" for 127.0.0.1 at 2017-04-27 22:49:25 +0300
Processing by Devise::SessionsController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"8uP5x1eRBFtGBEYsmDdBIwCkZA+r7+IX4fHvogUgplQrPEFM26Czq9oQuMG4NTh8uwkaPmgo8DS5eadhKRajsw==", "user"=>{"email"=>"admin@test.test", "password"=>"[FILTERED]"}, "commit"=>"Войти"}
  [1m[36mUser Load (5.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."email" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["email", "admin@test.test"], ["LIMIT", 1]]
Redirected to http://localhost:3000/
Completed 302 Found in 163ms (ActiveRecord: 5.1ms)


Started GET "/" for 127.0.0.1 at 2017-04-27 22:49:25 +0300
Processing by HomeController#index as HTML
  [1m[36mUser Load (2.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering home/index.html.haml within layouts/application
  Rendered home/index.html.haml within layouts/application (0.9ms)
  Rendered layouts/_header.html.haml (99.7ms)
Completed 200 OK in 662ms (Views: 656.2ms | ActiveRecord: 2.3ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 22:49:29 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (2.5ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (1.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (3.0ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (11.7ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (5.1ms)
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (7.8ms)
  Rendered clients/_table.html.haml (29.7ms)
  [1m[36mUserClient Load (0.9ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (162.4ms)
  Rendered layouts/_header.html.haml (21.2ms)
Completed 200 OK in 882ms (Views: 836.4ms | ActiveRecord: 28.7ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 22:49:32 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.1ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (17.2ms)
  Rendered estimates/_listing.html.haml (1.5ms)
  Rendered estimates/_listing.html.haml (1.2ms)
  [1m[36mClient Load (2.1ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (59.7ms)
  Rendered layouts/_header.html.haml (10.7ms)
Completed 200 OK in 721ms (Views: 704.7ms | ActiveRecord: 4.7ms)


Started GET "/estimates/6/edit" for 127.0.0.1 at 2017-04-27 22:49:34 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"6"}
  [1m[36mProduct Load (4.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (2.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (1.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (1.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (4.3ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (1.4ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (1.0ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.9ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (2.4ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (2.2ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 6]]
  [1m[36mStageProduct Load (3.1ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (14, 15, 16)[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 14]]
  [1m[36mStageProductSet Load (2.0ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 13[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (2.4ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 15]]
  [1m[36mStageProductSet Load (1.4ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 14[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 16]]
  [1m[36mStageProductSet Load (1.4ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 15[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 15]]
  [1m[36mStageProductSetValue Load (2.8ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 5[0m
  [1m[36mProductSet Load (1.2ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (1.4ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 5]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (21.1ms)
  [1m[36mClientFile Load (1.7ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 6]]
  Rendered estimates/_technical_file_fields.html.haml (6.8ms)
  [1m[36mTechnicalFile Load (2.1ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 6]]
  Rendered estimates/_discount.html.haml (11.7ms)
  Rendered estimates/_stages.html.haml (29.8ms)
  Rendered estimates/_form.html.haml (172.5ms)
  Rendered estimates/edit.html.haml within layouts/application (176.9ms)
  Rendered layouts/_header.html.haml (14.9ms)
Completed 200 OK in 1259ms (Views: 792.1ms | ActiveRecord: 121.0ms)


Started PATCH "/estimates/6" for 127.0.0.1 at 2017-04-27 22:49:44 +0300
Processing by EstimatesController#update as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"BKiBWrtkTODLt1WgIawULJx3P66aHDWnuAZ1+DZS2iwBRYkMpGfmOIY+ioRf15f6qOkcnQE06tkpFVrrhwi5Ug==", "commit"=>"Сохранить", "estimate"=>{"price"=>"415.895", "name"=>"Тестовая смета 2", "client_id"=>"1", "area"=>"4214", "first_floor_height"=>"124124.0", "second_floor_height_min"=>"0.0", "second_floor_height_max"=>"0.0", "third_floor_height_min"=>"0.0", "third_floor_height_max"=>"0.0", "discount_title"=>"", "discount_by_stages"=>{"0"=>"1", "1"=>"2", "2"=>"3"}}, "json_stages"=>"[{\"number\":1,\"text\":{\"name\":\"Первый этап\",\"summ\":\"Итого по первому этапу:\",\"summ_dis\":\"по первому этапу\",\"discount\":\"Итого по первому этапу со скидкой:\"},\"price\":143.5,\"total_price\":142.065,\"products\":[{\"id\":1,\"name\":\"Простой продукт 1 этап\",\"unit\":\"шт\",\"custom\":false,\"profit\":100,\"price_with_work\":70,\"price_without_work\":10,\"with_work\":true,\"quantity\":1,\"sets\":[],\"price\":143.5,\"$$hashKey\":\"object:15\"}],\"aggregated_price\":143.5,\"$$hashKey\":\"object:4\"},{\"number\":2,\"text\":{\"name\":\"Второй этап\",\"summ\":\"Итого по двум этапам:\",\"summ_dis\":\"по второму этапу\",\"discount\":\"Итого по двум этапам со скидкой:\"},\"price\":77.5,\"total_price\":75.95,\"products\":[{\"id\":2,\"name\":\"Простой продукт 2 этап\",\"unit\":\"м3\",\"custom\":false,\"profit\":50,\"price_with_work\":50,\"price_without_work\":50,\"with_work\":true,\"quantity\":1,\"sets\":[],\"price\":77.5,\"$$hashKey\":\"object:18\"}],\"aggregated_price\":221,\"$$hashKey\":\"object:5\"},{\"number\":3,\"text\":{\"name\":\"Третий этап\",\"summ\":\"Итого по трем этапам:\",\"summ_dis\":\"по третьему этапу\",\"discount\":\"Итого по трем этапам со скидкой:\"},\"price\":204,\"total_price\":197.88,\"products\":[{\"id\":3,\"name\":\"Конфигурируемый продукт 3 этап\",\"unit\":\"кг\",\"custom\":true,\"profit\":150,\"price_with_work\":80,\"price_without_work\":20,\"with_work\":true,\"quantity\":1,\"sets\":[{\"id\":1,\"name\":\"Сборка 1\",\"selected\":true,\"items\":[{\"id\":1,\"name\":\"Составляющая 1\",\"quantity\":2,\"value\":{\"id\":1,\"name\":\"Примитив 1\",\"unit\":\"лист\",\"price\":10,\"work_primitive\":false}},{\"id\":2,\"name\":\"Составляющая 2\",\"quantity\":1,\"value\":{\"id\":6,\"name\":\"Примитив 6\",\"unit\":\"лист\",\"price\":60,\"work_primitive\":true}}]}],\"price\":204,\"$$hashKey\":\"object:21\"}],\"aggregated_price\":425,\"$$hashKey\":\"object:6\"}]", "data"=>"", "id"=>"6"}
  [1m[36mProduct Load (4.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.5ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (1.5ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (2.3ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (2.4ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.2ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Unpermitted parameters: second_floor_height_min, second_floor_height_max, third_floor_height_min, third_floor_height_max, discount_by_stages
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mClient Load (1.4ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mAudited::Audit Load (1.5ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 6], ["auditable_type", "Estimate"], ["LIMIT", 1]]
  [1m[35mSQL (0.9ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 6], ["auditable_type", "Estimate"], ["user_id", 1], ["user_type", "User"], ["action", "update"], ["audited_changes", "---\nprice:\n- !ruby/object:BigDecimal 18:0.425E3\n- !ruby/object:BigDecimal 18:0.415895E3\n"], ["version", 7], ["remote_address", "127.0.0.1"], ["request_uuid", "f8fae91a-41e7-4ad4-bc63-375ee0f9b56e"], ["created_at", 2017-04-27 19:49:44 UTC]]
  [1m[35mSQL (1.6ms)[0m  [1m[33mUPDATE "estimates" SET "price" = $1, "updated_at" = $2 WHERE "estimates"."id" = $3[0m  [["price", #<BigDecimal:7f7cb111bb80,'0.415895E3',18(18)>], ["updated_at", 2017-04-27 19:49:44 UTC], ["id", 6]]
  [1m[35m (1.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (1.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["estimate_id", 6], ["number", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.8ms)[0m  [1m[33mUPDATE "stages" SET "total_price" = $1, "updated_at" = $2 WHERE "stages"."id" = $3[0m  [["total_price", #<BigDecimal:7f7cb0dcb048,'0.14207E3',18(36)>], ["updated_at", 2017-04-27 19:49:44 UTC], ["id", 14]]
  [1m[35m (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (1.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND ("stage_products"."product_id" != 1)[0m  [["stage_id", 14]]
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT  "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND "stage_products"."product_id" = $2 LIMIT $3[0m  [["stage_id", 14], ["product_id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (1.2ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["estimate_id", 6], ["number", 2], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.8ms)[0m  [1m[33mUPDATE "stages" SET "total_price" = $1, "updated_at" = $2 WHERE "stages"."id" = $3[0m  [["total_price", #<BigDecimal:7f7cb0d29e28,'0.7595E2',18(36)>], ["updated_at", 2017-04-27 19:49:44 UTC], ["id", 15]]
  [1m[35m (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (2.4ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND ("stage_products"."product_id" != 2)[0m  [["stage_id", 15]]
  [1m[36mStageProduct Load (0.9ms)[0m  [1m[34mSELECT  "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND "stage_products"."product_id" = $2 LIMIT $3[0m  [["stage_id", 15], ["product_id", 2], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (1.8ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["estimate_id", 6], ["number", 3], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.7ms)[0m  [1m[33mUPDATE "stages" SET "total_price" = $1, "updated_at" = $2 WHERE "stages"."id" = $3[0m  [["total_price", #<BigDecimal:7f7cba7cb350,'0.19788E3',18(36)>], ["updated_at", 2017-04-27 19:49:44 UTC], ["id", 16]]
  [1m[35m (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND ("stage_products"."product_id" != 3)[0m  [["stage_id", 16]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT  "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND "stage_products"."product_id" = $2 LIMIT $3[0m  [["stage_id", 16], ["product_id", 3], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSet Load (1.0ms)[0m  [1m[34mSELECT  "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1 AND "stage_product_sets"."product_set_id" = $2 LIMIT $3[0m  [["stage_product_id", 15], ["product_set_id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSetValue Load (1.2ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1 AND ("stage_product_set_values"."product_template_id" NOT IN (1, 2))[0m  [["stage_product_set_id", 5]]
  [1m[36mStageProductSetValue Load (0.9ms)[0m  [1m[34mSELECT  "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1 AND "stage_product_set_values"."product_template_id" = $2 LIMIT $3[0m  [["stage_product_set_id", 5], ["product_template_id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSetValue Load (1.2ms)[0m  [1m[34mSELECT  "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1 AND "stage_product_set_values"."product_template_id" = $2 LIMIT $3[0m  [["stage_product_set_id", 5], ["product_template_id", 2], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (3.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
Redirected to http://localhost:3000/estimates?client_id=1
Completed 302 Found in 256ms (ActiveRecord: 75.8ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 22:49:44 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (5.8ms)
  Rendered estimates/_listing.html.haml (1.6ms)
  Rendered estimates/_listing.html.haml (1.3ms)
  [1m[36mClient Load (0.9ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (28.7ms)
  Rendered layouts/_header.html.haml (9.7ms)
Completed 200 OK in 598ms (Views: 584.1ms | ActiveRecord: 3.4ms)


Started GET "/estimates/6/edit" for 127.0.0.1 at 2017-04-27 22:49:46 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"6"}
  [1m[36mProduct Load (2.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.5ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.2ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (1.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (1.2ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (1.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.9ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (2.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (1.0ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 6]]
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (14, 15, 16)[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 14]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 13[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 15]]
  [1m[36mStageProductSet Load (1.0ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 14[0m
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 16]]
  [1m[36mStageProductSet Load (0.8ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 15[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 15]]
  [1m[36mStageProductSetValue Load (0.6ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 5[0m
  [1m[36mProductSet Load (1.0ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 5]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.8ms)
  [1m[36mClientFile Load (0.7ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 6]]
  Rendered estimates/_technical_file_fields.html.haml (3.7ms)
  [1m[36mTechnicalFile Load (0.8ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 6]]
  Rendered estimates/_discount.html.haml (7.5ms)
  Rendered estimates/_stages.html.haml (19.4ms)
  Rendered estimates/_form.html.haml (83.0ms)
  Rendered estimates/edit.html.haml within layouts/application (87.6ms)
  Rendered layouts/_header.html.haml (13.1ms)
Completed 200 OK in 998ms (Views: 793.6ms | ActiveRecord: 37.3ms)


Started PATCH "/estimates/6" for 127.0.0.1 at 2017-04-27 22:50:05 +0300
Processing by EstimatesController#update as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"7WH6Rspg16MYauvUPp8nHI9dc0WIXMrvQ76iyoUhYk3ojPIQ1WN9e1XjNPBA5KTKu8NQdhN0FZHSrY3ZNHsBMw==", "commit"=>"Сохранить", "estimate"=>{"price"=>"415.895", "name"=>"Тестовая смета 2", "client_id"=>"1", "area"=>"4214", "first_floor_height"=>"124124.0", "second_floor_height_min"=>"0.0", "second_floor_height_max"=>"0.0", "third_floor_height_min"=>"0.0", "third_floor_height_max"=>"0.0", "discount_title"=>"123", "discount_by_stages"=>{"0"=>"1", "1"=>"2", "2"=>"3"}}, "json_stages"=>"[{\"number\":1,\"text\":{\"name\":\"Первый этап\",\"summ\":\"Итого по первому этапу:\",\"summ_dis\":\"по первому этапу\",\"discount\":\"Итого по первому этапу со скидкой:\"},\"price\":143.5,\"total_price\":142.065,\"products\":[{\"id\":1,\"name\":\"Простой продукт 1 этап\",\"unit\":\"шт\",\"custom\":false,\"profit\":100,\"price_with_work\":70,\"price_without_work\":10,\"with_work\":true,\"quantity\":1,\"sets\":[],\"price\":143.5,\"$$hashKey\":\"object:15\"}],\"aggregated_price\":143.5,\"$$hashKey\":\"object:4\"},{\"number\":2,\"text\":{\"name\":\"Второй этап\",\"summ\":\"Итого по двум этапам:\",\"summ_dis\":\"по второму этапу\",\"discount\":\"Итого по двум этапам со скидкой:\"},\"price\":77.5,\"total_price\":75.95,\"products\":[{\"id\":2,\"name\":\"Простой продукт 2 этап\",\"unit\":\"м3\",\"custom\":false,\"profit\":50,\"price_with_work\":50,\"price_without_work\":50,\"with_work\":true,\"quantity\":1,\"sets\":[],\"price\":77.5,\"$$hashKey\":\"object:18\"}],\"aggregated_price\":221,\"$$hashKey\":\"object:5\"},{\"number\":3,\"text\":{\"name\":\"Третий этап\",\"summ\":\"Итого по трем этапам:\",\"summ_dis\":\"по третьему этапу\",\"discount\":\"Итого по трем этапам со скидкой:\"},\"price\":204,\"total_price\":197.88,\"products\":[{\"id\":3,\"name\":\"Конфигурируемый продукт 3 этап\",\"unit\":\"кг\",\"custom\":true,\"profit\":150,\"price_with_work\":80,\"price_without_work\":20,\"with_work\":true,\"quantity\":1,\"sets\":[{\"id\":1,\"name\":\"Сборка 1\",\"selected\":true,\"items\":[{\"id\":1,\"name\":\"Составляющая 1\",\"quantity\":2,\"value\":{\"id\":1,\"name\":\"Примитив 1\",\"unit\":\"лист\",\"price\":10,\"work_primitive\":false}},{\"id\":2,\"name\":\"Составляющая 2\",\"quantity\":1,\"value\":{\"id\":6,\"name\":\"Примитив 6\",\"unit\":\"лист\",\"price\":60,\"work_primitive\":true}}]}],\"price\":204,\"$$hashKey\":\"object:21\"}],\"aggregated_price\":425,\"$$hashKey\":\"object:6\"}]", "data"=>"", "id"=>"6"}
  [1m[36mProduct Load (2.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (1.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (1.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (2.3ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (1.5ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (1.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.8ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (1.3ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (1.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (1.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.4ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Unpermitted parameters: second_floor_height_min, second_floor_height_max, third_floor_height_min, third_floor_height_max, discount_by_stages
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mAudited::Audit Load (1.2ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 6], ["auditable_type", "Estimate"], ["LIMIT", 1]]
  [1m[35mSQL (1.0ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 6], ["auditable_type", "Estimate"], ["user_id", 1], ["user_type", "User"], ["action", "update"], ["audited_changes", "---\ndiscount_title:\n- ''\n- '123'\n"], ["version", 8], ["remote_address", "127.0.0.1"], ["request_uuid", "e00f99c8-a9bc-442c-acab-15902e257389"], ["created_at", 2017-04-27 19:50:05 UTC]]
  [1m[35mSQL (3.3ms)[0m  [1m[33mUPDATE "estimates" SET "discount_title" = $1, "updated_at" = $2 WHERE "estimates"."id" = $3[0m  [["discount_title", "123"], ["updated_at", 2017-04-27 19:50:05 UTC], ["id", 6]]
  [1m[35m (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (1.6ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["estimate_id", 6], ["number", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND ("stage_products"."product_id" != 1)[0m  [["stage_id", 14]]
  [1m[36mStageProduct Load (1.5ms)[0m  [1m[34mSELECT  "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND "stage_products"."product_id" = $2 LIMIT $3[0m  [["stage_id", 14], ["product_id", 1], ["LIMIT", 1]]
  [1m[35m (1.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["estimate_id", 6], ["number", 2], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND ("stage_products"."product_id" != 2)[0m  [["stage_id", 15]]
  [1m[36mStageProduct Load (1.1ms)[0m  [1m[34mSELECT  "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND "stage_products"."product_id" = $2 LIMIT $3[0m  [["stage_id", 15], ["product_id", 2], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (1.7ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["estimate_id", 6], ["number", 3], ["LIMIT", 1]]
  [1m[35m (4.7ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND ("stage_products"."product_id" != 3)[0m  [["stage_id", 16]]
  [1m[36mStageProduct Load (4.9ms)[0m  [1m[34mSELECT  "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND "stage_products"."product_id" = $2 LIMIT $3[0m  [["stage_id", 16], ["product_id", 3], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT  "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1 AND "stage_product_sets"."product_set_id" = $2 LIMIT $3[0m  [["stage_product_id", 15], ["product_set_id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSetValue Load (0.8ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1 AND ("stage_product_set_values"."product_template_id" NOT IN (1, 2))[0m  [["stage_product_set_id", 5]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT  "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1 AND "stage_product_set_values"."product_template_id" = $2 LIMIT $3[0m  [["stage_product_set_id", 5], ["product_template_id", 1], ["LIMIT", 1]]
  [1m[35m (0.9ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSetValue Load (0.9ms)[0m  [1m[34mSELECT  "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1 AND "stage_product_set_values"."product_template_id" = $2 LIMIT $3[0m  [["stage_product_set_id", 5], ["product_template_id", 2], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
Redirected to http://localhost:3000/estimates?client_id=1
Completed 302 Found in 221ms (ActiveRecord: 67.1ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 22:50:05 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (3.1ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (2.3ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (6.8ms)
  Rendered estimates/_listing.html.haml (1.0ms)
  Rendered estimates/_listing.html.haml (1.1ms)
  [1m[36mClient Load (1.2ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (32.7ms)
  Rendered layouts/_header.html.haml (9.1ms)
Completed 200 OK in 619ms (Views: 603.2ms | ActiveRecord: 7.4ms)


Started GET "/estimates/6/edit" for 127.0.0.1 at 2017-04-27 22:50:08 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"6"}
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (1.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (1.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (1.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.9ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (1.2ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.4ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.6ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 6]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (14, 15, 16)[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 14]]
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 13[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 15]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 14[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 16]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 15[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 15]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 5[0m
  [1m[36mProductSet Load (0.8ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 5]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.4ms)
  [1m[36mClientFile Load (0.6ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 6]]
  Rendered estimates/_technical_file_fields.html.haml (3.4ms)
  [1m[36mTechnicalFile Load (0.5ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 6]]
  Rendered estimates/_discount.html.haml (7.4ms)
  Rendered estimates/_stages.html.haml (19.7ms)
  Rendered estimates/_form.html.haml (82.8ms)
  Rendered estimates/edit.html.haml within layouts/application (86.1ms)
  Rendered layouts/_header.html.haml (11.1ms)
Completed 200 OK in 786ms (Views: 648.8ms | ActiveRecord: 28.9ms)


DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
Started PATCH "/estimates/6" for 127.0.0.1 at 2017-04-27 23:01:51 +0300
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Processing by EstimatesController#update as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"GMlEoP0d1r02kqyowXwlxBIO1HRbwjwgoP/zLYANUocdJEz24h58ZXsbc4y/B6YSJpD3R8Dq414x7Nw+MVcx+Q==", "commit"=>"Сохранить", "estimate"=>{"price"=>"417.93499999999995", "name"=>"Тестовая смета 2", "client_id"=>"1", "area"=>"4214", "first_floor_height"=>"124124.0", "second_floor_height_min"=>"0.0", "second_floor_height_max"=>"0.0", "third_floor_height_min"=>"0.0", "third_floor_height_max"=>"0.0", "discount_title"=>"123", "discount_by_stages"=>{"0"=>"1", "1"=>"2", "2"=>"2"}}, "json_stages"=>"[{\"number\":1,\"text\":{\"name\":\"Первый этап\",\"summ\":\"Итого по первому этапу:\",\"summ_dis\":\"по первому этапу\",\"discount\":\"Итого по первому этапу со скидкой:\"},\"price\":143.5,\"total_price\":142.065,\"products\":[{\"id\":1,\"name\":\"Простой продукт 1 этап\",\"unit\":\"шт\",\"custom\":false,\"profit\":100,\"price_with_work\":70,\"price_without_work\":10,\"with_work\":true,\"quantity\":1,\"sets\":[],\"price\":143.5,\"$$hashKey\":\"object:15\"}],\"aggregated_price\":143.5,\"$$hashKey\":\"object:4\"},{\"number\":2,\"text\":{\"name\":\"Второй этап\",\"summ\":\"Итого по двум этапам:\",\"summ_dis\":\"по второму этапу\",\"discount\":\"Итого по двум этапам со скидкой:\"},\"price\":77.5,\"total_price\":75.95,\"products\":[{\"id\":2,\"name\":\"Простой продукт 2 этап\",\"unit\":\"м3\",\"custom\":false,\"profit\":50,\"price_with_work\":50,\"price_without_work\":50,\"with_work\":true,\"quantity\":1,\"sets\":[],\"price\":77.5,\"$$hashKey\":\"object:18\"}],\"aggregated_price\":221,\"$$hashKey\":\"object:5\"},{\"number\":3,\"text\":{\"name\":\"Третий этап\",\"summ\":\"Итого по трем этапам:\",\"summ_dis\":\"по третьему этапу\",\"discount\":\"Итого по трем этапам со скидкой:\"},\"price\":204,\"total_price\":199.92,\"products\":[{\"id\":3,\"name\":\"Конфигурируемый продукт 3 этап\",\"unit\":\"кг\",\"custom\":true,\"profit\":150,\"price_with_work\":80,\"price_without_work\":20,\"with_work\":true,\"quantity\":1,\"sets\":[{\"id\":1,\"name\":\"Сборка 1\",\"selected\":true,\"items\":[{\"id\":1,\"name\":\"Составляющая 1\",\"quantity\":2,\"value\":{\"id\":1,\"name\":\"Примитив 1\",\"unit\":\"лист\",\"price\":10,\"work_primitive\":false}},{\"id\":2,\"name\":\"Составляющая 2\",\"quantity\":1,\"value\":{\"id\":6,\"name\":\"Примитив 6\",\"unit\":\"лист\",\"price\":60,\"work_primitive\":true}}]}],\"price\":204,\"$$hashKey\":\"object:21\"}],\"aggregated_price\":425,\"$$hashKey\":\"object:6\"}]", "data"=>"", "id"=>"6"}
  [1m[36mProduct Load (1.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.4ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (1.3ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (3.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (2.2ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.9ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.9ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (3.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.2ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (3.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (1.5ms)[0m  [1m[35mBEGIN[0m
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mAudited::Audit Load (1.3ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 6], ["auditable_type", "Estimate"], ["LIMIT", 1]]
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 6], ["auditable_type", "Estimate"], ["user_id", 1], ["user_type", "User"], ["action", "update"], ["audited_changes", "---\ndiscount_by_stages:\n- - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n- - !ruby/object:BigDecimal 18:0.1E1\n  - !ruby/object:BigDecimal 18:0.2E1\n  - !ruby/object:BigDecimal 18:0.2E1\n"], ["version", 9], ["remote_address", "127.0.0.1"], ["request_uuid", "1dd70442-b394-44f8-a60f-be5bd3672e08"], ["created_at", 2017-04-27 20:03:47 UTC]]
  [1m[35mSQL (3.2ms)[0m  [1m[33mUPDATE "estimates" SET "discount_by_stages" = $1, "updated_at" = $2 WHERE "estimates"."id" = $3[0m  [["discount_by_stages", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007fae2cbc8a90 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fae2d790b98,'0.1E1',9(18)>, #<BigDecimal:7fae2d790b20,'0.2E1',9(18)>, #<BigDecimal:7fae2d790aa8,'0.2E1',9(18)>]>], ["updated_at", 2017-04-27 20:03:47 UTC], ["id", 6]]
  [1m[35m (2.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mAudited::Audit Load (0.9ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 6], ["auditable_type", "Estimate"], ["LIMIT", 1]]
  [1m[35mSQL (0.9ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 6], ["auditable_type", "Estimate"], ["user_id", 1], ["user_type", "User"], ["action", "update"], ["audited_changes", "---\ndiscount_by_stages:\n- - !ruby/object:BigDecimal 18:0.1E1\n  - !ruby/object:BigDecimal 18:0.2E1\n  - !ruby/object:BigDecimal 18:0.2E1\n- !ruby/object:BigDecimal 18:0.0\n"], ["version", 10], ["remote_address", "127.0.0.1"], ["request_uuid", "1dd70442-b394-44f8-a60f-be5bd3672e08"], ["created_at", 2017-04-27 20:04:06 UTC]]
  [1m[35mSQL (3.0ms)[0m  [1m[33mUPDATE "estimates" SET "discount_by_stages" = $1, "updated_at" = $2 WHERE "estimates"."id" = $3[0m  [["discount_by_stages", #<BigDecimal:7fae40019c08,'0.0',9(9)>], ["updated_at", 2017-04-27 20:04:06 UTC], ["id", 6]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
Unpermitted parameters: second_floor_height_min, second_floor_height_max, third_floor_height_min, third_floor_height_max, discount_by_stages
  [1m[35m (1.6ms)[0m  [1m[35mBEGIN[0m
  [1m[36mAudited::Audit Load (1.1ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 6], ["auditable_type", "Estimate"], ["LIMIT", 1]]
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 6], ["auditable_type", "Estimate"], ["user_id", 1], ["user_type", "User"], ["action", "update"], ["audited_changes", "---\ndiscount_by_stages:\n- - !ruby/object:BigDecimal 18:0.1E1\n  - !ruby/object:BigDecimal 18:0.2E1\n  - !ruby/object:BigDecimal 18:0.2E1\n- !ruby/object:BigDecimal 18:0.0\nprice:\n- !ruby/object:BigDecimal 18:0.415895E3\n- !ruby/object:BigDecimal 27:0.41793499999999995E3\n"], ["version", 10], ["remote_address", "127.0.0.1"], ["request_uuid", "1dd70442-b394-44f8-a60f-be5bd3672e08"], ["created_at", 2017-04-27 20:06:32 UTC]]
  [1m[35mSQL (1.2ms)[0m  [1m[33mUPDATE "estimates" SET "discount_by_stages" = $1, "price" = $2, "updated_at" = $3 WHERE "estimates"."id" = $4[0m  [["discount_by_stages", #<BigDecimal:7fae40019c08,'0.0',9(9)>], ["price", #<BigDecimal:563f1ed69f30,'0.4179349999 9999995E3',27(27)>], ["updated_at", 2017-04-27 20:04:06 UTC], ["id", 6]]
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK[0m
Completed 500 Internal Server Error in 281059ms (ActiveRecord: 101.0ms)


  
ActiveRecord::StatementInvalid (PG::InvalidTextRepresentation: ERROR:  malformed array literal: "0.0"
DETAIL:  Array value must start with "{" or dimension information.
: UPDATE "estimates" SET "discount_by_stages" = $1, "price" = $2, "updated_at" = $3 WHERE "estimates"."id" = $4):
  
app/controllers/estimates_controller.rb:84:in `update'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (6.9ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (3.3ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (2.3ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (41.9ms)
Started GET "/estimates/6/edit" for 127.0.0.1 at 2017-04-27 23:06:40 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"6"}
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.5ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.0ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.9ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.0ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (1.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 6]]
  [1m[36mStageProduct Load (0.9ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (14, 15, 16)[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 14]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 13[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 15]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 14[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 16]]
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 15[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 15]]
  [1m[36mStageProductSetValue Load (0.9ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 5[0m
  [1m[36mProductSet Load (1.1ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (1.2ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 5]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (2438.1ms)
  [1m[36mClientFile Load (3.6ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 6]]
  Rendered estimates/_technical_file_fields.html.haml (4.8ms)
  [1m[36mTechnicalFile Load (0.9ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 6]]
  Rendered estimates/_discount.html.haml (6.5ms)
  Rendered estimates/_stages.html.haml (15.3ms)
  Rendered estimates/_form.html.haml (2605.7ms)
  Rendered estimates/edit.html.haml within layouts/application (2610.8ms)
  Rendered layouts/_header.html.haml (22.3ms)
Completed 200 OK in 4115ms (Views: 3545.4ms | ActiveRecord: 126.1ms)


DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
Started GET "/estimates/6/edit" for 127.0.0.1 at 2017-04-27 23:07:00 +0300
  [1m[36mActiveRecord::SchemaMigration Load (1.9ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"6"}
  [1m[36mProduct Load (1.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.9ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.8ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (1.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.1ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (1.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.6ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.8ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 6]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (14, 15, 16)[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 14]]
  [1m[36mStageProductSet Load (0.8ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 13[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 15]]
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 14[0m
  [1m[36mProduct Load (1.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 16]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 15[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.8ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 15]]
  [1m[36mStageProductSetValue Load (1.0ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 5[0m
  [1m[36mProductSet Load (0.7ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 5]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.9ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (660.2ms)
  [1m[36mClientFile Load (0.8ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 6]]
  Rendered estimates/_technical_file_fields.html.haml (7.9ms)
  [1m[36mTechnicalFile Load (1.6ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 6]]
  Rendered estimates/_discount.html.haml (10.8ms)
  Rendered estimates/_stages.html.haml (41.7ms)
  Rendered estimates/_form.html.haml (839.6ms)
  Rendered estimates/edit.html.haml within layouts/application (847.4ms)
  Rendered layouts/_header.html.haml (27.0ms)
Completed 200 OK in 2516ms (Views: 1939.8ms | ActiveRecord: 115.5ms)


Started PATCH "/estimates/6" for 127.0.0.1 at 2017-04-27 23:07:12 +0300
Processing by EstimatesController#update as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"ycoe0pDi8cCSqWHWt0HCKxK3p+5JVS5KdXSRnldWZ1jMJxaEj+FbGN8gvvLJOkH9JimE3dJ98TTkZ76N5gwEJg==", "commit"=>"Сохранить", "estimate"=>{"price"=>"413.685", "name"=>"Тестовая смета 2", "client_id"=>"1", "area"=>"4214", "first_floor_height"=>"124124.0", "second_floor_height_min"=>"0.0", "second_floor_height_max"=>"0.0", "third_floor_height_min"=>"0.0", "third_floor_height_max"=>"0.0", "discount_title"=>"123", "discount_by_stages"=>{"0"=>"2", "1"=>"3", "2"=>"3"}}, "json_stages"=>"[{\"number\":1,\"text\":{\"name\":\"Первый этап\",\"summ\":\"Итого по первому этапу:\",\"summ_dis\":\"по первому этапу\",\"discount\":\"Итого по первому этапу со скидкой:\"},\"price\":143.5,\"total_price\":140.63,\"products\":[{\"id\":1,\"name\":\"Простой продукт 1 этап\",\"unit\":\"шт\",\"custom\":false,\"profit\":100,\"price_with_work\":70,\"price_without_work\":10,\"with_work\":true,\"quantity\":1,\"sets\":[],\"price\":143.5,\"$$hashKey\":\"object:14\"}],\"aggregated_price\":143.5,\"$$hashKey\":\"object:3\"},{\"number\":2,\"text\":{\"name\":\"Второй этап\",\"summ\":\"Итого по двум этапам:\",\"summ_dis\":\"по второму этапу\",\"discount\":\"Итого по двум этапам со скидкой:\"},\"price\":77.5,\"total_price\":75.175,\"products\":[{\"id\":2,\"name\":\"Простой продукт 2 этап\",\"unit\":\"м3\",\"custom\":false,\"profit\":50,\"price_with_work\":50,\"price_without_work\":50,\"with_work\":true,\"quantity\":1,\"sets\":[],\"price\":77.5,\"$$hashKey\":\"object:17\"}],\"aggregated_price\":221,\"$$hashKey\":\"object:4\"},{\"number\":3,\"text\":{\"name\":\"Третий этап\",\"summ\":\"Итого по трем этапам:\",\"summ_dis\":\"по третьему этапу\",\"discount\":\"Итого по трем этапам со скидкой:\"},\"price\":204,\"total_price\":197.88,\"products\":[{\"id\":3,\"name\":\"Конфигурируемый продукт 3 этап\",\"unit\":\"кг\",\"custom\":true,\"profit\":150,\"price_with_work\":80,\"price_without_work\":20,\"with_work\":true,\"quantity\":1,\"sets\":[{\"id\":1,\"name\":\"Сборка 1\",\"selected\":true,\"items\":[{\"id\":1,\"name\":\"Составляющая 1\",\"quantity\":2,\"value\":{\"id\":1,\"name\":\"Примитив 1\",\"unit\":\"лист\",\"price\":10,\"work_primitive\":false}},{\"id\":2,\"name\":\"Составляющая 2\",\"quantity\":1,\"value\":{\"id\":6,\"name\":\"Примитив 6\",\"unit\":\"лист\",\"price\":60,\"work_primitive\":true}}]}],\"price\":204,\"$$hashKey\":\"object:20\"}],\"aggregated_price\":425,\"$$hashKey\":\"object:5\"}]", "data"=>"", "id"=>"6"}
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (3.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (1.2ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.8ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (1.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Unpermitted parameters: second_floor_height_min, second_floor_height_max, third_floor_height_min, third_floor_height_max, discount_by_stages
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mAudited::Audit Load (1.6ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 6], ["auditable_type", "Estimate"], ["LIMIT", 1]]
  [1m[35mSQL (1.4ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 6], ["auditable_type", "Estimate"], ["user_id", 1], ["user_type", "User"], ["action", "update"], ["audited_changes", "---\ndiscount_by_stages:\n- - !ruby/object:BigDecimal 18:0.1E1\n  - !ruby/object:BigDecimal 18:0.2E1\n  - !ruby/object:BigDecimal 18:0.2E1\n- - '2'\n  - '3'\n  - '3'\nprice:\n- !ruby/object:BigDecimal 18:0.415895E3\n- !ruby/object:BigDecimal 18:0.413685E3\n"], ["version", 10], ["remote_address", "127.0.0.1"], ["request_uuid", "15dc7a8c-e170-4649-90e4-bd2c1f7821cf"], ["created_at", 2017-04-27 20:07:12 UTC]]
  [1m[35mSQL (0.7ms)[0m  [1m[33mUPDATE "estimates" SET "discount_by_stages" = $1, "price" = $2, "updated_at" = $3 WHERE "estimates"."id" = $4[0m  [["discount_by_stages", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007fbd68b3afb0 "decimal[]"  elements_type=nil needs quotation>, values=["2", "3", "3"]>], ["price", #<BigDecimal:55b303e693b0,'0.413685E3',18(18)>], ["updated_at", 2017-04-27 20:07:12 UTC], ["id", 6]]
  [1m[35m (2.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["estimate_id", 6], ["number", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.6ms)[0m  [1m[33mUPDATE "stages" SET "total_price" = $1, "updated_at" = $2 WHERE "stages"."id" = $3[0m  [["total_price", #<BigDecimal:55b3037d1fc0,'0.14063E3',18(36)>], ["updated_at", 2017-04-27 20:07:12 UTC], ["id", 14]]
  [1m[35m (3.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (1.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND ("stage_products"."product_id" != 1)[0m  [["stage_id", 14]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT  "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND "stage_products"."product_id" = $2 LIMIT $3[0m  [["stage_id", 14], ["product_id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (1.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["estimate_id", 6], ["number", 2], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.7ms)[0m  [1m[33mUPDATE "stages" SET "total_price" = $1, "updated_at" = $2 WHERE "stages"."id" = $3[0m  [["total_price", #<BigDecimal:55b3036fa1b0,'0.7518E2',18(36)>], ["updated_at", 2017-04-27 20:07:12 UTC], ["id", 15]]
  [1m[35m (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND ("stage_products"."product_id" != 2)[0m  [["stage_id", 15]]
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT  "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND "stage_products"."product_id" = $2 LIMIT $3[0m  [["stage_id", 15], ["product_id", 2], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["estimate_id", 6], ["number", 3], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND ("stage_products"."product_id" != 3)[0m  [["stage_id", 16]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT  "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND "stage_products"."product_id" = $2 LIMIT $3[0m  [["stage_id", 16], ["product_id", 3], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSet Load (0.8ms)[0m  [1m[34mSELECT  "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1 AND "stage_product_sets"."product_set_id" = $2 LIMIT $3[0m  [["stage_product_id", 15], ["product_set_id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1 AND ("stage_product_set_values"."product_template_id" NOT IN (1, 2))[0m  [["stage_product_set_id", 5]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT  "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1 AND "stage_product_set_values"."product_template_id" = $2 LIMIT $3[0m  [["stage_product_set_id", 5], ["product_template_id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSetValue Load (0.8ms)[0m  [1m[34mSELECT  "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1 AND "stage_product_set_values"."product_template_id" = $2 LIMIT $3[0m  [["stage_product_set_id", 5], ["product_template_id", 2], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mAudited::Audit Load (1.5ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 6], ["auditable_type", "Estimate"], ["LIMIT", 1]]
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 6], ["auditable_type", "Estimate"], ["user_id", 1], ["user_type", "User"], ["action", "update"], ["audited_changes", "---\ndiscount_amount:\n- - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n- - !ruby/object:BigDecimal 18:0.287E1\n  - !ruby/object:BigDecimal 18:0.233E1\n  - !ruby/object:BigDecimal 18:0.612E1\nprice_by_stage_aggregated_discounted:\n- - !ruby/object:BigDecimal 18:0.1435E3\n  - !ruby/object:BigDecimal 18:0.221E3\n  - !ruby/object:BigDecimal 18:0.425E3\n- - !ruby/object:BigDecimal 18:0.14063E3\n  - !ruby/object:BigDecimal 18:0.21867E3\n  - !ruby/object:BigDecimal 18:0.41888E3\n"], ["version", 11], ["remote_address", "127.0.0.1"], ["request_uuid", "15dc7a8c-e170-4649-90e4-bd2c1f7821cf"], ["created_at", 2017-04-27 20:07:12 UTC]]
  [1m[35mSQL (0.7ms)[0m  [1m[33mUPDATE "estimates" SET "discount_amount" = $1, "price_by_stage_aggregated_discounted" = $2, "updated_at" = $3 WHERE "estimates"."id" = $4[0m  [["discount_amount", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007fbd68b3afb0 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:55b3035501c0,'0.287E1',18(27)>, #<BigDecimal:55b303545f68,'0.233E1',18(27)>, #<BigDecimal:55b303537d50,'0.612E1',18(27)>]>], ["price_by_stage_aggregated_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007fbd68b3afb0 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:55b303550030,'0.14063E3',18(27)>, #<BigDecimal:55b3035459c8,'0.21867E3',18(27)>, #<BigDecimal:55b303537c88,'0.41888E3',18(27)>]>], ["updated_at", 2017-04-27 20:07:12 UTC], ["id", 6]]
  [1m[35m (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
Redirected to http://localhost:3000/estimates?client_id=1
Completed 302 Found in 286ms (ActiveRecord: 65.7ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 23:07:13 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (4.1ms)
  Rendered estimates/_listing.html.haml (1.0ms)
  Rendered estimates/_listing.html.haml (1.0ms)
  [1m[36mClient Load (0.9ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (28.1ms)
  Rendered layouts/_header.html.haml (11.0ms)
Completed 200 OK in 599ms (Views: 583.9ms | ActiveRecord: 3.3ms)


Started GET "/estimates/6/edit" for 127.0.0.1 at 2017-04-27 23:07:17 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"6"}
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (3.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.9ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (1.0ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.1ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 6]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (14, 15, 16)[0m
  [1m[36mStageProduct Load (1.1ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 14]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 13[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 15]]
  [1m[36mStageProductSet Load (1.1ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 14[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 16]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 15[0m
  [1m[36mProduct Load (1.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 15]]
  [1m[36mStageProductSetValue Load (0.8ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 5[0m
  [1m[36mProductSet Load (0.6ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.6ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 5]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (5.2ms)
  [1m[36mClientFile Load (0.6ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 6]]
  Rendered estimates/_technical_file_fields.html.haml (3.1ms)
  [1m[36mTechnicalFile Load (2.6ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 6]]
  Rendered estimates/_discount.html.haml (13.2ms)
  Rendered estimates/_stages.html.haml (19.8ms)
  Rendered estimates/_form.html.haml (97.8ms)
  Rendered estimates/edit.html.haml within layouts/application (101.3ms)
  Rendered layouts/_header.html.haml (9.8ms)
Completed 200 OK in 793ms (Views: 643.6ms | ActiveRecord: 36.9ms)


Started PATCH "/estimates/6" for 127.0.0.1 at 2017-04-27 23:07:24 +0300
Processing by EstimatesController#update as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"zqj2BwkGW5kIcf34Q6GwRb/vfiOUoOIIS9PuDo7q3fbLRf5RFgXxQUX4Itw92jOTi3FdEA+IPXbawMEdP7C+iA==", "commit"=>"Сохранить", "estimate"=>{"price"=>"399.5", "name"=>"Тестовая смета 2", "client_id"=>"1", "area"=>"4214", "first_floor_height"=>"124124.0", "second_floor_height_min"=>"0.0", "second_floor_height_max"=>"0.0", "third_floor_height_min"=>"0.0", "third_floor_height_max"=>"0.0", "discount_title"=>"123", "discount_by_stages"=>{"0"=>"6", "1"=>"6", "2"=>"6"}}, "json_stages"=>"[{\"number\":1,\"text\":{\"name\":\"Первый этап\",\"summ\":\"Итого по первому этапу:\",\"summ_dis\":\"по первому этапу\",\"discount\":\"Итого по первому этапу со скидкой:\"},\"price\":143.5,\"total_price\":134.89,\"products\":[{\"id\":1,\"name\":\"Простой продукт 1 этап\",\"unit\":\"шт\",\"custom\":false,\"profit\":100,\"price_with_work\":70,\"price_without_work\":10,\"with_work\":true,\"quantity\":1,\"sets\":[],\"price\":143.5,\"$$hashKey\":\"object:15\"}],\"aggregated_price\":143.5,\"$$hashKey\":\"object:4\"},{\"number\":2,\"text\":{\"name\":\"Второй этап\",\"summ\":\"Итого по двум этапам:\",\"summ_dis\":\"по второму этапу\",\"discount\":\"Итого по двум этапам со скидкой:\"},\"price\":77.5,\"total_price\":72.85,\"products\":[{\"id\":2,\"name\":\"Простой продукт 2 этап\",\"unit\":\"м3\",\"custom\":false,\"profit\":50,\"price_with_work\":50,\"price_without_work\":50,\"with_work\":true,\"quantity\":1,\"sets\":[],\"price\":77.5,\"$$hashKey\":\"object:18\"}],\"aggregated_price\":221,\"$$hashKey\":\"object:5\"},{\"number\":3,\"text\":{\"name\":\"Третий этап\",\"summ\":\"Итого по трем этапам:\",\"summ_dis\":\"по третьему этапу\",\"discount\":\"Итого по трем этапам со скидкой:\"},\"price\":204,\"total_price\":191.76,\"products\":[{\"id\":3,\"name\":\"Конфигурируемый продукт 3 этап\",\"unit\":\"кг\",\"custom\":true,\"profit\":150,\"price_with_work\":80,\"price_without_work\":20,\"with_work\":true,\"quantity\":1,\"sets\":[{\"id\":1,\"name\":\"Сборка 1\",\"selected\":true,\"items\":[{\"id\":1,\"name\":\"Составляющая 1\",\"quantity\":2,\"value\":{\"id\":1,\"name\":\"Примитив 1\",\"unit\":\"лист\",\"price\":10,\"work_primitive\":false}},{\"id\":2,\"name\":\"Составляющая 2\",\"quantity\":1,\"value\":{\"id\":6,\"name\":\"Примитив 6\",\"unit\":\"лист\",\"price\":60,\"work_primitive\":true}}]}],\"price\":204,\"$$hashKey\":\"object:21\"}],\"aggregated_price\":425,\"$$hashKey\":\"object:6\"}]", "data"=>"", "id"=>"6"}
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.3ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.7ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.5ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (1.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Unpermitted parameters: second_floor_height_min, second_floor_height_max, third_floor_height_min, third_floor_height_max, discount_by_stages
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mAudited::Audit Load (0.8ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 6], ["auditable_type", "Estimate"], ["LIMIT", 1]]
  [1m[35mSQL (2.6ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 6], ["auditable_type", "Estimate"], ["user_id", 1], ["user_type", "User"], ["action", "update"], ["audited_changes", "---\ndiscount_by_stages:\n- - !ruby/object:BigDecimal 18:0.2E1\n  - !ruby/object:BigDecimal 18:0.3E1\n  - !ruby/object:BigDecimal 18:0.3E1\n- - '6'\n  - '6'\n  - '6'\nprice:\n- !ruby/object:BigDecimal 18:0.413685E3\n- !ruby/object:BigDecimal 18:0.3995E3\n"], ["version", 12], ["remote_address", "127.0.0.1"], ["request_uuid", "67811f01-3fac-4752-a70c-0c8a635b9ddc"], ["created_at", 2017-04-27 20:07:24 UTC]]
  [1m[35mSQL (0.6ms)[0m  [1m[33mUPDATE "estimates" SET "discount_by_stages" = $1, "price" = $2, "updated_at" = $3 WHERE "estimates"."id" = $4[0m  [["discount_by_stages", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007fbd68b3afb0 "decimal[]"  elements_type=nil needs quotation>, values=["6", "6", "6"]>], ["price", #<BigDecimal:55b30379dce8,'0.3995E3',18(18)>], ["updated_at", 2017-04-27 20:07:24 UTC], ["id", 6]]
  [1m[35m (2.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (1.6ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["estimate_id", 6], ["number", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (1.3ms)[0m  [1m[33mUPDATE "stages" SET "total_price" = $1, "updated_at" = $2 WHERE "stages"."id" = $3[0m  [["total_price", #<BigDecimal:55b303606100,'0.13489E3',18(36)>], ["updated_at", 2017-04-27 20:07:24 UTC], ["id", 14]]
  [1m[35m (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND ("stage_products"."product_id" != 1)[0m  [["stage_id", 14]]
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT  "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND "stage_products"."product_id" = $2 LIMIT $3[0m  [["stage_id", 14], ["product_id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (0.8ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["estimate_id", 6], ["number", 2], ["LIMIT", 1]]
  [1m[35m (4.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.7ms)[0m  [1m[33mUPDATE "stages" SET "total_price" = $1, "updated_at" = $2 WHERE "stages"."id" = $3[0m  [["total_price", #<BigDecimal:55b303534fd8,'0.7285E2',18(36)>], ["updated_at", 2017-04-27 20:07:24 UTC], ["id", 15]]
  [1m[35m (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND ("stage_products"."product_id" != 2)[0m  [["stage_id", 15]]
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT  "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND "stage_products"."product_id" = $2 LIMIT $3[0m  [["stage_id", 15], ["product_id", 2], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (0.5ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["estimate_id", 6], ["number", 3], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.7ms)[0m  [1m[33mUPDATE "stages" SET "total_price" = $1, "updated_at" = $2 WHERE "stages"."id" = $3[0m  [["total_price", #<BigDecimal:55b3033f7b98,'0.19176E3',18(36)>], ["updated_at", 2017-04-27 20:07:24 UTC], ["id", 16]]
  [1m[35m (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND ("stage_products"."product_id" != 3)[0m  [["stage_id", 16]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT  "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND "stage_products"."product_id" = $2 LIMIT $3[0m  [["stage_id", 16], ["product_id", 3], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSet Load (2.9ms)[0m  [1m[34mSELECT  "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1 AND "stage_product_sets"."product_set_id" = $2 LIMIT $3[0m  [["stage_product_id", 15], ["product_set_id", 1], ["LIMIT", 1]]
  [1m[35m (1.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1 AND ("stage_product_set_values"."product_template_id" NOT IN (1, 2))[0m  [["stage_product_set_id", 5]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT  "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1 AND "stage_product_set_values"."product_template_id" = $2 LIMIT $3[0m  [["stage_product_set_id", 5], ["product_template_id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSetValue Load (0.8ms)[0m  [1m[34mSELECT  "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1 AND "stage_product_set_values"."product_template_id" = $2 LIMIT $3[0m  [["stage_product_set_id", 5], ["product_template_id", 2], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mAudited::Audit Load (0.8ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 6], ["auditable_type", "Estimate"], ["LIMIT", 1]]
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 6], ["auditable_type", "Estimate"], ["user_id", 1], ["user_type", "User"], ["action", "update"], ["audited_changes", "---\nprice_by_area:\n- !ruby/object:BigDecimal 18:0.1E0\n- !ruby/object:BigDecimal 27:0.9E-1\ndiscount_amount:\n- - !ruby/object:BigDecimal 18:0.287E1\n  - !ruby/object:BigDecimal 18:0.233E1\n  - !ruby/object:BigDecimal 18:0.612E1\n- - !ruby/object:BigDecimal 18:0.861E1\n  - !ruby/object:BigDecimal 18:0.465E1\n  - !ruby/object:BigDecimal 18:0.1224E2\nprice_by_stage_aggregated_discounted:\n- - !ruby/object:BigDecimal 18:0.14063E3\n  - !ruby/object:BigDecimal 18:0.21867E3\n  - !ruby/object:BigDecimal 18:0.41888E3\n- - !ruby/object:BigDecimal 18:0.13489E3\n  - !ruby/object:BigDecimal 18:0.21635E3\n  - !ruby/object:BigDecimal 18:0.41276E3\n"], ["version", 13], ["remote_address", "127.0.0.1"], ["request_uuid", "67811f01-3fac-4752-a70c-0c8a635b9ddc"], ["created_at", 2017-04-27 20:07:24 UTC]]
  [1m[35mSQL (1.4ms)[0m  [1m[33mUPDATE "estimates" SET "price_by_area" = $1, "discount_amount" = $2, "price_by_stage_aggregated_discounted" = $3, "updated_at" = $4 WHERE "estimates"."id" = $5[0m  [["price_by_area", #<BigDecimal:55b3030e1c88,'0.9E-1',9(36)>], ["discount_amount", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007fbd68b3afb0 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:55b3030f2dd0,'0.861E1',18(27)>, #<BigDecimal:55b3030f0ff8,'0.465E1',18(27)>, #<BigDecimal:55b3030ef388,'0.1224E2',18(27)>]>], ["price_by_stage_aggregated_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007fbd68b3afb0 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:55b3030f2560,'0.13489E3',18(27)>, #<BigDecimal:55b3030f0e40,'0.21635E3',18(27)>, #<BigDecimal:55b3030ee910,'0.41276E3',18(27)>]>], ["updated_at", 2017-04-27 20:07:24 UTC], ["id", 6]]
  [1m[35m (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
Redirected to http://localhost:3000/estimates?client_id=1
Completed 302 Found in 236ms (ActiveRecord: 57.4ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 23:07:24 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (5.9ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (4.1ms)
  Rendered estimates/_listing.html.haml (1.0ms)
  Rendered estimates/_listing.html.haml (1.5ms)
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (25.0ms)
  Rendered layouts/_header.html.haml (10.9ms)
Completed 200 OK in 604ms (Views: 587.3ms | ActiveRecord: 8.4ms)


Started GET "/estimates/6/edit" for 127.0.0.1 at 2017-04-27 23:07:27 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"6"}
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (2.2ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.1ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (3.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.6ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 6]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (14, 15, 16)[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 14]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 13[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 15]]
  [1m[36mStageProductSet Load (0.8ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 14[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 16]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 15[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 15]]
  [1m[36mStageProductSetValue Load (2.1ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 5[0m
  [1m[36mProductSet Load (0.6ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.4ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 5]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.3ms)
  [1m[36mClientFile Load (1.0ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 6]]
  Rendered estimates/_technical_file_fields.html.haml (3.2ms)
  [1m[36mTechnicalFile Load (0.7ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 6]]
  Rendered estimates/_discount.html.haml (8.0ms)
  Rendered estimates/_stages.html.haml (19.3ms)
  Rendered estimates/_form.html.haml (82.7ms)
  Rendered estimates/edit.html.haml within layouts/application (86.2ms)
  Rendered layouts/_header.html.haml (10.4ms)
Completed 200 OK in 856ms (Views: 702.7ms | ActiveRecord: 33.7ms)


Started GET "/estimates" for 127.0.0.1 at 2017-04-27 23:12:53 +0300
Processing by EstimatesController#index as HTML
  [1m[36mUser Load (3.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Redirected to http://localhost:3000/clients
Completed 302 Found in 9ms (ActiveRecord: 3.7ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 23:12:53 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (1.3ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (3.2ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (1.5ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (9.6ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (6.2ms)
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (5.4ms)
  Rendered clients/_table.html.haml (28.9ms)
  [1m[36mUserClient Load (0.9ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (62.2ms)
  Rendered layouts/_header.html.haml (11.1ms)
Completed 200 OK in 834ms (Views: 810.2ms | ActiveRecord: 12.9ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 23:14:37 +0300
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Processing by ClientsController#index as HTML
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (0.8ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (1.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (9.6ms)
  [1m[35m (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (5.8ms)
  [1m[35m (1.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (5.1ms)
  Rendered clients/_table.html.haml (52.2ms)
  [1m[36mUserClient Load (1.0ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (143.1ms)
  Rendered layouts/_header.html.haml (57.0ms)
Completed 200 OK in 893ms (Views: 835.7ms | ActiveRecord: 26.8ms)


Started GET "/clients?utf8=%E2%9C%93&name=&archived=1" for 127.0.0.1 at 2017-04-27 23:14:43 +0300
Processing by ClientsController#index as HTML
  Parameters: {"utf8"=>"✓", "name"=>"", "archived"=>"1"}
  [1m[36mUser Load (10.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (0.8ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE (user_id = 1 and owner = true)[0m
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (3.5ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (8.4ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (4.2ms)
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (4.5ms)
  Rendered clients/_table.html.haml (25.2ms)
  [1m[36mUserClient Load (1.6ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE (user_id = 1 and owner = false)[0m
  Rendered clients/index.html.haml within layouts/application (52.3ms)
  Rendered layouts/_header.html.haml (16.7ms)
Completed 200 OK in 634ms (Views: 611.4ms | ActiveRecord: 18.2ms)


Started GET "/clients/3/edit" for 127.0.0.1 at 2017-04-27 23:14:46 +0300
Processing by ClientsController#edit as HTML
  Parameters: {"id"=>"3"}
  [1m[36mClient Load (2.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUserClient Exists (0.5ms)[0m  [1m[34mSELECT  1 AS one FROM "user_clients" WHERE "user_clients"."user_id" = 1 AND "user_clients"."client_id" = 3 LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUserClient Load (0.5ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" WHERE "user_clients"."client_id" = 3 AND ("user_clients"."user_id" != 1)[0m
  Rendering clients/edit.html.haml within layouts/application
  [1m[36mUserClient Load (0.6ms)[0m  [1m[34mSELECT  "user_clients".* FROM "user_clients" WHERE "user_clients"."user_id" = 1 AND "user_clients"."client_id" = 3 LIMIT $1[0m  [["LIMIT", 1]]
  Rendered clients/_form.html.haml (53.2ms)
  Rendered clients/edit.html.haml within layouts/application (56.8ms)
  Rendered layouts/_header.html.haml (11.6ms)
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE ("users"."id" != $1)[0m  [["id", 1]]
Completed 200 OK in 872ms (Views: 831.5ms | ActiveRecord: 6.1ms)


Started PATCH "/clients/3" for 127.0.0.1 at 2017-04-27 23:14:49 +0300
Processing by ClientsController#update as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"fxEzSUcKWzY/Z3FXAtxhMfPwtpnWuBIRhoJ1KAQdHt96/DsfWAnx7nLurnN8p+Lnx26Vqk2QzW8XkVo7tUd9oQ==", "commit"=>"Сохранить", "client"=>{"first_name"=>"124", "last_name"=>"124", "middle_name"=>"124", "crm"=>"214", "archived"=>"1"}, "client_users"=>"[]", "id"=>"3"}
  [1m[36mClient Load (1.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUserClient Load (0.8ms)[0m  [1m[34mSELECT  "user_clients".* FROM "user_clients" WHERE "user_clients"."user_id" = 1 AND "user_clients"."client_id" = 3 LIMIT $1[0m  [["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[36mAudited::Audit Load (0.7ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 3], ["auditable_type", "Client"], ["LIMIT", 1]]
  [1m[35mSQL (3.8ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 3], ["auditable_type", "Client"], ["user_id", 1], ["user_type", "User"], ["action", "update"], ["audited_changes", "---\narchived:\n- false\n- true\n"], ["version", 2], ["remote_address", "127.0.0.1"], ["request_uuid", "015d03b1-83e3-4d4a-bd9d-a7084f113dc5"], ["created_at", 2017-04-27 20:14:49 UTC]]
  [1m[35mSQL (1.1ms)[0m  [1m[33mUPDATE "clients" SET "archived" = $1, "updated_at" = $2 WHERE "clients"."id" = $3[0m  [["archived", true], ["updated_at", 2017-04-27 20:14:49 UTC], ["id", 3]]
  [1m[35m (2.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mUserClient Load (0.8ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" WHERE "user_clients"."client_id" = 3 AND "user_clients"."owner" = $1 AND (1=1)[0m  [["owner", false]]
Redirected to http://localhost:3000/clients
Completed 302 Found in 45ms (ActiveRecord: 12.4ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 23:14:49 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (1.0ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2)[0m
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (10.5ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (4.3ms)
  Rendered clients/_table.html.haml (21.4ms)
  [1m[36mUserClient Load (0.8ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (41.2ms)
  Rendered layouts/_header.html.haml (11.1ms)
Completed 200 OK in 616ms (Views: 606.0ms | ActiveRecord: 5.3ms)


Started GET "/clients?utf8=%E2%9C%93&name=&archived=1" for 127.0.0.1 at 2017-04-27 23:14:53 +0300
Processing by ClientsController#index as HTML
  Parameters: {"utf8"=>"✓", "name"=>"", "archived"=>"1"}
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (2.4ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE (user_id = 1 and owner = true)[0m
  [1m[36mClient Load (1.1ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (2.9ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (11.5ms)
  [1m[35m (3.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (6.2ms)
  [1m[35m (3.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (7.1ms)
  Rendered clients/_table.html.haml (29.6ms)
  [1m[36mUserClient Load (1.6ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE (user_id = 1 and owner = false)[0m
  Rendered clients/index.html.haml within layouts/application (54.0ms)
  Rendered layouts/_header.html.haml (16.5ms)
Completed 200 OK in 642ms (Views: 622.9ms | ActiveRecord: 15.9ms)


Started GET "/clients?utf8=%E2%9C%93&name=&archived=1" for 127.0.0.1 at 2017-04-27 23:15:20 +0300
Processing by ClientsController#index as HTML
  Parameters: {"utf8"=>"✓", "name"=>"", "archived"=>"1"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (0.9ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE (user_id = 1 and owner = true)[0m
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (5.9ms)
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (3.6ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (3.7ms)
  Rendered clients/_table.html.haml (18.2ms)
  [1m[36mUserClient Load (2.0ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE (user_id = 1 and owner = false)[0m
  Rendered clients/index.html.haml within layouts/application (36.3ms)
  Rendered layouts/_header.html.haml (20.0ms)
Completed 200 OK in 714ms (Views: 704.4ms | ActiveRecord: 6.3ms)


Started GET "/clients?utf8=%E2%9C%93&name=&archived=1" for 127.0.0.1 at 2017-04-27 23:16:18 +0300
Processing by ClientsController#index as HTML
  Parameters: {"utf8"=>"✓", "name"=>"", "archived"=>"1"}
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (0.9ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE (user_id = 1 and owner = true)[0m
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (14.0ms)
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (10.3ms)
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (8.4ms)
  Rendered clients/_table.html.haml (41.2ms)
  [1m[36mUserClient Load (1.4ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE (user_id = 1 and owner = false)[0m
  Rendered clients/index.html.haml within layouts/application (72.3ms)
  Rendered layouts/_header.html.haml (12.5ms)
Completed 200 OK in 823ms (Views: 807.2ms | ActiveRecord: 7.3ms)


Started GET "/clients?utf8=%E2%9C%93&name=sf&archived=on" for 127.0.0.1 at 2017-04-27 23:16:25 +0300
Processing by ClientsController#index as HTML
  Parameters: {"utf8"=>"✓", "name"=>"sf", "archived"=>"on"}
  [1m[36mUser Load (1.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUserClient Load (3.7ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE (user_id = 1 and owner = true)[0m
  [1m[36mClient Load (1.5ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[36mUserClient Load (0.7ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE (user_id = 1 and owner = false)[0m
  Rendering clients/index.html.haml within layouts/application
  Rendered clients/index.html.haml within layouts/application (6.2ms)
  Rendered layouts/_header.html.haml (13.8ms)
Completed 200 OK in 659ms (Views: 634.6ms | ActiveRecord: 8.2ms)


Started GET "/clients?utf8=%E2%9C%93&name=&archived=on" for 127.0.0.1 at 2017-04-27 23:16:33 +0300
Processing by ClientsController#index as HTML
  Parameters: {"utf8"=>"✓", "name"=>"", "archived"=>"on"}
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (2.4ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE (user_id = 1 and owner = true)[0m
  [1m[36mClient Load (1.8ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (11.2ms)
  [1m[35m (2.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (5.7ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (3.8ms)
  Rendered clients/_table.html.haml (27.1ms)
  [1m[36mUserClient Load (4.3ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE (user_id = 1 and owner = false)[0m
  Rendered clients/index.html.haml within layouts/application (52.9ms)
  Rendered layouts/_header.html.haml (12.2ms)
Completed 200 OK in 692ms (Views: 674.7ms | ActiveRecord: 14.0ms)


Started GET "/clients?utf8=%E2%9C%93&name=&archived=on" for 127.0.0.1 at 2017-04-27 23:18:36 +0300
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Processing by ClientsController#index as HTML
  Parameters: {"utf8"=>"✓", "name"=>"", "archived"=>"on"}
  [1m[36mUser Load (1.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (0.9ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE (user_id = 1 and owner = true)[0m
  [1m[36mClient Load (1.1ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (1.1ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (8.4ms)
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (4.6ms)
  [1m[35m (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (7.2ms)
  Rendered clients/_table.html.haml (25.0ms)
  [1m[36mUserClient Load (0.7ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE (user_id = 1 and owner = false)[0m
  Rendered clients/index.html.haml within layouts/application (136.2ms)
  Rendered layouts/_header.html.haml (106.8ms)
Completed 200 OK in 892ms (Views: 839.8ms | ActiveRecord: 29.8ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 23:18:40 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (3.0ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.4ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (5.2ms)
  Rendered estimates/_listing.html.haml (1.6ms)
  Rendered estimates/_listing.html.haml (1.1ms)
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (41.2ms)
  Rendered layouts/_header.html.haml (16.2ms)
Completed 200 OK in 879ms (Views: 856.1ms | ActiveRecord: 6.1ms)


DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 23:21:31 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (2.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (36.9ms)
  Rendered estimates/_listing.html.haml (1.4ms)
  Rendered estimates/_listing.html.haml (3.5ms)
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (63.9ms)
  Rendered layouts/_header.html.haml (63.0ms)
Completed 200 OK in 783ms (Views: 672.1ms | ActiveRecord: 29.8ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 23:24:18 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.5ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.0ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (4.1ms)
  Rendered estimates/_listing.html.haml (3.3ms)
  Rendered estimates/_listing.html.haml (1.5ms)
  [1m[36mClient Load (1.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/index.html.haml within layouts/application (52.1ms)
Completed 500 Internal Server Error in 163ms (ActiveRecord: 21.4ms)


  
ActionView::Template::Error (undefined method `name' for #<Client:0x0055b303cfd080>):
    51:                 .form-group
    52:                   %label.col-sm-3.control-label Клиент
    53:                   .col-sm-9
    54:                     = select_tag :client_id, options_for_select(Client.all.map{ |u| [u.name, u.id] }), class: 'form-control'
    55:           .modal-footer
    56:             %button.btn.btn-default{ type: "button", data: { dismiss: "modal" } } Отмена
    57:             %button.btn.btn-success{ type: "button", data: { dismiss: "modal" } } Создать
  
app/views/estimates/index.html.haml:54:in `block (3 levels) in _app_views_estimates_index_html_haml__609351194539095214_70225737907680'
app/views/estimates/index.html.haml:54:in `block (2 levels) in _app_views_estimates_index_html_haml__609351194539095214_70225737907680'
app/views/estimates/index.html.haml:45:in `block in _app_views_estimates_index_html_haml__609351194539095214_70225737907680'
app/views/estimates/index.html.haml:33:in `_app_views_estimates_index_html_haml__609351194539095214_70225737907680'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (16.3ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.9ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.6ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (49.0ms)
Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 23:24:29 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.0ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (3.5ms)
  Rendered estimates/_listing.html.haml (1.0ms)
  Rendered estimates/_listing.html.haml (1.7ms)
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  [1m[36mCACHE (0.2ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/index.html.haml within layouts/application (31.8ms)
  Rendered layouts/_header.html.haml (64.7ms)
Completed 200 OK in 725ms (Views: 708.8ms | ActiveRecord: 3.4ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 23:24:40 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (1.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (2.4ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (1.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2)[0m
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2)[0m
  [1m[35m (6.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (17.9ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (5.8ms)
  Rendered clients/_table.html.haml (34.8ms)
  [1m[36mUserClient Load (0.8ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (76.1ms)
  Rendered layouts/_header.html.haml (14.5ms)
Completed 200 OK in 697ms (Views: 663.9ms | ActiveRecord: 18.4ms)


Started GET "/clients?utf8=%E2%9C%93&name=&archived=1" for 127.0.0.1 at 2017-04-27 23:24:44 +0300
Processing by ClientsController#index as HTML
  Parameters: {"utf8"=>"✓", "name"=>"", "archived"=>"1"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (1.1ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE (user_id = 1 and owner = true)[0m
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (2.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (9.2ms)
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (5.2ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (4.0ms)
  Rendered clients/_table.html.haml (23.4ms)
  [1m[36mUserClient Load (0.8ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE (user_id = 1 and owner = false)[0m
  Rendered clients/index.html.haml within layouts/application (47.8ms)
  Rendered layouts/_header.html.haml (13.1ms)
Completed 200 OK in 647ms (Views: 635.7ms | ActiveRecord: 7.7ms)


  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 23:25:38 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (1.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (8.0ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.3ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (4.0ms)
  Rendered estimates/_listing.html.haml (1.1ms)
  Rendered estimates/_listing.html.haml (1.3ms)
  [1m[36mClient Load (0.9ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered estimates/index.html.haml within layouts/application (48.0ms)
  Rendered layouts/_header.html.haml (12.8ms)
Completed 200 OK in 730ms (Views: 708.6ms | ActiveRecord: 11.7ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 23:26:01 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (1.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (1.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (4.4ms)
  Rendered estimates/_listing.html.haml (1.2ms)
  Rendered estimates/_listing.html.haml (1.6ms)
  [1m[36mClient Load (1.2ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered estimates/index.html.haml within layouts/application (45.9ms)
  Rendered layouts/_header.html.haml (9.4ms)
Completed 200 OK in 819ms (Views: 802.6ms | ActiveRecord: 5.6ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 23:26:43 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (1.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (3.4ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (4.6ms)
  Rendered estimates/_listing.html.haml (1.7ms)
  Rendered estimates/_listing.html.haml (1.0ms)
  [1m[36mClient Load (0.9ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered estimates/index.html.haml within layouts/application (34.9ms)
  Rendered layouts/_header.html.haml (11.3ms)
Completed 200 OK in 574ms (Views: 558.3ms | ActiveRecord: 6.5ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 23:27:42 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (4.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (2.6ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.1ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (3.8ms)
  Rendered estimates/_listing.html.haml (0.9ms)
  Rendered estimates/_listing.html.haml (1.2ms)
  [1m[36mClient Load (1.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered estimates/index.html.haml within layouts/application (31.5ms)
  Rendered layouts/_header.html.haml (9.8ms)
Completed 200 OK in 551ms (Views: 533.1ms | ActiveRecord: 9.3ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 23:28:28 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (8.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (4.0ms)
  Rendered estimates/_listing.html.haml (1.0ms)
  Rendered estimates/_listing.html.haml (1.0ms)
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered estimates/index.html.haml within layouts/application (32.8ms)
Completed 500 Internal Server Error in 54ms (ActiveRecord: 10.4ms)


  
ActionView::Template::Error (undefined method `submit' for nil:NilClass):
    54:                     = select_tag :client_id, options_for_select(current_user.clients.all.map{ |u| [u.full_name, u.id] }), class: 'form-control'
    55:             .modal-footer
    56:               %button.btn.btn-default{ type: "button", data: { dismiss: "modal" } } Отмена
    57:               = f.submit 'Создать', class: 'btn btn-success'
  
app/views/estimates/index.html.haml:57:in `block (2 levels) in _app_views_estimates_index_html_haml__609351194539095214_70225782356540'
app/views/estimates/index.html.haml:37:in `block in _app_views_estimates_index_html_haml__609351194539095214_70225782356540'
app/views/estimates/index.html.haml:33:in `_app_views_estimates_index_html_haml__609351194539095214_70225782356540'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (9.9ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.8ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.1ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (42.5ms)
Started GET "/clients?utf8=%E2%9C%93&name=&archived=1" for 127.0.0.1 at 2017-04-27 23:29:19 +0300
Processing by ClientsController#index as HTML
  Parameters: {"utf8"=>"✓", "name"=>"", "archived"=>"1"}
  [1m[36mUser Load (3.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (0.9ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE (user_id = 1 and owner = true)[0m
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2, 3)[0m
  [1m[36mEstimate Load (3.0ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2, 3)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (7.7ms)
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (9.5ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 3]]
  Rendered clients/_listing.html.haml (4.4ms)
  Rendered clients/_table.html.haml (27.7ms)
  [1m[36mUserClient Load (0.9ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE (user_id = 1 and owner = false)[0m
  Rendered clients/index.html.haml within layouts/application (50.9ms)
  Rendered layouts/_header.html.haml (17.4ms)
Completed 200 OK in 794ms (Views: 776.0ms | ActiveRecord: 11.4ms)


Started GET "/clients/1/edit" for 127.0.0.1 at 2017-04-27 23:29:22 +0300
Processing by ClientsController#edit as HTML
  Parameters: {"id"=>"1"}
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUserClient Exists (0.7ms)[0m  [1m[34mSELECT  1 AS one FROM "user_clients" WHERE "user_clients"."user_id" = 1 AND "user_clients"."client_id" = 1 LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUserClient Load (2.3ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" WHERE "user_clients"."client_id" = 1 AND ("user_clients"."user_id" != 1)[0m
  Rendering clients/edit.html.haml within layouts/application
  [1m[36mUserClient Load (0.8ms)[0m  [1m[34mSELECT  "user_clients".* FROM "user_clients" WHERE "user_clients"."user_id" = 1 AND "user_clients"."client_id" = 1 LIMIT $1[0m  [["LIMIT", 1]]
  Rendered clients/_form.html.haml (26.6ms)
  Rendered clients/edit.html.haml within layouts/application (30.5ms)
  Rendered layouts/_header.html.haml (11.8ms)
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE ("users"."id" != $1)[0m  [["id", 1]]
Completed 200 OK in 668ms (Views: 639.6ms | ActiveRecord: 5.8ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 23:29:24 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (1.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (0.8ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2)[0m
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (7.3ms)
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (4.5ms)
  Rendered clients/_table.html.haml (15.8ms)
  [1m[36mUserClient Load (2.3ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (33.9ms)
  Rendered layouts/_header.html.haml (10.1ms)
Completed 200 OK in 687ms (Views: 670.5ms | ActiveRecord: 7.7ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 23:29:31 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (3.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (2.2ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.9ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (6.9ms)
  Rendered estimates/_listing.html.haml (1.2ms)
  Rendered estimates/_listing.html.haml (1.2ms)
  [1m[36mClient Load (0.9ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered estimates/index.html.haml within layouts/application (40.9ms)
  Rendered layouts/_header.html.haml (9.5ms)
Completed 200 OK in 643ms (Views: 624.2ms | ActiveRecord: 8.3ms)


Started POST "/estimates/6/copy" for 127.0.0.1 at 2017-04-27 23:29:44 +0300
Processing by EstimatesController#copy as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"Op1g+QkfWGSxiBfx0j+dVEkED6Xh8khnZVlEOr1G18A/cGivFhzyvPwByNWsRB6CfZoslnralxn0SmspDBy0vg==", "name"=>"Тестовая 3", "client_id"=>"1", "commit"=>"Создать", "estimate_id"=>"6"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mStage Load (2.4ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = 6[0m
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 308ms (ActiveRecord: 9.3ms)


  
NameError (undefined local variable or method `estimate' for #<EstimatesController:0x007fbd484f9608>
Did you mean?  esitmate):
  
app/controllers/estimates_controller.rb:116:in `copy'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (4.6ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.2ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.6ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (174.1ms)
Started POST "/estimates/6/copy" for 127.0.0.1 at 2017-04-27 23:30:03 +0300
Processing by EstimatesController#copy as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"Op1g+QkfWGSxiBfx0j+dVEkED6Xh8khnZVlEOr1G18A/cGivFhzyvPwByNWsRB6CfZoslnralxn0SmspDBy0vg==", "name"=>"Тестовая 3", "client_id"=>"1", "commit"=>"Создать", "estimate_id"=>"6"}
  [1m[36mUser Load (1.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mStage Load (0.5ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = 6[0m
  [1m[36mClient Load (0.9ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (5.7ms)[0m  [1m[32mINSERT INTO "estimates" ("name", "client_id", "floors", "first_floor_height", "price", "area", "price_by_area", "price_by_stage", "price_by_stage_aggregated", "price_by_area_per_stage", "discount_title", "discount_by_stages", "discount_amount", "price_by_stage_aggregated_discounted", "price_by_area_per_stage_discounted", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17) RETURNING "id"[0m  [["name", "Тестовая 3"], ["client_id", 1], ["floors", #<BigDecimal:7fbd6ab8abd0,'0.1E1',9(18)>], ["first_floor_height", #<BigDecimal:7fbd6ab81210,'0.124124E6',9(18)>], ["price", #<BigDecimal:7fbd6ab81530,'0.3995E3',18(18)>], ["area", #<BigDecimal:7fbd6ab81418,'0.4214E4',9(18)>], ["price_by_area", #<BigDecimal:7fbd6ab8a568,'0.9E-1',9(18)>], ["price_by_stage", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007fbd68b3afb0 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fbd6ab8a270,'0.1435E3',18(18)>, #<BigDecimal:7fbd6ab8a248,'0.775E2',18(18)>, #<BigDecimal:7fbd6ab8a220,'0.204E3',9(18)>]>], ["price_by_stage_aggregated", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007fbd68b3afb0 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fbd6ab89cf8,'0.1435E3',18(18)>, #<BigDecimal:7fbd6ab89ca8,'0.221E3',9(18)>, #<BigDecimal:7fbd6ab89c80,'0.425E3',9(18)>]>], ["price_by_area_per_stage", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007fbd68b3afb0 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fbd6ab89708,'0.3E-1',9(18)>, #<BigDecimal:7fbd6ab896e0,'0.5E-1',9(18)>, #<BigDecimal:7fbd6ab896b8,'0.1E0',9(18)>]>], ["discount_title", "123"], ["discount_by_stages", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007fbd68b3afb0 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fbd6ab88fd8,'0.6E1',9(18)>, #<BigDecimal:7fbd6ab88fb0,'0.6E1',9(18)>, #<BigDecimal:7fbd6ab88f60,'0.6E1',9(18)>]>], ["discount_amount", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007fbd68b3afb0 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fbd6ab888f8,'0.861E1',18(18)>, #<BigDecimal:7fbd6ab888d0,'0.465E1',18(18)>, #<BigDecimal:7fbd6ab888a8,'0.1224E2',18(18)>]>], ["price_by_stage_aggregated_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007fbd68b3afb0 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fbd6ab88268,'0.13489E3',18(18)>, #<BigDecimal:7fbd6ab88240,'0.21635E3',18(18)>, #<BigDecimal:7fbd6ab88218,'0.41276E3',18(18)>]>], ["price_by_area_per_stage_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007fbd68b3afb0 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fbd6aba3c70,'0.3E-1',9(18)>, #<BigDecimal:7fbd6aba3c48,'0.5E-1',9(18)>, #<BigDecimal:7fbd6aba3c20,'0.1E0',9(18)>]>], ["created_at", 2017-04-27 20:30:03 UTC], ["updated_at", 2017-04-27 20:30:03 UTC]]
  [1m[36mAudited::Audit Load (0.9ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 7], ["auditable_type", "Estimate"], ["LIMIT", 1]]
  [1m[35mSQL (3.3ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 7], ["auditable_type", "Estimate"], ["user_id", 1], ["user_type", "User"], ["action", "create"], ["audited_changes", "---\nname: Тестовая 3\nclient_id: 1\nfloors: !ruby/object:BigDecimal 18:0.1E1\nfirst_floor_height: !ruby/object:BigDecimal 18:0.124124E6\nsecond_floor_height_min: !ruby/object:BigDecimal 18:0.0\nsecond_floor_height_max: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_min: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_max: !ruby/object:BigDecimal 18:0.0\nprice: !ruby/object:BigDecimal 18:0.3995E3\narea: !ruby/object:BigDecimal 18:0.4214E4\nprice_by_area: !ruby/object:BigDecimal 18:0.9E-1\nprice_by_stage:\n- !ruby/object:BigDecimal 18:0.1435E3\n- !ruby/object:BigDecimal 18:0.775E2\n- !ruby/object:BigDecimal 18:0.204E3\nprice_by_stage_aggregated:\n- !ruby/object:BigDecimal 18:0.1435E3\n- !ruby/object:BigDecimal 18:0.221E3\n- !ruby/object:BigDecimal 18:0.425E3\nprice_by_area_per_stage:\n- !ruby/object:BigDecimal 18:0.3E-1\n- !ruby/object:BigDecimal 18:0.5E-1\n- !ruby/object:BigDecimal 18:0.1E0\ndiscount_title: '123'\ndiscount_by_stages:\n- !ruby/object:BigDecimal 18:0.6E1\n- !ruby/object:BigDecimal 18:0.6E1\n- !ruby/object:BigDecimal 18:0.6E1\ndiscount_amount:\n- !ruby/object:BigDecimal 18:0.861E1\n- !ruby/object:BigDecimal 18:0.465E1\n- !ruby/object:BigDecimal 18:0.1224E2\nprice_by_stage_aggregated_discounted:\n- !ruby/object:BigDecimal 18:0.13489E3\n- !ruby/object:BigDecimal 18:0.21635E3\n- !ruby/object:BigDecimal 18:0.41276E3\nprice_by_area_per_stage_discounted:\n- !ruby/object:BigDecimal 18:0.3E-1\n- !ruby/object:BigDecimal 18:0.5E-1\n- !ruby/object:BigDecimal 18:0.1E0\nsigned: false\ndeleted_at: \nsigning_date: \nuser_id: \n"], ["version", 1], ["remote_address", "127.0.0.1"], ["request_uuid", "237e2243-9f91-4cc5-bbe0-4eb86d0ccacb"], ["created_at", 2017-04-27 20:30:03 UTC]]
  [1m[35m (3.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 6]]
  [1m[36mStageProduct Load (1.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (14, 15, 16)[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK[0m
Completed 500 Internal Server Error in 217ms (ActiveRecord: 46.8ms)


  
ActiveModel::UnknownAttributeError (unknown attribute 'estimage' for Stage.):
  
app/controllers/estimates_controller.rb:120:in `block in copy'
app/controllers/estimates_controller.rb:118:in `copy'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (7.3ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (3.0ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.8ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (35.2ms)
Started POST "/estimates/6/copy" for 127.0.0.1 at 2017-04-27 23:30:24 +0300
Processing by EstimatesController#copy as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"Op1g+QkfWGSxiBfx0j+dVEkED6Xh8khnZVlEOr1G18A/cGivFhzyvPwByNWsRB6CfZoslnralxn0SmspDBy0vg==", "name"=>"Тестовая 3", "client_id"=>"1", "commit"=>"Создать", "estimate_id"=>"6"}
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mStage Load (0.5ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = 6[0m
  [1m[36mClient Load (1.9ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "estimates" ("name", "client_id", "floors", "first_floor_height", "price", "area", "price_by_area", "price_by_stage", "price_by_stage_aggregated", "price_by_area_per_stage", "discount_title", "discount_by_stages", "discount_amount", "price_by_stage_aggregated_discounted", "price_by_area_per_stage_discounted", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17) RETURNING "id"[0m  [["name", "Тестовая 3"], ["client_id", 1], ["floors", #<BigDecimal:7fbd482d7398,'0.1E1',9(18)>], ["first_floor_height", #<BigDecimal:7fbd4887d4a0,'0.124124E6',9(18)>], ["price", #<BigDecimal:7fbd4887d680,'0.3995E3',18(18)>], ["area", #<BigDecimal:7fbd4887d590,'0.4214E4',9(18)>], ["price_by_area", #<BigDecimal:7fbd482d6cb8,'0.9E-1',9(18)>], ["price_by_stage", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007fbd68b3afb0 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fbd482d68d0,'0.1435E3',18(18)>, #<BigDecimal:7fbd482d68a8,'0.775E2',18(18)>, #<BigDecimal:7fbd482d6880,'0.204E3',9(18)>]>], ["price_by_stage_aggregated", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007fbd68b3afb0 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fbd482d62e0,'0.1435E3',18(18)>, #<BigDecimal:7fbd482d62b8,'0.221E3',9(18)>, #<BigDecimal:7fbd482d6290,'0.425E3',9(18)>]>], ["price_by_area_per_stage", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007fbd68b3afb0 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fbd482d5db8,'0.3E-1',9(18)>, #<BigDecimal:7fbd482d5d90,'0.5E-1',9(18)>, #<BigDecimal:7fbd482d5d68,'0.1E0',9(18)>]>], ["discount_title", "123"], ["discount_by_stages", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007fbd68b3afb0 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fbd482d5840,'0.6E1',9(18)>, #<BigDecimal:7fbd482d5818,'0.6E1',9(18)>, #<BigDecimal:7fbd482d57f0,'0.6E1',9(18)>]>], ["discount_amount", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007fbd68b3afb0 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fbd482d5318,'0.861E1',18(18)>, #<BigDecimal:7fbd482d52f0,'0.465E1',18(18)>, #<BigDecimal:7fbd482d52c8,'0.1224E2',18(18)>]>], ["price_by_stage_aggregated_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007fbd68b3afb0 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fbd482d4df0,'0.13489E3',18(18)>, #<BigDecimal:7fbd482d4dc8,'0.21635E3',18(18)>, #<BigDecimal:7fbd482d4da0,'0.41276E3',18(18)>]>], ["price_by_area_per_stage_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007fbd68b3afb0 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fbd482d48c8,'0.3E-1',9(18)>, #<BigDecimal:7fbd482d48a0,'0.5E-1',9(18)>, #<BigDecimal:7fbd482d4878,'0.1E0',9(18)>]>], ["created_at", 2017-04-27 20:30:25 UTC], ["updated_at", 2017-04-27 20:30:25 UTC]]
  [1m[36mAudited::Audit Load (1.3ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 8], ["auditable_type", "Estimate"], ["LIMIT", 1]]
  [1m[35mSQL (1.8ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 8], ["auditable_type", "Estimate"], ["user_id", 1], ["user_type", "User"], ["action", "create"], ["audited_changes", "---\nname: Тестовая 3\nclient_id: 1\nfloors: !ruby/object:BigDecimal 18:0.1E1\nfirst_floor_height: !ruby/object:BigDecimal 18:0.124124E6\nsecond_floor_height_min: !ruby/object:BigDecimal 18:0.0\nsecond_floor_height_max: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_min: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_max: !ruby/object:BigDecimal 18:0.0\nprice: !ruby/object:BigDecimal 18:0.3995E3\narea: !ruby/object:BigDecimal 18:0.4214E4\nprice_by_area: !ruby/object:BigDecimal 18:0.9E-1\nprice_by_stage:\n- !ruby/object:BigDecimal 18:0.1435E3\n- !ruby/object:BigDecimal 18:0.775E2\n- !ruby/object:BigDecimal 18:0.204E3\nprice_by_stage_aggregated:\n- !ruby/object:BigDecimal 18:0.1435E3\n- !ruby/object:BigDecimal 18:0.221E3\n- !ruby/object:BigDecimal 18:0.425E3\nprice_by_area_per_stage:\n- !ruby/object:BigDecimal 18:0.3E-1\n- !ruby/object:BigDecimal 18:0.5E-1\n- !ruby/object:BigDecimal 18:0.1E0\ndiscount_title: '123'\ndiscount_by_stages:\n- !ruby/object:BigDecimal 18:0.6E1\n- !ruby/object:BigDecimal 18:0.6E1\n- !ruby/object:BigDecimal 18:0.6E1\ndiscount_amount:\n- !ruby/object:BigDecimal 18:0.861E1\n- !ruby/object:BigDecimal 18:0.465E1\n- !ruby/object:BigDecimal 18:0.1224E2\nprice_by_stage_aggregated_discounted:\n- !ruby/object:BigDecimal 18:0.13489E3\n- !ruby/object:BigDecimal 18:0.21635E3\n- !ruby/object:BigDecimal 18:0.41276E3\nprice_by_area_per_stage_discounted:\n- !ruby/object:BigDecimal 18:0.3E-1\n- !ruby/object:BigDecimal 18:0.5E-1\n- !ruby/object:BigDecimal 18:0.1E0\nsigned: false\ndeleted_at: \nsigning_date: \nuser_id: \n"], ["version", 1], ["remote_address", "127.0.0.1"], ["request_uuid", "09c39642-8724-467a-ac37-8a9631984475"], ["created_at", 2017-04-27 20:30:25 UTC]]
  [1m[35m (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (1.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 6]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (14, 15, 16)[0m
  [1m[35m (5.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (1.0ms)[0m  [1m[32mINSERT INTO "stages" ("estimate_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["estimate_id", 8], ["number", 1], ["price", #<BigDecimal:7fbd6d20fda0,'0.1435E3',18(18)>], ["total_price", #<BigDecimal:7fbd6d20fd50,'0.13489E3',18(18)>], ["created_at", 2017-04-27 20:30:25 UTC], ["updated_at", 2017-04-27 20:30:25 UTC]]
  [1m[35m (2.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 14]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 13[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (1.8ms)[0m  [1m[32mINSERT INTO "stage_products" ("product_id", "stage_id", "quantity", "price_with_work", "created_at", "updated_at", "price_without_work") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["product_id", 1], ["stage_id", 17], ["quantity", 1], ["price_with_work", #<BigDecimal:7fbd6d6941a0,'0.7E2',9(18)>], ["created_at", 2017-04-27 20:30:25 UTC], ["updated_at", 2017-04-27 20:30:25 UTC], ["price_without_work", #<BigDecimal:7fbd6d7076c8,'0.1E2',9(18)>]]
  [1m[35m (1.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 13]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "stages" ("estimate_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["estimate_id", 8], ["number", 2], ["price", #<BigDecimal:7fbd6d732b20,'0.775E2',18(18)>], ["total_price", #<BigDecimal:7fbd6d732ad0,'0.7285E2',18(18)>], ["created_at", 2017-04-27 20:30:25 UTC], ["updated_at", 2017-04-27 20:30:25 UTC]]
  [1m[35m (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 15]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 14[0m
  [1m[35m (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "stage_products" ("product_id", "stage_id", "quantity", "price_with_work", "created_at", "updated_at", "price_without_work") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["product_id", 2], ["stage_id", 18], ["quantity", 1], ["price_with_work", #<BigDecimal:7fbd6d7c4ae8,'0.5E2',9(18)>], ["created_at", 2017-04-27 20:30:25 UTC], ["updated_at", 2017-04-27 20:30:25 UTC], ["price_without_work", #<BigDecimal:7fbd6d7b3ec8,'0.5E2',9(18)>]]
  [1m[35m (1.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 14]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "stages" ("estimate_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["estimate_id", 8], ["number", 3], ["price", #<BigDecimal:7fbd6d80e788,'0.204E3',9(18)>], ["total_price", #<BigDecimal:7fbd6d80e738,'0.19176E3',18(18)>], ["created_at", 2017-04-27 20:30:25 UTC], ["updated_at", 2017-04-27 20:30:25 UTC]]
  [1m[35m (2.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 16]]
  [1m[36mStageProductSet Load (0.8ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 15[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (1.1ms)[0m  [1m[32mINSERT INTO "stage_products" ("product_id", "stage_id", "quantity", "price_with_work", "created_at", "updated_at", "price_without_work") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["product_id", 3], ["stage_id", 19], ["quantity", 1], ["price_with_work", #<BigDecimal:7fbd6da79a68,'0.8E2',9(18)>], ["created_at", 2017-04-27 20:30:25 UTC], ["updated_at", 2017-04-27 20:30:25 UTC], ["price_without_work", #<BigDecimal:7fbd6da79040,'0.2E2',9(18)>]]
  [1m[35m (1.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSet Load (2.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 15]]
  [1m[36mStageProductSetValue Load (0.5ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 5[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (1.8ms)[0m  [1m[32mINSERT INTO "stage_product_sets" ("stage_product_id", "product_set_id", "selected", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["stage_product_id", 18], ["product_set_id", 1], ["selected", true], ["created_at", 2017-04-27 20:30:25 UTC], ["updated_at", 2017-04-27 20:30:25 UTC]]
  [1m[35m (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (1.9ms)[0m  [1m[32mINSERT INTO "stage_product_set_values" ("stage_product_set_id", "product_template_id", "constructor_object_id", "quantity", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["stage_product_set_id", 6], ["product_template_id", 1], ["constructor_object_id", 1], ["quantity", 2], ["created_at", 2017-04-27 20:30:25 UTC], ["updated_at", 2017-04-27 20:30:25 UTC]]
  [1m[35m (1.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.9ms)[0m  [1m[32mINSERT INTO "stage_product_set_values" ("stage_product_set_id", "product_template_id", "constructor_object_id", "quantity", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["stage_product_set_id", 6], ["product_template_id", 2], ["constructor_object_id", 6], ["quantity", 1], ["created_at", 2017-04-27 20:30:25 UTC], ["updated_at", 2017-04-27 20:30:25 UTC]]
  [1m[35m (1.2ms)[0m  [1m[35mCOMMIT[0m
Redirected to http://localhost:3000/estimates?client_id=1
Completed 302 Found in 454ms (ActiveRecord: 101.5ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 23:30:25 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (1.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (1.1ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.1ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (4.8ms)
  Rendered estimates/_listing.html.haml (0.9ms)
  Rendered estimates/_listing.html.haml (1.1ms)
  Rendered estimates/_listing.html.haml (1.1ms)
  Rendered estimates/_listing.html.haml (1.5ms)
  [1m[36mClient Load (2.5ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered estimates/index.html.haml within layouts/application (69.6ms)
  Rendered layouts/_header.html.haml (65.5ms)
Completed 200 OK in 779ms (Views: 758.4ms | ActiveRecord: 8.1ms)


Started DELETE "/estimates/7" for 127.0.0.1 at 2017-04-27 23:30:33 +0300
Processing by EstimatesController#destroy as HTML
  Parameters: {"authenticity_token"=>"U0Mr1GZKtw6KmQLdRf+4m+X4AjKPBgVXXxnvjI3YAmlWriOCeUkd1scQ3fk7hDtN0WYhARQu2inOCsCfPIJhFw==", "id"=>"7"}
  [1m[36mEstimate Load (1.7ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 7], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[35mBEGIN[0m
  [1m[36mAudited::Audit Load (0.9ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 7], ["auditable_type", "Estimate"], ["LIMIT", 1]]
  [1m[35mSQL (1.2ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 7], ["auditable_type", "Estimate"], ["user_id", 1], ["user_type", "User"], ["action", "destroy"], ["audited_changes", "---\nname: Тестовая 3\nclient_id: 1\nfloors: !ruby/object:BigDecimal 18:0.1E1\nfirst_floor_height: !ruby/object:BigDecimal 18:0.124124E6\nsecond_floor_height_min: !ruby/object:BigDecimal 18:0.0\nsecond_floor_height_max: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_min: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_max: !ruby/object:BigDecimal 18:0.0\nprice: !ruby/object:BigDecimal 18:0.3995E3\narea: !ruby/object:BigDecimal 18:0.4214E4\nprice_by_area: !ruby/object:BigDecimal 18:0.9E-1\nprice_by_stage:\n- !ruby/object:BigDecimal 18:0.1435E3\n- !ruby/object:BigDecimal 18:0.775E2\n- !ruby/object:BigDecimal 18:0.204E3\nprice_by_stage_aggregated:\n- !ruby/object:BigDecimal 18:0.1435E3\n- !ruby/object:BigDecimal 18:0.221E3\n- !ruby/object:BigDecimal 18:0.425E3\nprice_by_area_per_stage:\n- !ruby/object:BigDecimal 18:0.3E-1\n- !ruby/object:BigDecimal 18:0.5E-1\n- !ruby/object:BigDecimal 18:0.1E0\ndiscount_title: '123'\ndiscount_by_stages:\n- !ruby/object:BigDecimal 18:0.6E1\n- !ruby/object:BigDecimal 18:0.6E1\n- !ruby/object:BigDecimal 18:0.6E1\ndiscount_amount:\n- !ruby/object:BigDecimal 18:0.861E1\n- !ruby/object:BigDecimal 18:0.465E1\n- !ruby/object:BigDecimal 18:0.1224E2\nprice_by_stage_aggregated_discounted:\n- !ruby/object:BigDecimal 18:0.13489E3\n- !ruby/object:BigDecimal 18:0.21635E3\n- !ruby/object:BigDecimal 18:0.41276E3\nprice_by_area_per_stage_discounted:\n- !ruby/object:BigDecimal 18:0.3E-1\n- !ruby/object:BigDecimal 18:0.5E-1\n- !ruby/object:BigDecimal 18:0.1E0\nsigned: false\ndeleted_at: \nsigning_date: \nuser_id: \n"], ["version", 2], ["remote_address", "127.0.0.1"], ["request_uuid", "04d23070-e721-4991-8144-03fd30cd904c"], ["created_at", 2017-04-27 20:30:33 UTC]]
  [1m[35mSQL (0.7ms)[0m  [1m[33mUPDATE "estimates" SET "deleted_at" = '2017-04-27 20:30:33.847585', "updated_at" = '2017-04-27 20:30:33.847649' WHERE "estimates"."id" = $1[0m  [["id", 7]]
  [1m[35m (1.4ms)[0m  [1m[35mCOMMIT[0m
Redirected to http://localhost:3000/estimates?client_id=1
Completed 302 Found in 81ms (ActiveRecord: 7.3ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 23:30:33 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (1.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (3.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (4.4ms)
  Rendered estimates/_listing.html.haml (1.2ms)
  Rendered estimates/_listing.html.haml (1.2ms)
  Rendered estimates/_listing.html.haml (1.8ms)
  [1m[36mClient Load (1.2ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered estimates/index.html.haml within layouts/application (37.9ms)
  Rendered layouts/_header.html.haml (11.2ms)
Completed 200 OK in 642ms (Views: 618.1ms | ActiveRecord: 7.6ms)


Started DELETE "/estimates/8" for 127.0.0.1 at 2017-04-27 23:30:37 +0300
Processing by EstimatesController#destroy as HTML
  Parameters: {"authenticity_token"=>"UDItOcs8HBuWqaIwTe/fkYZiJdN13bhJf9HD4IcWltxV3yVv1D+2w9sgfRQzlFxHsvwG4O71ZzfuwuzzNkz1og==", "id"=>"8"}
  [1m[36mEstimate Load (4.4ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 8], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mAudited::Audit Load (1.3ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 8], ["auditable_type", "Estimate"], ["LIMIT", 1]]
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 8], ["auditable_type", "Estimate"], ["user_id", 1], ["user_type", "User"], ["action", "destroy"], ["audited_changes", "---\nname: Тестовая 3\nclient_id: 1\nfloors: !ruby/object:BigDecimal 18:0.1E1\nfirst_floor_height: !ruby/object:BigDecimal 18:0.124124E6\nsecond_floor_height_min: !ruby/object:BigDecimal 18:0.0\nsecond_floor_height_max: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_min: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_max: !ruby/object:BigDecimal 18:0.0\nprice: !ruby/object:BigDecimal 18:0.3995E3\narea: !ruby/object:BigDecimal 18:0.4214E4\nprice_by_area: !ruby/object:BigDecimal 18:0.9E-1\nprice_by_stage:\n- !ruby/object:BigDecimal 18:0.1435E3\n- !ruby/object:BigDecimal 18:0.775E2\n- !ruby/object:BigDecimal 18:0.204E3\nprice_by_stage_aggregated:\n- !ruby/object:BigDecimal 18:0.1435E3\n- !ruby/object:BigDecimal 18:0.221E3\n- !ruby/object:BigDecimal 18:0.425E3\nprice_by_area_per_stage:\n- !ruby/object:BigDecimal 18:0.3E-1\n- !ruby/object:BigDecimal 18:0.5E-1\n- !ruby/object:BigDecimal 18:0.1E0\ndiscount_title: '123'\ndiscount_by_stages:\n- !ruby/object:BigDecimal 18:0.6E1\n- !ruby/object:BigDecimal 18:0.6E1\n- !ruby/object:BigDecimal 18:0.6E1\ndiscount_amount:\n- !ruby/object:BigDecimal 18:0.861E1\n- !ruby/object:BigDecimal 18:0.465E1\n- !ruby/object:BigDecimal 18:0.1224E2\nprice_by_stage_aggregated_discounted:\n- !ruby/object:BigDecimal 18:0.13489E3\n- !ruby/object:BigDecimal 18:0.21635E3\n- !ruby/object:BigDecimal 18:0.41276E3\nprice_by_area_per_stage_discounted:\n- !ruby/object:BigDecimal 18:0.3E-1\n- !ruby/object:BigDecimal 18:0.5E-1\n- !ruby/object:BigDecimal 18:0.1E0\nsigned: false\ndeleted_at: \nsigning_date: \nuser_id: \n"], ["version", 2], ["remote_address", "127.0.0.1"], ["request_uuid", "29e0e5e4-4784-4811-b9e2-8a0d548a9f6b"], ["created_at", 2017-04-27 20:30:37 UTC]]
  [1m[35mSQL (0.6ms)[0m  [1m[33mUPDATE "estimates" SET "deleted_at" = '2017-04-27 20:30:37.736300', "updated_at" = '2017-04-27 20:30:37.736365' WHERE "estimates"."id" = $1[0m  [["id", 8]]
  [1m[35m (1.4ms)[0m  [1m[35mCOMMIT[0m
Redirected to http://localhost:3000/estimates?client_id=1
Completed 302 Found in 68ms (ActiveRecord: 9.2ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 23:30:37 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (1.6ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.8ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (6.0ms)
  Rendered estimates/_listing.html.haml (1.1ms)
  Rendered estimates/_listing.html.haml (1.0ms)
  [1m[36mClient Load (1.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered estimates/index.html.haml within layouts/application (49.6ms)
  Rendered layouts/_header.html.haml (13.8ms)
Completed 200 OK in 613ms (Views: 597.9ms | ActiveRecord: 5.4ms)


Started POST "/estimates/6/copy" for 127.0.0.1 at 2017-04-27 23:30:48 +0300
Processing by EstimatesController#copy as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"bW35OEZBz+kKvR1ODsPEmi5tE5FUictZrlaNpKO5jHBogPFuWUJlMUc0wmpwuEdMGvMwos+hFCc/RaK3EuPvDg==", "name"=>"Тестовая смета 3", "client_id"=>"1", "commit"=>"Создать", "estimate_id"=>"6"}
  [1m[36mUser Load (6.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mStage Load (0.8ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = 6[0m
  [1m[36mClient Load (2.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (2.8ms)[0m  [1m[32mINSERT INTO "estimates" ("name", "client_id", "floors", "first_floor_height", "price", "area", "price_by_area", "price_by_stage", "price_by_stage_aggregated", "price_by_area_per_stage", "discount_title", "discount_by_stages", "discount_amount", "price_by_stage_aggregated_discounted", "price_by_area_per_stage_discounted", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17) RETURNING "id"[0m  [["name", "Тестовая смета 3"], ["client_id", 1], ["floors", #<BigDecimal:7fbd48919a30,'0.1E1',9(18)>], ["first_floor_height", #<BigDecimal:7fbd4891a818,'0.124124E6',9(18)>], ["price", #<BigDecimal:7fbd4891a958,'0.3995E3',18(18)>], ["area", #<BigDecimal:7fbd4891a8b8,'0.4214E4',9(18)>], ["price_by_area", #<BigDecimal:7fbd489193f0,'0.9E-1',9(18)>], ["price_by_stage", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007fbd68b3afb0 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fbd48919148,'0.1435E3',18(18)>, #<BigDecimal:7fbd48919120,'0.775E2',18(18)>, #<BigDecimal:7fbd489190f8,'0.204E3',9(18)>]>], ["price_by_stage_aggregated", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007fbd68b3afb0 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fbd48918c20,'0.1435E3',18(18)>, #<BigDecimal:7fbd48918bf8,'0.221E3',9(18)>, #<BigDecimal:7fbd48918bd0,'0.425E3',9(18)>]>], ["price_by_area_per_stage", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007fbd68b3afb0 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fbd489186f8,'0.3E-1',9(18)>, #<BigDecimal:7fbd489186d0,'0.5E-1',9(18)>, #<BigDecimal:7fbd489186a8,'0.1E0',9(18)>]>], ["discount_title", "123"], ["discount_by_stages", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007fbd68b3afb0 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fbd48918180,'0.6E1',9(18)>, #<BigDecimal:7fbd48918158,'0.6E1',9(18)>, #<BigDecimal:7fbd48918130,'0.6E1',9(18)>]>], ["discount_amount", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007fbd68b3afb0 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fbd6aeabc88,'0.861E1',18(18)>, #<BigDecimal:7fbd6aeabc60,'0.465E1',18(18)>, #<BigDecimal:7fbd6aeabc38,'0.1224E2',18(18)>]>], ["price_by_stage_aggregated_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007fbd68b3afb0 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fbd6aeab760,'0.13489E3',18(18)>, #<BigDecimal:7fbd6aeab738,'0.21635E3',18(18)>, #<BigDecimal:7fbd6aeab710,'0.41276E3',18(18)>]>], ["price_by_area_per_stage_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007fbd68b3afb0 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7fbd6aeab198,'0.3E-1',9(18)>, #<BigDecimal:7fbd6aeab170,'0.5E-1',9(18)>, #<BigDecimal:7fbd6aeab148,'0.1E0',9(18)>]>], ["created_at", 2017-04-27 20:30:48 UTC], ["updated_at", 2017-04-27 20:30:48 UTC]]
  [1m[36mAudited::Audit Load (6.8ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 9], ["auditable_type", "Estimate"], ["LIMIT", 1]]
  [1m[35mSQL (1.0ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 9], ["auditable_type", "Estimate"], ["user_id", 1], ["user_type", "User"], ["action", "create"], ["audited_changes", "---\nname: Тестовая смета 3\nclient_id: 1\nfloors: !ruby/object:BigDecimal 18:0.1E1\nfirst_floor_height: !ruby/object:BigDecimal 18:0.124124E6\nsecond_floor_height_min: !ruby/object:BigDecimal 18:0.0\nsecond_floor_height_max: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_min: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_max: !ruby/object:BigDecimal 18:0.0\nprice: !ruby/object:BigDecimal 18:0.3995E3\narea: !ruby/object:BigDecimal 18:0.4214E4\nprice_by_area: !ruby/object:BigDecimal 18:0.9E-1\nprice_by_stage:\n- !ruby/object:BigDecimal 18:0.1435E3\n- !ruby/object:BigDecimal 18:0.775E2\n- !ruby/object:BigDecimal 18:0.204E3\nprice_by_stage_aggregated:\n- !ruby/object:BigDecimal 18:0.1435E3\n- !ruby/object:BigDecimal 18:0.221E3\n- !ruby/object:BigDecimal 18:0.425E3\nprice_by_area_per_stage:\n- !ruby/object:BigDecimal 18:0.3E-1\n- !ruby/object:BigDecimal 18:0.5E-1\n- !ruby/object:BigDecimal 18:0.1E0\ndiscount_title: '123'\ndiscount_by_stages:\n- !ruby/object:BigDecimal 18:0.6E1\n- !ruby/object:BigDecimal 18:0.6E1\n- !ruby/object:BigDecimal 18:0.6E1\ndiscount_amount:\n- !ruby/object:BigDecimal 18:0.861E1\n- !ruby/object:BigDecimal 18:0.465E1\n- !ruby/object:BigDecimal 18:0.1224E2\nprice_by_stage_aggregated_discounted:\n- !ruby/object:BigDecimal 18:0.13489E3\n- !ruby/object:BigDecimal 18:0.21635E3\n- !ruby/object:BigDecimal 18:0.41276E3\nprice_by_area_per_stage_discounted:\n- !ruby/object:BigDecimal 18:0.3E-1\n- !ruby/object:BigDecimal 18:0.5E-1\n- !ruby/object:BigDecimal 18:0.1E0\nsigned: false\ndeleted_at: \nsigning_date: \nuser_id: \n"], ["version", 1], ["remote_address", "127.0.0.1"], ["request_uuid", "fa865fc2-8f6f-42b9-96a6-6c5d58fa5453"], ["created_at", 2017-04-27 20:30:48 UTC]]
  [1m[35m (4.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (0.6ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 6]]
  [1m[36mStageProduct Load (0.9ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (14, 15, 16)[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (1.3ms)[0m  [1m[32mINSERT INTO "stages" ("estimate_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["estimate_id", 9], ["number", 1], ["price", #<BigDecimal:7fbd751fa0b0,'0.1435E3',18(18)>], ["total_price", #<BigDecimal:7fbd751fa060,'0.13489E3',18(18)>], ["created_at", 2017-04-27 20:30:48 UTC], ["updated_at", 2017-04-27 20:30:48 UTC]]
  [1m[35m (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (3.2ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 14]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 13[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "stage_products" ("product_id", "stage_id", "quantity", "price_with_work", "created_at", "updated_at", "price_without_work") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["product_id", 1], ["stage_id", 20], ["quantity", 1], ["price_with_work", #<BigDecimal:7fbd6cdc6488,'0.7E2',9(18)>], ["created_at", 2017-04-27 20:30:48 UTC], ["updated_at", 2017-04-27 20:30:48 UTC], ["price_without_work", #<BigDecimal:7fbd6cdc58d0,'0.1E2',9(18)>]]
  [1m[35m (1.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 13]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "stages" ("estimate_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["estimate_id", 9], ["number", 2], ["price", #<BigDecimal:7fbd65a5a558,'0.775E2',18(18)>], ["total_price", #<BigDecimal:7fbd65a5a508,'0.7285E2',18(18)>], ["created_at", 2017-04-27 20:30:48 UTC], ["updated_at", 2017-04-27 20:30:48 UTC]]
  [1m[35m (2.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 15]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 14[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "stage_products" ("product_id", "stage_id", "quantity", "price_with_work", "created_at", "updated_at", "price_without_work") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["product_id", 2], ["stage_id", 21], ["quantity", 1], ["price_with_work", #<BigDecimal:7fbd74746538,'0.5E2',9(18)>], ["created_at", 2017-04-27 20:30:48 UTC], ["updated_at", 2017-04-27 20:30:48 UTC], ["price_without_work", #<BigDecimal:7fbd74745b10,'0.5E2',9(18)>]]
  [1m[35m (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 14]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "stages" ("estimate_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["estimate_id", 9], ["number", 3], ["price", #<BigDecimal:7fbd65b7a938,'0.204E3',9(18)>], ["total_price", #<BigDecimal:7fbd65b7a8e8,'0.19176E3',18(18)>], ["created_at", 2017-04-27 20:30:48 UTC], ["updated_at", 2017-04-27 20:30:48 UTC]]
  [1m[35m (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 16]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 15[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "stage_products" ("product_id", "stage_id", "quantity", "price_with_work", "created_at", "updated_at", "price_without_work") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["product_id", 3], ["stage_id", 22], ["quantity", 1], ["price_with_work", #<BigDecimal:7fbd78efab68,'0.8E2',9(18)>], ["created_at", 2017-04-27 20:30:48 UTC], ["updated_at", 2017-04-27 20:30:48 UTC], ["price_without_work", #<BigDecimal:7fbd78efa140,'0.2E2',9(18)>]]
  [1m[35m (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 15]]
  [1m[36mStageProductSetValue Load (0.5ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 5[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "stage_product_sets" ("stage_product_id", "product_set_id", "selected", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["stage_product_id", 21], ["product_set_id", 1], ["selected", true], ["created_at", 2017-04-27 20:30:48 UTC], ["updated_at", 2017-04-27 20:30:48 UTC]]
  [1m[35m (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.9ms)[0m  [1m[32mINSERT INTO "stage_product_set_values" ("stage_product_set_id", "product_template_id", "constructor_object_id", "quantity", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["stage_product_set_id", 7], ["product_template_id", 1], ["constructor_object_id", 1], ["quantity", 2], ["created_at", 2017-04-27 20:30:48 UTC], ["updated_at", 2017-04-27 20:30:48 UTC]]
  [1m[35m (1.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "stage_product_set_values" ("stage_product_set_id", "product_template_id", "constructor_object_id", "quantity", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["stage_product_set_id", 7], ["product_template_id", 2], ["constructor_object_id", 6], ["quantity", 1], ["created_at", 2017-04-27 20:30:48 UTC], ["updated_at", 2017-04-27 20:30:48 UTC]]
  [1m[35m (2.7ms)[0m  [1m[35mCOMMIT[0m
Redirected to http://localhost:3000/estimates?client_id=1
Completed 302 Found in 178ms (ActiveRecord: 58.6ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 23:30:48 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (1.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (3.9ms)
  Rendered estimates/_listing.html.haml (1.0ms)
  Rendered estimates/_listing.html.haml (1.0ms)
  Rendered estimates/_listing.html.haml (1.1ms)
  [1m[36mClient Load (0.9ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered estimates/index.html.haml within layouts/application (34.5ms)
  Rendered layouts/_header.html.haml (13.5ms)
Completed 200 OK in 573ms (Views: 558.8ms | ActiveRecord: 3.8ms)


Started GET "/estimates/9/edit" for 127.0.0.1 at 2017-04-27 23:30:52 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"9"}
  [1m[36mProduct Load (1.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (1.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (0.9ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (3.4ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.0ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 9], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (4.3ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 9]]
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (20, 21, 22)[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 20]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 19[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 21]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 20[0m
  [1m[36mProduct Load (1.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 22]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 21[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.8ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 21]]
  [1m[36mStageProductSetValue Load (0.8ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 7[0m
  [1m[36mProductSet Load (0.7ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (1.0ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 7]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (10.4ms)
  [1m[36mClientFile Load (0.7ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 9]]
  Rendered estimates/_technical_file_fields.html.haml (6.3ms)
  [1m[36mTechnicalFile Load (0.5ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 9]]
  Rendered estimates/_discount.html.haml (12.9ms)
  Rendered estimates/_stages.html.haml (20.8ms)
  Rendered estimates/_form.html.haml (150.5ms)
  Rendered estimates/edit.html.haml within layouts/application (155.5ms)
  Rendered layouts/_header.html.haml (10.2ms)
Completed 200 OK in 1037ms (Views: 720.4ms | ActiveRecord: 87.6ms)


Started GET "/estimates" for 127.0.0.1 at 2017-04-27 23:31:02 +0300
Processing by EstimatesController#index as HTML
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Redirected to http://localhost:3000/clients
Completed 302 Found in 5ms (ActiveRecord: 1.1ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 23:31:02 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (2.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (1.1ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2)[0m
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (10.4ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (7.4ms)
  Rendered clients/_table.html.haml (24.6ms)
  [1m[36mUserClient Load (1.1ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (56.9ms)
  Rendered layouts/_header.html.haml (9.7ms)
Completed 200 OK in 572ms (Views: 555.9ms | ActiveRecord: 10.5ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-27 23:32:06 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (1.1ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2)[0m
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2)[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (11.2ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (5.6ms)
  Rendered clients/_table.html.haml (22.4ms)
  [1m[36mUserClient Load (0.8ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (122.9ms)
Completed 401 Unauthorized in 5668ms (ActiveRecord: 27.8ms)


DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
Started GET "/clients" for 127.0.0.1 at 2017-04-27 23:33:18 +0300
  [1m[36mActiveRecord::SchemaMigration Load (0.9ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Processing by ClientsController#index as HTML
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (1.2ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (1.2ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2)[0m
  [1m[36mEstimate Load (1.3ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" IN (1, 2)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (10.6ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (4.4ms)
  Rendered clients/_table.html.haml (18.8ms)
  [1m[36mUserClient Load (0.8ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (147.4ms)
  Rendered layouts/_header.html.haml (76.1ms)
Completed 200 OK in 7755ms (Views: 7680.2ms | ActiveRecord: 36.5ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-27 23:33:31 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (1.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.0ms)[0m  [1m[34mSELECT "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (4.5ms)
  Rendered estimates/_listing.html.haml (1.3ms)
  Rendered estimates/_listing.html.haml (1.0ms)
  Rendered estimates/_listing.html.haml (1.1ms)
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."archived" = $1[0m  [["archived", false]]
  Rendered estimates/index.html.haml within layouts/application (29.4ms)
  Rendered layouts/_header.html.haml (8.5ms)
Completed 200 OK in 541ms (Views: 514.4ms | ActiveRecord: 4.2ms)


Started GET "/estimates/9/edit" for 127.0.0.1 at 2017-04-27 23:33:35 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"9"}
  [1m[36mProduct Load (2.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (2.4ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (1.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (2.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (2.6ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (1.3ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (1.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (1.4ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (1.4ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (1.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (2.6ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 9], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.6ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (1.4ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 9]]
  [1m[36mStageProduct Load (0.9ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (20, 21, 22)[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 20]]
  [1m[36mStageProductSet Load (1.0ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 19[0m
  [1m[36mProduct Load (1.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (1.3ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 21]]
  [1m[36mStageProductSet Load (1.4ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 20[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 22]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 21[0m
  [1m[36mProduct Load (1.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 21]]
  [1m[36mStageProductSetValue Load (0.9ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 7[0m
  [1m[36mProductSet Load (0.6ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 7]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (13.6ms)
  [1m[36mClientFile Load (0.8ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."estimate_id" = $1[0m  [["estimate_id", 9]]
  Rendered estimates/_technical_file_fields.html.haml (4.6ms)
  [1m[36mTechnicalFile Load (1.2ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."estimate_id" = $1[0m  [["estimate_id", 9]]
  Rendered estimates/_discount.html.haml (6.4ms)
  Rendered estimates/_stages.html.haml (15.8ms)
  Rendered estimates/_form.html.haml (145.3ms)
  Rendered estimates/edit.html.haml within layouts/application (148.4ms)
  Rendered layouts/_header.html.haml (12.0ms)
Completed 200 OK in 1239ms (Views: 803.3ms | ActiveRecord: 111.1ms)


Started GET "/estimates/9/export_pdf" for 127.0.0.1 at 2017-04-27 23:33:39 +0300
Processing by EstimatesController#export_pdf as HTML
  Parameters: {"id"=>"9"}
  [1m[36mUser Load (2.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (3.7ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 9], ["LIMIT", 1]]
  [1m[36mStage Load (0.6ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 9]]
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (20, 21, 22)[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 20]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 19[0m
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (3.9ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 21]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 20[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (2.3ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 22]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 21[0m
  [1m[36mProduct Load (3.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT  "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1 AND "stage_product_sets"."selected" = $2 LIMIT $3[0m  [["stage_product_id", 21], ["selected", true], ["LIMIT", 1]]
  [1m[36mProductSet Load (3.0ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 21]]
  [1m[36mStageProductSetValue Load (1.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 7[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (1.2ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 7]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1 AND "stage_product_sets"."selected" = $2 LIMIT $3[0m  [["stage_product_id", 21], ["selected", true], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 7]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
***************WICKED***************
  Rendering estimates/export_pdf.html.haml
  Rendered estimates/export_pdf.html.haml (933.5ms)
  Rendering text template
  Rendered text template (0.0ms)
Sent data export_pdf.pdf (5.3ms)
Completed 200 OK in 3020ms (Views: 2.7ms | ActiveRecord: 30.7ms)


Started GET "/estimates/9/export_doc" for 127.0.0.1 at 2017-04-27 23:34:09 +0300
Processing by EstimatesController#export_doc as DOCX
  Parameters: {"id"=>"9"}
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (2.9ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 9], ["LIMIT", 1]]
  [1m[36mStage Load (2.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 9]]
  [1m[36mStageProduct Load (1.1ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (20, 21, 22)[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 20]]
  [1m[36mStageProductSet Load (1.1ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 19[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mUnit Load (1.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 21]]
  [1m[36mStageProductSet Load (2.4ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 20[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 22]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 21[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (1.6ms)[0m  [1m[34mSELECT  "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1 AND "stage_product_sets"."selected" = $2 LIMIT $3[0m  [["stage_product_id", 21], ["selected", true], ["LIMIT", 1]]
  [1m[36mProductSet Load (0.5ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 21]]
  [1m[36mStageProductSetValue Load (0.7ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 7[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (0.6ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 7]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1 AND "stage_product_sets"."selected" = $2 LIMIT $3[0m  [["stage_product_id", 21], ["selected", true], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 7]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendering estimates/export_doc.docx.haml
  Rendered estimates/export_doc.docx.haml (742.6ms)
DEPRECATION WARNING: Accessing mime types via constants is deprecated. Please change `Mime::DOCX` to `Mime[:docx]`. (called from render at /home/g1nc/Development/ruby/constructor/app/controllers/application_controller.rb:8)
  Rendering text template
  Rendered text template (0.0ms)
Sent data export_doc.docx (1.1ms)
Completed 200 OK in 981ms (Views: 891.7ms | ActiveRecord: 24.1ms)


Started GET "/estimates/9/export_doc" for 127.0.0.1 at 2017-04-27 23:34:10 +0300
Processing by EstimatesController#export_doc as DOCX
  Parameters: {"id"=>"9"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (3.8ms)[0m  [1m[34mSELECT  "estimates".* FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."id" = $1 LIMIT $2[0m  [["id", 9], ["LIMIT", 1]]
  [1m[36mStage Load (0.8ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."estimate_id" = $1[0m  [["estimate_id", 9]]
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (20, 21, 22)[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 20]]
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 19[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 21]]
  [1m[36mStageProductSet Load (1.0ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 20[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 2[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 22]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 21[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 3[0m
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT  "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1 AND "stage_product_sets"."selected" = $2 LIMIT $3[0m  [["stage_product_id", 21], ["selected", true], ["LIMIT", 1]]
  [1m[36mProductSet Load (3.2ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 21]]
  [1m[36mStageProductSetValue Load (4.6ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = 7[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "product_sets".* FROM "product_sets" WHERE "product_sets"."deleted_at" IS NULL AND "product_sets"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStageProductSetValue Load (2.2ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 7]]
  [1m[36mProductTemplate Load (1.9ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mConstructorObject Load (2.5ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1 AND "stage_product_sets"."selected" = $2 LIMIT $3[0m  [["stage_product_id", 21], ["selected", true], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "stage_product_set_values".* FROM "stage_product_set_values" WHERE "stage_product_set_values"."stage_product_set_id" = $1[0m  [["stage_product_set_id", 7]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  Rendering estimates/export_doc.docx.haml
  Rendered estimates/export_doc.docx.haml (642.5ms)
DEPRECATION WARNING: Accessing mime types via constants is deprecated. Please change `Mime::DOCX` to `Mime[:docx]`. (called from render at /home/g1nc/Development/ruby/constructor/app/controllers/application_controller.rb:8)
  Rendering text template
  Rendered text template (0.0ms)
Sent data export_doc.docx (0.8ms)
Completed 200 OK in 971ms (Views: 871.7ms | ActiveRecord: 30.9ms)


DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
Started GET "/" for 127.0.0.1 at 2017-04-28 23:18:21 +0300
  [1m[36mActiveRecord::SchemaMigration Load (3.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Processing by HomeController#index as HTML
  [1m[36mUser Load (3.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering home/index.html.haml within layouts/application
  Rendered home/index.html.haml within layouts/application (3.2ms)
Started GET "/" for 127.0.0.1 at 2017-04-28 23:18:22 +0300
Processing by HomeController#index as HTML
  [1m[36mUser Load (5.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering home/index.html.haml within layouts/application
  Rendered home/index.html.haml within layouts/application (3.4ms)
  Rendered layouts/_header.html.haml (99.4ms)
  Rendered layouts/_header.html.haml (112.6ms)
Completed 200 OK in 2243ms (Views: 2222.4ms | ActiveRecord: 5.3ms)


Completed 200 OK in 3045ms (Views: 2992.9ms | ActiveRecord: 16.1ms)


Started GET "/reports" for 127.0.0.1 at 2017-04-28 23:18:28 +0300
Processing by ReportsController#index as HTML
  [1m[36mUser Load (1.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/index.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (4.4ms)
  Rendered reports/index.html.haml within layouts/application (6.6ms)
  Rendered layouts/_header.html.haml (11.7ms)
Completed 200 OK in 565ms (Views: 557.2ms | ActiveRecord: 1.2ms)


Started GET "/reports/estimate-conversion" for 127.0.0.1 at 2017-04-28 23:18:32 +0300
Processing by ReportsController#estimate_conversion as HTML
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (1.4ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35m (3.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 20:18:32.028537')[0m  [["user_id", 1]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 20:18:32.028537') AND (signed)[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 20:18:32.028537')[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 20:18:32.028537') AND (signed)[0m  [["user_id", 1]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 1]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 20:18:32.089101')[0m  [["user_id", 2]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 20:18:32.089101') AND (signed)[0m  [["user_id", 2]]
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 20:18:32.089101')[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 20:18:32.089101') AND (signed)[0m  [["user_id", 2]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 2]]
  [1m[35m (1.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 20:18:32.101228')[0m  [["user_id", 3]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 20:18:32.101228') AND (signed)[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 20:18:32.101228')[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 20:18:32.101228') AND (signed)[0m  [["user_id", 3]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 3]]
  Rendering reports/estimate_conversion.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (3.2ms)
  Rendered reports/estimate_conversion.html.haml within layouts/application (10.9ms)
  Rendered layouts/_header.html.haml (8.5ms)
Completed 200 OK in 692ms (Views: 598.7ms | ActiveRecord: 18.4ms)


Started GET "/reports/estimate-conversion" for 127.0.0.1 at 2017-04-28 23:20:20 +0300
Processing by ReportsController#estimate_conversion as HTML
  [1m[36mUser Load (2.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (2.3ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35m (1.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 20:20:20.481407')[0m  [["user_id", 1]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 20:20:20.481407') AND (signed)[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 20:20:20.481407')[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 20:20:20.481407') AND (signed)[0m  [["user_id", 1]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 1]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 20:20:20.497675')[0m  [["user_id", 2]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 20:20:20.497675') AND (signed)[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 20:20:20.497675')[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 20:20:20.497675') AND (signed)[0m  [["user_id", 2]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 2]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 20:20:20.513743')[0m  [["user_id", 3]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 20:20:20.513743') AND (signed)[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 20:20:20.513743')[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 20:20:20.513743') AND (signed)[0m  [["user_id", 3]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 3]]
  Rendering reports/estimate_conversion.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (5.2ms)
  Rendered reports/estimate_conversion.html.haml within layouts/application (11.7ms)
Completed 500 Internal Server Error in 71ms (ActiveRecord: 12.5ms)


  
ActionView::Template::Error (Illegal nesting: content can't be both given on the same line as %button and nested within it.):
    3: 
    4: .dropdown
    5:   %button.btn.btn-default.dropdown-toggle#dropdownMenu1{ type: "button", 'data-toggle': "dropdown" } Выберите отчет
    6:     %span.caret
    7:   %ul.dropdown-menu{ 'aria-labelledby': "dropdownMenu1" }
    8:     %li= link_to 'Популярность сметных продуктов', reports_product_popularity_path
    9:     %li= link_to 'Популярность этажности',         reports_floor_popularity_path
  
app/views/reports/_header_reports.html.haml:6
app/views/reports/estimate_conversion.html.haml:1:in `_app_views_reports_estimate_conversion_html_haml___1275462049272675925_70297823978720'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (7.9ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (4.2ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (0.9ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (40.7ms)
Started GET "/reports/estimate-conversion" for 127.0.0.1 at 2017-04-28 23:20:44 +0300
Processing by ReportsController#estimate_conversion as HTML
  [1m[36mUser Load (1.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35m (1.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 20:20:44.318687')[0m  [["user_id", 1]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 20:20:44.318687') AND (signed)[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 20:20:44.318687')[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 20:20:44.318687') AND (signed)[0m  [["user_id", 1]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 20:20:44.331288')[0m  [["user_id", 2]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 20:20:44.331288') AND (signed)[0m  [["user_id", 2]]
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 20:20:44.331288')[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 20:20:44.331288') AND (signed)[0m  [["user_id", 2]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 2]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 20:20:44.344418')[0m  [["user_id", 3]]
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 20:20:44.344418') AND (signed)[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 20:20:44.344418')[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 20:20:44.344418') AND (signed)[0m  [["user_id", 3]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 3]]
  Rendering reports/estimate_conversion.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (4.1ms)
  Rendered reports/estimate_conversion.html.haml within layouts/application (11.0ms)
  Rendered layouts/_header.html.haml (11.6ms)
Completed 200 OK in 588ms (Views: 542.7ms | ActiveRecord: 10.8ms)


Started GET "/reports/estimate-conversion" for 127.0.0.1 at 2017-04-28 23:21:16 +0300
Processing by ReportsController#estimate_conversion as HTML
  [1m[36mUser Load (1.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35m (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 20:21:16.284942')[0m  [["user_id", 1]]
  [1m[35m (1.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 20:21:16.284942') AND (signed)[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 20:21:16.284942')[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 20:21:16.284942') AND (signed)[0m  [["user_id", 1]]
  [1m[35m (1.1ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 1]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 20:21:16.302288')[0m  [["user_id", 2]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 20:21:16.302288') AND (signed)[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 20:21:16.302288')[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 20:21:16.302288') AND (signed)[0m  [["user_id", 2]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 2]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 20:21:16.315277')[0m  [["user_id", 3]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 20:21:16.315277') AND (signed)[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 20:21:16.315277')[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 20:21:16.315277') AND (signed)[0m  [["user_id", 3]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 3]]
  Rendering reports/estimate_conversion.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (4.6ms)
  Rendered reports/estimate_conversion.html.haml within layouts/application (12.1ms)
  Rendered layouts/_header.html.haml (11.4ms)
Completed 200 OK in 596ms (Views: 543.6ms | ActiveRecord: 10.2ms)


Started GET "/reports/floor-popularity" for 127.0.0.1 at 2017-04-28 23:21:18 +0300
Processing by ReportsController#floor_popularity as HTML
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (2.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed)[0m
  [1m[35m (1.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '1')[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '1.5')[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '2')[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '2.5')[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '3')[0m
  Rendering reports/floor_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (2.7ms)
  Rendered reports/floor_popularity.html.haml within layouts/application (8.2ms)
  Rendered layouts/_header.html.haml (11.3ms)
Completed 200 OK in 773ms (Views: 752.0ms | ActiveRecord: 8.1ms)


Started GET "/reports/floor-popularity" for 127.0.0.1 at 2017-04-28 23:21:22 +0300
Processing by ReportsController#floor_popularity as HTML
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed)[0m
  [1m[35m (1.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '1')[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '1.5')[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '2')[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '2.5')[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '3')[0m
  Rendering reports/floor_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (3.5ms)
  Rendered reports/floor_popularity.html.haml within layouts/application (10.1ms)
  Rendered layouts/_header.html.haml (10.2ms)
Completed 200 OK in 587ms (Views: 568.8ms | ActiveRecord: 5.5ms)


Started GET "/reports/area-popularity" for 127.0.0.1 at 2017-04-28 23:21:24 +0300
Processing by ReportsController#area_popularity as HTML
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (2.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed)[0m
  [1m[35m (1.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 10) AND (area < 30)[0m
  [1m[35m (1.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 30) AND (area < 50)[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 50) AND (area < 70)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 70) AND (area < 90)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 90) AND (area < 110)[0m
  [1m[35m (2.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 110) AND (area < 130)[0m
  [1m[35m (1.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 130) AND (area < 150)[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 150) AND (area < 170)[0m
  [1m[35m (2.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 170) AND (area < 190)[0m
  [1m[35m (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 190) AND (area < 210)[0m
  [1m[35m (1.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 210) AND (area < 230)[0m
  [1m[35m (3.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 230) AND (area < 250)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 250) AND (area < 270)[0m
  [1m[35m (1.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 270)[0m
  Rendering reports/area_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (7.3ms)
  Rendered reports/area_popularity.html.haml within layouts/application (21.5ms)
  Rendered layouts/_header.html.haml (10.5ms)
Completed 200 OK in 613ms (Views: 565.2ms | ActiveRecord: 22.7ms)


Started GET "/reports/estimate-conversion" for 127.0.0.1 at 2017-04-28 23:21:26 +0300
Processing by ReportsController#estimate_conversion as HTML
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 20:21:26.539498')[0m  [["user_id", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 20:21:26.539498') AND (signed)[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 20:21:26.539498')[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 20:21:26.539498') AND (signed)[0m  [["user_id", 1]]
  [1m[35m (1.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 20:21:26.552586')[0m  [["user_id", 2]]
  [1m[35m (1.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 20:21:26.552586') AND (signed)[0m  [["user_id", 2]]
  [1m[36mCACHE (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 20:21:26.552586')[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 20:21:26.552586') AND (signed)[0m  [["user_id", 2]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 2]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 20:21:26.567166')[0m  [["user_id", 3]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 20:21:26.567166') AND (signed)[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 20:21:26.567166')[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 20:21:26.567166') AND (signed)[0m  [["user_id", 3]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 3]]
  Rendering reports/estimate_conversion.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (2.9ms)
  Rendered reports/estimate_conversion.html.haml within layouts/application (11.3ms)
  Rendered layouts/_header.html.haml (14.1ms)
Completed 200 OK in 605ms (Views: 560.9ms | ActiveRecord: 9.0ms)


Started GET "/reports/estimate-conversion" for 127.0.0.1 at 2017-04-28 23:21:39 +0300
Processing by ReportsController#estimate_conversion as HTML
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 20:21:39.685115')[0m  [["user_id", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 20:21:39.685115') AND (signed)[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 20:21:39.685115')[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 20:21:39.685115') AND (signed)[0m  [["user_id", 1]]
  [1m[35m (1.3ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 20:21:39.697766')[0m  [["user_id", 2]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 20:21:39.697766') AND (signed)[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 20:21:39.697766')[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 20:21:39.697766') AND (signed)[0m  [["user_id", 2]]
  [1m[35m (1.1ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 2]]
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 20:21:39.713857')[0m  [["user_id", 3]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 20:21:39.713857') AND (signed)[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 20:21:39.713857')[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 20:21:39.713857') AND (signed)[0m  [["user_id", 3]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 3]]
  Rendering reports/estimate_conversion.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (2.9ms)
  Rendered reports/estimate_conversion.html.haml within layouts/application (16.0ms)
  Rendered layouts/_header.html.haml (10.6ms)
Completed 200 OK in 645ms (Views: 594.6ms | ActiveRecord: 9.3ms)


Started GET "/reports/product-popularity" for 127.0.0.1 at 2017-04-28 23:21:41 +0300
Processing by ReportsController#product_popularity as HTML
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/product_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (6.0ms)
  [1m[36mCategory Load (2.3ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mProduct Load (4.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[35m (5.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  Rendered reports/product_popularity.html.haml within layouts/application (98.4ms)
  Rendered layouts/_header.html.haml (9.7ms)
Completed 200 OK in 644ms (Views: 594.0ms | ActiveRecord: 33.3ms)


Started GET "/reports/product-popularity" for 127.0.0.1 at 2017-04-28 23:22:20 +0300
Processing by ReportsController#product_popularity as HTML
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/product_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (3.4ms)
  [1m[36mCategory Load (1.1ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mProduct Load (1.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[35m (1.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  Rendered reports/product_popularity.html.haml within layouts/application (25.9ms)
  Rendered layouts/_header.html.haml (14.2ms)
Completed 200 OK in 764ms (Views: 752.5ms | ActiveRecord: 4.1ms)


Started GET "/reports/product-popularity" for 127.0.0.1 at 2017-04-28 23:22:23 +0300
Processing by ReportsController#product_popularity as HTML
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/product_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (6.2ms)
  [1m[36mCategory Load (1.0ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[35m (1.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  Rendered reports/product_popularity.html.haml within layouts/application (36.8ms)
  Rendered layouts/_header.html.haml (9.1ms)
Completed 200 OK in 617ms (Views: 605.5ms | ActiveRecord: 3.9ms)


Started GET "/reports/area-popularity" for 127.0.0.1 at 2017-04-28 23:22:25 +0300
Processing by ReportsController#area_popularity as HTML
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (3.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed)[0m
  [1m[35m (1.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 10) AND (area < 30)[0m
  [1m[35m (3.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 30) AND (area < 50)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 50) AND (area < 70)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 70) AND (area < 90)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 90) AND (area < 110)[0m
  [1m[35m (2.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 110) AND (area < 130)[0m
  [1m[35m (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 130) AND (area < 150)[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 150) AND (area < 170)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 170) AND (area < 190)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 190) AND (area < 210)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 210) AND (area < 230)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 230) AND (area < 250)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 250) AND (area < 270)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 270)[0m
  Rendering reports/area_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (2.7ms)
  Rendered reports/area_popularity.html.haml within layouts/application (9.6ms)
  Rendered layouts/_header.html.haml (9.2ms)
Completed 200 OK in 578ms (Views: 538.2ms | ActiveRecord: 18.9ms)


Started GET "/reports/material-consumption" for 127.0.0.1 at 2017-04-28 23:22:26 +0300
Processing by ReportsController#material_consumption as HTML
  [1m[36mUser Load (6.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/material_consumption.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (3.0ms)
  [1m[36mCategory Load (0.9ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mPrimitive Load (5.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL[0m
  [1m[36mUnit Load (2.2ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (1.6ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 3)[0m
  [1m[36mUnit Load (1.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 4)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 4)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 5)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 5)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 7)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 7)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 8)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 8)[0m
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 9)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 9)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 10)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 10)[0m
  Rendered reports/material_consumption.html.haml within layouts/application (116.1ms)
  Rendered layouts/_header.html.haml (10.6ms)
Completed 200 OK in 703ms (Views: 659.1ms | ActiveRecord: 37.7ms)


Started GET "/reports/estimate-conversion" for 127.0.0.1 at 2017-04-28 23:22:28 +0300
Processing by ReportsController#estimate_conversion as HTML
  [1m[36mUser Load (2.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 20:22:28.855692')[0m  [["user_id", 1]]
  [1m[35m (2.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 20:22:28.855692') AND (signed)[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 20:22:28.855692')[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 20:22:28.855692') AND (signed)[0m  [["user_id", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 1]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 20:22:28.869908')[0m  [["user_id", 2]]
  [1m[35m (1.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 20:22:28.869908') AND (signed)[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 20:22:28.869908')[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 20:22:28.869908') AND (signed)[0m  [["user_id", 2]]
  [1m[35m (1.2ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 2]]
  [1m[35m (1.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 20:22:28.884747')[0m  [["user_id", 3]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 20:22:28.884747') AND (signed)[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 20:22:28.884747')[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 20:22:28.884747') AND (signed)[0m  [["user_id", 3]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 3]]
  Rendering reports/estimate_conversion.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (2.7ms)
  Rendered reports/estimate_conversion.html.haml within layouts/application (9.2ms)
  Rendered layouts/_header.html.haml (10.9ms)
Completed 200 OK in 602ms (Views: 551.5ms | ActiveRecord: 12.7ms)


Started GET "/reports/material-consumption" for 127.0.0.1 at 2017-04-28 23:22:31 +0300
Processing by ReportsController#material_consumption as HTML
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/material_consumption.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (4.3ms)
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mPrimitive Load (1.4ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL[0m
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (2.5ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 3)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 4)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 4)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 5)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 5)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 7)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 7)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 8)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 8)[0m
  [1m[36mUnit Load (1.3ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 9)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 9)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 10)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 10)[0m
  Rendered reports/material_consumption.html.haml within layouts/application (77.0ms)
  Rendered layouts/_header.html.haml (9.2ms)
Completed 200 OK in 786ms (Views: 762.6ms | ActiveRecord: 14.1ms)


Started GET "/reports/material-consumption?utf8=%E2%9C%93&name=&category=4" for 127.0.0.1 at 2017-04-28 23:22:48 +0300
Processing by ReportsController#material_consumption as HTML
  Parameters: {"utf8"=>"✓", "name"=>"", "category"=>"4"}
  [1m[36mUser Load (1.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/material_consumption.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (4.9ms)
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mPrimitive Load (1.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL[0m
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (1.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 3)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (1.2ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 4)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 4)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[35m (1.8ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 5)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 5)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[35m (1.6ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 7)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 7)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 8)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 8)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 9)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 9)[0m
  [1m[36mCACHE (2.2ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 10)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 10)[0m
  Rendered reports/material_consumption.html.haml within layouts/application (76.2ms)
  Rendered layouts/_header.html.haml (10.2ms)
Completed 200 OK in 633ms (Views: 608.3ms | ActiveRecord: 17.9ms)


Started GET "/reports/material-consumption?utf8=%E2%9C%93&name=&category=1" for 127.0.0.1 at 2017-04-28 23:22:52 +0300
Processing by ReportsController#material_consumption as HTML
  Parameters: {"utf8"=>"✓", "name"=>"", "category"=>"1"}
  [1m[36mUser Load (2.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/material_consumption.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (4.0ms)
  [1m[36mCategory Load (1.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mPrimitive Load (1.3ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL[0m
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (5.5ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (4.4ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 3)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (1.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 4)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 4)[0m
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 5)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 5)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[35m (1.2ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 7)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 7)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (1.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 8)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 8)[0m
  [1m[36mUnit Load (1.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 9)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 9)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 10)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 10)[0m
  Rendered reports/material_consumption.html.haml within layouts/application (86.2ms)
  Rendered layouts/_header.html.haml (10.3ms)
Completed 200 OK in 634ms (Views: 599.2ms | ActiveRecord: 25.3ms)


Started GET "/reports/material-consumption?utf8=%E2%9C%93&name=&category=7" for 127.0.0.1 at 2017-04-28 23:22:57 +0300
Processing by ReportsController#material_consumption as HTML
  Parameters: {"utf8"=>"✓", "name"=>"", "category"=>"7"}
  [1m[36mUser Load (1.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/material_consumption.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (3.0ms)
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mPrimitive Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL[0m
  [1m[36mUnit Load (1.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 3)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 4)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 4)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[35m (6.4ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 5)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 5)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 7)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 7)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 8)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 8)[0m
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 9)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 9)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (1.7ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 10)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 10)[0m
  Rendered reports/material_consumption.html.haml within layouts/application (82.0ms)
  Rendered layouts/_header.html.haml (11.6ms)
Completed 200 OK in 646ms (Views: 621.6ms | ActiveRecord: 19.5ms)


Started GET "/reports/material-consumption?utf8=%E2%9C%93&name=&category=7" for 127.0.0.1 at 2017-04-28 23:25:08 +0300
Processing by ReportsController#material_consumption as HTML
  Parameters: {"utf8"=>"✓", "name"=>"", "category"=>"7"}
  [1m[36mUser Load (3.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/material_consumption.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (2.8ms)
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mPrimitive Load (1.3ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL[0m
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (1.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 3)[0m
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 4)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 4)[0m
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 5)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 5)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 7)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 7)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 8)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 8)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 9)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 9)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 10)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 10)[0m
  Rendered reports/material_consumption.html.haml within layouts/application (64.4ms)
  Rendered layouts/_header.html.haml (11.3ms)
Completed 200 OK in 605ms (Views: 584.3ms | ActiveRecord: 15.3ms)


Started GET "/reports/product-popularity" for 127.0.0.1 at 2017-04-28 23:25:13 +0300
Processing by ReportsController#product_popularity as HTML
  [1m[36mUser Load (1.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/product_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (2.8ms)
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[35m (1.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  Rendered reports/product_popularity.html.haml within layouts/application (21.4ms)
  Rendered layouts/_header.html.haml (11.2ms)
Completed 200 OK in 783ms (Views: 773.1ms | ActiveRecord: 4.1ms)


Started GET "/reports/estimate-conversion" for 127.0.0.1 at 2017-04-28 23:25:16 +0300
Processing by ReportsController#estimate_conversion as HTML
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 20:25:16.274552')[0m  [["user_id", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 20:25:16.274552') AND (signed)[0m  [["user_id", 1]]
  [1m[36mCACHE (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 20:25:16.274552')[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 20:25:16.274552') AND (signed)[0m  [["user_id", 1]]
  [1m[35m (1.3ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 1]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 20:25:16.293841')[0m  [["user_id", 2]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 20:25:16.293841') AND (signed)[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 20:25:16.293841')[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 20:25:16.293841') AND (signed)[0m  [["user_id", 2]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 2]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 20:25:16.307325')[0m  [["user_id", 3]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 20:25:16.307325') AND (signed)[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 20:25:16.307325')[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 20:25:16.307325') AND (signed)[0m  [["user_id", 3]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 3]]
  Rendering reports/estimate_conversion.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (2.8ms)
  Rendered reports/estimate_conversion.html.haml within layouts/application (9.1ms)
  Rendered layouts/_header.html.haml (9.6ms)
Completed 200 OK in 649ms (Views: 592.8ms | ActiveRecord: 9.5ms)


Started GET "/reports/product-popularity" for 127.0.0.1 at 2017-04-28 23:25:18 +0300
Processing by ReportsController#product_popularity as HTML
  [1m[36mUser Load (1.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/product_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (9.7ms)
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mProduct Load (1.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[35m (1.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  Rendered reports/product_popularity.html.haml within layouts/application (28.9ms)
  Rendered layouts/_header.html.haml (8.8ms)
Completed 200 OK in 599ms (Views: 586.0ms | ActiveRecord: 5.6ms)


Started GET "/reports/floor-popularity" for 127.0.0.1 at 2017-04-28 23:25:19 +0300
Processing by ReportsController#floor_popularity as HTML
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (2.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '1')[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '1.5')[0m
  [1m[35m (1.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '2')[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '2.5')[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '3')[0m
  Rendering reports/floor_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (3.1ms)
  Rendered reports/floor_popularity.html.haml within layouts/application (8.9ms)
  Rendered layouts/_header.html.haml (9.1ms)
Completed 200 OK in 546ms (Views: 526.0ms | ActiveRecord: 7.1ms)


Started GET "/reports/floor-popularity?utf8=%E2%9C%93&date_start=2017-04-28&date_end=2017-04-28" for 127.0.0.1 at 2017-04-28 23:25:21 +0300
Processing by ReportsController#floor_popularity as HTML
  Parameters: {"utf8"=>"✓", "date_start"=>"2017-04-28", "date_end"=>"2017-04-28"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 9ms (ActiveRecord: 0.7ms)


  
NoMethodError (undefined method `-' for "2017-04-28":String
Did you mean?  -@):
  
app/models/estimate.rb:24:in `block in <class:Estimate>'
app/controllers/reports_controller.rb:9:in `floor_popularity'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (5.4ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.4ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.4ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (33.1ms)
Started GET "/reports/product-popularity" for 127.0.0.1 at 2017-04-28 23:27:17 +0300
Processing by ReportsController#product_popularity as HTML
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/product_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (4.7ms)
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mProduct Load (3.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  Rendered reports/product_popularity.html.haml within layouts/application (29.5ms)
  Rendered layouts/_header.html.haml (14.5ms)
Completed 200 OK in 586ms (Views: 573.3ms | ActiveRecord: 5.6ms)


Started GET "/reports/product-popularity?utf8=%E2%9C%93&name=&category=&date_start=2017-04-28&date_end=2017-04-28" for 127.0.0.1 at 2017-04-28 23:27:20 +0300
Processing by ReportsController#product_popularity as HTML
  Parameters: {"utf8"=>"✓", "name"=>"", "category"=>"", "date_start"=>"2017-04-28", "date_end"=>"2017-04-28"}
  [1m[36mUser Load (2.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/product_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (3.1ms)
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[35m (1.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed) AND (estimates.signing_date > '2017-04-28') AND (estimates.signing_date < '2017-04-28')[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed) AND (estimates.signing_date > '2017-04-28') AND (estimates.signing_date < '2017-04-28')[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed) AND (estimates.signing_date > '2017-04-28') AND (estimates.signing_date < '2017-04-28')[0m
  Rendered reports/product_popularity.html.haml within layouts/application (23.9ms)
  Rendered layouts/_header.html.haml (10.5ms)
Completed 200 OK in 789ms (Views: 775.9ms | ActiveRecord: 5.6ms)


Started GET "/reports/product-popularity?utf8=%E2%9C%93&name=&category=&date_start=2017-04-28&date_end=2017-04-28" for 127.0.0.1 at 2017-04-28 23:28:05 +0300
Processing by ReportsController#product_popularity as HTML
  Parameters: {"utf8"=>"✓", "name"=>"", "category"=>"", "date_start"=>"2017-04-28", "date_end"=>"2017-04-28"}
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/product_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (3.4ms)
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[35m (1.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed) AND (estimates.signing_date > '2017-04-28') AND (estimates.signing_date < '2017-04-28')[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed) AND (estimates.signing_date > '2017-04-28') AND (estimates.signing_date < '2017-04-28')[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed) AND (estimates.signing_date > '2017-04-28') AND (estimates.signing_date < '2017-04-28')[0m
  Rendered reports/product_popularity.html.haml within layouts/application (35.3ms)
  Rendered layouts/_header.html.haml (15.2ms)
Completed 200 OK in 636ms (Views: 627.0ms | ActiveRecord: 4.1ms)


Started GET "/reports/product-popularity" for 127.0.0.1 at 2017-04-28 23:28:13 +0300
Processing by ReportsController#product_popularity as HTML
  [1m[36mUser Load (2.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/product_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (4.8ms)
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[35m (1.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  Rendered reports/product_popularity.html.haml within layouts/application (22.8ms)
  Rendered layouts/_header.html.haml (13.5ms)
Completed 200 OK in 595ms (Views: 580.9ms | ActiveRecord: 5.1ms)


Started GET "/reports/product-popularity" for 127.0.0.1 at 2017-04-28 23:28:34 +0300
Processing by ReportsController#product_popularity as HTML
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/product_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (3.8ms)
  [1m[36mCategory Load (0.8ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  Rendered reports/product_popularity.html.haml within layouts/application (24.8ms)
  Rendered layouts/_header.html.haml (13.1ms)
Completed 200 OK in 626ms (Views: 614.8ms | ActiveRecord: 3.4ms)


Started GET "/reports/product-popularity" for 127.0.0.1 at 2017-04-28 23:28:57 +0300
Processing by ReportsController#product_popularity as HTML
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/product_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (2.8ms)
  [1m[36mCategory Load (1.5ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  Rendered reports/product_popularity.html.haml within layouts/application (22.3ms)
  Rendered layouts/_header.html.haml (13.3ms)
Completed 200 OK in 568ms (Views: 559.2ms | ActiveRecord: 4.0ms)


Started GET "/reports/product-popularity" for 127.0.0.1 at 2017-04-28 23:29:22 +0300
Processing by ReportsController#product_popularity as HTML
  [1m[36mUser Load (2.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/product_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (3.6ms)
  [1m[36mCategory Load (1.0ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  Rendered reports/product_popularity.html.haml within layouts/application (20.4ms)
Completed 500 Internal Server Error in 37ms (ActiveRecord: 3.0ms)


  
ActionView::Template::Error (wrong number of arguments (given 4, expected 2..3)):
    12:         %button.btn.btn-default.col-sm-12 Поиск
    13:       .col-sm-4
    14:         %label.col-sm-4.control-label Период от
    15:         .col-sm-8= date_field :date_start, nil, Date.today, class: 'form-control'
    16:       .col-sm-3
    17:         %label.col-sm-2.control-label до
    18:         .col-sm-10= date_field :date_end, nil, Date.today, class: 'form-control'
  
app/views/reports/product_popularity.html.haml:15:in `block in _app_views_reports_product_popularity_html_haml___3701104658081073499_70297787441260'
app/views/reports/product_popularity.html.haml:8:in `_app_views_reports_product_popularity_html_haml___3701104658081073499_70297787441260'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (7.9ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (3.1ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.1ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (34.8ms)
Started GET "/reports/product-popularity" for 127.0.0.1 at 2017-04-28 23:31:40 +0300
Processing by ReportsController#product_popularity as HTML
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/product_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (4.7ms)
  [1m[36mCategory Load (1.0ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[35m (1.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  Rendered reports/product_popularity.html.haml within layouts/application (28.1ms)
  Rendered layouts/_header.html.haml (12.4ms)
Completed 200 OK in 724ms (Views: 712.2ms | ActiveRecord: 4.0ms)


Started GET "/reports/product-popularity" for 127.0.0.1 at 2017-04-28 23:33:06 +0300
Processing by ReportsController#product_popularity as HTML
  [1m[36mUser Load (1.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/product_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (3.3ms)
  [1m[36mCategory Load (0.8ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  Rendered reports/product_popularity.html.haml within layouts/application (25.1ms)
  Rendered layouts/_header.html.haml (12.8ms)
Completed 200 OK in 587ms (Views: 576.2ms | ActiveRecord: 3.7ms)


Started GET "/reports/product-popularity" for 127.0.0.1 at 2017-04-28 23:33:09 +0300
Processing by ReportsController#product_popularity as HTML
  [1m[36mUser Load (2.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/product_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (4.9ms)
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mProduct Load (0.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  Rendered reports/product_popularity.html.haml within layouts/application (24.7ms)
  Rendered layouts/_header.html.haml (8.9ms)
Completed 200 OK in 589ms (Views: 577.2ms | ActiveRecord: 4.4ms)


Started GET "/reports/floor-popularity" for 127.0.0.1 at 2017-04-28 23:33:11 +0300
Processing by ReportsController#floor_popularity as HTML
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (1.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '1')[0m
  [1m[35m (2.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '1.5')[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '2')[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '2.5')[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '3')[0m
  Rendering reports/floor_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (5.0ms)
  Rendered reports/floor_popularity.html.haml within layouts/application (10.8ms)
  Rendered layouts/_header.html.haml (12.1ms)
Completed 200 OK in 604ms (Views: 586.3ms | ActiveRecord: 6.9ms)


Started GET "/reports/floor-popularity?utf8=%E2%9C%93&date_start=2017-04-12&date_end=2017-04-28" for 127.0.0.1 at 2017-04-28 23:33:27 +0300
Processing by ReportsController#floor_popularity as HTML
  Parameters: {"utf8"=>"✓", "date_start"=>"2017-04-12", "date_end"=>"2017-04-28"}
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 10ms (ActiveRecord: 0.8ms)


  
NoMethodError (undefined method `-' for "2017-04-12":String
Did you mean?  -@):
  
app/models/estimate.rb:24:in `block in <class:Estimate>'
app/controllers/reports_controller.rb:9:in `floor_popularity'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (5.5ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.3ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.2ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (31.9ms)
Started GET "/reports/floor-popularity?utf8=%E2%9C%93&date_start=2017-04-12&date_end=2017-04-28" for 127.0.0.1 at 2017-04-28 23:34:30 +0300
Processing by ReportsController#floor_popularity as HTML
  Parameters: {"utf8"=>"✓", "date_start"=>"2017-04-12", "date_end"=>"2017-04-28"}
  [1m[36mUser Load (1.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (signing_date >= '2017-04-11') AND (signing_date <= '2017-04-29')[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (signing_date >= '2017-04-11') AND (signing_date <= '2017-04-29') AND (floors = '1')[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (signing_date >= '2017-04-11') AND (signing_date <= '2017-04-29') AND (floors = '1.5')[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (signing_date >= '2017-04-11') AND (signing_date <= '2017-04-29') AND (floors = '2')[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (signing_date >= '2017-04-11') AND (signing_date <= '2017-04-29') AND (floors = '2.5')[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (signing_date >= '2017-04-11') AND (signing_date <= '2017-04-29') AND (floors = '3')[0m
  Rendering reports/floor_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (2.7ms)
  Rendered reports/floor_popularity.html.haml within layouts/application (8.1ms)
  Rendered layouts/_header.html.haml (22.5ms)
Completed 200 OK in 810ms (Views: 681.6ms | ActiveRecord: 9.6ms)


Started GET "/reports/floor-popularity?utf8=%E2%9C%93&date_start=2017-05-16&date_end=2017-04-28" for 127.0.0.1 at 2017-04-28 23:34:41 +0300
Processing by ReportsController#floor_popularity as HTML
  Parameters: {"utf8"=>"✓", "date_start"=>"2017-05-16", "date_end"=>"2017-04-28"}
  [1m[36mUser Load (2.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (signing_date >= '2017-05-15') AND (signing_date <= '2017-04-29')[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (signing_date >= '2017-05-15') AND (signing_date <= '2017-04-29') AND (floors = '1')[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (signing_date >= '2017-05-15') AND (signing_date <= '2017-04-29') AND (floors = '1.5')[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (signing_date >= '2017-05-15') AND (signing_date <= '2017-04-29') AND (floors = '2')[0m
  [1m[35m (1.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (signing_date >= '2017-05-15') AND (signing_date <= '2017-04-29') AND (floors = '2.5')[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (signing_date >= '2017-05-15') AND (signing_date <= '2017-04-29') AND (floors = '3')[0m
  Rendering reports/floor_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (5.5ms)
  Rendered reports/floor_popularity.html.haml within layouts/application (19.1ms)
  Rendered layouts/_header.html.haml (10.8ms)
Completed 200 OK in 729ms (Views: 704.3ms | ActiveRecord: 6.9ms)


Started GET "/reports/product-popularity" for 127.0.0.1 at 2017-04-28 23:51:40 +0300
Processing by ReportsController#product_popularity as HTML
  [1m[36mUser Load (1.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/product_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (4.1ms)
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mProduct Load (1.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  Rendered reports/product_popularity.html.haml within layouts/application (73.7ms)
  Rendered layouts/_header.html.haml (11.3ms)
Completed 200 OK in 711ms (Views: 671.8ms | ActiveRecord: 26.0ms)


Started GET "/reports/floor-popularity" for 127.0.0.1 at 2017-04-28 23:51:42 +0300
Processing by ReportsController#floor_popularity as HTML
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (2.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '1')[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '1.5')[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '2')[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '2.5')[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '3')[0m
  Rendering reports/floor_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (5.7ms)
  Rendered reports/floor_popularity.html.haml within layouts/application (10.4ms)
  Rendered layouts/_header.html.haml (12.0ms)
Completed 200 OK in 565ms (Views: 547.3ms | ActiveRecord: 6.0ms)


Started GET "/reports/estimate-conversion" for 127.0.0.1 at 2017-04-28 23:51:44 +0300
Processing by ReportsController#estimate_conversion as HTML
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (2.5ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
Completed 500 Internal Server Error in 12ms (ActiveRecord: 3.2ms)


  
TypeError (no implicit conversion of ActiveSupport::TimeWithZone into String):
  
app/models/estimate.rb:24:in `parse'
app/models/estimate.rb:24:in `block in <class:Estimate>'
app/controllers/reports_controller.rb:39:in `block in estimate_conversion'
app/controllers/reports_controller.rb:35:in `estimate_conversion'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (5.1ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.1ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (0.9ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (36.7ms)
DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
Started GET "/reports/floor-popularity" for 127.0.0.1 at 2017-04-28 23:55:10 +0300
Processing by ReportsController#floor_popularity as HTML
  [1m[36mUser Load (1.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 11333ms (ActiveRecord: 6.8ms)


  
TypeError (no implicit conversion of nil into Integer):
  
app/controllers/reports_controller.rb:10:in `initialize'
app/controllers/reports_controller.rb:10:in `new'
app/controllers/reports_controller.rb:10:in `floor_popularity'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (5.4ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.4ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.2ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (30.5ms)
Started GET "/reports/floor-popularity" for 127.0.0.1 at 2017-04-28 23:55:51 +0300
Processing by ReportsController#floor_popularity as HTML
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed)[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '1')[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '1.5')[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '2')[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '2.5')[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '3')[0m
  Rendering reports/floor_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (4.3ms)
  Rendered reports/floor_popularity.html.haml within layouts/application (13.5ms)
  Rendered layouts/_header.html.haml (8.9ms)
Completed 200 OK in 757ms (Views: 622.2ms | ActiveRecord: 8.1ms)


Started GET "/reports/floor-popularity?utf8=%E2%9C%93&date_start=2017-04-27&date_end=2017-04-28" for 127.0.0.1 at 2017-04-28 23:55:58 +0300
Processing by ReportsController#floor_popularity as HTML
  Parameters: {"utf8"=>"✓", "date_start"=>"2017-04-27", "date_end"=>"2017-04-28"}
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 8ms (ActiveRecord: 0.9ms)


  
NoMethodError (undefined method `-' for "2017-04-27":String
Did you mean?  -@):
  
app/models/estimate.rb:24:in `block in <class:Estimate>'
app/controllers/reports_controller.rb:9:in `floor_popularity'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (5.0ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.1ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.7ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (32.4ms)
Started GET "/reports/floor-popularity?utf8=%E2%9C%93&date_start=2017-04-27&date_end=2017-04-28" for 127.0.0.1 at 2017-04-28 23:56:12 +0300
Processing by ReportsController#floor_popularity as HTML
  Parameters: {"utf8"=>"✓", "date_start"=>"2017-04-27", "date_end"=>"2017-04-28"}
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 11ms (ActiveRecord: 0.8ms)


  
NoMethodError (undefined method `-' for "2017-04-27":String
Did you mean?  -@):
  
app/models/estimate.rb:24:in `block in <class:Estimate>'
app/controllers/reports_controller.rb:9:in `floor_popularity'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (34.1ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.2ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.0ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (59.2ms)
Started GET "/reports/floor-popularity" for 127.0.0.1 at 2017-04-28 23:56:14 +0300
Processing by ReportsController#floor_popularity as HTML
  [1m[36mUser Load (1.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (3.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed)[0m
  [1m[35m (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '1')[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '1.5')[0m
  [1m[35m (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '2')[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '2.5')[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '3')[0m
  Rendering reports/floor_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (4.0ms)
  Rendered reports/floor_popularity.html.haml within layouts/application (16.5ms)
  Rendered layouts/_header.html.haml (8.9ms)
Completed 200 OK in 528ms (Views: 509.1ms | ActiveRecord: 8.9ms)


Started GET "/reports/estimate-conversion" for 127.0.0.1 at 2017-04-28 23:56:41 +0300
Processing by ReportsController#estimate_conversion as HTML
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (2.8ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 20:56:41.953918')[0m  [["user_id", 1]]
  [1m[35m (1.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 20:56:41.953918') AND (signed)[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 20:56:41.953918')[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 20:56:41.953918') AND (signed)[0m  [["user_id", 1]]
  [1m[35m (2.1ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 20:56:41.977101')[0m  [["user_id", 2]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 20:56:41.977101') AND (signed)[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 20:56:41.977101')[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 20:56:41.977101') AND (signed)[0m  [["user_id", 2]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 2]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 20:56:41.990083')[0m  [["user_id", 3]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 20:56:41.990083') AND (signed)[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 20:56:41.990083')[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 20:56:41.990083') AND (signed)[0m  [["user_id", 3]]
  [1m[35m (1.1ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 3]]
  Rendering reports/estimate_conversion.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (2.3ms)
  Rendered reports/estimate_conversion.html.haml within layouts/application (9.8ms)
  Rendered layouts/_header.html.haml (12.3ms)
Completed 200 OK in 591ms (Views: 537.3ms | ActiveRecord: 12.8ms)


Started GET "/reports/product-popularity" for 127.0.0.1 at 2017-04-28 23:56:47 +0300
Processing by ReportsController#product_popularity as HTML
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/product_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (2.8ms)
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mProduct Load (1.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  Rendered reports/product_popularity.html.haml within layouts/application (58.3ms)
  Rendered layouts/_header.html.haml (9.4ms)
Completed 200 OK in 569ms (Views: 536.6ms | ActiveRecord: 19.9ms)


Started GET "/reports/product-popularity?utf8=%E2%9C%93&name=&category=1&date_start=2017-04-28&date_end=2017-04-28" for 127.0.0.1 at 2017-04-28 23:56:50 +0300
Processing by ReportsController#product_popularity as HTML
  Parameters: {"utf8"=>"✓", "name"=>"", "category"=>"1", "date_start"=>"2017-04-28", "date_end"=>"2017-04-28"}
  [1m[36mUser Load (1.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/product_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (3.8ms)
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[35m (1.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed) AND (estimates.signing_date > '2017-04-28') AND (estimates.signing_date < '2017-04-28')[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed) AND (estimates.signing_date > '2017-04-28') AND (estimates.signing_date < '2017-04-28')[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed) AND (estimates.signing_date > '2017-04-28') AND (estimates.signing_date < '2017-04-28')[0m
  Rendered reports/product_popularity.html.haml within layouts/application (19.4ms)
  Rendered layouts/_header.html.haml (10.6ms)
Completed 200 OK in 629ms (Views: 617.4ms | ActiveRecord: 4.3ms)


Started GET "/reports/product-popularity?utf8=%E2%9C%93&name=&category=4&date_start=2017-04-28&date_end=2017-04-28" for 127.0.0.1 at 2017-04-28 23:56:55 +0300
Processing by ReportsController#product_popularity as HTML
  Parameters: {"utf8"=>"✓", "name"=>"", "category"=>"4", "date_start"=>"2017-04-28", "date_end"=>"2017-04-28"}
  [1m[36mUser Load (3.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/product_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (3.8ms)
  [1m[36mCategory Load (0.8ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[35m (1.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed) AND (estimates.signing_date > '2017-04-28') AND (estimates.signing_date < '2017-04-28')[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed) AND (estimates.signing_date > '2017-04-28') AND (estimates.signing_date < '2017-04-28')[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed) AND (estimates.signing_date > '2017-04-28') AND (estimates.signing_date < '2017-04-28')[0m
  Rendered reports/product_popularity.html.haml within layouts/application (23.3ms)
  Rendered layouts/_header.html.haml (8.2ms)
Completed 200 OK in 896ms (Views: 883.2ms | ActiveRecord: 7.4ms)


Started GET "/reports/product-popularity?utf8=%E2%9C%93&name=&category=4&date_start=2017-04-28&date_end=2017-04-28" for 127.0.0.1 at 2017-04-28 23:57:34 +0300
Processing by ReportsController#product_popularity as HTML
  Parameters: {"utf8"=>"✓", "name"=>"", "category"=>"4", "date_start"=>"2017-04-28", "date_end"=>"2017-04-28"}
  [1m[36mUser Load (3.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/product_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (7.0ms)
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mProduct Load (2.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed) AND (estimates.signing_date > '2017-04-28') AND (estimates.signing_date < '2017-04-28')[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed) AND (estimates.signing_date > '2017-04-28') AND (estimates.signing_date < '2017-04-28')[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed) AND (estimates.signing_date > '2017-04-28') AND (estimates.signing_date < '2017-04-28')[0m
  Rendered reports/product_popularity.html.haml within layouts/application (27.4ms)
  Rendered layouts/_header.html.haml (12.0ms)
Completed 200 OK in 560ms (Views: 542.8ms | ActiveRecord: 7.8ms)


Started GET "/categories" for 127.0.0.1 at 2017-04-29 00:03:58 +0300
Processing by CategoriesController#index as HTML
  [1m[36mUser Load (4.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering categories/index.html.haml within layouts/application
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  Rendered categories/_listing.html.haml (6.0ms)
  Rendered categories/_listing.html.haml (0.5ms)
  Rendered categories/_listing.html.haml (0.5ms)
  Rendered categories/_listing.html.haml (0.6ms)
  Rendered categories/_listing.html.haml (0.4ms)
  Rendered categories/_listing.html.haml (0.6ms)
  Rendered categories/_listing.html.haml (0.5ms)
  Rendered categories/_listing.html.haml (0.5ms)
  [1m[36mCategory Load (1.3ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", true]]
  Rendered categories/_listing.html.haml (0.6ms)
  Rendered categories/_listing.html.haml (0.6ms)
  Rendered categories/_listing.html.haml (0.5ms)
  Rendered categories/_listing.html.haml (0.5ms)
  Rendered categories/_listing.html.haml (0.5ms)
  Rendered categories/_listing.html.haml (0.6ms)
  Rendered categories/_listing.html.haml (0.6ms)
  Rendered categories/index.html.haml within layouts/application (44.2ms)
  Rendered layouts/_header.html.haml (8.3ms)
Completed 200 OK in 557ms (Views: 546.1ms | ActiveRecord: 5.9ms)


Started GET "/reports" for 127.0.0.1 at 2017-04-29 00:04:06 +0300
Processing by ReportsController#index as HTML
  [1m[36mUser Load (2.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/index.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (2.8ms)
  Rendered reports/index.html.haml within layouts/application (4.6ms)
  Rendered layouts/_header.html.haml (11.3ms)
Completed 200 OK in 619ms (Views: 608.5ms | ActiveRecord: 2.2ms)


Started GET "/reports/product-popularity" for 127.0.0.1 at 2017-04-29 00:04:10 +0300
Processing by ReportsController#product_popularity as HTML
  [1m[36mUser Load (1.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/product_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (3.3ms)
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mProduct Load (0.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[35m (2.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  Rendered reports/product_popularity.html.haml within layouts/application (32.3ms)
  Rendered layouts/_header.html.haml (16.0ms)
Completed 200 OK in 658ms (Views: 648.3ms | ActiveRecord: 4.9ms)


Started GET "/reports/floor-popularity" for 127.0.0.1 at 2017-04-29 00:04:12 +0300
Processing by ReportsController#floor_popularity as HTML
  [1m[36mUser Load (2.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (1.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '1')[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '1.5')[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '2')[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '2.5')[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '3')[0m
  Rendering reports/floor_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (3.3ms)
  Rendered reports/floor_popularity.html.haml within layouts/application (10.9ms)
  Rendered layouts/_header.html.haml (12.6ms)
Completed 200 OK in 707ms (Views: 690.3ms | ActiveRecord: 6.9ms)


Started GET "/reports/area-popularity" for 127.0.0.1 at 2017-04-29 00:04:14 +0300
Processing by ReportsController#area_popularity as HTML
  [1m[36mUser Load (2.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed)[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 10) AND (area < 30)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 30) AND (area < 50)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 50) AND (area < 70)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 70) AND (area < 90)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 90) AND (area < 110)[0m
  [1m[35m (1.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 110) AND (area < 130)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 130) AND (area < 150)[0m
  [1m[35m (2.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 150) AND (area < 170)[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 170) AND (area < 190)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 190) AND (area < 210)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 210) AND (area < 230)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 230) AND (area < 250)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 250) AND (area < 270)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 270)[0m
  Rendering reports/area_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (4.5ms)
  Rendered reports/area_popularity.html.haml within layouts/application (14.8ms)
  Rendered layouts/_header.html.haml (11.4ms)
Completed 200 OK in 586ms (Views: 550.8ms | ActiveRecord: 14.2ms)


Started GET "/reports/material-consumption" for 127.0.0.1 at 2017-04-29 00:04:17 +0300
Processing by ReportsController#material_consumption as HTML
  [1m[36mUser Load (2.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/material_consumption.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (2.3ms)
  [1m[36mCategory Load (1.4ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mPrimitive Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 3)[0m
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 4)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 4)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 5)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 5)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 7)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 7)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 8)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 8)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 9)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 9)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 10)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 10)[0m
  Rendered reports/material_consumption.html.haml within layouts/application (97.6ms)
  Rendered layouts/_header.html.haml (13.7ms)
Completed 200 OK in 678ms (Views: 650.4ms | ActiveRecord: 21.2ms)


Started GET "/reports/estimate-conversion" for 127.0.0.1 at 2017-04-29 00:04:19 +0300
Processing by ReportsController#estimate_conversion as HTML
  [1m[36mUser Load (5.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 21:04:19.379041')[0m  [["user_id", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 21:04:19.379041') AND (signed)[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 21:04:19.379041')[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 21:04:19.379041') AND (signed)[0m  [["user_id", 1]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 21:04:19.392529')[0m  [["user_id", 2]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 21:04:19.392529') AND (signed)[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 21:04:19.392529')[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 21:04:19.392529') AND (signed)[0m  [["user_id", 2]]
  [1m[35m (1.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 2]]
  [1m[35m (1.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 21:04:19.402132')[0m  [["user_id", 3]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 21:04:19.402132') AND (signed)[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 21:04:19.402132')[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 21:04:19.402132') AND (signed)[0m  [["user_id", 3]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 3]]
  Rendering reports/estimate_conversion.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (3.5ms)
  Rendered reports/estimate_conversion.html.haml within layouts/application (13.2ms)
  Rendered layouts/_header.html.haml (9.8ms)
Completed 200 OK in 668ms (Views: 620.9ms | ActiveRecord: 13.2ms)


Started GET "/reports/product-popularity" for 127.0.0.1 at 2017-04-29 00:04:21 +0300
Processing by ReportsController#product_popularity as HTML
  [1m[36mUser Load (5.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/product_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (2.7ms)
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mProduct Load (3.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  Rendered reports/product_popularity.html.haml within layouts/application (32.2ms)
  Rendered layouts/_header.html.haml (8.7ms)
Completed 200 OK in 639ms (Views: 623.9ms | ActiveRecord: 10.0ms)


Started GET "/reports/product-popularity" for 127.0.0.1 at 2017-04-29 00:19:50 +0300
Processing by ReportsController#product_popularity as HTML
  [1m[36mUser Load (6.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/product_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (2.9ms)
  [1m[36mCategory Load (0.8ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[35m (2.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  Rendered reports/product_popularity.html.haml within layouts/application (32.6ms)
  Rendered layouts/_header.html.haml (10.4ms)
Completed 200 OK in 595ms (Views: 580.0ms | ActiveRecord: 10.4ms)


Started GET "/reports/floor-popularity" for 127.0.0.1 at 2017-04-29 00:28:10 +0300
Processing by ReportsController#floor_popularity as HTML
  [1m[36mUser Load (3.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (1.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed)[0m
  [1m[35m (2.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '1')[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '1.5')[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '2')[0m
  [1m[35m (2.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '2.5')[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '3')[0m
  Rendering reports/floor_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (2.8ms)
  Rendered reports/floor_popularity.html.haml within layouts/application (8.7ms)
  Rendered layouts/_header.html.haml (10.3ms)
Completed 200 OK in 1882ms (Views: 1857.2ms | ActiveRecord: 11.4ms)


Started GET "/reports/floor-popularity" for 127.0.0.1 at 2017-04-29 00:28:12 +0300
Processing by ReportsController#floor_popularity as HTML
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed)[0m
  [1m[35m (1.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '1')[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '1.5')[0m
  [1m[35m (1.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '2')[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '2.5')[0m
  [1m[35m (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '3')[0m
  Rendering reports/floor_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (2.8ms)
  Rendered reports/floor_popularity.html.haml within layouts/application (11.6ms)
  Rendered layouts/_header.html.haml (9.5ms)
Completed 200 OK in 677ms (Views: 661.9ms | ActiveRecord: 7.5ms)


Started GET "/reports/product-popularity" for 127.0.0.1 at 2017-04-29 00:29:42 +0300
Processing by ReportsController#product_popularity as HTML
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/product_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (4.2ms)
  [1m[36mCategory Load (0.5ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mProduct Load (1.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  Rendered reports/product_popularity.html.haml within layouts/application (21.9ms)
  Rendered layouts/_header.html.haml (11.8ms)
Completed 200 OK in 582ms (Views: 573.5ms | ActiveRecord: 3.6ms)


Started GET "/reports/product-popularity" for 127.0.0.1 at 2017-04-29 00:30:13 +0300
Processing by ReportsController#product_popularity as HTML
  [1m[36mUser Load (2.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/product_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (2.9ms)
  [1m[36mCategory Load (2.4ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[35m (1.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  Rendered reports/product_popularity.html.haml within layouts/application (21.2ms)
  Rendered layouts/_header.html.haml (14.3ms)
Completed 200 OK in 1235ms (Views: 1223.6ms | ActiveRecord: 6.4ms)


Started GET "/reports/product-popularity" for 127.0.0.1 at 2017-04-29 00:30:31 +0300
Processing by ReportsController#product_popularity as HTML
  [1m[36mUser Load (3.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/product_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (2.8ms)
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[35m (1.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  Rendered reports/product_popularity.html.haml within layouts/application (26.2ms)
  Rendered layouts/_header.html.haml (10.5ms)
Completed 200 OK in 598ms (Views: 585.9ms | ActiveRecord: 6.2ms)


Started GET "/reports/product-popularity" for 127.0.0.1 at 2017-04-29 00:30:41 +0300
Processing by ReportsController#product_popularity as HTML
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/product_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (3.1ms)
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mProduct Load (2.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[35m (1.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  Rendered reports/product_popularity.html.haml within layouts/application (30.8ms)
  Rendered layouts/_header.html.haml (34.9ms)
Completed 200 OK in 601ms (Views: 591.2ms | ActiveRecord: 5.5ms)


Started GET "/reports/product-popularity" for 127.0.0.1 at 2017-04-29 00:31:38 +0300
Processing by ReportsController#product_popularity as HTML
  [1m[36mUser Load (2.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/product_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (3.1ms)
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[35m (1.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  Rendered reports/product_popularity.html.haml within layouts/application (22.3ms)
  Rendered layouts/_header.html.haml (9.7ms)
Completed 200 OK in 606ms (Views: 590.3ms | ActiveRecord: 4.8ms)


Started GET "/reports/area-popularity" for 127.0.0.1 at 2017-04-29 00:33:46 +0300
Processing by ReportsController#area_popularity as HTML
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (2.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed)[0m
  [1m[35m (1.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 10) AND (area < 30)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 30) AND (area < 50)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 50) AND (area < 70)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 70) AND (area < 90)[0m
  [1m[35m (3.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 90) AND (area < 110)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 110) AND (area < 130)[0m
  [1m[35m (1.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 130) AND (area < 150)[0m
  [1m[35m (1.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 150) AND (area < 170)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 170) AND (area < 190)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 190) AND (area < 210)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 210) AND (area < 230)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 230) AND (area < 250)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 250) AND (area < 270)[0m
  [1m[35m (6.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 270)[0m
  Rendering reports/area_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (3.2ms)
  Rendered reports/area_popularity.html.haml within layouts/application (9.2ms)
  Rendered layouts/_header.html.haml (8.8ms)
Completed 200 OK in 607ms (Views: 561.9ms | ActiveRecord: 22.7ms)


Started GET "/reports/product-popularity" for 127.0.0.1 at 2017-04-29 00:33:56 +0300
Processing by ReportsController#product_popularity as HTML
  [1m[36mUser Load (2.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/product_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (9.2ms)
  [1m[36mCategory Load (1.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  Rendered reports/product_popularity.html.haml within layouts/application (32.0ms)
  Rendered layouts/_header.html.haml (8.9ms)
Completed 200 OK in 598ms (Views: 584.3ms | ActiveRecord: 5.4ms)


Started GET "/reports/floor-popularity" for 127.0.0.1 at 2017-04-29 00:33:57 +0300
Processing by ReportsController#floor_popularity as HTML
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (1.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed)[0m
  [1m[35m (2.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '1')[0m
  [1m[35m (1.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '1.5')[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '2')[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '2.5')[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '3')[0m
  Rendering reports/floor_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (3.2ms)
  Rendered reports/floor_popularity.html.haml within layouts/application (11.0ms)
  Rendered layouts/_header.html.haml (11.0ms)
Completed 200 OK in 576ms (Views: 556.5ms | ActiveRecord: 9.0ms)


Started GET "/reports/floor-popularity" for 127.0.0.1 at 2017-04-29 00:34:40 +0300
Processing by ReportsController#floor_popularity as HTML
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (3.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed)[0m
  [1m[35m (1.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '1')[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '1.5')[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '2')[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '2.5')[0m
  [1m[35m (1.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '3')[0m
  Rendering reports/floor_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (5.4ms)
  Rendered reports/floor_popularity.html.haml within layouts/application (11.4ms)
  Rendered layouts/_header.html.haml (8.2ms)
Completed 200 OK in 1258ms (Views: 1238.3ms | ActiveRecord: 9.6ms)


Started GET "/reports/floor-popularity" for 127.0.0.1 at 2017-04-29 00:34:47 +0300
Processing by ReportsController#floor_popularity as HTML
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (3.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '1')[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '1.5')[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '2')[0m
  [1m[35m (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '2.5')[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '3')[0m
  Rendering reports/floor_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (3.1ms)
  Rendered reports/floor_popularity.html.haml within layouts/application (8.3ms)
  Rendered layouts/_header.html.haml (11.8ms)
Completed 200 OK in 1349ms (Views: 1328.1ms | ActiveRecord: 8.2ms)


Started GET "/reports/area-popularity" for 127.0.0.1 at 2017-04-29 00:35:02 +0300
Processing by ReportsController#area_popularity as HTML
  [1m[36mUser Load (1.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 10) AND (area < 30)[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 30) AND (area < 50)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 50) AND (area < 70)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 70) AND (area < 90)[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 90) AND (area < 110)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 110) AND (area < 130)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 130) AND (area < 150)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 150) AND (area < 170)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 170) AND (area < 190)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 190) AND (area < 210)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 210) AND (area < 230)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 230) AND (area < 250)[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 250) AND (area < 270)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 270)[0m
  Rendering reports/area_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (6.5ms)
  Rendered reports/area_popularity.html.haml within layouts/application (21.4ms)
  Rendered layouts/_header.html.haml (13.1ms)
Completed 200 OK in 729ms (Views: 686.5ms | ActiveRecord: 11.1ms)


Started GET "/reports/area-popularity" for 127.0.0.1 at 2017-04-29 00:35:36 +0300
Processing by ReportsController#area_popularity as HTML
  [1m[36mUser Load (2.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed)[0m
  [1m[35m (1.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 10) AND (area < 30)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 30) AND (area < 50)[0m
  [1m[35m (3.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 50) AND (area < 70)[0m
  [1m[35m (1.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 70) AND (area < 90)[0m
  [1m[35m (1.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 90) AND (area < 110)[0m
  [1m[35m (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 110) AND (area < 130)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 130) AND (area < 150)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 150) AND (area < 170)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 170) AND (area < 190)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 190) AND (area < 210)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 210) AND (area < 230)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 230) AND (area < 250)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 250) AND (area < 270)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 270)[0m
  Rendering reports/area_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (7.0ms)
  Rendered reports/area_popularity.html.haml within layouts/application (13.3ms)
  Rendered layouts/_header.html.haml (11.4ms)
Completed 200 OK in 1287ms (Views: 1239.5ms | ActiveRecord: 18.5ms)


Started GET "/reports/area-popularity" for 127.0.0.1 at 2017-04-29 00:35:48 +0300
Processing by ReportsController#area_popularity as HTML
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (2.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed)[0m
  [1m[35m (3.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 10) AND (area < 30)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 30) AND (area < 50)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 50) AND (area < 70)[0m
  [1m[35m (1.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 70) AND (area < 90)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 90) AND (area < 110)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 110) AND (area < 130)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 130) AND (area < 150)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 150) AND (area < 170)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 170) AND (area < 190)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 190) AND (area < 210)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 210) AND (area < 230)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 230) AND (area < 250)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 250) AND (area < 270)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 270)[0m
  Rendering reports/area_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (2.3ms)
  Rendered reports/area_popularity.html.haml within layouts/application (11.3ms)
  Rendered layouts/_header.html.haml (9.1ms)
Completed 200 OK in 639ms (Views: 602.6ms | ActiveRecord: 15.2ms)


Started GET "/reports/area-popularity" for 127.0.0.1 at 2017-04-29 00:38:03 +0300
Processing by ReportsController#area_popularity as HTML
  [1m[36mUser Load (3.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed)[0m
  [1m[35m (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 10) AND (area < 30)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 30) AND (area < 50)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 50) AND (area < 70)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 70) AND (area < 90)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 90) AND (area < 110)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 110) AND (area < 130)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 130) AND (area < 150)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 150) AND (area < 170)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 170) AND (area < 190)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 190) AND (area < 210)[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 210) AND (area < 230)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 230) AND (area < 250)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 250) AND (area < 270)[0m
  [1m[35m (1.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 270)[0m
  Rendering reports/area_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (3.4ms)
  Rendered reports/area_popularity.html.haml within layouts/application (13.8ms)
  Rendered layouts/_header.html.haml (11.7ms)
Completed 200 OK in 694ms (Views: 651.9ms | ActiveRecord: 14.6ms)


Started GET "/reports/area-popularity" for 127.0.0.1 at 2017-04-29 00:38:26 +0300
Processing by ReportsController#area_popularity as HTML
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (2.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed)[0m
  [1m[35m (1.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 10) AND (area < 30)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 30) AND (area < 50)[0m
  [1m[35m (1.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 50) AND (area < 70)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 70) AND (area < 90)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 90) AND (area < 110)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 110) AND (area < 130)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 130) AND (area < 150)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 150) AND (area < 170)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 170) AND (area < 190)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 190) AND (area < 210)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 210) AND (area < 230)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 230) AND (area < 250)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 250) AND (area < 270)[0m
  [1m[35m (2.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 270)[0m
  Rendering reports/area_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (2.6ms)
  Rendered reports/area_popularity.html.haml within layouts/application (13.0ms)
  Rendered layouts/_header.html.haml (13.4ms)
Completed 200 OK in 2329ms (Views: 2293.7ms | ActiveRecord: 16.1ms)


Started GET "/reports/area-popularity" for 127.0.0.1 at 2017-04-29 00:40:49 +0300
Processing by ReportsController#area_popularity as HTML
  [1m[36mUser Load (12.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (4.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed)[0m
  [1m[35m (1.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 10) AND (area < 30)[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 30) AND (area < 50)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 50) AND (area < 70)[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 70) AND (area < 90)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 90) AND (area < 110)[0m
  [1m[35m (1.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 110) AND (area < 130)[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 130) AND (area < 150)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 150) AND (area < 170)[0m
  [1m[35m (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 170) AND (area < 190)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 190) AND (area < 210)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 210) AND (area < 230)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 230) AND (area < 250)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 250) AND (area < 270)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 270)[0m
  Rendering reports/area_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (3.6ms)
  Rendered reports/area_popularity.html.haml within layouts/application (14.5ms)
  Rendered layouts/_header.html.haml (10.5ms)
Completed 200 OK in 729ms (Views: 674.5ms | ActiveRecord: 29.0ms)


Started GET "/reports/area-popularity" for 127.0.0.1 at 2017-04-29 00:41:52 +0300
Processing by ReportsController#area_popularity as HTML
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 10) AND (area < 30)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 30) AND (area < 50)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 50) AND (area < 70)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 70) AND (area < 90)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 90) AND (area < 110)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 110) AND (area < 130)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 130) AND (area < 150)[0m
  [1m[35m (3.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 150) AND (area < 170)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 170) AND (area < 190)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 190) AND (area < 210)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 210) AND (area < 230)[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 230) AND (area < 250)[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 250) AND (area < 270)[0m
  [1m[35m (1.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 270)[0m
  Rendering reports/area_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (2.3ms)
  Rendered reports/area_popularity.html.haml within layouts/application (8.8ms)
  Rendered layouts/_header.html.haml (13.1ms)
Completed 200 OK in 599ms (Views: 466.8ms | ActiveRecord: 13.7ms)


Started GET "/reports/area-popularity" for 127.0.0.1 at 2017-04-29 00:42:04 +0300
Processing by ReportsController#area_popularity as HTML
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 10) AND (area < 30)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 30) AND (area < 50)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 50) AND (area < 70)[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 70) AND (area < 90)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 90) AND (area < 110)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 110) AND (area < 130)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 130) AND (area < 150)[0m
  [1m[35m (3.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 150) AND (area < 170)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 170) AND (area < 190)[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 190) AND (area < 210)[0m
  [1m[35m (3.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 210) AND (area < 230)[0m
  [1m[35m (3.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 230) AND (area < 250)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 250) AND (area < 270)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 270)[0m
  Rendering reports/area_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (4.3ms)
  Rendered reports/area_popularity.html.haml within layouts/application (10.3ms)
  Rendered layouts/_header.html.haml (7.8ms)
Completed 200 OK in 701ms (Views: 593.3ms | ActiveRecord: 19.8ms)


Started GET "/reports/area-popularity" for 127.0.0.1 at 2017-04-29 00:43:07 +0300
Processing by ReportsController#area_popularity as HTML
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 10) AND (area < 30)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 30) AND (area < 50)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 50) AND (area < 70)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 70) AND (area < 90)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 90) AND (area < 110)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 110) AND (area < 130)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 130) AND (area < 150)[0m
  [1m[35m (1.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 150) AND (area < 170)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 170) AND (area < 190)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 190) AND (area < 210)[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 210) AND (area < 230)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 230) AND (area < 250)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 250) AND (area < 270)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 270)[0m
  Rendering reports/area_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (2.5ms)
  Rendered reports/area_popularity.html.haml within layouts/application (8.0ms)
  Rendered layouts/_header.html.haml (9.3ms)
Completed 200 OK in 686ms (Views: 574.3ms | ActiveRecord: 11.9ms)


Started GET "/reports/area-popularity" for 127.0.0.1 at 2017-04-29 00:43:48 +0300
Processing by ReportsController#area_popularity as HTML
  [1m[36mUser Load (74.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (3.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed)[0m
  [1m[35m (1.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 10) AND (area < 30)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 30) AND (area < 50)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 50) AND (area < 70)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 70) AND (area < 90)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 90) AND (area < 110)[0m
  [1m[35m (1.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 110) AND (area < 130)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 130) AND (area < 150)[0m
  [1m[35m (1.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 150) AND (area < 170)[0m
  [1m[35m (3.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 170) AND (area < 190)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 190) AND (area < 210)[0m
  [1m[35m (1.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 210) AND (area < 230)[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 230) AND (area < 250)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 250) AND (area < 270)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 270)[0m
  Rendering reports/area_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (5.9ms)
  Rendered reports/area_popularity.html.haml within layouts/application (12.0ms)
  Rendered layouts/_header.html.haml (8.9ms)
Completed 200 OK in 693ms (Views: 576.3ms | ActiveRecord: 93.5ms)


Started GET "/reports/material-consumption" for 127.0.0.1 at 2017-04-29 00:43:56 +0300
Processing by ReportsController#material_consumption as HTML
  [1m[36mUser Load (13.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/material_consumption.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (3.5ms)
  [1m[36mCategory Load (1.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mPrimitive Load (2.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL[0m
  [1m[36mUnit Load (2.3ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (1.9ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 3)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (3.5ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 4)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 4)[0m
  [1m[36mUnit Load (1.4ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 5)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 5)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[35m (2.1ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (1.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 7)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 7)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 8)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 8)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 9)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 9)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 10)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 10)[0m
  Rendered reports/material_consumption.html.haml within layouts/application (143.8ms)
  Rendered layouts/_header.html.haml (13.5ms)
Completed 200 OK in 762ms (Views: 667.7ms | ActiveRecord: 87.8ms)


Started GET "/reports/material-consumption" for 127.0.0.1 at 2017-04-29 00:45:01 +0300
Processing by ReportsController#material_consumption as HTML
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/material_consumption.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (2.9ms)
  [1m[36mCategory Load (3.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mPrimitive Load (3.1ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL[0m
  [1m[36mUnit Load (3.9ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (2.4ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 3)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 4)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 4)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 5)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 5)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 7)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 7)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 8)[0m
  [1m[36mCACHE (0.3ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 8)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 9)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 9)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 10)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 10)[0m
  Rendered reports/material_consumption.html.haml within layouts/application (78.0ms)
  Rendered layouts/_header.html.haml (9.0ms)
Completed 200 OK in 1524ms (Views: 1495.4ms | ActiveRecord: 21.7ms)


Started GET "/reports/estimate-conversion" for 127.0.0.1 at 2017-04-29 00:45:28 +0300
Processing by ReportsController#estimate_conversion as HTML
  [1m[36mUser Load (2.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (1.4ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35m (1.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 21:45:28.146711')[0m  [["user_id", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 21:45:28.146711') AND (signed)[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 21:45:28.146711')[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 21:45:28.146711') AND (signed)[0m  [["user_id", 1]]
  [1m[35m (1.2ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 1]]
  [1m[35m (1.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 21:45:28.168444')[0m  [["user_id", 2]]
  [1m[35m (1.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 21:45:28.168444') AND (signed)[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 21:45:28.168444')[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 21:45:28.168444') AND (signed)[0m  [["user_id", 2]]
  [1m[35m (1.2ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 2]]
  [1m[35m (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 21:45:28.179374')[0m  [["user_id", 3]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 21:45:28.179374') AND (signed)[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 21:45:28.179374')[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 21:45:28.179374') AND (signed)[0m  [["user_id", 3]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 3]]
  Rendering reports/estimate_conversion.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (2.6ms)
  Rendered reports/estimate_conversion.html.haml within layouts/application (11.7ms)
  Rendered layouts/_header.html.haml (7.9ms)
Completed 200 OK in 580ms (Views: 521.5ms | ActiveRecord: 13.7ms)


Started GET "/reports/area-popularity" for 127.0.0.1 at 2017-04-29 00:45:30 +0300
Processing by ReportsController#area_popularity as HTML
  [1m[36mUser Load (2.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (3.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 10) AND (area < 30)[0m
  [1m[35m (1.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 30) AND (area < 50)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 50) AND (area < 70)[0m
  [1m[35m (1.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 70) AND (area < 90)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 90) AND (area < 110)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 110) AND (area < 130)[0m
  [1m[35m (3.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 130) AND (area < 150)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 150) AND (area < 170)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 170) AND (area < 190)[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 190) AND (area < 210)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 210) AND (area < 230)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 230) AND (area < 250)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 250) AND (area < 270)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 270)[0m
  Rendering reports/area_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (2.5ms)
  Rendered reports/area_popularity.html.haml within layouts/application (11.2ms)
  Rendered layouts/_header.html.haml (9.8ms)
Completed 200 OK in 586ms (Views: 549.4ms | ActiveRecord: 19.3ms)


Started GET "/reports/product-popularity" for 127.0.0.1 at 2017-04-29 00:45:32 +0300
Processing by ReportsController#product_popularity as HTML
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/product_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (6.5ms)
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mProduct Load (1.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[35m (3.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  Rendered reports/product_popularity.html.haml within layouts/application (69.9ms)
  Rendered layouts/_header.html.haml (12.4ms)
Completed 200 OK in 635ms (Views: 605.6ms | ActiveRecord: 18.6ms)


Started GET "/reports/estimate-conversion" for 127.0.0.1 at 2017-04-29 00:45:33 +0300
Processing by ReportsController#estimate_conversion as HTML
  [1m[36mUser Load (4.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (2.6ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35m (1.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 21:45:33.948858')[0m  [["user_id", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 21:45:33.948858') AND (signed)[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 21:45:33.948858')[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 21:45:33.948858') AND (signed)[0m  [["user_id", 1]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 21:45:33.969735')[0m  [["user_id", 2]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 21:45:33.969735') AND (signed)[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 21:45:33.969735')[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 21:45:33.969735') AND (signed)[0m  [["user_id", 2]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 2]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 21:45:33.981157')[0m  [["user_id", 3]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 21:45:33.981157') AND (signed)[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 21:45:33.981157')[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 21:45:33.981157') AND (signed)[0m  [["user_id", 3]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 3]]
  Rendering reports/estimate_conversion.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (2.7ms)
  Rendered reports/estimate_conversion.html.haml within layouts/application (11.7ms)
  Rendered layouts/_header.html.haml (10.4ms)
Completed 200 OK in 653ms (Views: 597.9ms | ActiveRecord: 14.4ms)


Started GET "/reports/estimate-conversion" for 127.0.0.1 at 2017-04-29 00:46:22 +0300
Processing by ReportsController#estimate_conversion as HTML
  [1m[36mUser Load (1.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (4.9ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35m (1.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 21:46:22.258495')[0m  [["user_id", 1]]
  [1m[35m (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 21:46:22.258495') AND (signed)[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 21:46:22.258495')[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 21:46:22.258495') AND (signed)[0m  [["user_id", 1]]
  [1m[35m (5.2ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 1]]
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 21:46:22.274838')[0m  [["user_id", 2]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 21:46:22.274838') AND (signed)[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 21:46:22.274838')[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 21:46:22.274838') AND (signed)[0m  [["user_id", 2]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 2]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 21:46:22.285391')[0m  [["user_id", 3]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 21:46:22.285391') AND (signed)[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 21:46:22.285391')[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 21:46:22.285391') AND (signed)[0m  [["user_id", 3]]
  [1m[35m (1.7ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 3]]
  Rendering reports/estimate_conversion.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (2.9ms)
  Rendered reports/estimate_conversion.html.haml within layouts/application (9.2ms)
  Rendered layouts/_header.html.haml (12.0ms)
Completed 200 OK in 1284ms (Views: 1235.1ms | ActiveRecord: 19.6ms)


Started GET "/reports/product-popularity" for 127.0.0.1 at 2017-04-29 00:47:01 +0300
Processing by ReportsController#product_popularity as HTML
  [1m[36mUser Load (4.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/product_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (2.6ms)
  [1m[36mCategory Load (1.1ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mProduct Load (2.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[35m (14.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  Rendered reports/product_popularity.html.haml within layouts/application (38.9ms)
  Rendered layouts/_header.html.haml (8.2ms)
Completed 200 OK in 725ms (Views: 698.4ms | ActiveRecord: 21.3ms)


Started GET "/reports/floor-popularity" for 127.0.0.1 at 2017-04-29 00:47:15 +0300
Processing by ReportsController#floor_popularity as HTML
  [1m[36mUser Load (1.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed)[0m
  [1m[35m (1.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '1')[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '1.5')[0m
  [1m[35m (2.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '2')[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '2.5')[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '3')[0m
  Rendering reports/floor_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (6.7ms)
  Rendered reports/floor_popularity.html.haml within layouts/application (12.8ms)
  Rendered layouts/_header.html.haml (21.2ms)
Completed 200 OK in 574ms (Views: 554.5ms | ActiveRecord: 7.8ms)


Started GET "/reports/area-popularity" for 127.0.0.1 at 2017-04-29 00:47:50 +0300
Processing by ReportsController#area_popularity as HTML
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (5.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed)[0m
  [1m[35m (1.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 10) AND (area < 30)[0m
  [1m[35m (1.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 30) AND (area < 50)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 50) AND (area < 70)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 70) AND (area < 90)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 90) AND (area < 110)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 110) AND (area < 130)[0m
  [1m[35m (4.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 130) AND (area < 150)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 150) AND (area < 170)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 170) AND (area < 190)[0m
  [1m[35m (1.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 190) AND (area < 210)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 210) AND (area < 230)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 230) AND (area < 250)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 250) AND (area < 270)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 270)[0m
  Rendering reports/area_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (3.9ms)
  Rendered reports/area_popularity.html.haml within layouts/application (12.7ms)
  Rendered layouts/_header.html.haml (9.7ms)
Completed 200 OK in 1310ms (Views: 1270.8ms | ActiveRecord: 20.0ms)


Started GET "/reports/area-popularity" for 127.0.0.1 at 2017-04-29 00:47:51 +0300
Processing by ReportsController#area_popularity as HTML
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed)[0m
  [1m[35m (2.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 10) AND (area < 30)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 30) AND (area < 50)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 50) AND (area < 70)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 70) AND (area < 90)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 90) AND (area < 110)[0m
  [1m[35m (1.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 110) AND (area < 130)[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 130) AND (area < 150)[0m
  [1m[35m (1.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 150) AND (area < 170)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 170) AND (area < 190)[0m
  [1m[35m (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 190) AND (area < 210)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 210) AND (area < 230)[0m
  [1m[35m (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 230) AND (area < 250)[0m
  [1m[35m (1.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 250) AND (area < 270)[0m
  [1m[35m (1.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 270)[0m
  Rendering reports/area_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (3.3ms)
  Rendered reports/area_popularity.html.haml within layouts/application (9.8ms)
  Rendered layouts/_header.html.haml (9.7ms)
Completed 200 OK in 613ms (Views: 575.5ms | ActiveRecord: 16.8ms)


Started GET "/reports/material-consumption" for 127.0.0.1 at 2017-04-29 00:49:26 +0300
Processing by ReportsController#material_consumption as HTML
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/material_consumption.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (3.0ms)
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mPrimitive Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL[0m
  [1m[36mUnit Load (1.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 3)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 4)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 4)[0m
  [1m[36mUnit Load (2.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[35m (1.4ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 5)[0m
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 5)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[35m (1.1ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 7)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 7)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 8)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 8)[0m
  [1m[36mUnit Load (1.2ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 9)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 9)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (6.2ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 10)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 10)[0m
  Rendered reports/material_consumption.html.haml within layouts/application (91.4ms)
  Rendered layouts/_header.html.haml (12.2ms)
Completed 200 OK in 706ms (Views: 680.1ms | ActiveRecord: 21.6ms)


Started GET "/reports/estimate-conversion" for 127.0.0.1 at 2017-04-29 00:51:05 +0300
Processing by ReportsController#estimate_conversion as HTML
  [1m[36mUser Load (1.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35m (1.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 21:51:05.511064')[0m  [["user_id", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 21:51:05.511064') AND (signed)[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 21:51:05.511064')[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 21:51:05.511064') AND (signed)[0m  [["user_id", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 1]]
  [1m[35m (1.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 21:51:05.522281')[0m  [["user_id", 2]]
  [1m[35m (1.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 21:51:05.522281') AND (signed)[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 21:51:05.522281')[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 21:51:05.522281') AND (signed)[0m  [["user_id", 2]]
  [1m[35m (1.3ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 2]]
  [1m[35m (1.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 21:51:05.536364')[0m  [["user_id", 3]]
  [1m[35m (2.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 21:51:05.536364') AND (signed)[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 21:51:05.536364')[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 21:51:05.536364') AND (signed)[0m  [["user_id", 3]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 3]]
  Rendering reports/estimate_conversion.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (3.4ms)
  Rendered reports/estimate_conversion.html.haml within layouts/application (28.3ms)
Completed 500 Internal Server Error in 78ms (ActiveRecord: 13.8ms)


  
ActionView::Template::Error (divided by 0):
    31:             %td= row[:user_name]
    32:             %td= row[:estimates_all]
    33:             %td= row[:estimates_signed]
    34:             %td{ data: { order: 1 / row[:conversion] } }= "1 / #{row[:conversion]}"
    35:             %td= row[:profit]
    36:             %td= row[:profit_month]
  
app/views/reports/estimate_conversion.html.haml:34:in `/'
app/views/reports/estimate_conversion.html.haml:34:in `block in _app_views_reports_estimate_conversion_html_haml___1275462049272675925_70297787368580'
app/views/reports/estimate_conversion.html.haml:29:in `each'
app/views/reports/estimate_conversion.html.haml:29:in `_app_views_reports_estimate_conversion_html_haml___1275462049272675925_70297787368580'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (6.4ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.6ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.0ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (44.3ms)
Started GET "/reports/estimate-conversion" for 127.0.0.1 at 2017-04-29 00:51:55 +0300
Processing by ReportsController#estimate_conversion as HTML
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (2.2ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35m (1.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 21:51:55.746162')[0m  [["user_id", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 21:51:55.746162') AND (signed)[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 21:51:55.746162')[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 21:51:55.746162') AND (signed)[0m  [["user_id", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 21:51:55.755583')[0m  [["user_id", 2]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 21:51:55.755583') AND (signed)[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 21:51:55.755583')[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 21:51:55.755583') AND (signed)[0m  [["user_id", 2]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 2]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 21:51:55.763403')[0m  [["user_id", 3]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 21:51:55.763403') AND (signed)[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 21:51:55.763403')[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 21:51:55.763403') AND (signed)[0m  [["user_id", 3]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 3]]
  Rendering reports/estimate_conversion.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (2.2ms)
  Rendered reports/estimate_conversion.html.haml within layouts/application (8.6ms)
Completed 500 Internal Server Error in 43ms (ActiveRecord: 9.8ms)


  
ActionView::Template::Error (divided by 0):
    31:             %td= row[:user_name]
    32:             %td= row[:estimates_all]
    33:             %td= row[:estimates_signed]
    34:             %td{ data: { order: "#{1 / row[:conversion]}" } }= "1" + row[:conversion].to_s
    35:             %td= row[:profit]
    36:             %td= row[:profit_month]
  
app/views/reports/estimate_conversion.html.haml:34:in `/'
app/views/reports/estimate_conversion.html.haml:34:in `block in _app_views_reports_estimate_conversion_html_haml___1275462049272675925_70297821613660'
app/views/reports/estimate_conversion.html.haml:29:in `each'
app/views/reports/estimate_conversion.html.haml:29:in `_app_views_reports_estimate_conversion_html_haml___1275462049272675925_70297821613660'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (6.6ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.8ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (0.9ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (31.0ms)
Started GET "/reports/estimate-conversion" for 127.0.0.1 at 2017-04-29 00:52:31 +0300
Processing by ReportsController#estimate_conversion as HTML
  [1m[36mUser Load (1.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35m (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 21:52:31.138438')[0m  [["user_id", 1]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 21:52:31.138438') AND (signed)[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 21:52:31.138438')[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 21:52:31.138438') AND (signed)[0m  [["user_id", 1]]
  [1m[35m (1.3ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 1]]
  [1m[35m (6.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 21:52:31.154056')[0m  [["user_id", 2]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 21:52:31.154056') AND (signed)[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 21:52:31.154056')[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 21:52:31.154056') AND (signed)[0m  [["user_id", 2]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 2]]
  [1m[35m (2.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 21:52:31.169280')[0m  [["user_id", 3]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 21:52:31.169280') AND (signed)[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 21:52:31.169280')[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 21:52:31.169280') AND (signed)[0m  [["user_id", 3]]
  [1m[35m (1.1ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 3]]
  Rendering reports/estimate_conversion.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (4.6ms)
  Rendered reports/estimate_conversion.html.haml within layouts/application (17.5ms)
  Rendered layouts/_header.html.haml (10.0ms)
Completed 200 OK in 1313ms (Views: 1257.4ms | ActiveRecord: 17.9ms)


Started GET "/reports/estimate-conversion?utf8=%E2%9C%93&date_start=2017-04-19&date_end=2017-04-29" for 127.0.0.1 at 2017-04-29 00:52:50 +0300
Processing by ReportsController#estimate_conversion as HTML
  Parameters: {"utf8"=>"✓", "date_start"=>"2017-04-19", "date_end"=>"2017-04-29"}
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (1.8ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35m (1.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2016-12-30 21:00:00') AND (signing_date <= '2017-01-01 21:00:00')[0m  [["user_id", 1]]
  [1m[35m (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2016-12-30 21:00:00') AND (signing_date <= '2017-01-01 21:00:00') AND (signed)[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2016-12-30 21:00:00') AND (signing_date <= '2017-01-01 21:00:00')[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2016-12-30 21:00:00') AND (signing_date <= '2017-01-01 21:00:00') AND (signed)[0m  [["user_id", 1]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 1]]
  [1m[35m (4.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2016-12-30 21:00:00') AND (signing_date <= '2017-01-01 21:00:00')[0m  [["user_id", 2]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2016-12-30 21:00:00') AND (signing_date <= '2017-01-01 21:00:00') AND (signed)[0m  [["user_id", 2]]
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2016-12-30 21:00:00') AND (signing_date <= '2017-01-01 21:00:00')[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2016-12-30 21:00:00') AND (signing_date <= '2017-01-01 21:00:00') AND (signed)[0m  [["user_id", 2]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 2]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2016-12-30 21:00:00') AND (signing_date <= '2017-01-01 21:00:00')[0m  [["user_id", 3]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2016-12-30 21:00:00') AND (signing_date <= '2017-01-01 21:00:00') AND (signed)[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2016-12-30 21:00:00') AND (signing_date <= '2017-01-01 21:00:00')[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2016-12-30 21:00:00') AND (signing_date <= '2017-01-01 21:00:00') AND (signed)[0m  [["user_id", 3]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 3]]
  Rendering reports/estimate_conversion.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (3.3ms)
  Rendered reports/estimate_conversion.html.haml within layouts/application (9.9ms)
  Rendered layouts/_header.html.haml (12.1ms)
Completed 200 OK in 603ms (Views: 558.5ms | ActiveRecord: 13.8ms)


Started GET "/reports/material-consumption" for 127.0.0.1 at 2017-04-29 01:08:37 +0300
Processing by ReportsController#material_consumption as HTML
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/material_consumption.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (6.0ms)
  [1m[36mCategory Load (1.1ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mPrimitive Load (1.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (1.9ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 3)[0m
  [1m[36mUnit Load (1.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (1.5ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 4)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 4)[0m
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 5)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 5)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 7)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 7)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 8)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 8)[0m
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 9)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 9)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 10)[0m
  [1m[36mCACHE (1.8ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 10)[0m
  Rendered reports/material_consumption.html.haml within layouts/application (77.0ms)
  Rendered layouts/_header.html.haml (10.2ms)
Completed 200 OK in 602ms (Views: 580.2ms | ActiveRecord: 16.5ms)


Started GET "/reports/material-consumption?utf8=%E2%9C%93&name=%D0%9F%D1%80%D0%B8&category=&date_start=2017-04-29&date_end=2017-04-29" for 127.0.0.1 at 2017-04-29 01:08:45 +0300
Processing by ReportsController#material_consumption as HTML
  Parameters: {"utf8"=>"✓", "name"=>"При", "category"=>"", "date_start"=>"2017-04-29", "date_end"=>"2017-04-29"}
  [1m[36mUser Load (2.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/material_consumption.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (2.8ms)
  [1m[36mCategory Load (1.9ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mPrimitive Load (9.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL[0m
  [1m[36mUnit Load (1.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (2.2ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 3)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 4)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 4)[0m
  [1m[36mUnit Load (2.3ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 5)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 5)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 7)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 7)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 8)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 8)[0m
  [1m[36mUnit Load (1.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 9)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 9)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (1.2ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 10)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 10)[0m
  Rendered reports/material_consumption.html.haml within layouts/application (79.6ms)
  Rendered layouts/_header.html.haml (9.5ms)
Completed 200 OK in 653ms (Views: 621.5ms | ActiveRecord: 27.8ms)


Started GET "/reports/material-consumption?utf8=%E2%9C%93&name=%D0%9F%D1%80%D0%B8%D0%BC%D0%B8%D1%82%D0%B8%D0%B2+10&category=&date_start=2017-04-29&date_end=2017-04-29" for 127.0.0.1 at 2017-04-29 01:08:52 +0300
Processing by ReportsController#material_consumption as HTML
  Parameters: {"utf8"=>"✓", "name"=>"Примитив 10", "category"=>"", "date_start"=>"2017-04-29", "date_end"=>"2017-04-29"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/material_consumption.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (6.2ms)
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mPrimitive Load (1.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."type" IN ('Primitive') AND "constructor_objects"."deleted_at" IS NULL[0m
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (2.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 3)[0m
  [1m[36mUnit Load (1.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (2.8ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 4)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 4)[0m
  [1m[36mUnit Load (1.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[35m (1.7ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 5)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 5)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[35m (1.3ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (1.6ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 7)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 7)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 8)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 8)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 9)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 9)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 10)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("report_primitives"."amount") FROM "report_primitives" WHERE (constructor_object_id = 10)[0m
  Rendered reports/material_consumption.html.haml within layouts/application (79.2ms)
  Rendered layouts/_header.html.haml (11.5ms)
Completed 200 OK in 644ms (Views: 616.9ms | ActiveRecord: 20.0ms)


Started GET "/reports/product-popularity" for 127.0.0.1 at 2017-04-29 01:08:56 +0300
Processing by ReportsController#product_popularity as HTML
  [1m[36mUser Load (1.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/product_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (4.0ms)
  [1m[36mCategory Load (1.8ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mProduct Load (2.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[35m (5.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed)[0m
  Rendered reports/product_popularity.html.haml within layouts/application (28.2ms)
  Rendered layouts/_header.html.haml (9.5ms)
Completed 200 OK in 610ms (Views: 584.4ms | ActiveRecord: 11.4ms)


Started GET "/reports/product-popularity?utf8=%E2%9C%93&name=%D0%9A%D0%BE%D0%BD&category=&date_start=2017-04-29&date_end=2017-04-29" for 127.0.0.1 at 2017-04-29 01:09:02 +0300
Processing by ReportsController#product_popularity as HTML
  Parameters: {"utf8"=>"✓", "name"=>"Кон", "category"=>"", "date_start"=>"2017-04-29", "date_end"=>"2017-04-29"}
  [1m[36mUser Load (3.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/product_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (3.0ms)
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mProduct Load (12.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND (name ILIKE '%Кон%')[0m
  [1m[35m (6.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed) AND (estimates.signing_date > '2017-04-29') AND (estimates.signing_date < '2017-04-29')[0m
  Rendered reports/product_popularity.html.haml within layouts/application (39.3ms)
  Rendered layouts/_header.html.haml (8.3ms)
Completed 200 OK in 620ms (Views: 591.0ms | ActiveRecord: 23.5ms)


Started GET "/reports/product-popularity?utf8=%E2%9C%93&name=&category=&date_start=2017-04-29&date_end=2017-04-29" for 127.0.0.1 at 2017-04-29 01:09:08 +0300
Processing by ReportsController#product_popularity as HTML
  Parameters: {"utf8"=>"✓", "name"=>"", "category"=>"", "date_start"=>"2017-04-29", "date_end"=>"2017-04-29"}
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/product_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (2.8ms)
  [1m[36mCategory Load (1.3ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mProduct Load (1.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[35m (1.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed) AND (estimates.signing_date > '2017-04-29') AND (estimates.signing_date < '2017-04-29')[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed) AND (estimates.signing_date > '2017-04-29') AND (estimates.signing_date < '2017-04-29')[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed) AND (estimates.signing_date > '2017-04-29') AND (estimates.signing_date < '2017-04-29')[0m
  Rendered reports/product_popularity.html.haml within layouts/application (18.9ms)
  Rendered layouts/_header.html.haml (9.7ms)
Completed 200 OK in 546ms (Views: 536.8ms | ActiveRecord: 4.9ms)


Started GET "/reports/product-popularity?utf8=%E2%9C%93&name=&category=1&date_start=2017-04-29&date_end=2017-04-29" for 127.0.0.1 at 2017-04-29 01:09:11 +0300
Processing by ReportsController#product_popularity as HTML
  Parameters: {"utf8"=>"✓", "name"=>"", "category"=>"1", "date_start"=>"2017-04-29", "date_end"=>"2017-04-29"}
  [1m[36mUser Load (7.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/product_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (3.1ms)
  [1m[36mCategory Load (5.9ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mProduct Load (1.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[35m (5.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed) AND (estimates.signing_date > '2017-04-29') AND (estimates.signing_date < '2017-04-29')[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed) AND (estimates.signing_date > '2017-04-29') AND (estimates.signing_date < '2017-04-29')[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed) AND (estimates.signing_date > '2017-04-29') AND (estimates.signing_date < '2017-04-29')[0m
  Rendered reports/product_popularity.html.haml within layouts/application (35.1ms)
  Rendered layouts/_header.html.haml (11.9ms)
Completed 200 OK in 627ms (Views: 601.5ms | ActiveRecord: 19.9ms)


Started GET "/reports/product-popularity?utf8=%E2%9C%93&name=&category=2&date_start=2017-04-29&date_end=2017-04-29" for 127.0.0.1 at 2017-04-29 01:09:14 +0300
Processing by ReportsController#product_popularity as HTML
  Parameters: {"utf8"=>"✓", "name"=>"", "category"=>"2", "date_start"=>"2017-04-29", "date_end"=>"2017-04-29"}
  [1m[36mUser Load (2.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/product_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (2.4ms)
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mProduct Load (4.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[35m (1.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed) AND (estimates.signing_date > '2017-04-29') AND (estimates.signing_date < '2017-04-29')[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed) AND (estimates.signing_date > '2017-04-29') AND (estimates.signing_date < '2017-04-29')[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed) AND (estimates.signing_date > '2017-04-29') AND (estimates.signing_date < '2017-04-29')[0m
  Rendered reports/product_popularity.html.haml within layouts/application (24.4ms)
  Rendered layouts/_header.html.haml (9.5ms)
Completed 200 OK in 559ms (Views: 537.8ms | ActiveRecord: 8.4ms)


Started GET "/reports/product-popularity?utf8=%E2%9C%93&name=&category=4&date_start=2017-04-29&date_end=2017-04-29" for 127.0.0.1 at 2017-04-29 01:09:17 +0300
Processing by ReportsController#product_popularity as HTML
  Parameters: {"utf8"=>"✓", "name"=>"", "category"=>"4", "date_start"=>"2017-04-29", "date_end"=>"2017-04-29"}
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering reports/product_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (2.8ms)
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL[0m
  [1m[35m (3.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed) AND (estimates.signing_date > '2017-04-29') AND (estimates.signing_date < '2017-04-29')[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed) AND (estimates.signing_date > '2017-04-29') AND (estimates.signing_date < '2017-04-29')[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "stage_products" INNER JOIN "stages" ON "stages"."id" = "stage_products"."stage_id" INNER JOIN "estimates" ON "estimates"."id" = "stages"."estimate_id" AND "estimates"."deleted_at" IS NULL WHERE (estimates.signed) AND (estimates.signing_date > '2017-04-29') AND (estimates.signing_date < '2017-04-29')[0m
  Rendered reports/product_popularity.html.haml within layouts/application (24.7ms)
  Rendered layouts/_header.html.haml (8.9ms)
Completed 200 OK in 623ms (Views: 613.0ms | ActiveRecord: 5.8ms)


Started GET "/reports/estimate-conversion" for 127.0.0.1 at 2017-04-29 01:09:51 +0300
Processing by ReportsController#estimate_conversion as HTML
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (4.3ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 22:09:51.154201')[0m  [["user_id", 1]]
  [1m[35m (2.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 22:09:51.154201') AND (signed)[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 22:09:51.154201')[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.489259') AND (signing_date <= '2017-04-29 22:09:51.154201') AND (signed)[0m  [["user_id", 1]]
  [1m[35m (1.6ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 22:09:51.172702')[0m  [["user_id", 2]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 22:09:51.172702') AND (signed)[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 22:09:51.172702')[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.677787') AND (signing_date <= '2017-04-29 22:09:51.172702') AND (signed)[0m  [["user_id", 2]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 2]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 22:09:51.181933')[0m  [["user_id", 3]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 22:09:51.181933') AND (signed)[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 22:09:51.181933')[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signing_date >= '2017-04-24 22:08:59.827398') AND (signing_date <= '2017-04-29 22:09:51.181933') AND (signed)[0m  [["user_id", 3]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 3]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT SUM("estimates"."price") FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND "estimates"."user_id" = $1 AND (signed)[0m  [["user_id", 3]]
  Rendering reports/estimate_conversion.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (4.0ms)
  Rendered reports/estimate_conversion.html.haml within layouts/application (11.6ms)
  Rendered layouts/_header.html.haml (8.1ms)
Completed 200 OK in 573ms (Views: 523.7ms | ActiveRecord: 13.6ms)


Started GET "/reports/area-popularity" for 127.0.0.1 at 2017-04-29 01:09:54 +0300
Processing by ReportsController#area_popularity as HTML
  [1m[36mUser Load (2.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed)[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 10) AND (area < 30)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 30) AND (area < 50)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 50) AND (area < 70)[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 70) AND (area < 90)[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 90) AND (area < 110)[0m
  [1m[35m (5.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 110) AND (area < 130)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 130) AND (area < 150)[0m
  [1m[35m (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 150) AND (area < 170)[0m
  [1m[35m (3.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 170) AND (area < 190)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 190) AND (area < 210)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 210) AND (area < 230)[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 230) AND (area < 250)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 250) AND (area < 270)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 270)[0m
  Rendering reports/area_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (2.9ms)
  Rendered reports/area_popularity.html.haml within layouts/application (9.6ms)
  Rendered layouts/_header.html.haml (8.6ms)
Completed 200 OK in 552ms (Views: 511.0ms | ActiveRecord: 21.5ms)


Started GET "/reports/floor-popularity" for 127.0.0.1 at 2017-04-29 01:09:56 +0300
Processing by ReportsController#floor_popularity as HTML
  [1m[36mUser Load (1.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '1')[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '1.5')[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '2')[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '2.5')[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '3')[0m
  Rendering reports/floor_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (2.4ms)
  Rendered reports/floor_popularity.html.haml within layouts/application (8.8ms)
  Rendered layouts/_header.html.haml (12.0ms)
Completed 200 OK in 579ms (Views: 562.1ms | ActiveRecord: 5.8ms)


Started GET "/reports/area-popularity" for 127.0.0.1 at 2017-04-29 01:09:58 +0300
Processing by ReportsController#area_popularity as HTML
  [1m[36mUser Load (1.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (3.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed)[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 10) AND (area < 30)[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 30) AND (area < 50)[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 50) AND (area < 70)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 70) AND (area < 90)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 90) AND (area < 110)[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 110) AND (area < 130)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 130) AND (area < 150)[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 150) AND (area < 170)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 170) AND (area < 190)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 190) AND (area < 210)[0m
  [1m[35m (1.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 210) AND (area < 230)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 230) AND (area < 250)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 250) AND (area < 270)[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (area >= 270)[0m
  Rendering reports/area_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (3.9ms)
  Rendered reports/area_popularity.html.haml within layouts/application (45.3ms)
  Rendered layouts/_header.html.haml (10.7ms)
Completed 200 OK in 615ms (Views: 574.1ms | ActiveRecord: 15.4ms)


Started GET "/reports/floor-popularity" for 127.0.0.1 at 2017-04-29 01:10:00 +0300
Processing by ReportsController#floor_popularity as HTML
  [1m[36mUser Load (1.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (2.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed)[0m
  [1m[35m (1.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '1')[0m
  [1m[35m (3.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '1.5')[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '2')[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '2.5')[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '3')[0m
  Rendering reports/floor_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (7.6ms)
  Rendered reports/floor_popularity.html.haml within layouts/application (14.2ms)
  Rendered layouts/_header.html.haml (10.0ms)
Completed 200 OK in 640ms (Views: 619.5ms | ActiveRecord: 10.8ms)


Started GET "/reports/floor-popularity" for 127.0.0.1 at 2017-04-29 01:10:02 +0300
Processing by ReportsController#floor_popularity as HTML
  [1m[36mUser Load (3.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '1')[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '1.5')[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '2')[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '2.5')[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '3')[0m
  Rendering reports/floor_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (3.1ms)
  Rendered reports/floor_popularity.html.haml within layouts/application (10.2ms)
  Rendered layouts/_header.html.haml (8.0ms)
Completed 200 OK in 518ms (Views: 499.6ms | ActiveRecord: 7.2ms)


Started GET "/reports/floor-popularity" for 127.0.0.1 at 2017-04-29 01:10:15 +0300
Processing by ReportsController#floor_popularity as HTML
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed)[0m
  [1m[35m (1.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '1')[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '1.5')[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '2')[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '2.5')[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "estimates" WHERE "estimates"."deleted_at" IS NULL AND (signed) AND (floors = '3')[0m
  Rendering reports/floor_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (4.4ms)
  Rendered reports/floor_popularity.html.haml within layouts/application (9.5ms)
  Rendered layouts/_header.html.haml (9.3ms)
Completed 200 OK in 621ms (Views: 597.7ms | ActiveRecord: 5.9ms)


DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
  [1m[35m (1.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(6572146483646705745);[0m
  [1m[36mActiveRecord::SchemaMigration Load (2.4ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Migrating to RenameEstimatesTable (20170428235151)
  [1m[35m (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (8.2ms)[0m  [1m[35mALTER TABLE "estimates" RENAME TO "budgets"[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "public"."estimates_id_seq" RENAME TO "budgets_id_seq"[0m
  [1m[35m (5.2ms)[0m  [1m[35mALTER INDEX "estimates_pkey" RENAME TO "budgets_pkey"[0m
  [1m[35m (1.8ms)[0m  [1m[35mALTER INDEX "index_estimates_on_client_id" RENAME TO "index_budgets_on_client_id"[0m
  [1m[35m (3.0ms)[0m  [1m[35mALTER TABLE "budgets" ADD "type" character varying[0m
  [1m[35m (47.2ms)[0m  [1m[35mALTER TABLE "budgets" ADD "proposed" boolean DEFAULT 'f'[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "budgets" ADD "proposer_id" integer[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "stages" RENAME COLUMN "estimate_id" TO "budget_id"[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER INDEX "index_stages_on_estimate_id" RENAME TO "index_stages_on_budget_id"[0m
  [1m[35mSQL (1.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20170428235151"]]
  [1m[35m (6.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (4.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT pg_advisory_unlock(6572146483646705745)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
Started GET "/reports/floor-popularity" for 127.0.0.1 at 2017-04-29 03:06:56 +0300
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Processing by ReportsController#floor_popularity as HTML
  [1m[36mUser Load (2.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (1.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."type" IN ('Estimate') AND "budgets"."deleted_at" IS NULL AND (signed)[0m
  [1m[35m (1.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."type" IN ('Estimate') AND "budgets"."deleted_at" IS NULL AND (signed) AND (floors = '1')[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."type" IN ('Estimate') AND "budgets"."deleted_at" IS NULL AND (signed) AND (floors = '1.5')[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."type" IN ('Estimate') AND "budgets"."deleted_at" IS NULL AND (signed) AND (floors = '2')[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."type" IN ('Estimate') AND "budgets"."deleted_at" IS NULL AND (signed) AND (floors = '2.5')[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."type" IN ('Estimate') AND "budgets"."deleted_at" IS NULL AND (signed) AND (floors = '3')[0m
  Rendering reports/floor_popularity.html.haml within layouts/application
  Rendered reports/_header_reports.html.haml (12.7ms)
  Rendered reports/floor_popularity.html.haml within layouts/application (23.7ms)
  Rendered layouts/_header.html.haml (12.5ms)
Completed 200 OK in 2950ms (Views: 2774.3ms | ActiveRecord: 18.4ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-29 03:07:05 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Redirected to http://localhost:3000/clients
Completed 302 Found in 12ms (ActiveRecord: 0.9ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-29 03:07:05 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (4.2ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2)[0m
  [1m[36mEstimate Load (1.4ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" IN (1, 2)[0m
  [1m[35m (1.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (12.9ms)
  [1m[35m (1.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (6.7ms)
  Rendered clients/_table.html.haml (29.9ms)
  [1m[36mUserClient Load (2.0ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (116.1ms)
  Rendered layouts/_header.html.haml (9.8ms)
Completed 200 OK in 735ms (Views: 702.6ms | ActiveRecord: 20.0ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-29 03:08:46 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.6ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/index.html.haml within layouts/application (6.4ms)
  Rendered layouts/_header.html.haml (58.1ms)
Completed 200 OK in 679ms (Views: 594.6ms | ActiveRecord: 15.3ms)


Started GET "/estimates/new?client_id=1" for 127.0.0.1 at 2017-04-29 03:09:00 +0300
Processing by EstimatesController#new as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mProduct Load (2.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (5.5ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (2.3ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (5.9ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (1.4ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (1.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (2.8ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (2.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_form.html.haml (81.1ms)
  Rendered estimates/new.html.haml within layouts/application (84.0ms)
Completed 500 Internal Server Error in 419ms (ActiveRecord: 83.4ms)


  
ActionView::Template::Error (unknown attribute 'budget_id' for ClientFile.):
    63:           /    Выберите файл
    64: 
    65:           %div{ style: 'dislpay: none' }
    66:             = link_to_add_association '', f, :client_files, id: 'create-file', 'data-association-insertion-method': 'append', 'data-association-insertion-node': '#client-files'
    67: 
    68:         .form-group
    69:           %label.col-sm-3.control-label
  
app/views/estimates/_form.html.haml:66:in `block in _app_views_estimates__form_html_haml___817967257950161143_70133060257500'
app/views/estimates/_form.html.haml:1:in `_app_views_estimates__form_html_haml___817967257950161143_70133060257500'
app/views/estimates/new.html.haml:8:in `_app_views_estimates_new_html_haml___2482512944591397113_70133060473980'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (19.1ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (3.2ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.6ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (54.7ms)
DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT pg_try_advisory_lock(6572146483646705745);[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Migrating to RenameEstimatesTable (20170428235151)
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "stages" RENAME COLUMN "budget_id" TO "estimate_id"[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER INDEX "index_stages_on_budget_id" RENAME TO "index_stages_on_estimate_id"[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "budgets" DROP "proposer_id"[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "budgets" DROP "proposed"[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "budgets" DROP "type"[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "budgets" RENAME TO "estimates"[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "public"."budgets_id_seq" RENAME TO "estimates_id_seq"[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER INDEX "budgets_pkey" RENAME TO "estimates_pkey"[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER INDEX "index_budgets_on_client_id" RENAME TO "index_estimates_on_client_id"[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "schema_migrations" WHERE "schema_migrations"."version" = $1[0m  [["version", "20170428235151"]]
  [1m[35m (8.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT pg_advisory_unlock(6572146483646705745)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT pg_try_advisory_lock(6572146483646705745);[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.3ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Migrating to RenameEstimatesTable (20170428235151)
  [1m[35m (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "estimates" RENAME TO "budgets"[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "public"."estimates_id_seq" RENAME TO "budgets_id_seq"[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER INDEX "estimates_pkey" RENAME TO "budgets_pkey"[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER INDEX "index_estimates_on_client_id" RENAME TO "index_budgets_on_client_id"[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "budgets" ADD "type" character varying[0m
  [1m[35m (18.7ms)[0m  [1m[35mALTER TABLE "budgets" ADD "proposed" boolean DEFAULT 'f'[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "budgets" ADD "proposer_id" integer[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "stages" RENAME COLUMN "estimate_id" TO "budget_id"[0m
  [1m[35m (6.1ms)[0m  [1m[35mALTER INDEX "index_stages_on_estimate_id" RENAME TO "index_stages_on_budget_id"[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "client_files" RENAME COLUMN "estimate_id" TO "budget_id"[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER INDEX "index_client_files_on_estimate_id" RENAME TO "index_client_files_on_budget_id"[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "technical_files" RENAME COLUMN "estimate_id" TO "budget_id"[0m
  [1m[35m (3.1ms)[0m  [1m[35mALTER INDEX "index_technical_files_on_estimate_id" RENAME TO "index_technical_files_on_budget_id"[0m
  [1m[35mSQL (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20170428235151"]]
  [1m[35m (3.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT pg_advisory_unlock(6572146483646705745)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
Started GET "/estimates/new?client_id=1" for 127.0.0.1 at 2017-04-29 03:16:53 +0300
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Processing by EstimatesController#new as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (2.4ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (2.3ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.9ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (1.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (3.4ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.7ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (678.0ms)
  Rendered estimates/_technical_file_fields.html.haml (10.1ms)
  Rendered estimates/_discount.html.haml (10.7ms)
  Rendered estimates/_stages.html.haml (38.8ms)
  Rendered estimates/_form.html.haml (852.6ms)
  Rendered estimates/new.html.haml within layouts/application (865.1ms)
  Rendered layouts/_header.html.haml (22.6ms)
Completed 200 OK in 2539ms (Views: 2059.6ms | ActiveRecord: 86.9ms)


Started POST "/estimates" for 127.0.0.1 at 2017-04-29 03:17:15 +0300
Processing by EstimatesController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"CYQVY+Sy6At4oCdAAh3qM1ZgGK4ptuS5KdwhONSB9poMaR01+7FC0zUp+GR8ZmnlYv47nbKeO8e4zw4rZduV5A==", "commit"=>"Сохранить", "estimate"=>{"price"=>"3013.5", "name"=>"123", "client_id"=>"1", "area"=>"1", "first_floor_height"=>"23", "second_floor_height_min"=>"0.0", "second_floor_height_max"=>"0.0", "third_floor_height_min"=>"0.0", "third_floor_height_max"=>"0.0", "discount_title"=>"", "discount_by_stages"=>{"0"=>"0", "1"=>"0", "2"=>"0"}}, "json_stages"=>"[{\"number\":1,\"text\":{\"name\":\"Первый этап\",\"summ\":\"Итого по первому этапу:\",\"summ_dis\":\"по первому этапу\",\"discount\":\"Итого по первому этапу со скидкой:\"},\"products\":[{\"id\":1,\"name\":\"Простой продукт 1 этап\",\"unit\":\"шт\",\"custom\":false,\"sets\":[],\"profit\":100,\"price_with_work\":70,\"price_without_work\":10,\"$$hashKey\":\"object:14\",\"quantity\":\"21\",\"with_work\":true,\"price\":143.5}],\"price\":3013.5,\"total_price\":3013.5,\"aggregated_price\":3013.5,\"$$hashKey\":\"object:3\"},{\"number\":2,\"text\":{\"name\":\"Второй этап\",\"summ\":\"Итого по двум этапам:\",\"summ_dis\":\"по второму этапу\",\"discount\":\"Итого по двум этапам со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":3013.5,\"$$hashKey\":\"object:4\"},{\"number\":3,\"text\":{\"name\":\"Третий этап\",\"summ\":\"Итого по трем этапам:\",\"summ_dis\":\"по третьему этапу\",\"discount\":\"Итого по трем этапам со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":3013.5,\"$$hashKey\":\"object:5\"}]", "data"=>""}
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.1ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (2.9ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Unpermitted parameters: second_floor_height_min, second_floor_height_max, third_floor_height_min, third_floor_height_max, discount_by_stages
  [1m[35m (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (3.1ms)[0m  [1m[32mINSERT INTO "budgets" ("name", "client_id", "first_floor_height", "price", "area", "discount_title", "discount_by_stages", "created_at", "updated_at", "type") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "123"], ["client_id", 1], ["first_floor_height", #<BigDecimal:7f74f2c2b820,'0.23E2',9(18)>], ["price", #<BigDecimal:7f74f2c2ba00,'0.30135E4',18(18)>], ["area", #<BigDecimal:7f74f2c2b910,'0.1E1',9(18)>], ["discount_title", ""], ["discount_by_stages", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f74f0dc12b8 "decimal[]"  elements_type=nil needs quotation>, values=["0", "0", "0"]>], ["created_at", 2017-04-29 00:17:16 UTC], ["updated_at", 2017-04-29 00:17:16 UTC], ["type", "Estimate"]]
  [1m[36mAudited::Audit Load (5.8ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 10], ["auditable_type", "Budget"], ["LIMIT", 1]]
  [1m[35mSQL (1.8ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 10], ["auditable_type", "Budget"], ["user_id", 1], ["user_type", "User"], ["action", "create"], ["audited_changes", "---\nname: '123'\nclient_id: 1\nfloors: \nfirst_floor_height: !ruby/object:BigDecimal 18:0.23E2\nsecond_floor_height_min: !ruby/object:BigDecimal 18:0.0\nsecond_floor_height_max: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_min: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_max: !ruby/object:BigDecimal 18:0.0\nprice: !ruby/object:BigDecimal 18:0.30135E4\narea: !ruby/object:BigDecimal 18:0.1E1\nprice_by_area: \nprice_by_stage:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_area_per_stage:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\ndiscount_title: ''\ndiscount_by_stages:\n- '0'\n- '0'\n- '0'\ndiscount_amount:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated_discounted:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_area_per_stage_discounted:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nsigned: false\ndeleted_at: \nsigning_date: \nuser_id: \nproposed: false\nproposer_id: \n"], ["version", 1], ["remote_address", "127.0.0.1"], ["request_uuid", "62c8b3ac-5e6c-46ba-a11f-50346b4e43c7"], ["created_at", 2017-04-29 00:17:16 UTC]]
  [1m[35m (1.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (2.7ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."budget_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["budget_id", 10], ["number", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (1.8ms)[0m  [1m[32mINSERT INTO "stages" ("budget_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["budget_id", 10], ["number", 1], ["price", #<BigDecimal:7f74f132b618,'0.30135E4',18(36)>], ["total_price", #<BigDecimal:7f74f132b438,'0.30135E4',18(36)>], ["created_at", 2017-04-29 00:17:16 UTC], ["updated_at", 2017-04-29 00:17:16 UTC]]
  [1m[35m (1.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (3.1ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND ("stage_products"."product_id" != 1)[0m  [["stage_id", 23]]
  [1m[36mStageProduct Load (2.3ms)[0m  [1m[34mSELECT  "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND "stage_products"."product_id" = $2 LIMIT $3[0m  [["stage_id", 23], ["product_id", 1], ["LIMIT", 1]]
  [1m[35m (1.7ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (2.8ms)[0m  [1m[32mINSERT INTO "stage_products" ("product_id", "stage_id", "quantity", "price_with_work", "created_at", "updated_at", "price_without_work") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["product_id", 1], ["stage_id", 23], ["quantity", 21], ["price_with_work", #<BigDecimal:7f74f2c11da8,'0.7E2',9(27)>], ["created_at", 2017-04-29 00:17:16 UTC], ["updated_at", 2017-04-29 00:17:16 UTC], ["price_without_work", #<BigDecimal:7f74f2c11330,'0.1E2',9(27)>]]
  [1m[35m (1.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."budget_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["budget_id", 10], ["number", 2], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (1.3ms)[0m  [1m[32mINSERT INTO "stages" ("budget_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["budget_id", 10], ["number", 2], ["price", #<BigDecimal:7f74f2c34f88,'0.0',9(27)>], ["total_price", #<BigDecimal:7f74f2c34ee8,'0.0',9(18)>], ["created_at", 2017-04-29 00:17:16 UTC], ["updated_at", 2017-04-29 00:17:16 UTC]]
  [1m[35m (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (1.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND (1=1)[0m  [["stage_id", 24]]
  [1m[36mStage Load (1.5ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."budget_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["budget_id", 10], ["number", 3], ["LIMIT", 1]]
  [1m[35m (1.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "stages" ("budget_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["budget_id", 10], ["number", 3], ["price", #<BigDecimal:7f74f2c68400,'0.0',9(27)>], ["total_price", #<BigDecimal:7f74f2c68360,'0.0',9(18)>], ["created_at", 2017-04-29 00:17:16 UTC], ["updated_at", 2017-04-29 00:17:16 UTC]]
  [1m[35m (1.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND (1=1)[0m  [["stage_id", 25]]
  [1m[35m (0.8ms)[0m  [1m[35mBEGIN[0m
  [1m[36mAudited::Audit Load (1.3ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 10], ["auditable_type", "Budget"], ["LIMIT", 1]]
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 10], ["auditable_type", "Budget"], ["user_id", 1], ["user_type", "User"], ["action", "update"], ["audited_changes", "---\nfloors:\n- \n- !ruby/object:BigDecimal 18:0.1E1\nprice_by_area:\n- \n- !ruby/object:BigDecimal 18:0.30135E4\nprice_by_stage:\n- - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n- - !ruby/object:BigDecimal 27:0.30135E4\n  - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated:\n- - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n- - !ruby/object:BigDecimal 27:0.30135E4\n  - !ruby/object:BigDecimal 18:0.30135E4\n  - !ruby/object:BigDecimal 18:0.30135E4\nprice_by_area_per_stage:\n- - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n- - !ruby/object:BigDecimal 18:0.30135E4\n  - !ruby/object:BigDecimal 18:0.30135E4\n  - !ruby/object:BigDecimal 18:0.30135E4\nprice_by_stage_aggregated_discounted:\n- - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n- - !ruby/object:BigDecimal 18:0.30135E4\n  - !ruby/object:BigDecimal 18:0.30135E4\n  - !ruby/object:BigDecimal 18:0.30135E4\nprice_by_area_per_stage_discounted:\n- - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n- - !ruby/object:BigDecimal 18:0.30135E4\n  - !ruby/object:BigDecimal 18:0.30135E4\n  - !ruby/object:BigDecimal 18:0.30135E4\n"], ["version", 2], ["remote_address", "127.0.0.1"], ["request_uuid", "62c8b3ac-5e6c-46ba-a11f-50346b4e43c7"], ["created_at", 2017-04-29 00:17:16 UTC]]
  [1m[35mSQL (1.0ms)[0m  [1m[33mUPDATE "budgets" SET "floors" = $1, "price_by_area" = $2, "price_by_stage" = $3, "price_by_stage_aggregated" = $4, "price_by_area_per_stage" = $5, "price_by_stage_aggregated_discounted" = $6, "price_by_area_per_stage_discounted" = $7, "updated_at" = $8 WHERE "budgets"."id" = $9[0m  [["floors", #<BigDecimal:7f74f2c98a10,'0.1E1',9(27)>], ["price_by_area", #<BigDecimal:7f74f2c98970,'0.30135E4',18(27)>], ["price_by_stage", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f74f0dc12b8 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f74f2c9bf58,'0.30135E4',18(36)>, #<BigDecimal:7f74f2c9bda0,'0.0',9(27)>, #<BigDecimal:7f74f2c9bd28,'0.0',9(27)>]>], ["price_by_stage_aggregated", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f74f0dc12b8 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f74f2c9bf58,'0.30135E4',18(36)>, #<BigDecimal:7f74f2c9bcb0,'0.30135E4',18(27)>, #<BigDecimal:7f74f2c9bc60,'0.30135E4',18(27)>]>], ["price_by_area_per_stage", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f74f0dc12b8 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f74f2c9b9e0,'0.30135E4',18(27)>, #<BigDecimal:7f74f2c9b030,'0.30135E4',18(27)>, #<BigDecimal:7f74f2c9aae0,'0.30135E4',18(27)>]>], ["price_by_stage_aggregated_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f74f0dc12b8 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f74f2c9b350,'0.30135E4',18(27)>, #<BigDecimal:7f74f2c9ad10,'0.30135E4',18(27)>, #<BigDecimal:7f74f2c9a7c0,'0.30135E4',18(27)>]>], ["price_by_area_per_stage_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f74f0dc12b8 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f74f2c9b170,'0.30135E4',18(27)>, #<BigDecimal:7f74f2c9ac20,'0.30135E4',18(27)>, #<BigDecimal:7f74f2c9a6d0,'0.30135E4',18(27)>]>], ["updated_at", 2017-04-29 00:17:16 UTC], ["id", 10]]
  [1m[35m (5.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.0ms)[0m  [1m[35mCOMMIT[0m
Redirected to http://localhost:3000/estimates?client_id=1
Completed 302 Found in 395ms (ActiveRecord: 83.5ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-29 03:17:16 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (1.6ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (2.4ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (4.1ms)
  [1m[36mClient Load (1.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered estimates/index.html.haml within layouts/application (56.6ms)
  Rendered layouts/_header.html.haml (9.8ms)
Completed 200 OK in 599ms (Views: 581.6ms | ActiveRecord: 7.2ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-29 03:17:21 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (3.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (1.1ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2)[0m
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" IN (1, 2)[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (10.2ms)
  [1m[35m (2.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (7.2ms)
  Rendered clients/_table.html.haml (21.7ms)
  [1m[36mUserClient Load (0.9ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (57.6ms)
  Rendered layouts/_header.html.haml (11.8ms)
Completed 200 OK in 608ms (Views: 589.9ms | ActiveRecord: 12.5ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-29 03:17:23 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (1.6ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (4.2ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (3.8ms)
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered estimates/index.html.haml within layouts/application (18.8ms)
  Rendered layouts/_header.html.haml (9.7ms)
Completed 200 OK in 661ms (Views: 643.0ms | ActiveRecord: 7.2ms)


Started POST "/estimates/10/copy" for 127.0.0.1 at 2017-04-29 03:29:59 +0300
Processing by EstimatesController#copy as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"jkRAkDV7gdVrOuyb0ToMZdMn3QZWFNqW9D4s7zjaS0OLqUjGKngrDSazM7+vQY+z57n+Nc08BehlLQP8iYAoPQ==", "name"=>"321", "client_id"=>"1", "commit"=>"Создать", "estimate_id"=>"10"}
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Estimate') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 10], ["LIMIT", 1]]
  [1m[36mStage Load (0.8ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = 10[0m
  [1m[36mClientFile Load (3.4ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = 10[0m
  [1m[36mTechnicalFile Load (2.0ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = 10[0m
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.9ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "budgets" ("name", "client_id", "floors", "first_floor_height", "price", "area", "price_by_area", "price_by_stage", "price_by_stage_aggregated", "price_by_area_per_stage", "discount_title", "price_by_stage_aggregated_discounted", "price_by_area_per_stage_discounted", "created_at", "updated_at", "type") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16) RETURNING "id"[0m  [["name", "321"], ["client_id", 1], ["floors", #<BigDecimal:7f74f07ef6f0,'0.1E1',9(18)>], ["first_floor_height", #<BigDecimal:7f74f0800c20,'0.23E2',9(18)>], ["price", #<BigDecimal:7f74f0800f18,'0.30135E4',18(18)>], ["area", #<BigDecimal:7f74f0800db0,'0.1E1',9(18)>], ["price_by_area", #<BigDecimal:7f74f07eee80,'0.30135E4',18(18)>], ["price_by_stage", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f74f0dc12b8 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f74f07eeb10,'0.30135E4',18(18)>, #<BigDecimal:7f74f07eeae8,'0.0',9(18)>, #<BigDecimal:7f74f07eeac0,'0.0',9(18)>]>], ["price_by_stage_aggregated", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f74f0dc12b8 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f74f07ee340,'0.30135E4',18(18)>, #<BigDecimal:7f74f07ee318,'0.30135E4',18(18)>, #<BigDecimal:7f74f07ee2f0,'0.30135E4',18(18)>]>], ["price_by_area_per_stage", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f74f0dc12b8 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f74f07edb70,'0.30135E4',18(18)>, #<BigDecimal:7f74f07edb48,'0.30135E4',18(18)>, #<BigDecimal:7f74f07edaf8,'0.30135E4',18(18)>]>], ["discount_title", ""], ["price_by_stage_aggregated_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f74f0dc12b8 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f74f07ec428,'0.30135E4',18(18)>, #<BigDecimal:7f74f07ec3d8,'0.30135E4',18(18)>, #<BigDecimal:7f74f07ec338,'0.30135E4',18(18)>]>], ["price_by_area_per_stage_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f74f0dc12b8 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f74f07d76b8,'0.30135E4',18(18)>, #<BigDecimal:7f74f07d7690,'0.30135E4',18(18)>, #<BigDecimal:7f74f07d75f0,'0.30135E4',18(18)>]>], ["created_at", 2017-04-29 00:29:59 UTC], ["updated_at", 2017-04-29 00:29:59 UTC], ["type", "Estimate"]]
  [1m[36mAudited::Audit Load (0.8ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 11], ["auditable_type", "Budget"], ["LIMIT", 1]]
  [1m[35mSQL (0.9ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 11], ["auditable_type", "Budget"], ["user_id", 1], ["user_type", "User"], ["action", "create"], ["audited_changes", "---\nname: '321'\nclient_id: 1\nfloors: !ruby/object:BigDecimal 18:0.1E1\nfirst_floor_height: !ruby/object:BigDecimal 18:0.23E2\nsecond_floor_height_min: !ruby/object:BigDecimal 18:0.0\nsecond_floor_height_max: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_min: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_max: !ruby/object:BigDecimal 18:0.0\nprice: !ruby/object:BigDecimal 18:0.30135E4\narea: !ruby/object:BigDecimal 18:0.1E1\nprice_by_area: !ruby/object:BigDecimal 18:0.30135E4\nprice_by_stage:\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated:\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\nprice_by_area_per_stage:\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\ndiscount_title: ''\ndiscount_by_stages:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\ndiscount_amount:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated_discounted:\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\nprice_by_area_per_stage_discounted:\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\nsigned: false\ndeleted_at: \nsigning_date: \nuser_id: \nproposed: false\nproposer_id: \n"], ["version", 1], ["remote_address", "127.0.0.1"], ["request_uuid", "1cd4dfa5-6abb-457f-81d2-77ed5a79776b"], ["created_at", 2017-04-29 00:29:59 UTC]]
  [1m[35m (3.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (1.2ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 10]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (23, 24, 25)[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "stages" ("budget_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["budget_id", 11], ["number", 1], ["price", #<BigDecimal:55a377b53748,'0.30135E4',18(18)>], ["total_price", #<BigDecimal:55a377b535b8,'0.30135E4',18(18)>], ["created_at", 2017-04-29 00:29:59 UTC], ["updated_at", 2017-04-29 00:29:59 UTC]]
  [1m[35m (1.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 23]]
  [1m[36mStageProductSet Load (2.1ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 22[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "stage_products" ("product_id", "stage_id", "quantity", "price_with_work", "created_at", "updated_at", "price_without_work") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["product_id", 1], ["stage_id", 26], ["quantity", 21], ["price_with_work", #<BigDecimal:55a377960a30,'0.7E2',9(18)>], ["created_at", 2017-04-29 00:29:59 UTC], ["updated_at", 2017-04-29 00:29:59 UTC], ["price_without_work", #<BigDecimal:55a37795a388,'0.1E2',9(18)>]]
  [1m[35m (1.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 22]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "stages" ("budget_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["budget_id", 11], ["number", 2], ["price", #<BigDecimal:55a3778e4a20,'0.0',9(18)>], ["total_price", #<BigDecimal:55a3778e49d0,'0.0',9(18)>], ["created_at", 2017-04-29 00:29:59 UTC], ["updated_at", 2017-04-29 00:29:59 UTC]]
  [1m[35m (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 24]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "stages" ("budget_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["budget_id", 11], ["number", 3], ["price", #<BigDecimal:55a377867818,'0.0',9(18)>], ["total_price", #<BigDecimal:55a3778677a0,'0.0',9(18)>], ["created_at", 2017-04-29 00:29:59 UTC], ["updated_at", 2017-04-29 00:29:59 UTC]]
  [1m[35m (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 25]]
  [1m[36mTechnicalFile Load (0.9ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 10]]
  [1m[36mClient Load (0.9ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 391ms (ActiveRecord: 70.5ms)


  
NoMethodError (undefined method `includes' for #<Client:0x0055a3777747d0>):
  
app/controllers/estimates_controller.rb:144:in `copy'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (4.7ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.5ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.5ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (31.2ms)
Started POST "/estimates/10/copy" for 127.0.0.1 at 2017-04-29 03:30:27 +0300
Processing by EstimatesController#copy as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"jkRAkDV7gdVrOuyb0ToMZdMn3QZWFNqW9D4s7zjaS0OLqUjGKngrDSazM7+vQY+z57n+Nc08BehlLQP8iYAoPQ==", "name"=>"321", "client_id"=>"1", "commit"=>"Создать", "estimate_id"=>"10"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Estimate') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 10], ["LIMIT", 1]]
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = 10[0m
  [1m[36mClientFile Load (0.4ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = 10[0m
  [1m[36mTechnicalFile Load (0.5ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = 10[0m
  [1m[36mClient Load (1.5ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (1.0ms)[0m  [1m[32mINSERT INTO "budgets" ("name", "client_id", "floors", "first_floor_height", "price", "area", "price_by_area", "price_by_stage", "price_by_stage_aggregated", "price_by_area_per_stage", "discount_title", "price_by_stage_aggregated_discounted", "price_by_area_per_stage_discounted", "created_at", "updated_at", "type") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16) RETURNING "id"[0m  [["name", "321"], ["client_id", 1], ["floors", #<BigDecimal:7f74f1185818,'0.1E1',9(18)>], ["first_floor_height", #<BigDecimal:7f74f119cbd0,'0.23E2',9(18)>], ["price", #<BigDecimal:7f74f119cef0,'0.30135E4',18(18)>], ["area", #<BigDecimal:7f74f119cdb0,'0.1E1',9(18)>], ["price_by_area", #<BigDecimal:7f74f1184e40,'0.30135E4',18(18)>], ["price_by_stage", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f74f0dc12b8 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f74f1184a80,'0.30135E4',18(18)>, #<BigDecimal:7f74f1184a08,'0.0',9(18)>, #<BigDecimal:7f74f11849e0,'0.0',9(18)>]>], ["price_by_stage_aggregated", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f74f0dc12b8 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f74f11840a8,'0.30135E4',18(18)>, #<BigDecimal:7f74f1184080,'0.30135E4',18(18)>, #<BigDecimal:7f74f1184058,'0.30135E4',18(18)>]>], ["price_by_area_per_stage", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f74f0dc12b8 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f74f11db8a8,'0.30135E4',18(18)>, #<BigDecimal:7f74f11db880,'0.30135E4',18(18)>, #<BigDecimal:7f74f11db858,'0.30135E4',18(18)>]>], ["discount_title", ""], ["price_by_stage_aggregated_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f74f0dc12b8 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f74f11d9940,'0.30135E4',18(18)>, #<BigDecimal:7f74f11d98f0,'0.30135E4',18(18)>, #<BigDecimal:7f74f11d98c8,'0.30135E4',18(18)>]>], ["price_by_area_per_stage_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f74f0dc12b8 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f74f11d91e8,'0.30135E4',18(18)>, #<BigDecimal:7f74f11d9170,'0.30135E4',18(18)>, #<BigDecimal:7f74f11d9120,'0.30135E4',18(18)>]>], ["created_at", 2017-04-29 00:30:27 UTC], ["updated_at", 2017-04-29 00:30:27 UTC], ["type", "Estimate"]]
  [1m[36mAudited::Audit Load (0.9ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 12], ["auditable_type", "Budget"], ["LIMIT", 1]]
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 12], ["auditable_type", "Budget"], ["user_id", 1], ["user_type", "User"], ["action", "create"], ["audited_changes", "---\nname: '321'\nclient_id: 1\nfloors: !ruby/object:BigDecimal 18:0.1E1\nfirst_floor_height: !ruby/object:BigDecimal 18:0.23E2\nsecond_floor_height_min: !ruby/object:BigDecimal 18:0.0\nsecond_floor_height_max: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_min: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_max: !ruby/object:BigDecimal 18:0.0\nprice: !ruby/object:BigDecimal 18:0.30135E4\narea: !ruby/object:BigDecimal 18:0.1E1\nprice_by_area: !ruby/object:BigDecimal 18:0.30135E4\nprice_by_stage:\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated:\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\nprice_by_area_per_stage:\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\ndiscount_title: ''\ndiscount_by_stages:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\ndiscount_amount:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated_discounted:\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\nprice_by_area_per_stage_discounted:\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\nsigned: false\ndeleted_at: \nsigning_date: \nuser_id: \nproposed: false\nproposer_id: \n"], ["version", 1], ["remote_address", "127.0.0.1"], ["request_uuid", "c431e437-ed5c-4ade-9b69-1016aa34f57a"], ["created_at", 2017-04-29 00:30:27 UTC]]
  [1m[35m (2.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (0.6ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 10]]
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (23, 24, 25)[0m
  [1m[35m (0.6ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (1.0ms)[0m  [1m[32mINSERT INTO "stages" ("budget_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["budget_id", 12], ["number", 1], ["price", #<BigDecimal:7f74f21f4320,'0.30135E4',18(18)>], ["total_price", #<BigDecimal:7f74f21f4258,'0.30135E4',18(18)>], ["created_at", 2017-04-29 00:30:27 UTC], ["updated_at", 2017-04-29 00:30:27 UTC]]
  [1m[35m (1.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 23]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 22[0m
  [1m[35m (0.8ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "stage_products" ("product_id", "stage_id", "quantity", "price_with_work", "created_at", "updated_at", "price_without_work") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["product_id", 1], ["stage_id", 29], ["quantity", 21], ["price_with_work", #<BigDecimal:7f74f128fc68,'0.7E2',9(18)>], ["created_at", 2017-04-29 00:30:27 UTC], ["updated_at", 2017-04-29 00:30:27 UTC], ["price_without_work", #<BigDecimal:7f74f128f038,'0.1E2',9(18)>]]
  [1m[35m (1.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 22]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "stages" ("budget_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["budget_id", 12], ["number", 2], ["price", #<BigDecimal:7f74f1694d40,'0.0',9(18)>], ["total_price", #<BigDecimal:7f74f1694c78,'0.0',9(18)>], ["created_at", 2017-04-29 00:30:27 UTC], ["updated_at", 2017-04-29 00:30:27 UTC]]
  [1m[35m (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (1.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 24]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "stages" ("budget_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["budget_id", 12], ["number", 3], ["price", #<BigDecimal:7f74f2a85840,'0.0',9(18)>], ["total_price", #<BigDecimal:7f74f2a857f0,'0.0',9(18)>], ["created_at", 2017-04-29 00:30:27 UTC], ["updated_at", 2017-04-29 00:30:27 UTC]]
  [1m[35m (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (1.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 25]]
  [1m[36mTechnicalFile Load (0.6ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 10]]
  [1m[36mClientFile Load (2.9ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 10]]
Redirected to http://localhost:3000/estimates?client_id=1
Completed 302 Found in 468ms (ActiveRecord: 69.4ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-29 03:30:27 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.2ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (5.3ms)
  Rendered estimates/_listing.html.haml (1.6ms)
  Rendered estimates/_listing.html.haml (1.6ms)
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered estimates/index.html.haml within layouts/application (62.4ms)
  Rendered layouts/_header.html.haml (61.4ms)
Completed 200 OK in 757ms (Views: 729.8ms | ActiveRecord: 6.8ms)


Started DELETE "/estimates/11" for 127.0.0.1 at 2017-04-29 03:30:33 +0300
Processing by EstimatesController#destroy as HTML
  Parameters: {"authenticity_token"=>"EzC6m90kfYMj+N/hDlDfNifNUhBX6+La+E6DBd5Gm6UW3bLNwifXW25xAMVwK1zgE1NxI8zDPaRpXawWbxz42w==", "id"=>"11"}
  [1m[36mEstimate Load (1.0ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Estimate') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 11], ["LIMIT", 1]]
  [1m[36mUser Load (2.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (2.9ms)[0m  [1m[35mBEGIN[0m
  [1m[36mAudited::Audit Load (0.9ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 11], ["auditable_type", "Budget"], ["LIMIT", 1]]
  [1m[35mSQL (4.4ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 11], ["auditable_type", "Budget"], ["user_id", 1], ["user_type", "User"], ["action", "destroy"], ["audited_changes", "---\nname: '321'\nclient_id: 1\nfloors: !ruby/object:BigDecimal 18:0.1E1\nfirst_floor_height: !ruby/object:BigDecimal 18:0.23E2\nsecond_floor_height_min: !ruby/object:BigDecimal 18:0.0\nsecond_floor_height_max: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_min: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_max: !ruby/object:BigDecimal 18:0.0\nprice: !ruby/object:BigDecimal 18:0.30135E4\narea: !ruby/object:BigDecimal 18:0.1E1\nprice_by_area: !ruby/object:BigDecimal 18:0.30135E4\nprice_by_stage:\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated:\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\nprice_by_area_per_stage:\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\ndiscount_title: ''\ndiscount_by_stages:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\ndiscount_amount:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated_discounted:\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\nprice_by_area_per_stage_discounted:\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\nsigned: false\ndeleted_at: \nsigning_date: \nuser_id: \nproposed: false\nproposer_id: \n"], ["version", 2], ["remote_address", "127.0.0.1"], ["request_uuid", "e2cfa8b1-101e-413c-85f4-23fd704fcd83"], ["created_at", 2017-04-29 00:30:33 UTC]]
  [1m[35mSQL (1.0ms)[0m  [1m[33mUPDATE "budgets" SET "deleted_at" = '2017-04-29 00:30:33.521175', "updated_at" = '2017-04-29 00:30:33.521244' WHERE "budgets"."type" IN ('Estimate') AND "budgets"."id" = $1[0m  [["id", 11]]
  [1m[35m (1.3ms)[0m  [1m[35mCOMMIT[0m
Redirected to http://localhost:3000/estimates?client_id=1
Completed 302 Found in 82ms (ActiveRecord: 14.3ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-29 03:30:33 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (2.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (4.4ms)
  Rendered estimates/_listing.html.haml (1.3ms)
  [1m[36mClient Load (0.9ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered estimates/index.html.haml within layouts/application (27.4ms)
  Rendered layouts/_header.html.haml (9.2ms)
Completed 200 OK in 546ms (Views: 528.1ms | ActiveRecord: 4.9ms)


Started GET "/estimates/12/edit" for 127.0.0.1 at 2017-04-29 03:48:17 +0300
  
SyntaxError (/home/g1nc/Development/ruby/constructor/app/controllers/estimates_controller.rb:23: syntax error, unexpected keyword_end, expecting ')'
/home/g1nc/Development/ruby/constructor/app/controllers/estimates_controller.rb:41: syntax error, unexpected tIDENTIFIER, expecting ')'
      render 'new'
            ^
/home/g1nc/Development/ruby/constructor/app/controllers/estimates_controller.rb:51: syntax error, unexpected keyword_end, expecting ')'
/home/g1nc/Development/ruby/constructor/app/controllers/estimates_controller.rb:67: syntax error, unexpected tIDENTIFIER, expecting ')'
      render 'edit'
            ^
/home/g1nc/Development/ruby/constructor/app/controllers/estimates_controller.rb:157: syntax error, unexpected end-of-input, expecting keyword_end):
  
app/controllers/estimates_controller.rb:23: syntax error, unexpected keyword_end, expecting ')'
app/controllers/estimates_controller.rb:41: syntax error, unexpected tIDENTIFIER, expecting ')'
app/controllers/estimates_controller.rb:51: syntax error, unexpected keyword_end, expecting ')'
app/controllers/estimates_controller.rb:67: syntax error, unexpected tIDENTIFIER, expecting ')'
app/controllers/estimates_controller.rb:157: syntax error, unexpected end-of-input, expecting keyword_end
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (4.0ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.0ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.4ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (30.0ms)
Started GET "/estimates/12/edit" for 127.0.0.1 at 2017-04-29 03:48:50 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"12"}
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Estimate') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 12], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 259ms (ActiveRecord: 34.7ms)


  
NoMethodError (undefined method `includes' for nil:NilClass):
  
app/models/budget.rb:119:in `get_stages'
app/controllers/estimates_controller.rb:49:in `edit'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (4.7ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.1ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.1ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (30.8ms)
Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-29 03:49:09 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.5ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (4.8ms)
  Rendered estimates/_listing.html.haml (4.4ms)
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered estimates/index.html.haml within layouts/application (43.4ms)
  Rendered layouts/_header.html.haml (28.5ms)
Completed 200 OK in 678ms (Views: 623.1ms | ActiveRecord: 7.8ms)


Started GET "/estimates/10/edit" for 127.0.0.1 at 2017-04-29 03:49:12 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"10"}
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.9ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Estimate') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 10], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 85ms (ActiveRecord: 4.4ms)


  
NoMethodError (undefined method `includes' for nil:NilClass):
  
app/models/budget.rb:119:in `get_stages'
app/controllers/estimates_controller.rb:49:in `edit'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (7.9ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (5.5ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.2ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (38.4ms)
Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-29 03:49:16 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.9ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (5.7ms)
  Rendered estimates/_listing.html.haml (1.6ms)
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered estimates/index.html.haml within layouts/application (29.4ms)
  Rendered layouts/_header.html.haml (12.5ms)
Completed 200 OK in 595ms (Views: 580.8ms | ActiveRecord: 3.6ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-29 03:49:45 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (1.6ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (4.7ms)
  Rendered estimates/_listing.html.haml (1.4ms)
  [1m[36mClient Load (0.9ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered estimates/index.html.haml within layouts/application (41.6ms)
  Rendered layouts/_header.html.haml (55.8ms)
Completed 200 OK in 1125ms (Views: 993.5ms | ActiveRecord: 4.3ms)


Started GET "/estimates/10/edit" for 127.0.0.1 at 2017-04-29 03:49:47 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"10"}
  [1m[36mProduct Load (1.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (3.5ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mEstimate Load (1.4ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Estimate') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 10], ["LIMIT", 1]]
  [1m[36mUser Load (1.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.9ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 10]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (23, 24, 25)[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 23]]
  [1m[36mStageProductSet Load (0.9ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 22[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (1.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 24]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 25]]
  [1m[36mExpense Load (0.4ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (1.3ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (13.8ms)
  [1m[36mClientFile Load (1.4ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 10]]
  Rendered estimates/_technical_file_fields.html.haml (4.3ms)
  [1m[36mTechnicalFile Load (1.8ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 10]]
  Rendered estimates/_discount.html.haml (10.4ms)
  Rendered estimates/_stages.html.haml (20.8ms)
  Rendered estimates/_form.html.haml (146.7ms)
  Rendered estimates/edit.html.haml within layouts/application (155.3ms)
  Rendered layouts/_header.html.haml (10.6ms)
Completed 200 OK in 1022ms (Views: 725.9ms | ActiveRecord: 73.9ms)


Started GET "/estimates/10/edit" for 127.0.0.1 at 2017-04-29 03:49:59 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"10"}
  [1m[36mProduct Load (0.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Estimate') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 10], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.5ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 10]]
  [1m[36mStageProduct Load (0.9ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (23, 24, 25)[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 23]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 22[0m
  [1m[36mProduct Load (3.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 24]]
  [1m[36mStageProduct Load (1.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 25]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.5ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (7.3ms)
  [1m[36mClientFile Load (0.8ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 10]]
  Rendered estimates/_technical_file_fields.html.haml (5.2ms)
  [1m[36mTechnicalFile Load (0.5ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 10]]
  Rendered estimates/_discount.html.haml (7.2ms)
  Rendered estimates/_stages.html.haml (18.9ms)
  Rendered estimates/_form.html.haml (122.6ms)
  Rendered estimates/edit.html.haml within layouts/application (125.7ms)
  Rendered layouts/_header.html.haml (23.6ms)
Completed 200 OK in 1013ms (Views: 715.2ms | ActiveRecord: 35.4ms)


Started GET "/estimates" for 127.0.0.1 at 2017-04-29 03:50:20 +0300
Processing by EstimatesController#index as HTML
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Redirected to http://localhost:3000/clients
Completed 302 Found in 16ms (ActiveRecord: 0.8ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-29 03:50:20 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (1.3ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.9ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2)[0m
  [1m[36mEstimate Load (2.4ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" IN (1, 2)[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (9.0ms)
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (5.4ms)
  Rendered clients/_table.html.haml (18.3ms)
  [1m[36mUserClient Load (3.5ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (130.4ms)
  Rendered layouts/_header.html.haml (82.5ms)
Completed 200 OK in 772ms (Views: 725.9ms | ActiveRecord: 27.0ms)


Started GET "/clients/new" for 127.0.0.1 at 2017-04-29 03:50:22 +0300
Processing by ClientsController#new as HTML
  [1m[36mUser Load (2.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/new.html.haml within layouts/application
  Rendered clients/_form.html.haml (25.8ms)
  Rendered clients/new.html.haml within layouts/application (29.7ms)
  Rendered layouts/_header.html.haml (11.0ms)
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE ("users"."id" != $1)[0m  [["id", 1]]
Completed 200 OK in 668ms (Views: 651.0ms | ActiveRecord: 3.2ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-29 03:50:25 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (1.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (1.4ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (3.4ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2)[0m
  [1m[36mEstimate Load (1.4ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" IN (1, 2)[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (9.2ms)
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (5.5ms)
  Rendered clients/_table.html.haml (20.4ms)
  [1m[36mUserClient Load (0.9ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (45.7ms)
  Rendered layouts/_header.html.haml (8.3ms)
Completed 200 OK in 631ms (Views: 609.4ms | ActiveRecord: 10.7ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-29 03:50:27 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (1.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (5.6ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (2.3ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (44.2ms)
  Rendered estimates/_listing.html.haml (1.2ms)
  [1m[36mClient Load (1.6ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered estimates/index.html.haml within layouts/application (72.7ms)
  Rendered layouts/_header.html.haml (10.9ms)
Completed 200 OK in 632ms (Views: 608.8ms | ActiveRecord: 11.2ms)


Started GET "/estimates/new?client_id=1" for 127.0.0.1 at 2017-04-29 03:50:29 +0300
Processing by EstimatesController#new as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mProduct Load (4.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (2.4ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (5.5ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (6.3ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (1.2ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (1.5ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (8.2ms)
  Rendered estimates/_technical_file_fields.html.haml (6.4ms)
  Rendered estimates/_discount.html.haml (7.3ms)
  Rendered estimates/_stages.html.haml (23.4ms)
  Rendered estimates/_form.html.haml (151.0ms)
  Rendered estimates/new.html.haml within layouts/application (154.3ms)
  Rendered layouts/_header.html.haml (11.6ms)
Completed 200 OK in 1020ms (Views: 843.2ms | ActiveRecord: 22.8ms)


Started GET "/estimates/new?client_id=1" for 127.0.0.1 at 2017-04-29 03:50:36 +0300
Processing by EstimatesController#new as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (7.2ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.6ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (11.9ms)
  Rendered estimates/_technical_file_fields.html.haml (5.9ms)
  Rendered estimates/_discount.html.haml (7.7ms)
  Rendered estimates/_stages.html.haml (20.3ms)
  Rendered estimates/_form.html.haml (113.1ms)
  Rendered estimates/new.html.haml within layouts/application (117.0ms)
  Rendered layouts/_header.html.haml (29.1ms)
Completed 200 OK in 1043ms (Views: 750.1ms | ActiveRecord: 12.7ms)


Started GET "/estimates/new?client_id=1" for 127.0.0.1 at 2017-04-29 03:50:59 +0300
Processing by EstimatesController#new as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.6ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (7.4ms)
  Rendered estimates/_technical_file_fields.html.haml (4.6ms)
  Rendered estimates/_discount.html.haml (6.5ms)
  Rendered estimates/_stages.html.haml (15.6ms)
  Rendered estimates/_form.html.haml (86.4ms)
  Rendered estimates/new.html.haml within layouts/application (89.4ms)
  Rendered layouts/_header.html.haml (36.0ms)
Completed 200 OK in 968ms (Views: 734.8ms | ActiveRecord: 7.0ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-29 03:51:03 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (2.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (3.5ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (2.1ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (4.5ms)
  Rendered estimates/_listing.html.haml (2.2ms)
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered estimates/index.html.haml within layouts/application (49.6ms)
  Rendered layouts/_header.html.haml (14.7ms)
Completed 200 OK in 658ms (Views: 626.0ms | ActiveRecord: 10.4ms)


Started GET "/estimates/10/edit" for 127.0.0.1 at 2017-04-29 03:51:05 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"10"}
  [1m[36mProduct Load (1.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.4ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (8.1ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mEstimate Load (1.5ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Estimate') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 10], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (1.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 10]]
  [1m[36mStageProduct Load (1.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (23, 24, 25)[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 23]]
  [1m[36mStageProductSet Load (0.8ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 22[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 24]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 25]]
  [1m[36mExpense Load (0.7ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (2.0ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (7.1ms)
  [1m[36mClientFile Load (0.7ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 10]]
  Rendered estimates/_technical_file_fields.html.haml (3.9ms)
  [1m[36mTechnicalFile Load (0.7ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 10]]
  Rendered estimates/_discount.html.haml (53.4ms)
  Rendered estimates/_stages.html.haml (20.5ms)
  Rendered estimates/_form.html.haml (147.4ms)
  Rendered estimates/edit.html.haml within layouts/application (152.3ms)
  Rendered layouts/_header.html.haml (13.6ms)
Completed 200 OK in 930ms (Views: 750.5ms | ActiveRecord: 48.3ms)


Started POST "/estimates/files" for 127.0.0.1 at 2017-04-29 03:51:10 +0300
Processing by EstimatesController#files as JSON
  Parameters: {"file"=>#<ActionDispatch::Http::UploadedFile:0x007f74f2cd7210 @tempfile=#<Tempfile:/tmp/RackMultipart20170429-17379-1kecmhf.jpg>, @original_filename="Lakeside_SunRise_1920x1080.jpg", @content_type="image/jpeg", @headers="Content-Disposition: form-data; name=\"file\"; filename=\"Lakeside_SunRise_1920x1080.jpg\"\r\nContent-Type: image/jpeg\r\n">}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Command :: file -b --mime '/tmp/05154d90c55acca365abcec94b3affce20170429-17379-1c5skrn.jpg'
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
Command :: file -b --mime '/tmp/05154d90c55acca365abcec94b3affce20170429-17379-116lboq.jpg'
  [1m[35mSQL (3.6ms)[0m  [1m[32mINSERT INTO "asset_files" ("data_file_name", "data_content_type", "data_file_size", "data_updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["data_file_name", "Lakeside_SunRise_1920x1080.jpg"], ["data_content_type", "image/jpeg"], ["data_file_size", 926548], ["data_updated_at", 2017-04-29 00:51:11 UTC]]
  [1m[35m (2.8ms)[0m  [1m[35mCOMMIT[0m
Completed 200 OK in 112ms (Views: 1.0ms | ActiveRecord: 15.7ms)


Started PATCH "/estimates/10" for 127.0.0.1 at 2017-04-29 03:51:12 +0300
Processing by EstimatesController#update as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"v4HSK2hZ5pmRQRC308kVRvDRci7tlmnaBX9PnzuOXAm6bNp9d1pMQdzIz5OtspaQxE9RHXa+tqSUbGCMitQ/dw==", "commit"=>"Сохранить", "estimate"=>{"price"=>"3013.5", "name"=>"123", "client_id"=>"1", "area"=>"1", "first_floor_height"=>"23.0", "second_floor_height_min"=>"0.0", "second_floor_height_max"=>"0.0", "third_floor_height_min"=>"0.0", "third_floor_height_max"=>"0.0", "client_files_attributes"=>{"1493427070929"=>{"asset_file_id"=>"3", "_destroy"=>"false"}}, "discount_title"=>"", "discount_by_stages"=>{"0"=>"0", "1"=>"0", "2"=>"0"}}, "json_stages"=>"[{\"number\":1,\"text\":{\"name\":\"Первый этап\",\"summ\":\"Итого по первому этапу:\",\"summ_dis\":\"по первому этапу\",\"discount\":\"Итого по первому этапу со скидкой:\"},\"price\":3013.5,\"total_price\":3013.5,\"products\":[{\"id\":1,\"name\":\"Простой продукт 1 этап\",\"unit\":\"шт\",\"custom\":false,\"profit\":100,\"price_with_work\":70,\"price_without_work\":10,\"with_work\":true,\"quantity\":21,\"sets\":[],\"price\":143.5}],\"aggregated_price\":3013.5},{\"number\":2,\"text\":{\"name\":\"Второй этап\",\"summ\":\"Итого по двум этапам:\",\"summ_dis\":\"по второму этапу\",\"discount\":\"Итого по двум этапам со скидкой:\"},\"price\":0,\"total_price\":0,\"products\":[],\"aggregated_price\":3013.5},{\"number\":3,\"text\":{\"name\":\"Третий этап\",\"summ\":\"Итого по трем этапам:\",\"summ_dis\":\"по третьему этапу\",\"discount\":\"Итого по трем этапам со скидкой:\"},\"price\":0,\"total_price\":0,\"products\":[],\"aggregated_price\":3013.5}]", "data"=>"", "id"=>"10"}
  [1m[36mProduct Load (1.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.4ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mEstimate Load (1.1ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Estimate') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 10], ["LIMIT", 1]]
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Unpermitted parameters: second_floor_height_min, second_floor_height_max, third_floor_height_min, third_floor_height_max, discount_by_stages
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mAudited::Audit Load (0.9ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 10], ["auditable_type", "Budget"], ["LIMIT", 1]]
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 10], ["auditable_type", "Budget"], ["user_id", 1], ["user_type", "User"], ["action", "update"], ["audited_changes", "---\ndiscount_by_stages:\n- - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n- - '0'\n  - '0'\n  - '0'\n"], ["version", 3], ["remote_address", "127.0.0.1"], ["request_uuid", "43381c3a-b1d9-4ce3-8b0e-b2b19aff6c78"], ["created_at", 2017-04-29 00:51:12 UTC]]
  [1m[35mSQL (1.3ms)[0m  [1m[33mUPDATE "budgets" SET "discount_by_stages" = $1, "updated_at" = $2 WHERE "budgets"."id" = $3[0m  [["discount_by_stages", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f74f0dc12b8 "decimal[]"  elements_type=nil needs quotation>, values=["0", "0", "0"]>], ["updated_at", 2017-04-29 00:51:12 UTC], ["id", 10]]
  [1m[35mSQL (4.8ms)[0m  [1m[32mINSERT INTO "client_files" ("budget_id", "asset_file_id") VALUES ($1, $2) RETURNING "id"[0m  [["budget_id", 10], ["asset_file_id", 3]]
  [1m[35m (2.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (1.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."budget_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["budget_id", 10], ["number", 1], ["LIMIT", 1]]
  [1m[35m (2.8ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (3.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND ("stage_products"."product_id" != 1)[0m  [["stage_id", 23]]
  [1m[36mStageProduct Load (2.0ms)[0m  [1m[34mSELECT  "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND "stage_products"."product_id" = $2 LIMIT $3[0m  [["stage_id", 23], ["product_id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."budget_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["budget_id", 10], ["number", 2], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND (1=1)[0m  [["stage_id", 24]]
  [1m[36mStage Load (0.8ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."budget_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["budget_id", 10], ["number", 3], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND (1=1)[0m  [["stage_id", 25]]
  [1m[35m (1.6ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
Redirected to http://localhost:3000/estimates?client_id=1
Completed 302 Found in 136ms (ActiveRecord: 33.7ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-29 03:51:12 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (9.7ms)
  Rendered estimates/_listing.html.haml (1.1ms)
  [1m[36mClient Load (0.9ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered estimates/index.html.haml within layouts/application (35.4ms)
  Rendered layouts/_header.html.haml (10.9ms)
Completed 200 OK in 630ms (Views: 611.9ms | ActiveRecord: 3.3ms)


Started GET "/estimates/10/edit" for 127.0.0.1 at 2017-04-29 03:51:15 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"10"}
  [1m[36mProduct Load (3.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (2.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (3.2ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mEstimate Load (1.0ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Estimate') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 10], ["LIMIT", 1]]
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (2.3ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 10]]
  [1m[36mStageProduct Load (0.9ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (23, 24, 25)[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 23]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 22[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.9ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 24]]
  [1m[36mStageProduct Load (0.9ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 25]]
  [1m[36mExpense Load (1.1ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.7ms)
  [1m[36mClientFile Load (0.6ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 10]]
  [1m[36mAssetFile Load (0.4ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  Rendered estimates/_client_file_fields.html.haml (9.9ms)
  Rendered estimates/_technical_file_fields.html.haml (3.5ms)
  [1m[36mTechnicalFile Load (0.5ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 10]]
  Rendered estimates/_discount.html.haml (7.0ms)
  Rendered estimates/_stages.html.haml (27.1ms)
  Rendered estimates/_form.html.haml (113.8ms)
  Rendered estimates/edit.html.haml within layouts/application (118.0ms)
  Rendered layouts/_header.html.haml (12.1ms)
Completed 200 OK in 846ms (Views: 745.1ms | ActiveRecord: 22.1ms)


Started GET "/estimates" for 127.0.0.1 at 2017-04-29 03:51:16 +0300
Processing by EstimatesController#index as HTML
  [1m[36mUser Load (4.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Redirected to http://localhost:3000/clients
Completed 302 Found in 8ms (ActiveRecord: 4.8ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-29 03:51:16 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (3.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (16.8ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (2.4ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2)[0m
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" IN (1, 2)[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (11.3ms)
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (6.3ms)
  Rendered clients/_table.html.haml (22.0ms)
  [1m[36mUserClient Load (0.9ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (68.9ms)
  Rendered layouts/_header.html.haml (10.4ms)
Completed 200 OK in 614ms (Views: 581.3ms | ActiveRecord: 27.7ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-29 03:51:19 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (1.3ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.5ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (4.2ms)
  Rendered estimates/_listing.html.haml (1.1ms)
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered estimates/index.html.haml within layouts/application (24.5ms)
  Rendered layouts/_header.html.haml (10.6ms)
Completed 200 OK in 639ms (Views: 622.7ms | ActiveRecord: 4.2ms)


Started GET "/estimates/10/edit" for 127.0.0.1 at 2017-04-29 03:51:22 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"10"}
  [1m[36mProduct Load (3.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.5ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Estimate') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 10], ["LIMIT", 1]]
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 10]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (23, 24, 25)[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 23]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 22[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 24]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 25]]
  [1m[36mExpense Load (0.4ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.5ms)
  [1m[36mClientFile Load (0.7ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 10]]
  [1m[36mAssetFile Load (0.4ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  Rendered estimates/_client_file_fields.html.haml (10.4ms)
  Rendered estimates/_technical_file_fields.html.haml (6.8ms)
  [1m[36mTechnicalFile Load (0.6ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 10]]
  Rendered estimates/_discount.html.haml (9.5ms)
  Rendered estimates/_stages.html.haml (20.6ms)
  Rendered estimates/_form.html.haml (103.7ms)
  Rendered estimates/edit.html.haml within layouts/application (107.2ms)
  Rendered layouts/_header.html.haml (10.6ms)
Completed 200 OK in 778ms (Views: 699.7ms | ActiveRecord: 15.4ms)


Started POST "/estimates/10/copy" for 127.0.0.1 at 2017-04-29 03:51:37 +0300
Processing by EstimatesController#copy as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"dKbnnVPOWoIncLmTInb5DVdctigrHk3X2oy/GMccTX1xS+/LTM3wWmr5ZrdcDXrbY8KVG7A2kqlLn5ALdkYuAw==", "name"=>"11", "client_id"=>"1", "commit"=>"Создать", "estimate_id"=>"10"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Estimate') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 10], ["LIMIT", 1]]
  [1m[36mStage Load (0.6ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = 10[0m
  [1m[36mClientFile Load (0.7ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = 10[0m
  [1m[36mTechnicalFile Load (0.5ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = 10[0m
  [1m[36mClient Load (1.4ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "budgets" ("name", "client_id", "floors", "first_floor_height", "price", "area", "price_by_area", "price_by_stage", "price_by_stage_aggregated", "price_by_area_per_stage", "discount_title", "price_by_stage_aggregated_discounted", "price_by_area_per_stage_discounted", "created_at", "updated_at", "type") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16) RETURNING "id"[0m  [["name", "11"], ["client_id", 1], ["floors", #<BigDecimal:7f74d41137f8,'0.1E1',9(18)>], ["first_floor_height", #<BigDecimal:7f74d44cabd0,'0.23E2',9(18)>], ["price", #<BigDecimal:7f74d44cae78,'0.30135E4',18(18)>], ["area", #<BigDecimal:7f74d44cad10,'0.1E1',9(18)>], ["price_by_area", #<BigDecimal:7f74d4112ee8,'0.30135E4',18(18)>], ["price_by_stage", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f74f0dc12b8 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f74d4112a38,'0.30135E4',18(18)>, #<BigDecimal:7f74d4112a10,'0.0',9(18)>, #<BigDecimal:7f74d41129e8,'0.0',9(18)>]>], ["price_by_stage_aggregated", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f74f0dc12b8 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f74d4111f98,'0.30135E4',18(18)>, #<BigDecimal:7f74d4111f70,'0.30135E4',18(18)>, #<BigDecimal:7f74d4111ed0,'0.30135E4',18(18)>]>], ["price_by_area_per_stage", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f74f0dc12b8 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f74d4111750,'0.30135E4',18(18)>, #<BigDecimal:7f74d4111728,'0.30135E4',18(18)>, #<BigDecimal:7f74d41116d8,'0.30135E4',18(18)>]>], ["discount_title", ""], ["price_by_stage_aggregated_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f74f0dc12b8 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f74d410b4b8,'0.30135E4',18(18)>, #<BigDecimal:7f74d410b468,'0.30135E4',18(18)>, #<BigDecimal:7f74d410b440,'0.30135E4',18(18)>]>], ["price_by_area_per_stage_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f74f0dc12b8 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f74d410ab80,'0.30135E4',18(18)>, #<BigDecimal:7f74d410ab58,'0.30135E4',18(18)>, #<BigDecimal:7f74d410ab08,'0.30135E4',18(18)>]>], ["created_at", 2017-04-29 00:51:37 UTC], ["updated_at", 2017-04-29 00:51:37 UTC], ["type", "Estimate"]]
  [1m[36mAudited::Audit Load (1.2ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 13], ["auditable_type", "Budget"], ["LIMIT", 1]]
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 13], ["auditable_type", "Budget"], ["user_id", 1], ["user_type", "User"], ["action", "create"], ["audited_changes", "---\nname: '11'\nclient_id: 1\nfloors: !ruby/object:BigDecimal 18:0.1E1\nfirst_floor_height: !ruby/object:BigDecimal 18:0.23E2\nsecond_floor_height_min: !ruby/object:BigDecimal 18:0.0\nsecond_floor_height_max: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_min: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_max: !ruby/object:BigDecimal 18:0.0\nprice: !ruby/object:BigDecimal 18:0.30135E4\narea: !ruby/object:BigDecimal 18:0.1E1\nprice_by_area: !ruby/object:BigDecimal 18:0.30135E4\nprice_by_stage:\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated:\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\nprice_by_area_per_stage:\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\ndiscount_title: ''\ndiscount_by_stages:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\ndiscount_amount:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated_discounted:\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\nprice_by_area_per_stage_discounted:\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\nsigned: false\ndeleted_at: \nsigning_date: \nuser_id: \nproposed: false\nproposer_id: \n"], ["version", 1], ["remote_address", "127.0.0.1"], ["request_uuid", "75f44cf1-3c0b-40f6-ac66-fb5dfd56abb0"], ["created_at", 2017-04-29 00:51:37 UTC]]
  [1m[35m (3.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (2.6ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 10]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (23, 24, 25)[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (1.2ms)[0m  [1m[32mINSERT INTO "stages" ("budget_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["budget_id", 13], ["number", 1], ["price", #<BigDecimal:7f74f3426c78,'0.30135E4',18(18)>], ["total_price", #<BigDecimal:7f74f3426c28,'0.30135E4',18(18)>], ["created_at", 2017-04-29 00:51:37 UTC], ["updated_at", 2017-04-29 00:51:37 UTC]]
  [1m[35m (2.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 23]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 22[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "stage_products" ("product_id", "stage_id", "quantity", "price_with_work", "created_at", "updated_at", "price_without_work") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["product_id", 1], ["stage_id", 32], ["quantity", 21], ["price_with_work", #<BigDecimal:7f74f35a61e8,'0.7E2',9(18)>], ["created_at", 2017-04-29 00:51:37 UTC], ["updated_at", 2017-04-29 00:51:37 UTC], ["price_without_work", #<BigDecimal:7f74f35a4a00,'0.1E2',9(18)>]]
  [1m[35m (9.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSet Load (1.0ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 22]]
  [1m[35m (1.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "stages" ("budget_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["budget_id", 13], ["number", 2], ["price", #<BigDecimal:7f74f286bac8,'0.0',9(18)>], ["total_price", #<BigDecimal:7f74f286ba28,'0.0',9(18)>], ["created_at", 2017-04-29 00:51:37 UTC], ["updated_at", 2017-04-29 00:51:37 UTC]]
  [1m[35m (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 24]]
  [1m[35m (0.8ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (1.4ms)[0m  [1m[32mINSERT INTO "stages" ("budget_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["budget_id", 13], ["number", 3], ["price", #<BigDecimal:7f74f3eddef0,'0.0',9(18)>], ["total_price", #<BigDecimal:7f74f3edde78,'0.0',9(18)>], ["created_at", 2017-04-29 00:51:37 UTC], ["updated_at", 2017-04-29 00:51:37 UTC]]
  [1m[35m (1.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (3.2ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 25]]
  [1m[36mTechnicalFile Load (0.6ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 10]]
  [1m[36mClientFile Load (0.5ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 10]]
  [1m[36mAssetFile Load (0.9ms)[0m  [1m[34mSELECT "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = 3[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (1.6ms)[0m  [1m[32mINSERT INTO "asset_files" ("data_file_name", "data_content_type", "data_file_size", "data_updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["data_file_name", "Lakeside_SunRise_1920x1080.jpg"], ["data_content_type", "image/jpeg"], ["data_file_size", 926548], ["data_updated_at", 2017-04-29 00:51:11 UTC]]
  [1m[35m (1.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
Completed 500 Internal Server Error in 159ms (ActiveRecord: 47.8ms)


  
ActiveModel::UnknownAttributeError (unknown attribute 'budget' for ClientFile.):
  
app/controllers/estimates_controller.rb:111:in `block (2 levels) in copy'
app/controllers/estimates_controller.rb:107:in `block in copy'
app/controllers/estimates_controller.rb:106:in `each'
app/controllers/estimates_controller.rb:106:in `copy'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (6.1ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (4.4ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.4ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (41.1ms)
Started POST "/estimates/10/copy" for 127.0.0.1 at 2017-04-29 03:52:04 +0300
Processing by EstimatesController#copy as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"dKbnnVPOWoIncLmTInb5DVdctigrHk3X2oy/GMccTX1xS+/LTM3wWmr5ZrdcDXrbY8KVG7A2kqlLn5ALdkYuAw==", "name"=>"11", "client_id"=>"1", "commit"=>"Создать", "estimate_id"=>"10"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.1ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Estimate') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 10], ["LIMIT", 1]]
  [1m[36mStage Load (0.5ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = 10[0m
  [1m[36mClientFile Load (0.5ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = 10[0m
  [1m[36mTechnicalFile Load (0.5ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = 10[0m
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (2.4ms)[0m  [1m[32mINSERT INTO "budgets" ("name", "client_id", "floors", "first_floor_height", "price", "area", "price_by_area", "price_by_stage", "price_by_stage_aggregated", "price_by_area_per_stage", "discount_title", "price_by_stage_aggregated_discounted", "price_by_area_per_stage_discounted", "created_at", "updated_at", "type") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16) RETURNING "id"[0m  [["name", "11"], ["client_id", 1], ["floors", #<BigDecimal:7f7500881ea0,'0.1E1',9(18)>], ["first_floor_height", #<BigDecimal:7f74d43645e8,'0.23E2',9(18)>], ["price", #<BigDecimal:7f74d43647c8,'0.30135E4',18(18)>], ["area", #<BigDecimal:7f74d43646d8,'0.1E1',9(18)>], ["price_by_area", #<BigDecimal:7f7500881810,'0.30135E4',18(18)>], ["price_by_stage", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f74f0dc12b8 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f7500881540,'0.30135E4',18(18)>, #<BigDecimal:7f7500881518,'0.0',9(18)>, #<BigDecimal:7f75008814f0,'0.0',9(18)>]>], ["price_by_stage_aggregated", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f74f0dc12b8 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f7500880fa0,'0.30135E4',18(18)>, #<BigDecimal:7f7500880f78,'0.30135E4',18(18)>, #<BigDecimal:7f7500880f50,'0.30135E4',18(18)>]>], ["price_by_area_per_stage", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f74f0dc12b8 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f75008807d0,'0.30135E4',18(18)>, #<BigDecimal:7f75008807a8,'0.30135E4',18(18)>, #<BigDecimal:7f7500880780,'0.30135E4',18(18)>]>], ["discount_title", ""], ["price_by_stage_aggregated_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f74f0dc12b8 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f74f2c03578,'0.30135E4',18(18)>, #<BigDecimal:7f74f2c03550,'0.30135E4',18(18)>, #<BigDecimal:7f74f2c03528,'0.30135E4',18(18)>]>], ["price_by_area_per_stage_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f74f0dc12b8 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f74f2c02f60,'0.30135E4',18(18)>, #<BigDecimal:7f74f2c02f38,'0.30135E4',18(18)>, #<BigDecimal:7f74f2c02f10,'0.30135E4',18(18)>]>], ["created_at", 2017-04-29 00:52:05 UTC], ["updated_at", 2017-04-29 00:52:05 UTC], ["type", "Estimate"]]
  [1m[36mAudited::Audit Load (0.6ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 14], ["auditable_type", "Budget"], ["LIMIT", 1]]
  [1m[35mSQL (3.1ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 14], ["auditable_type", "Budget"], ["user_id", 1], ["user_type", "User"], ["action", "create"], ["audited_changes", "---\nname: '11'\nclient_id: 1\nfloors: !ruby/object:BigDecimal 18:0.1E1\nfirst_floor_height: !ruby/object:BigDecimal 18:0.23E2\nsecond_floor_height_min: !ruby/object:BigDecimal 18:0.0\nsecond_floor_height_max: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_min: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_max: !ruby/object:BigDecimal 18:0.0\nprice: !ruby/object:BigDecimal 18:0.30135E4\narea: !ruby/object:BigDecimal 18:0.1E1\nprice_by_area: !ruby/object:BigDecimal 18:0.30135E4\nprice_by_stage:\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated:\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\nprice_by_area_per_stage:\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\ndiscount_title: ''\ndiscount_by_stages:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\ndiscount_amount:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated_discounted:\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\nprice_by_area_per_stage_discounted:\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\nsigned: false\ndeleted_at: \nsigning_date: \nuser_id: \nproposed: false\nproposer_id: \n"], ["version", 1], ["remote_address", "127.0.0.1"], ["request_uuid", "dd573920-6e37-469e-aa7d-985c5497a74d"], ["created_at", 2017-04-29 00:52:05 UTC]]
  [1m[35m (2.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (2.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 10]]
  [1m[36mStageProduct Load (2.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (23, 24, 25)[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "stages" ("budget_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["budget_id", 14], ["number", 1], ["price", #<BigDecimal:7f74ed4f2ef0,'0.30135E4',18(18)>], ["total_price", #<BigDecimal:7f74ed4f2e78,'0.30135E4',18(18)>], ["created_at", 2017-04-29 00:52:05 UTC], ["updated_at", 2017-04-29 00:52:05 UTC]]
  [1m[35m (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (1.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 23]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 22[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "stage_products" ("product_id", "stage_id", "quantity", "price_with_work", "created_at", "updated_at", "price_without_work") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["product_id", 1], ["stage_id", 35], ["quantity", 21], ["price_with_work", #<BigDecimal:7f74f954ce30,'0.7E2',9(18)>], ["created_at", 2017-04-29 00:52:05 UTC], ["updated_at", 2017-04-29 00:52:05 UTC], ["price_without_work", #<BigDecimal:7f74f954c250,'0.1E2',9(18)>]]
  [1m[35m (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 22]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "stages" ("budget_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["budget_id", 14], ["number", 2], ["price", #<BigDecimal:7f74d4529ba8,'0.0',9(18)>], ["total_price", #<BigDecimal:7f74d4529b58,'0.0',9(18)>], ["created_at", 2017-04-29 00:52:05 UTC], ["updated_at", 2017-04-29 00:52:05 UTC]]
  [1m[35m (1.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 24]]
  [1m[35m (1.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (2.5ms)[0m  [1m[32mINSERT INTO "stages" ("budget_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["budget_id", 14], ["number", 3], ["price", #<BigDecimal:7f74d45aae38,'0.0',9(18)>], ["total_price", #<BigDecimal:7f74d45aade8,'0.0',9(18)>], ["created_at", 2017-04-29 00:52:05 UTC], ["updated_at", 2017-04-29 00:52:05 UTC]]
  [1m[35m (1.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 25]]
  [1m[36mTechnicalFile Load (0.6ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 10]]
  [1m[36mClientFile Load (0.5ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 10]]
  [1m[36mAssetFile Load (0.6ms)[0m  [1m[34mSELECT "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = 3[0m
  [1m[35m (3.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "asset_files" ("data_file_name", "data_content_type", "data_file_size", "data_updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["data_file_name", "Lakeside_SunRise_1920x1080.jpg"], ["data_content_type", "image/jpeg"], ["data_file_size", 926548], ["data_updated_at", 2017-04-29 00:51:11 UTC]]
  [1m[35m (1.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.9ms)[0m  [1m[32mINSERT INTO "client_files" ("budget_id", "asset_file_id") VALUES ($1, $2) RETURNING "id"[0m  [["budget_id", 14], ["asset_file_id", 5]]
  [1m[35m (1.7ms)[0m  [1m[35mCOMMIT[0m
Redirected to http://localhost:3000/estimates?client_id=1
Completed 302 Found in 406ms (ActiveRecord: 45.2ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-29 03:52:05 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (1.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (3.5ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (2.8ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (8.6ms)
  Rendered estimates/_listing.html.haml (1.0ms)
  Rendered estimates/_listing.html.haml (1.2ms)
  Rendered estimates/_listing.html.haml (1.2ms)
  [1m[36mClient Load (0.9ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered estimates/index.html.haml within layouts/application (63.2ms)
  Rendered layouts/_header.html.haml (110.4ms)
Completed 200 OK in 918ms (Views: 896.3ms | ActiveRecord: 8.7ms)


Started DELETE "/estimates/13" for 127.0.0.1 at 2017-04-29 03:52:11 +0300
Processing by EstimatesController#destroy as HTML
  Parameters: {"authenticity_token"=>"NYrAGvWwMTBgU5fKcF09adUiHyHbuSUbMcmi3CP71wswZ8hM6rOb6C3aSO4OJr6/4bw8EkCR+mWg2o3PkqG0dQ==", "id"=>"13"}
  [1m[36mEstimate Load (2.0ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Estimate') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 13], ["LIMIT", 1]]
  [1m[36mUser Load (1.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mAudited::Audit Load (0.8ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 13], ["auditable_type", "Budget"], ["LIMIT", 1]]
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 13], ["auditable_type", "Budget"], ["user_id", 1], ["user_type", "User"], ["action", "destroy"], ["audited_changes", "---\nname: '11'\nclient_id: 1\nfloors: !ruby/object:BigDecimal 18:0.1E1\nfirst_floor_height: !ruby/object:BigDecimal 18:0.23E2\nsecond_floor_height_min: !ruby/object:BigDecimal 18:0.0\nsecond_floor_height_max: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_min: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_max: !ruby/object:BigDecimal 18:0.0\nprice: !ruby/object:BigDecimal 18:0.30135E4\narea: !ruby/object:BigDecimal 18:0.1E1\nprice_by_area: !ruby/object:BigDecimal 18:0.30135E4\nprice_by_stage:\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated:\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\nprice_by_area_per_stage:\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\ndiscount_title: ''\ndiscount_by_stages:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\ndiscount_amount:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated_discounted:\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\nprice_by_area_per_stage_discounted:\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\n- !ruby/object:BigDecimal 18:0.30135E4\nsigned: false\ndeleted_at: \nsigning_date: \nuser_id: \nproposed: false\nproposer_id: \n"], ["version", 2], ["remote_address", "127.0.0.1"], ["request_uuid", "e7be3bd9-67b0-4e3c-b0c9-3500ce9450d4"], ["created_at", 2017-04-29 00:52:11 UTC]]
  [1m[35mSQL (0.7ms)[0m  [1m[33mUPDATE "budgets" SET "deleted_at" = '2017-04-29 00:52:11.781749', "updated_at" = '2017-04-29 00:52:11.781809' WHERE "budgets"."type" IN ('Estimate') AND "budgets"."id" = $1[0m  [["id", 13]]
  [1m[35m (2.6ms)[0m  [1m[35mCOMMIT[0m
Redirected to http://localhost:3000/estimates?client_id=1
Completed 302 Found in 76ms (ActiveRecord: 9.0ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-29 03:52:11 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (2.8ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (3.6ms)
  Rendered estimates/_listing.html.haml (1.1ms)
  Rendered estimates/_listing.html.haml (0.9ms)
  [1m[36mClient Load (0.9ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered estimates/index.html.haml within layouts/application (30.9ms)
  Rendered layouts/_header.html.haml (11.3ms)
Completed 200 OK in 713ms (Views: 697.1ms | ActiveRecord: 5.2ms)


Started GET "/estimates/14/edit" for 127.0.0.1 at 2017-04-29 03:52:14 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"14"}
  [1m[36mProduct Load (2.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Estimate') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 14], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.8ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 14]]
  [1m[36mStageProduct Load (0.9ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (35, 36, 37)[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 35]]
  [1m[36mStageProductSet Load (0.8ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 26[0m
  [1m[36mProduct Load (5.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 36]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 37]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (7.6ms)
  [1m[36mClientFile Load (1.1ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 14]]
  [1m[36mAssetFile Load (0.3ms)[0m  [1m[34mSELECT  "asset_files".* FROM "asset_files" WHERE "asset_files"."id" = $1 LIMIT $2[0m  [["id", 5], ["LIMIT", 1]]
  Rendered estimates/_client_file_fields.html.haml (8.5ms)
  Rendered estimates/_technical_file_fields.html.haml (6.6ms)
  [1m[36mTechnicalFile Load (0.7ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 14]]
  Rendered estimates/_discount.html.haml (8.5ms)
  Rendered estimates/_stages.html.haml (20.9ms)
  Rendered estimates/_form.html.haml (142.7ms)
  Rendered estimates/edit.html.haml within layouts/application (147.2ms)
  Rendered layouts/_header.html.haml (10.9ms)
Completed 200 OK in 958ms (Views: 771.0ms | ActiveRecord: 50.0ms)


Started GET "/system/asset_files/data/000/000/005/original/Lakeside_SunRise_1920x1080.jpg?1493427071" for 127.0.0.1 at 2017-04-29 03:52:15 +0300
  
ActionController::RoutingError (No route matches [GET] "/system/asset_files/data/000/000/005/original/Lakeside_SunRise_1920x1080.jpg"):
  
actionpack (5.0.2) lib/action_dispatch/middleware/debug_exceptions.rb:53:in `call'
web-console (3.4.0) lib/web_console/middleware.rb:135:in `call_app'
web-console (3.4.0) lib/web_console/middleware.rb:28:in `block in call'
web-console (3.4.0) lib/web_console/middleware.rb:18:in `catch'
web-console (3.4.0) lib/web_console/middleware.rb:18:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/show_exceptions.rb:31:in `call'
railties (5.0.2) lib/rails/rack/logger.rb:36:in `call_app'
railties (5.0.2) lib/rails/rack/logger.rb:24:in `block in call'
activesupport (5.0.2) lib/active_support/tagged_logging.rb:69:in `block in tagged'
activesupport (5.0.2) lib/active_support/tagged_logging.rb:26:in `tagged'
activesupport (5.0.2) lib/active_support/tagged_logging.rb:69:in `tagged'
railties (5.0.2) lib/rails/rack/logger.rb:24:in `call'
sprockets-rails (3.2.0) lib/sprockets/rails/quiet_assets.rb:13:in `call'
request_store (1.2.0) lib/request_store/middleware.rb:8:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/request_id.rb:24:in `call'
rack (2.0.1) lib/rack/method_override.rb:22:in `call'
rack (2.0.1) lib/rack/runtime.rb:22:in `call'
activesupport (5.0.2) lib/active_support/cache/strategy/local_cache_middleware.rb:28:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/executor.rb:12:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/static.rb:136:in `call'
rack (2.0.1) lib/rack/sendfile.rb:111:in `call'
railties (5.0.2) lib/rails/engine.rb:522:in `call'
puma (3.7.1) lib/puma/configuration.rb:232:in `call'
puma (3.7.1) lib/puma/server.rb:578:in `handle_request'
puma (3.7.1) lib/puma/server.rb:415:in `process_client'
puma (3.7.1) lib/puma/server.rb:275:in `block in run'
puma (3.7.1) lib/puma/thread_pool.rb:120:in `block in spawn_thread'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/routing_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (1.4ms)
  Rendered collection of /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/routes/_route.html.erb [100 times] (38.7ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/routes/_table.html.erb (3.8ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.6ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/routing_error.html.erb within rescues/layout (87.5ms)
  [1m[36mAssetFile Load (1.2ms)[0m  [1m[34mSELECT "asset_files".* FROM "asset_files"[0m
Started GET "/estimates" for 127.0.0.1 at 2017-04-29 03:54:17 +0300
Processing by EstimatesController#index as HTML
  [1m[36mUser Load (18.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Redirected to http://localhost:3000/clients
Completed 302 Found in 23ms (ActiveRecord: 18.4ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-29 03:54:17 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (2.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (5.4ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2)[0m
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" IN (1, 2)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (20.0ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (6.6ms)
  Rendered clients/_table.html.haml (30.7ms)
  [1m[36mUserClient Load (1.0ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (62.2ms)
  Rendered layouts/_header.html.haml (11.6ms)
Completed 200 OK in 707ms (Views: 688.8ms | ActiveRecord: 13.5ms)


Started GET "/system/asset_files/data/000/000/005/original/Lakeside_SunRise_1920x1080.jpg?1493427071" for 127.0.0.1 at 2017-04-29 03:54:18 +0300
  
ActionController::RoutingError (No route matches [GET] "/system/asset_files/data/000/000/005/original/Lakeside_SunRise_1920x1080.jpg"):
  
actionpack (5.0.2) lib/action_dispatch/middleware/debug_exceptions.rb:53:in `call'
web-console (3.4.0) lib/web_console/middleware.rb:135:in `call_app'
web-console (3.4.0) lib/web_console/middleware.rb:28:in `block in call'
web-console (3.4.0) lib/web_console/middleware.rb:18:in `catch'
web-console (3.4.0) lib/web_console/middleware.rb:18:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/show_exceptions.rb:31:in `call'
railties (5.0.2) lib/rails/rack/logger.rb:36:in `call_app'
railties (5.0.2) lib/rails/rack/logger.rb:24:in `block in call'
activesupport (5.0.2) lib/active_support/tagged_logging.rb:69:in `block in tagged'
activesupport (5.0.2) lib/active_support/tagged_logging.rb:26:in `tagged'
activesupport (5.0.2) lib/active_support/tagged_logging.rb:69:in `tagged'
railties (5.0.2) lib/rails/rack/logger.rb:24:in `call'
sprockets-rails (3.2.0) lib/sprockets/rails/quiet_assets.rb:13:in `call'
request_store (1.2.0) lib/request_store/middleware.rb:8:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/request_id.rb:24:in `call'
rack (2.0.1) lib/rack/method_override.rb:22:in `call'
rack (2.0.1) lib/rack/runtime.rb:22:in `call'
activesupport (5.0.2) lib/active_support/cache/strategy/local_cache_middleware.rb:28:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/executor.rb:12:in `call'
actionpack (5.0.2) lib/action_dispatch/middleware/static.rb:136:in `call'
rack (2.0.1) lib/rack/sendfile.rb:111:in `call'
railties (5.0.2) lib/rails/engine.rb:522:in `call'
puma (3.7.1) lib/puma/configuration.rb:232:in `call'
puma (3.7.1) lib/puma/server.rb:578:in `handle_request'
puma (3.7.1) lib/puma/server.rb:415:in `process_client'
puma (3.7.1) lib/puma/server.rb:275:in `block in run'
puma (3.7.1) lib/puma/thread_pool.rb:120:in `block in spawn_thread'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/routing_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (1.6ms)
  Rendered collection of /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/routes/_route.html.erb [100 times] (29.4ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/routes/_table.html.erb (1.6ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.9ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/routing_error.html.erb within rescues/layout (74.1ms)
Started GET "/clients" for 127.0.0.1 at 2017-04-29 03:54:18 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (1.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (0.9ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2)[0m
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" IN (1, 2)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (7.1ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (4.0ms)
  Rendered clients/_table.html.haml (14.8ms)
  [1m[36mUserClient Load (0.7ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (30.1ms)
  Rendered layouts/_header.html.haml (11.2ms)
Completed 200 OK in 626ms (Views: 611.0ms | ActiveRecord: 5.8ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-29 03:55:44 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (2.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (0.9ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2)[0m
  [1m[36mEstimate Load (7.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" IN (1, 2)[0m
  [1m[35m (3.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (12.5ms)
  [1m[35m (3.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (7.2ms)
  Rendered clients/_table.html.haml (24.7ms)
  [1m[36mUserClient Load (0.7ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (48.3ms)
  Rendered layouts/_header.html.haml (8.8ms)
Completed 200 OK in 665ms (Views: 640.6ms | ActiveRecord: 18.7ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-29 03:56:13 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (1.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (1.1ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.1ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (5.2ms)
  Rendered estimates/_listing.html.haml (1.0ms)
  Rendered estimates/_listing.html.haml (0.9ms)
  [1m[36mClient Load (1.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered estimates/index.html.haml within layouts/application (35.4ms)
  Rendered layouts/_header.html.haml (11.1ms)
Completed 200 OK in 665ms (Views: 644.8ms | ActiveRecord: 4.4ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-29 03:56:16 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (3.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 37ms (ActiveRecord: 3.5ms)


  
NameError (uninitialized constant SolutionsController::Solutions):
  
app/controllers/solutions_controller.rb:7:in `index'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (11.0ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (4.4ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (0.9ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (49.5ms)
Started GET "/solutions" for 127.0.0.1 at 2017-04-29 03:56:34 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  Rendered solutions/index.html.haml within layouts/application (10.0ms)
Completed 500 Internal Server Error in 48ms (ActiveRecord: 0.8ms)


  
ActionView::Template::Error (undefined method `full_name' for nil:NilClass):
    1: %h1 Список смет
    2: %ol.breadcrumb.row
    3:   %li= link_to 'Клиенты', clients_path
    4:   %li.active= @client.full_name
    5: 
    6: .action-buttons.row
    7:   = form_tag estimates_path(client_id: @client.id), :method => 'get' do
  
app/views/solutions/index.html.haml:4:in `_app_views_solutions_index_html_haml__3750532985787942247_70070185691220'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (8.2ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.6ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.2ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (40.9ms)
Started GET "/solutions" for 127.0.0.1 at 2017-04-29 03:57:44 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (0.7ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL[0m
  Rendered solutions/index.html.haml within layouts/application (466.8ms)
Completed 500 Internal Server Error in 481ms (ActiveRecord: 1.3ms)


  
ActionView::Template::Error (undefined local variable or method `ыщдгешщты_path' for #<#<Class:0x007f74f90dfb68>:0x007f74f166d970>):
    3:   %li.active= link_to 'Готовые решения', solutions_path
    4: 
    5: .action-buttons.row
    6:   = form_tag ыщдгешщты_path, :method => 'get' do
    7:     .col-sm-8
    8:       = text_field_tag :name, params[:name], class: 'form-control', placeholder: 'Наименование'
    9:     .col-sm-1
  
app/views/solutions/index.html.haml:6:in `_app_views_solutions_index_html_haml__3750532985787942247_70070121495420'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (5.5ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.2ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (0.8ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (28.9ms)
Started GET "/solutions" for 127.0.0.1 at 2017-04-29 03:58:03 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  Rendered solutions/index.html.haml within layouts/application (11.2ms)
Completed 500 Internal Server Error in 22ms (ActiveRecord: 1.0ms)


  
ActionView::Template::Error (undefined method `id' for nil:NilClass):
     9:     .col-sm-1
    10:       %button.btn.btn-default.col-sm-12 Поиск
    11:     .col-sm-3
    12:       = link_to 'Добавить готовое решение', new_estimate_path(client_id: @client.id), class: 'btn btn-primary col-sm-12'
    13: 
    14: %br
    15: 
  
app/views/solutions/index.html.haml:12:in `block in _app_views_solutions_index_html_haml__3750532985787942247_70070128309340'
app/views/solutions/index.html.haml:6:in `_app_views_solutions_index_html_haml__3750532985787942247_70070128309340'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (6.0ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.5ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (0.8ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (30.5ms)
Started GET "/solutions" for 127.0.0.1 at 2017-04-29 04:04:13 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  Rendered solutions/index.html.haml within layouts/application (5.8ms)
Completed 500 Internal Server Error in 16ms (ActiveRecord: 1.1ms)


  
ActionView::Template::Error (undefined method `id' for nil:NilClass):
     9:     .col-sm-1
    10:       %button.btn.btn-default.col-sm-12 Поиск
    11:     .col-sm-3
    12:       = link_to 'Добавить готовое решение', new_estimate_path(client_id: @client.id), class: 'btn btn-primary col-sm-12'
    13: 
    14: %br
    15: 
  
app/views/solutions/index.html.haml:12:in `block in _app_views_solutions_index_html_haml__3750532985787942247_70070136713600'
app/views/solutions/index.html.haml:6:in `_app_views_solutions_index_html_haml__3750532985787942247_70070136713600'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (6.1ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.4ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (0.8ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (29.7ms)
Started GET "/solutions" for 127.0.0.1 at 2017-04-29 04:04:32 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (0.8ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL[0m
  Rendered solutions/index.html.haml within layouts/application (6.0ms)
  Rendered layouts/_header.html.haml (66.0ms)
Completed 200 OK in 571ms (Views: 565.8ms | ActiveRecord: 1.5ms)


Started GET "/solutions/new" for 127.0.0.1 at 2017-04-29 04:04:38 +0300
Processing by SolutionsController#new as HTML
  [1m[36mProduct Load (5.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.3ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (1.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.3ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (1.7ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (1.3ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/new.html.haml within layouts/application
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered solutions/_client_file_fields.html.haml (7.0ms)
  Rendered solutions/_technical_file_fields.html.haml (4.4ms)
  Rendered solutions/_discount.html.haml (6.1ms)
  Rendered solutions/_stages.html.haml (16.9ms)
  Rendered solutions/_form.html.haml (108.2ms)
  Rendered solutions/new.html.haml within layouts/application (111.2ms)
  Rendered layouts/_header.html.haml (18.2ms)
Completed 200 OK in 895ms (Views: 646.3ms | ActiveRecord: 40.6ms)


Started POST "/estimates" for 127.0.0.1 at 2017-04-29 04:04:46 +0300
Processing by EstimatesController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"sN55cDc35vKQ07rY1qrmfcicQxm9ZElBu7kYHV+huQW1M3EmKDRMKt1aZfyo0WWr/AJgKiZMlj8qqjcO7vvaew==", "commit"=>"Сохранить", "estimate"=>{"price"=>"0", "name"=>"123213", "client_id"=>"", "area"=>"0", "first_floor_height"=>"", "second_floor_height_min"=>"0.0", "second_floor_height_max"=>"0.0", "third_floor_height_min"=>"0.0", "third_floor_height_max"=>"0.0", "discount_title"=>"", "discount_by_stages"=>{"0"=>"0", "1"=>"0", "2"=>"0"}}, "json_stages"=>"[{\"number\":1,\"text\":{\"name\":\"Первый этап\",\"summ\":\"Итого по первому этапу:\",\"summ_dis\":\"по первому этапу\",\"discount\":\"Итого по первому этапу со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":0},{\"number\":2,\"text\":{\"name\":\"Второй этап\",\"summ\":\"Итого по двум этапам:\",\"summ_dis\":\"по второму этапу\",\"discount\":\"Итого по двум этапам со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":0},{\"number\":3,\"text\":{\"name\":\"Третий этап\",\"summ\":\"Итого по трем этапам:\",\"summ_dis\":\"по третьему этапу\",\"discount\":\"Итого по трем этапам со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":0}]", "data"=>""}
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.9ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (2.2ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Unpermitted parameters: second_floor_height_min, second_floor_height_max, third_floor_height_min, third_floor_height_max, discount_by_stages
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mExpense Load (0.7ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.5ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (4.7ms)
  Rendered estimates/_technical_file_fields.html.haml (3.2ms)
  Rendered estimates/_discount.html.haml (6.0ms)
  Rendered estimates/_stages.html.haml (17.1ms)
  Rendered estimates/_form.html.haml (75.7ms)
  Rendered estimates/new.html.haml within layouts/application (79.2ms)
  Rendered layouts/_header.html.haml (8.3ms)
Completed 200 OK in 699ms (Views: 643.1ms | ActiveRecord: 7.9ms)


Started POST "/estimates" for 127.0.0.1 at 2017-04-29 04:04:57 +0300
Processing by EstimatesController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"vQjGa6ji7MotsNDofV+sEaGSZiRhpAkpjn/q1XOu9zq45c49t+FGEmA5D8wDJC/HlQxFF/qM1lcfbMXGwvSURA==", "commit"=>"Сохранить", "estimate"=>{"price"=>"0", "name"=>"123213", "client_id"=>"4", "area"=>"0", "first_floor_height"=>"123", "second_floor_height_min"=>"0.0", "second_floor_height_max"=>"0.0", "third_floor_height_min"=>"0.0", "third_floor_height_max"=>"0.0", "discount_title"=>"", "discount_by_stages"=>{"0"=>"0", "1"=>"0", "2"=>"0"}}, "json_stages"=>"[{\"number\":1,\"text\":{\"name\":\"Первый этап\",\"summ\":\"Итого по первому этапу:\",\"summ_dis\":\"по первому этапу\",\"discount\":\"Итого по первому этапу со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":0},{\"number\":2,\"text\":{\"name\":\"Второй этап\",\"summ\":\"Итого по двум этапам:\",\"summ_dis\":\"по второму этапу\",\"discount\":\"Итого по двум этапам со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":0},{\"number\":3,\"text\":{\"name\":\"Третий этап\",\"summ\":\"Итого по трем этапам:\",\"summ_dis\":\"по третьему этапу\",\"discount\":\"Итого по трем этапам со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":0}]", "data"=>""}
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (2.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.3ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Unpermitted parameters: second_floor_height_min, second_floor_height_max, third_floor_height_min, third_floor_height_max, discount_by_stages
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
  [1m[35mSQL (1.2ms)[0m  [1m[32mINSERT INTO "budgets" ("name", "client_id", "first_floor_height", "price", "area", "discount_title", "discount_by_stages", "created_at", "updated_at", "type") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "123213"], ["client_id", 4], ["first_floor_height", #<BigDecimal:7f74f8ad4250,'0.123E3',9(18)>], ["price", #<BigDecimal:7f74f8ad4430,'0.0',9(18)>], ["area", #<BigDecimal:7f74f8ad4340,'0.0',9(18)>], ["discount_title", ""], ["discount_by_stages", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f74f0dc12b8 "decimal[]"  elements_type=nil needs quotation>, values=["0", "0", "0"]>], ["created_at", 2017-04-29 01:04:57 UTC], ["updated_at", 2017-04-29 01:04:57 UTC], ["type", "Estimate"]]
  [1m[36mAudited::Audit Load (0.8ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 15], ["auditable_type", "Budget"], ["LIMIT", 1]]
  [1m[35mSQL (0.9ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 15], ["auditable_type", "Budget"], ["user_id", 1], ["user_type", "User"], ["action", "create"], ["audited_changes", "---\nname: '123213'\nclient_id: 4\nfloors: \nfirst_floor_height: !ruby/object:BigDecimal 18:0.123E3\nsecond_floor_height_min: !ruby/object:BigDecimal 18:0.0\nsecond_floor_height_max: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_min: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_max: !ruby/object:BigDecimal 18:0.0\nprice: !ruby/object:BigDecimal 18:0.0\narea: !ruby/object:BigDecimal 18:0.0\nprice_by_area: \nprice_by_stage:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_area_per_stage:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\ndiscount_title: ''\ndiscount_by_stages:\n- '0'\n- '0'\n- '0'\ndiscount_amount:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated_discounted:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_area_per_stage_discounted:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nsigned: false\ndeleted_at: \nsigning_date: \nuser_id: \nproposed: false\nproposer_id: \n"], ["version", 1], ["remote_address", "127.0.0.1"], ["request_uuid", "70967b41-c073-4c56-81b3-f6d2d58360e2"], ["created_at", 2017-04-29 01:04:57 UTC]]
  [1m[35m (1.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (1.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."budget_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["budget_id", 15], ["number", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "stages" ("budget_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["budget_id", 15], ["number", 1], ["price", #<BigDecimal:7f74f3689a60,'0.0',9(27)>], ["total_price", #<BigDecimal:7f74f36899c0,'0.0',9(18)>], ["created_at", 2017-04-29 01:04:57 UTC], ["updated_at", 2017-04-29 01:04:57 UTC]]
  [1m[35m (2.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND (1=1)[0m  [["stage_id", 38]]
  [1m[36mStage Load (0.6ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."budget_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["budget_id", 15], ["number", 2], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "stages" ("budget_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["budget_id", 15], ["number", 2], ["price", #<BigDecimal:7f74ed3656f0,'0.0',9(27)>], ["total_price", #<BigDecimal:7f74ed365628,'0.0',9(18)>], ["created_at", 2017-04-29 01:04:57 UTC], ["updated_at", 2017-04-29 01:04:57 UTC]]
  [1m[35m (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (1.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND (1=1)[0m  [["stage_id", 39]]
  [1m[36mStage Load (0.6ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."budget_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["budget_id", 15], ["number", 3], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "stages" ("budget_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["budget_id", 15], ["number", 3], ["price", #<BigDecimal:7f74f465ca78,'0.0',9(27)>], ["total_price", #<BigDecimal:7f74f465c960,'0.0',9(18)>], ["created_at", 2017-04-29 01:04:57 UTC], ["updated_at", 2017-04-29 01:04:57 UTC]]
  [1m[35m (1.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND (1=1)[0m  [["stage_id", 40]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mAudited::Audit Load (0.9ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 15], ["auditable_type", "Budget"], ["LIMIT", 1]]
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 15], ["auditable_type", "Budget"], ["user_id", 1], ["user_type", "User"], ["action", "update"], ["audited_changes", "---\nfloors:\n- \n- !ruby/object:BigDecimal 18:0.1E1\nprice_by_area_per_stage_discounted:\n- - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n- - !ruby/object:BigDecimal 9:NaN\n  - !ruby/object:BigDecimal 9:NaN\n  - !ruby/object:BigDecimal 9:NaN\n"], ["version", 2], ["remote_address", "127.0.0.1"], ["request_uuid", "70967b41-c073-4c56-81b3-f6d2d58360e2"], ["created_at", 2017-04-29 01:04:57 UTC]]
  [1m[35mSQL (1.7ms)[0m  [1m[33mUPDATE "budgets" SET "floors" = $1, "price_by_area_per_stage_discounted" = $2, "updated_at" = $3 WHERE "budgets"."id" = $4[0m  [["floors", #<BigDecimal:7f7500b73eb0,'0.1E1',9(27)>], ["price_by_area_per_stage_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f74f0dc12b8 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f74ed5c70d8,'NaN',9(18)>, #<BigDecimal:7f74ed5c6b38,'NaN',9(18)>, #<BigDecimal:7f74ed5c6548,'NaN',9(18)>]>], ["updated_at", 2017-04-29 01:04:57 UTC], ["id", 15]]
  [1m[35m (4.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mAudited::Audit Load (0.7ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 15], ["auditable_type", "Budget"], ["LIMIT", 1]]
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 15], ["auditable_type", "Budget"], ["user_id", 1], ["user_type", "User"], ["action", "update"], ["audited_changes", "---\nprice_by_area_per_stage_discounted:\n- - !ruby/object:BigDecimal 9:NaN\n  - !ruby/object:BigDecimal 9:NaN\n  - !ruby/object:BigDecimal 9:NaN\n- - !ruby/object:BigDecimal 9:NaN\n  - !ruby/object:BigDecimal 9:NaN\n  - !ruby/object:BigDecimal 9:NaN\n"], ["version", 3], ["remote_address", "127.0.0.1"], ["request_uuid", "70967b41-c073-4c56-81b3-f6d2d58360e2"], ["created_at", 2017-04-29 01:04:57 UTC]]
  [1m[35mSQL (0.7ms)[0m  [1m[33mUPDATE "budgets" SET "price_by_area_per_stage_discounted" = $1, "updated_at" = $2 WHERE "budgets"."id" = $3[0m  [["price_by_area_per_stage_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f74f0dc12b8 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f7500a85878,'NaN',9(18)>, #<BigDecimal:7f7500a852b0,'NaN',9(18)>, #<BigDecimal:7f7500a84d10,'NaN',9(18)>]>], ["updated_at", 2017-04-29 01:04:57 UTC], ["id", 15]]
  [1m[35m (1.5ms)[0m  [1m[35mCOMMIT[0m
Redirected to http://localhost:3000/estimates?client_id=4
Completed 302 Found in 223ms (ActiveRecord: 35.6ms)


Started GET "/estimates?client_id=4" for 127.0.0.1 at 2017-04-29 04:04:57 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"4"}
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
  [1m[36mEstimate Load (2.5ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = 4[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (3.3ms)
  [1m[36mClient Load (0.9ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered estimates/index.html.haml within layouts/application (27.4ms)
  Rendered layouts/_header.html.haml (15.2ms)
Completed 200 OK in 589ms (Views: 572.0ms | ActiveRecord: 7.4ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-29 04:05:02 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (1.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (0.8ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL[0m
  Rendered solutions/index.html.haml within layouts/application (8.7ms)
  Rendered layouts/_header.html.haml (9.6ms)
Completed 200 OK in 568ms (Views: 562.4ms | ActiveRecord: 2.1ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-29 04:06:47 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (3.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (0.7ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL[0m
  Rendered solutions/index.html.haml within layouts/application (8.4ms)
  Rendered layouts/_header.html.haml (8.8ms)
Completed 200 OK in 2247ms (Views: 2237.6ms | ActiveRecord: 4.5ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-29 04:07:51 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (1.0ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2)[0m
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" IN (1, 2)[0m
  [1m[35m (1.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (9.0ms)
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (5.3ms)
  Rendered clients/_table.html.haml (20.1ms)
  [1m[36mUserClient Load (0.9ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (42.7ms)
  Rendered layouts/_header.html.haml (9.9ms)
Completed 200 OK in 571ms (Views: 561.1ms | ActiveRecord: 5.8ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-29 04:07:53 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (1.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (2.9ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL[0m
  Rendered solutions/index.html.haml within layouts/application (13.1ms)
  Rendered layouts/_header.html.haml (9.6ms)
Completed 200 OK in 558ms (Views: 543.4ms | ActiveRecord: 4.4ms)


Started GET "/solutions/new" for 127.0.0.1 at 2017-04-29 04:07:56 +0300
Processing by SolutionsController#new as HTML
  [1m[36mProduct Load (1.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.5ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.1ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (1.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (2.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.5ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (1.2ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.5ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.9ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (2.0ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (2.1ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.5ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.6ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/new.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered solutions/_client_file_fields.html.haml (3.6ms)
  Rendered solutions/_technical_file_fields.html.haml (3.0ms)
  Rendered solutions/_discount.html.haml (9.4ms)
  Rendered solutions/_stages.html.haml (18.0ms)
  Rendered solutions/_form.html.haml (80.6ms)
  Rendered solutions/new.html.haml within layouts/application (84.5ms)
  Rendered layouts/_header.html.haml (8.2ms)
Completed 200 OK in 697ms (Views: 602.6ms | ActiveRecord: 22.7ms)


Started GET "/solutions/new" for 127.0.0.1 at 2017-04-29 04:37:59 +0300
Processing by SolutionsController#new as HTML
  [1m[36mProduct Load (2.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.3ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (1.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (1.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.0ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (1.9ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.6ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/new.html.haml within layouts/application
  Rendered solutions/_form.html.haml (27.3ms)
  Rendered solutions/new.html.haml within layouts/application (31.9ms)
Completed 500 Internal Server Error in 127ms (ActiveRecord: 21.0ms)


  
ActionView::Template::Error (undefined method `model_name' for nil:NilClass):
    1: = simple_form_for @solution,  wrapper: :horizontal_form do |f|
    2:   .action-buttons.row
    3:     = link_to 'Отмена', solutions_path, class: 'btn btn-default'
    4:     = f.button :submit, 'Сохранить', class: 'btn btn-success pull-right'
  
app/views/solutions/_form.html.haml:1:in `_app_views_solutions__form_html_haml__754661016047972805_70070189519140'
app/views/solutions/new.html.haml:7:in `_app_views_solutions_new_html_haml__2139377642151108362_70070189120540'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (6.7ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (3.2ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.3ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (39.3ms)
Started GET "/solutions/new" for 127.0.0.1 at 2017-04-29 04:38:12 +0300
Processing by SolutionsController#new as HTML
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.5ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (3.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (1.0ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.6ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/new.html.haml within layouts/application
  Rendered solutions/_form.html.haml (18.4ms)
  Rendered solutions/new.html.haml within layouts/application (21.3ms)
Completed 500 Internal Server Error in 114ms (ActiveRecord: 20.2ms)


  
ActionView::Template::Error (undefined method `model_name' for nil:NilClass):
    1: = simple_form_for @esimate,  wrapper: :horizontal_form do |f|
    2:   .action-buttons.row
    3:     = link_to 'Отмена', solutions_path, class: 'btn btn-default'
    4:     = f.button :submit, 'Сохранить', class: 'btn btn-success pull-right'
  
app/views/solutions/_form.html.haml:1:in `_app_views_solutions__form_html_haml__754661016047972805_70070146305780'
app/views/solutions/new.html.haml:7:in `_app_views_solutions_new_html_haml__2139377642151108362_70070146515500'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (6.9ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.5ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.0ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (32.0ms)
Started GET "/solutions/new" for 127.0.0.1 at 2017-04-29 04:38:18 +0300
Processing by SolutionsController#new as HTML
  [1m[36mProduct Load (1.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.1ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.9ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.6ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (1.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (2.1ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.9ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.6ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/new.html.haml within layouts/application
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered solutions/_client_file_fields.html.haml (3.7ms)
  Rendered solutions/_technical_file_fields.html.haml (3.3ms)
  Rendered solutions/_discount.html.haml (6.0ms)
  Rendered solutions/_form.html.haml (58.2ms)
  Rendered solutions/new.html.haml within layouts/application (60.9ms)
Completed 500 Internal Server Error in 150ms (ActiveRecord: 20.0ms)


  
ActionView::Template::Error (Missing partial ../budgets/_stages with {:locale=>[:en], :formats=>[:html], :variants=>[], :handlers=>[:raw, :erb, :html, :builder, :ruby, :coffee, :haml, :jbuilder]}. Searched in:
  * "/home/g1nc/Development/ruby/constructor/app/views"
  * "/home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/bootstrap-kaminari-views-0.0.5/app/views"
  * "/home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/kaminari-core-1.0.1/app/views"
  * "/home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/devise-4.2.0/app/views"
):
    93:         = render 'discount', f: f
    94: 
    95:   %p
    96:   = render '../budgets/stages', f: f
    97: 
    98:   %p
    99:   .row.main-content
  
app/views/solutions/_form.html.haml:96:in `block in _app_views_solutions__form_html_haml__754661016047972805_70070136794820'
app/views/solutions/_form.html.haml:1:in `_app_views_solutions__form_html_haml__754661016047972805_70070136794820'
app/views/solutions/new.html.haml:7:in `_app_views_solutions_new_html_haml__2139377642151108362_70070133341440'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (8.0ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (3.1ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.2ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (36.0ms)
Started GET "/solutions/new" for 127.0.0.1 at 2017-04-29 04:38:30 +0300
Processing by SolutionsController#new as HTML
  [1m[36mProduct Load (1.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.4ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (2.4ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.5ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (1.6ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.9ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (4.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (5.1ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/new.html.haml within layouts/application
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered solutions/_client_file_fields.html.haml (3.0ms)
  Rendered solutions/_technical_file_fields.html.haml (3.0ms)
  Rendered solutions/_discount.html.haml (5.9ms)
  Rendered budgets/_stages.html.haml (22.0ms)
  Rendered solutions/_form.html.haml (82.8ms)
  Rendered solutions/new.html.haml within layouts/application (86.5ms)
  Rendered layouts/_header.html.haml (10.8ms)
Completed 200 OK in 799ms (Views: 703.5ms | ActiveRecord: 32.3ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-29 04:56:17 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (10.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (3.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.4ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (2.1ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUser Load (1.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (1.9ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (1.1ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_form.html.haml (100.4ms)
  Rendered estimates/new.html.haml within layouts/application (117.3ms)
Completed 500 Internal Server Error in 264ms (ActiveRecord: 22.3ms)


  
ActionView::Template::Error (Missing partial estimates/_client_file_fields, application/_client_file_fields with {:locale=>[:en], :formats=>[:html], :variants=>[], :handlers=>[:raw, :erb, :html, :builder, :ruby, :coffee, :haml, :jbuilder]}. Searched in:
  * "/home/g1nc/Development/ruby/constructor/app/views"
  * "/home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/bootstrap-kaminari-views-0.0.5/app/views"
  * "/home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/kaminari-core-1.0.1/app/views"
  * "/home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/devise-4.2.0/app/views"
):
    63:           /    Выберите файл
    64: 
    65:           %div{ style: 'dislpay: none' }
    66:             = link_to_add_association '', f, :client_files, id: 'create-file', 'data-association-insertion-method': 'append', 'data-association-insertion-node': '#client-files'
    67: 
    68:         .form-group
    69:           %label.col-sm-3.control-label
  
app/views/estimates/_form.html.haml:66:in `block in _app_views_estimates__form_html_haml___4445102110716318297_70070249074860'
app/views/estimates/_form.html.haml:1:in `_app_views_estimates__form_html_haml___4445102110716318297_70070249074860'
app/views/estimates/new.html.haml:8:in `_app_views_estimates_new_html_haml__3238045333593825097_70070191132800'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (13.1ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (4.9ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (2.7ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (61.6ms)
Started GET "/estimates/new" for 127.0.0.1 at 2017-04-29 04:56:46 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (11.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (2.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (2.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUser Load (2.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (4.2ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (2.1ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_form.html.haml (63.3ms)
  Rendered estimates/new.html.haml within layouts/application (66.0ms)
Completed 500 Internal Server Error in 138ms (ActiveRecord: 27.5ms)


  
ActionView::Template::Error (Missing partial estimates/_client_file_fields, application/_client_file_fields with {:locale=>[:en], :formats=>[:html], :variants=>[], :handlers=>[:raw, :erb, :html, :builder, :ruby, :coffee, :haml, :jbuilder]}. Searched in:
  * "/home/g1nc/Development/ruby/constructor/app/views"
  * "/home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/bootstrap-kaminari-views-0.0.5/app/views"
  * "/home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/kaminari-core-1.0.1/app/views"
  * "/home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/devise-4.2.0/app/views"
):
    63:           /    Выберите файл
    64: 
    65:           %div{ style: 'dislpay: none' }
    66:             = link_to_add_association '', f, :client_files, id: 'create-file', 'data-association-insertion-method': 'append', 'data-association-insertion-node': '#client-files'
    67: 
    68:         .form-group
    69:           %label.col-sm-3.control-label
  
app/views/estimates/_form.html.haml:66:in `block in _app_views_estimates__form_html_haml___4445102110716318297_70070112318480'
app/views/estimates/_form.html.haml:1:in `_app_views_estimates__form_html_haml___4445102110716318297_70070112318480'
app/views/estimates/new.html.haml:8:in `_app_views_estimates_new_html_haml__3238045333593825097_70070113041000'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (9.0ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (3.2ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (0.9ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (34.0ms)
Started GET "/solutions/new" for 127.0.0.1 at 2017-04-29 04:58:11 +0300
Processing by SolutionsController#new as HTML
  [1m[36mProduct Load (5.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.2ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.5ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (1.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (2.4ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (2.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (1.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (1.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.9ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (1.4ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (2.1ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (1.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (1.0ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/new.html.haml within layouts/application
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered solutions/_form.html.haml (35.4ms)
  Rendered solutions/new.html.haml within layouts/application (39.0ms)
Completed 500 Internal Server Error in 129ms (ActiveRecord: 30.7ms)


  
ActionView::Template::Error (Missing partial solutions/_client_file_fields, application/_client_file_fields with {:locale=>[:en], :formats=>[:html], :variants=>[], :handlers=>[:raw, :erb, :html, :builder, :ruby, :coffee, :haml, :jbuilder]}. Searched in:
  * "/home/g1nc/Development/ruby/constructor/app/views"
  * "/home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/bootstrap-kaminari-views-0.0.5/app/views"
  * "/home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/kaminari-core-1.0.1/app/views"
  * "/home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/devise-4.2.0/app/views"
):
    63:           /    Выберите файл
    64: 
    65:           %div{ style: 'dislpay: none' }
    66:             = link_to_add_association '', f, :client_files, id: 'create-file', 'data-association-insertion-method': 'append', 'data-association-insertion-node': '#client-files'
    67: 
    68:         .form-group
    69:           %label.col-sm-3.control-label
  
app/views/solutions/_form.html.haml:66:in `block in _app_views_solutions__form_html_haml__754661016047972805_70070078690080'
app/views/solutions/_form.html.haml:1:in `_app_views_solutions__form_html_haml__754661016047972805_70070078690080'
app/views/solutions/new.html.haml:7:in `_app_views_solutions_new_html_haml__2139377642151108362_70070083826660'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (12.7ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (3.4ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.1ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (39.1ms)
Started GET "/solutions/new" for 127.0.0.1 at 2017-04-29 04:59:17 +0300
Processing by SolutionsController#new as HTML
  [1m[36mProduct Load (5.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.3ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (1.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (1.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (2.6ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (0.8ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (1.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (1.1ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (1.3ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (1.0ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/new.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered solutions/_client_file_fields.html.haml (4.7ms)
  Rendered solutions/_technical_file_fields.html.haml (4.4ms)
  Rendered budgets/_discount.html.haml (12.8ms)
  Rendered budgets/_stages.html.haml (17.2ms)
  Rendered solutions/_form.html.haml (96.0ms)
  Rendered solutions/new.html.haml within layouts/application (102.8ms)
  Rendered layouts/_header.html.haml (9.9ms)
Completed 200 OK in 755ms (Views: 636.2ms | ActiveRecord: 28.3ms)


DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
  [1m[36mActiveRecord::SchemaMigration Load (5.3ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT pg_try_advisory_lock(6572146483646705745);[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Migrating to RenameEstimatesTable (20170428235151)
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.6ms)[0m  [1m[35mALTER TABLE "technical_files" RENAME COLUMN "budget_id" TO "estimate_id"[0m
  [1m[35m (2.7ms)[0m  [1m[35mALTER INDEX "index_technical_files_on_budget_id" RENAME TO "index_technical_files_on_estimate_id"[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "client_files" RENAME COLUMN "budget_id" TO "estimate_id"[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER INDEX "index_client_files_on_budget_id" RENAME TO "index_client_files_on_estimate_id"[0m
  [1m[35m (2.7ms)[0m  [1m[35mALTER TABLE "stages" RENAME COLUMN "budget_id" TO "estimate_id"[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER INDEX "index_stages_on_budget_id" RENAME TO "index_stages_on_estimate_id"[0m
  [1m[35m (5.3ms)[0m  [1m[35mALTER TABLE "budgets" DROP "proposer_id"[0m
  [1m[35m (6.4ms)[0m  [1m[35mALTER TABLE "budgets" DROP "proposed"[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "budgets" DROP "type"[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "budgets" RENAME TO "estimates"[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "public"."budgets_id_seq" RENAME TO "estimates_id_seq"[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER INDEX "budgets_pkey" RENAME TO "estimates_pkey"[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER INDEX "index_budgets_on_client_id" RENAME TO "index_estimates_on_client_id"[0m
  [1m[35mSQL (1.1ms)[0m  [1m[31mDELETE FROM "schema_migrations" WHERE "schema_migrations"."version" = $1[0m  [["version", "20170428235151"]]
  [1m[35m (6.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT pg_advisory_unlock(6572146483646705745)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
  [1m[35m (0.5ms)[0m  [1m[34mSELECT pg_try_advisory_lock(6572146483646705745);[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.9ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Migrating to RenameEstimatesTable (20170428235151)
  [1m[35m (0.7ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "estimates" RENAME TO "budgets"[0m
  [1m[35m (3.5ms)[0m  [1m[35mALTER TABLE "public"."estimates_id_seq" RENAME TO "budgets_id_seq"[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER INDEX "estimates_pkey" RENAME TO "budgets_pkey"[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER INDEX "index_estimates_on_client_id" RENAME TO "index_budgets_on_client_id"[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER TABLE "budgets" ADD "type" character varying[0m
  [1m[35m (1.6ms)[0m  [1m[35mALTER TABLE "budgets" ADD "link" character varying[0m
  [1m[35m (28.8ms)[0m  [1m[35mALTER TABLE "budgets" ADD "proposed" boolean DEFAULT 'f'[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "budgets" ADD "proposer_id" integer[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "stages" RENAME COLUMN "estimate_id" TO "budget_id"[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER INDEX "index_stages_on_estimate_id" RENAME TO "index_stages_on_budget_id"[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "client_files" RENAME COLUMN "estimate_id" TO "budget_id"[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER INDEX "index_client_files_on_estimate_id" RENAME TO "index_client_files_on_budget_id"[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "technical_files" RENAME COLUMN "estimate_id" TO "budget_id"[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER INDEX "index_technical_files_on_estimate_id" RENAME TO "index_technical_files_on_budget_id"[0m
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20170428235151"]]
  [1m[35m (3.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.5ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (1.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT pg_advisory_unlock(6572146483646705745)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT pg_try_advisory_lock(6572146483646705745);[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Migrating to RenameEstimatesTable (20170428235151)
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "technical_files" RENAME COLUMN "budget_id" TO "estimate_id"[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER INDEX "index_technical_files_on_budget_id" RENAME TO "index_technical_files_on_estimate_id"[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "client_files" RENAME COLUMN "budget_id" TO "estimate_id"[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER INDEX "index_client_files_on_budget_id" RENAME TO "index_client_files_on_estimate_id"[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "stages" RENAME COLUMN "budget_id" TO "estimate_id"[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER INDEX "index_stages_on_budget_id" RENAME TO "index_stages_on_estimate_id"[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "budgets" DROP "proposer_id"[0m
  [1m[35m (5.2ms)[0m  [1m[35mALTER TABLE "budgets" DROP "proposed"[0m
  [1m[35m (2.9ms)[0m  [1m[35mALTER TABLE "budgets" DROP "link"[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "budgets" DROP "type"[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "budgets" RENAME TO "estimates"[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "public"."budgets_id_seq" RENAME TO "estimates_id_seq"[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER INDEX "budgets_pkey" RENAME TO "estimates_pkey"[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER INDEX "index_budgets_on_client_id" RENAME TO "index_estimates_on_client_id"[0m
  [1m[35mSQL (2.0ms)[0m  [1m[31mDELETE FROM "schema_migrations" WHERE "schema_migrations"."version" = $1[0m  [["version", "20170428235151"]]
  [1m[35m (4.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT pg_advisory_unlock(6572146483646705745)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
  [1m[35m (0.5ms)[0m  [1m[34mSELECT pg_try_advisory_lock(6572146483646705745);[0m
  [1m[36mActiveRecord::SchemaMigration Load (2.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Migrating to RenameEstimatesTable (20170428235151)
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "estimates" RENAME TO "budgets"[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "public"."estimates_id_seq" RENAME TO "budgets_id_seq"[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER INDEX "estimates_pkey" RENAME TO "budgets_pkey"[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER INDEX "index_estimates_on_client_id" RENAME TO "index_budgets_on_client_id"[0m
  [1m[35m (2.0ms)[0m  [1m[35mALTER TABLE "budgets" ADD "type" character varying[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "budgets" ADD "url" character varying[0m
  [1m[35m (17.4ms)[0m  [1m[35mALTER TABLE "budgets" ADD "proposed" boolean DEFAULT 'f'[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "budgets" ADD "proposer_id" integer[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "stages" RENAME COLUMN "estimate_id" TO "budget_id"[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER INDEX "index_stages_on_estimate_id" RENAME TO "index_stages_on_budget_id"[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "client_files" RENAME COLUMN "estimate_id" TO "budget_id"[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER INDEX "index_client_files_on_estimate_id" RENAME TO "index_client_files_on_budget_id"[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "technical_files" RENAME COLUMN "estimate_id" TO "budget_id"[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER INDEX "index_technical_files_on_estimate_id" RENAME TO "index_technical_files_on_budget_id"[0m
  [1m[35mSQL (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20170428235151"]]
  [1m[35m (3.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT pg_advisory_unlock(6572146483646705745)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
Started GET "/solutions/new" for 127.0.0.1 at 2017-04-29 17:26:50 +0300
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Processing by SolutionsController#new as HTML
  [1m[36mProduct Load (3.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (4.1ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (3.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (3.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (1.3ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (4.4ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (2.0ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (5.2ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (3.0ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (2.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (1.7ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/new.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (1838.5ms)
  Rendered solutions/_technical_file_fields.html.haml (6.3ms)
  Rendered budgets/_discount.html.haml (8.4ms)
  Rendered budgets/_stages.html.haml (21.6ms)
  Rendered solutions/_form.html.haml (1971.7ms)
  Rendered solutions/new.html.haml within layouts/application (1980.0ms)
  Rendered layouts/_header.html.haml (36.3ms)
Completed 200 OK in 3071ms (Views: 2592.6ms | ActiveRecord: 106.5ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-29 18:24:38 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (2.4ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL[0m
  Rendered solutions/index.html.haml within layouts/application (12.5ms)
  Rendered layouts/_header.html.haml (10.0ms)
Completed 200 OK in 560ms (Views: 546.4ms | ActiveRecord: 3.0ms)


Started GET "/solutions/new" for 127.0.0.1 at 2017-04-29 18:24:40 +0300
Processing by SolutionsController#new as HTML
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.4ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (2.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (1.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (1.1ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (2.8ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (1.7ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.5ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.5ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.5ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.6ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/new.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (4.9ms)
  Rendered solutions/_technical_file_fields.html.haml (7.0ms)
  Rendered budgets/_discount.html.haml (10.1ms)
  Rendered budgets/_stages.html.haml (24.7ms)
  Rendered solutions/_form.html.haml (129.4ms)
  Rendered solutions/new.html.haml within layouts/application (132.3ms)
  Rendered layouts/_header.html.haml (7.4ms)
Completed 200 OK in 739ms (Views: 656.3ms | ActiveRecord: 20.8ms)


Started POST "/estimates" for 127.0.0.1 at 2017-04-29 18:24:47 +0300
Processing by EstimatesController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"y/tTMv54n4fYy/RpfQVXdzqke0plKQk8h0K3MVXp7JnOFltk4Xs1X5VCK00DftShDjpYef4B1kIWUZgi5LOP5w==", "commit"=>"Сохранить", "estimate"=>{"price"=>"0", "name"=>"124", "url"=>"", "area"=>"124", "first_floor_height"=>"124", "second_floor_height_min"=>"0.0", "second_floor_height_max"=>"0.0", "third_floor_height_min"=>"0.0", "third_floor_height_max"=>"0.0", "discount_title"=>"", "discount_by_stages"=>{"0"=>"0", "1"=>"0", "2"=>"0"}}, "json_stages"=>"[{\"number\":1,\"text\":{\"name\":\"Первый этап\",\"summ\":\"Итого по первому этапу:\",\"summ_dis\":\"по первому этапу\",\"discount\":\"Итого по первому этапу со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":0},{\"number\":2,\"text\":{\"name\":\"Второй этап\",\"summ\":\"Итого по двум этапам:\",\"summ_dis\":\"по второму этапу\",\"discount\":\"Итого по двум этапам со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":0},{\"number\":3,\"text\":{\"name\":\"Третий этап\",\"summ\":\"Итого по трем этапам:\",\"summ_dis\":\"по третьему этапу\",\"discount\":\"Итого по трем этапам со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":0}]", "data"=>""}
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Unpermitted parameters: url, second_floor_height_min, second_floor_height_max, third_floor_height_min, third_floor_height_max, discount_by_stages
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mExpense Load (0.7ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (2.9ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (8.4ms)
  Rendered estimates/_technical_file_fields.html.haml (3.0ms)
  Rendered budgets/_discount.html.haml (7.5ms)
  Rendered budgets/_stages.html.haml (18.6ms)
  Rendered estimates/_form.html.haml (111.3ms)
  Rendered estimates/new.html.haml within layouts/application (114.4ms)
  Rendered layouts/_header.html.haml (9.4ms)
Completed 200 OK in 684ms (Views: 616.3ms | ActiveRecord: 18.2ms)


Started POST "/estimates" for 127.0.0.1 at 2017-04-29 18:28:39 +0300
Processing by EstimatesController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"6rIRrtLSOuMIYjOyX8KQxg+iPrV5TiZygEZgA/3COtXvXxn4zdGQO0Xr7JYhuRMQOzwdhuJm+QwRVU8QTJhZqw==", "commit"=>"Сохранить", "estimate"=>{"price"=>"0", "name"=>"124124", "url"=>"124", "area"=>"124", "first_floor_height"=>"124", "second_floor_height_min"=>"0.0", "second_floor_height_max"=>"0.0", "third_floor_height_min"=>"0.0", "third_floor_height_max"=>"0.0", "discount_title"=>"", "discount_by_stages"=>{"0"=>"0", "1"=>"0", "2"=>"0"}}, "json_stages"=>"[{\"number\":1,\"text\":{\"name\":\"Первый этап\",\"summ\":\"Итого по первому этапу:\",\"summ_dis\":\"по первому этапу\",\"discount\":\"Итого по первому этапу со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":0},{\"number\":2,\"text\":{\"name\":\"Второй этап\",\"summ\":\"Итого по двум этапам:\",\"summ_dis\":\"по второму этапу\",\"discount\":\"Итого по двум этапам со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":0},{\"number\":3,\"text\":{\"name\":\"Третий этап\",\"summ\":\"Итого по трем этапам:\",\"summ_dis\":\"по третьему этапу\",\"discount\":\"Итого по трем этапам со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":0}]", "data"=>""}
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.3ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Unpermitted parameters: url, second_floor_height_min, second_floor_height_max, third_floor_height_min, third_floor_height_max, discount_by_stages
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.5ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (7.7ms)
  Rendered estimates/_technical_file_fields.html.haml (6.1ms)
  Rendered budgets/_discount.html.haml (7.9ms)
  Rendered budgets/_stages.html.haml (20.6ms)
  Rendered estimates/_form.html.haml (159.7ms)
  Rendered estimates/new.html.haml within layouts/application (162.9ms)
  Rendered layouts/_header.html.haml (28.0ms)
Completed 200 OK in 1110ms (Views: 816.7ms | ActiveRecord: 54.0ms)


Started GET "/solutions/new" for 127.0.0.1 at 2017-04-29 18:28:45 +0300
Processing by SolutionsController#new as HTML
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (4.2ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.5ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.6ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 73ms (ActiveRecord: 9.8ms)


  
NoMethodError (undefined method `discount_by_stages' for nil:NilClass):
  
app/controllers/solutions_controller.rb:141:in `get_json_values'
app/controllers/solutions_controller.rb:18:in `new'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (9.7ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.7ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (0.9ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (41.6ms)
Started GET "/solutions/new" for 127.0.0.1 at 2017-04-29 18:29:20 +0300
Processing by SolutionsController#new as HTML
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.5ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.6ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/new.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (7.2ms)
  Rendered solutions/_technical_file_fields.html.haml (4.7ms)
  Rendered budgets/_discount.html.haml (7.5ms)
  Rendered budgets/_stages.html.haml (15.7ms)
  Rendered solutions/_form.html.haml (100.3ms)
  Rendered solutions/new.html.haml within layouts/application (103.6ms)
  Rendered layouts/_header.html.haml (56.6ms)
Completed 200 OK in 915ms (Views: 652.6ms | ActiveRecord: 46.7ms)


Started POST "/solutions" for 127.0.0.1 at 2017-04-29 18:29:28 +0300
Processing by SolutionsController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"pHfTYQxDP2kMFI7Bt566aXFhVBioC8QAvKKPbg2jcaWhmts3E0CVsUGdUeXJ5Tm/Rf93KzMjG34tsaB9vPkS2w==", "commit"=>"Сохранить", "estimate"=>{"price"=>"0", "discount_by_stages"=>{"0"=>"0", "1"=>"0", "2"=>"0"}}, "json_stages"=>"[{\"number\":1,\"text\":{\"name\":\"Первый этап\",\"summ\":\"Итого по первому этапу:\",\"summ_dis\":\"по первому этапу\",\"discount\":\"Итого по первому этапу со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":0},{\"number\":2,\"text\":{\"name\":\"Второй этап\",\"summ\":\"Итого по двум этапам:\",\"summ_dis\":\"по второму этапу\",\"discount\":\"Итого по двум этапам со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":0},{\"number\":3,\"text\":{\"name\":\"Третий этап\",\"summ\":\"Итого по трем этапам:\",\"summ_dis\":\"по третьему этапу\",\"discount\":\"Итого по трем этапам со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":0}]", "solution"=>{"name"=>"123", "url"=>"123", "area"=>"123", "first_floor_height"=>"123", "second_floor_height_min"=>"0.0", "second_floor_height_max"=>"0.0", "third_floor_height_min"=>"0.0", "third_floor_height_max"=>"0.0", "discount_title"=>""}, "data"=>""}
  [1m[36mProduct Load (3.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (2.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Unpermitted parameter: discount_by_stages
Completed 500 Internal Server Error in 66ms (ActiveRecord: 9.2ms)


  
NoMethodError (undefined method `each' for nil:NilClass):
  
app/controllers/solutions_controller.rb:23:in `create'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (4.8ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.1ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (2.6ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (31.3ms)
Started GET "/solutions/new" for 127.0.0.1 at 2017-04-29 18:31:26 +0300
Processing by SolutionsController#new as HTML
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/new.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (7.8ms)
  Rendered solutions/_technical_file_fields.html.haml (9.4ms)
  Rendered budgets/_discount.html.haml (6.1ms)
  Rendered budgets/_stages.html.haml (18.8ms)
  Rendered solutions/_form.html.haml (105.3ms)
  Rendered solutions/new.html.haml within layouts/application (108.3ms)
  Rendered layouts/_header.html.haml (33.1ms)
Completed 200 OK in 1083ms (Views: 795.2ms | ActiveRecord: 50.6ms)


Started POST "/solutions" for 127.0.0.1 at 2017-04-29 18:31:33 +0300
Processing by SolutionsController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"MOeyjECyPcXyZ/aazyrA2/E9zUq4TZK5nlAlMFq5CjA1CrraX7GXHb/uKb6xUUMNxaPueSNlTccPQwoj6+NpTg==", "commit"=>"Сохранить", "estimate"=>{"price"=>"0"}, "json_stages"=>"[{\"number\":1,\"text\":{\"name\":\"Первый этап\",\"summ\":\"Итого по первому этапу:\",\"summ_dis\":\"по первому этапу\",\"discount\":\"Итого по первому этапу со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":0},{\"number\":2,\"text\":{\"name\":\"Второй этап\",\"summ\":\"Итого по двум этапам:\",\"summ_dis\":\"по второму этапу\",\"discount\":\"Итого по двум этапам со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":0},{\"number\":3,\"text\":{\"name\":\"Третий этап\",\"summ\":\"Итого по трем этапам:\",\"summ_dis\":\"по третьему этапу\",\"discount\":\"Итого по трем этапам со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":0}]", "solution"=>{"name"=>"123", "url"=>"123", "area"=>"123", "first_floor_height"=>"123", "second_floor_height_min"=>"0.0", "second_floor_height_max"=>"0.0", "third_floor_height_min"=>"0.0", "third_floor_height_max"=>"0.0", "discount_title"=>"", "discount_by_stages"=>{"0"=>"0", "1"=>"0", "2"=>"0"}}, "data"=>""}
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.9ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 53ms (ActiveRecord: 4.0ms)


  
NoMethodError (undefined method `each' for nil:NilClass):
  
app/controllers/solutions_controller.rb:23:in `create'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (4.7ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.3ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.9ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (30.5ms)
Started GET "/solutions/new" for 127.0.0.1 at 2017-04-29 18:31:54 +0300
Processing by SolutionsController#new as HTML
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.4ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/new.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (7.4ms)
  Rendered solutions/_technical_file_fields.html.haml (4.9ms)
  Rendered budgets/_discount.html.haml (6.4ms)
  Rendered budgets/_stages.html.haml (19.8ms)
  Rendered solutions/_form.html.haml (137.1ms)
  Rendered solutions/new.html.haml within layouts/application (141.7ms)
  Rendered layouts/_header.html.haml (26.9ms)
Completed 200 OK in 906ms (Views: 634.5ms | ActiveRecord: 55.4ms)


Started POST "/solutions" for 127.0.0.1 at 2017-04-29 18:31:59 +0300
Processing by SolutionsController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"IYxZACNM80oerp/l4tEAMyjYAY80O5U/jOlnuTlrNm4kYVFWPE9ZklMnQMGcqoPlHEYivK8TSkEd+kiqiDFVEA==", "commit"=>"Сохранить", "estimate"=>{"price"=>"0"}, "json_stages"=>"[{\"number\":1,\"text\":{\"name\":\"Первый этап\",\"summ\":\"Итого по первому этапу:\",\"summ_dis\":\"по первому этапу\",\"discount\":\"Итого по первому этапу со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":0},{\"number\":2,\"text\":{\"name\":\"Второй этап\",\"summ\":\"Итого по двум этапам:\",\"summ_dis\":\"по второму этапу\",\"discount\":\"Итого по двум этапам со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":0},{\"number\":3,\"text\":{\"name\":\"Третий этап\",\"summ\":\"Итого по трем этапам:\",\"summ_dis\":\"по третьему этапу\",\"discount\":\"Итого по трем этапам со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":0}]", "solution"=>{"name"=>"123", "url"=>"123", "area"=>"123", "first_floor_height"=>"123", "second_floor_height_min"=>"0.0", "second_floor_height_max"=>"0.0", "third_floor_height_min"=>"0.0", "third_floor_height_max"=>"0.0", "discount_title"=>"", "discount_by_stages"=>{"0"=>"0", "1"=>"0", "2"=>"0"}}, "data"=>""}
  [1m[36mProduct Load (2.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.5ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mExpense Load (0.3ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/new.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (3.7ms)
  Rendered solutions/_technical_file_fields.html.haml (3.7ms)
  Rendered budgets/_discount.html.haml (6.0ms)
  Rendered budgets/_stages.html.haml (14.3ms)
  Rendered solutions/_form.html.haml (73.9ms)
  Rendered solutions/new.html.haml within layouts/application (77.1ms)
  Rendered layouts/_header.html.haml (9.9ms)
Completed 200 OK in 649ms (Views: 586.7ms | ActiveRecord: 7.8ms)


Started POST "/solutions" for 127.0.0.1 at 2017-04-29 18:32:17 +0300
Processing by SolutionsController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"4U/Uabg+6ruXsaLwjMmhOXVVr9OnEMdgXw9cEzYqWUvkotw/pz1AY9o4fdTysiLvQcuM4Dw4GB7OHHMAh3A6NQ==", "commit"=>"Сохранить", "estimate"=>{"price"=>"0"}, "json_stages"=>"[{\"number\":1,\"text\":{\"name\":\"Первый этап\",\"summ\":\"Итого по первому этапу:\",\"summ_dis\":\"по первому этапу\",\"discount\":\"Итого по первому этапу со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":0},{\"number\":2,\"text\":{\"name\":\"Второй этап\",\"summ\":\"Итого по двум этапам:\",\"summ_dis\":\"по второму этапу\",\"discount\":\"Итого по двум этапам со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":0},{\"number\":3,\"text\":{\"name\":\"Третий этап\",\"summ\":\"Итого по трем этапам:\",\"summ_dis\":\"по третьему этапу\",\"discount\":\"Итого по трем этапам со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":0}]", "solution"=>{"name"=>"124124", "url"=>"123123", "area"=>"12321", "first_floor_height"=>"3123123", "second_floor_height_min"=>"0.0", "second_floor_height_max"=>"0.0", "third_floor_height_min"=>"0.0", "third_floor_height_max"=>"0.0", "discount_title"=>"", "discount_by_stages"=>{"0"=>"0", "1"=>"0", "2"=>"0"}}, "data"=>""}
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUser Load (1.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mExpense Load (0.3ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/new.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (3.0ms)
  Rendered solutions/_technical_file_fields.html.haml (2.9ms)
  Rendered budgets/_discount.html.haml (6.5ms)
  Rendered budgets/_stages.html.haml (16.1ms)
  Rendered solutions/_form.html.haml (65.6ms)
  Rendered solutions/new.html.haml within layouts/application (68.7ms)
  Rendered layouts/_header.html.haml (39.9ms)
Completed 200 OK in 625ms (Views: 573.7ms | ActiveRecord: 6.2ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-29 18:32:36 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (0.9ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL[0m
  Rendered solutions/index.html.haml within layouts/application (7.1ms)
  Rendered layouts/_header.html.haml (84.4ms)
Completed 200 OK in 783ms (Views: 735.4ms | ActiveRecord: 13.1ms)


Started GET "/solutions/new" for 127.0.0.1 at 2017-04-29 18:32:38 +0300
Processing by SolutionsController#new as HTML
  [1m[36mProduct Load (1.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.9ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.4ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/new.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (16.1ms)
  Rendered solutions/_technical_file_fields.html.haml (7.1ms)
  Rendered budgets/_discount.html.haml (10.6ms)
  Rendered budgets/_stages.html.haml (25.0ms)
  Rendered solutions/_form.html.haml (140.3ms)
  Rendered solutions/new.html.haml within layouts/application (143.4ms)
  Rendered layouts/_header.html.haml (13.9ms)
Completed 200 OK in 893ms (Views: 674.4ms | ActiveRecord: 36.1ms)


Started POST "/solutions" for 127.0.0.1 at 2017-04-29 18:32:43 +0300
Processing by SolutionsController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"dcP+hMoNPkofCW4n9EyNJ69w6RihMD5Q45NqbQt7yntwLvbS1Q6UklKAsQOKNw7xm+7KKzoY4S5ygEV+uiGpBQ==", "commit"=>"Сохранить", "estimate"=>{"price"=>"0"}, "json_stages"=>"[{\"number\":1,\"text\":{\"name\":\"Первый этап\",\"summ\":\"Итого по первому этапу:\",\"summ_dis\":\"по первому этапу\",\"discount\":\"Итого по первому этапу со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":0},{\"number\":2,\"text\":{\"name\":\"Второй этап\",\"summ\":\"Итого по двум этапам:\",\"summ_dis\":\"по второму этапу\",\"discount\":\"Итого по двум этапам со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":0},{\"number\":3,\"text\":{\"name\":\"Третий этап\",\"summ\":\"Итого по трем этапам:\",\"summ_dis\":\"по третьему этапу\",\"discount\":\"Итого по трем этапам со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":0}]", "solution"=>{"name"=>"123", "url"=>"123", "area"=>"123", "first_floor_height"=>"123", "second_floor_height_min"=>"0.0", "second_floor_height_max"=>"0.0", "third_floor_height_min"=>"0.0", "third_floor_height_max"=>"0.0", "discount_title"=>"", "discount_by_stages"=>{"0"=>"0", "1"=>"0", "2"=>"0"}}, "data"=>""}
  [1m[36mProduct Load (1.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (2.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (2.1ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Unpermitted parameters: url, second_floor_height_min, second_floor_height_max, third_floor_height_min, third_floor_height_max, discount_by_stages
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mExpense Load (0.6ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/new.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (3.4ms)
  Rendered solutions/_technical_file_fields.html.haml (3.0ms)
  Rendered budgets/_discount.html.haml (6.7ms)
  Rendered budgets/_stages.html.haml (19.2ms)
  Rendered solutions/_form.html.haml (77.2ms)
  Rendered solutions/new.html.haml within layouts/application (80.2ms)
  Rendered layouts/_header.html.haml (15.3ms)
Completed 200 OK in 681ms (Views: 601.3ms | ActiveRecord: 9.0ms)


DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
Started GET "/solutions" for 127.0.0.1 at 2017-04-29 19:08:56 +0300
  [1m[36mActiveRecord::SchemaMigration Load (1.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (1.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (1.4ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL[0m
  Rendered solutions/index.html.haml within layouts/application (12.2ms)
Started GET "/solutions" for 127.0.0.1 at 2017-04-29 19:08:57 +0300
Started GET "/solutions" for 127.0.0.1 at 2017-04-29 19:08:57 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (7.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Processing by SolutionsController#index as HTML
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mUser Load (7.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (10.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL[0m
  Rendered solutions/index.html.haml within layouts/application (22.8ms)
  [1m[36mSolution Load (1.5ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL[0m
  Rendered solutions/index.html.haml within layouts/application (9.1ms)
Completed 500 Internal Server Error in 3354ms (ActiveRecord: 17.7ms)


  
ActionView::Template::Error (can't add a new key into hash during iteration):
     5:     %title Конструктор сметы - Арт СИП Строй
     6:     = csrf_meta_tags
     7:     = stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track': 'reload'
     8:     = javascript_include_tag 'application', 'data-turbolinks-track': 'reload'
     9: 
    10:   %body
    11:     = render 'layouts/header'
  
app/views/layouts/application.html.haml:8:in `_app_views_layouts_application_html_haml__1583011328027957626_69818956672720'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (8.5ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (3.2ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.2ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (102.7ms)
  Rendered layouts/_header.html.haml (202.4ms)
  Rendered layouts/_header.html.haml (181.6ms)
Completed 200 OK in 3857ms (Views: 3830.9ms | ActiveRecord: 17.7ms)


Completed 200 OK in 3832ms (Views: 3806.6ms | ActiveRecord: 8.6ms)


Started GET "/solutions/new" for 127.0.0.1 at 2017-04-29 19:09:05 +0300
Processing by SolutionsController#new as HTML
  [1m[36mProduct Load (1.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.5ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (1.0ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/new.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (14.3ms)
  Rendered solutions/_technical_file_fields.html.haml (5.8ms)
  Rendered budgets/_discount.html.haml (11.9ms)
  Rendered budgets/_stages.html.haml (21.6ms)
  Rendered solutions/_form.html.haml (151.6ms)
  Rendered solutions/new.html.haml within layouts/application (155.0ms)
  Rendered layouts/_header.html.haml (33.7ms)
Completed 200 OK in 996ms (Views: 737.3ms | ActiveRecord: 46.8ms)


Started POST "/solutions" for 127.0.0.1 at 2017-04-29 19:09:15 +0300
Processing by SolutionsController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"iyNXa0VR2ncPFMAANt67W2ZG99YDf2lhVlCLfNZvx6mOzl89WlJwr0KdHyRIpTiNUtjU5ZhXth/HQ6RvZzWk1w==", "commit"=>"Сохранить", "estimate"=>{"price"=>"0"}, "json_stages"=>"[{\"number\":1,\"text\":{\"name\":\"Первый этап\",\"summ\":\"Итого по первому этапу:\",\"summ_dis\":\"по первому этапу\",\"discount\":\"Итого по первому этапу со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":0},{\"number\":2,\"text\":{\"name\":\"Второй этап\",\"summ\":\"Итого по двум этапам:\",\"summ_dis\":\"по второму этапу\",\"discount\":\"Итого по двум этапам со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":0},{\"number\":3,\"text\":{\"name\":\"Третий этап\",\"summ\":\"Итого по трем этапам:\",\"summ_dis\":\"по третьему этапу\",\"discount\":\"Итого по трем этапам со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":0}]", "solution"=>{"name"=>"111", "url"=>"2222", "area"=>"123", "first_floor_height"=>"123", "second_floor_height_min"=>"0.0", "second_floor_height_max"=>"0.0", "third_floor_height_min"=>"0.0", "third_floor_height_max"=>"0.0", "discount_title"=>"", "discount_by_stages"=>{"0"=>"0", "1"=>"0", "2"=>"0"}}, "data"=>""}
  [1m[36mProduct Load (2.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.4ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUser Load (1.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Unpermitted parameters: second_floor_height_min, second_floor_height_max, third_floor_height_min, third_floor_height_max, discount_by_stages
  [1m[35m (1.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mExpense Load (0.6ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/new.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (3.6ms)
  Rendered solutions/_technical_file_fields.html.haml (3.4ms)
  Rendered budgets/_discount.html.haml (7.3ms)
  Rendered budgets/_stages.html.haml (19.7ms)
  Rendered solutions/_form.html.haml (73.3ms)
  Rendered solutions/new.html.haml within layouts/application (76.4ms)
  Rendered layouts/_header.html.haml (9.3ms)
Completed 200 OK in 714ms (Views: 650.9ms | ActiveRecord: 11.9ms)


Started POST "/solutions" for 127.0.0.1 at 2017-04-29 19:09:36 +0300
Processing by SolutionsController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"WrwsU2VeaI9lbfupoWcWq57h0GQZhrCbvNK3xBFICBtfUSQFel3CVyjkJI3fHJV9qn/zV4Kub+UtwZjXoBJrZQ==", "commit"=>"Сохранить", "estimate"=>{"price"=>"NaN"}, "json_stages"=>"[{\"number\":1,\"text\":{\"name\":\"Первый этап\",\"summ\":\"Итого по первому этапу:\",\"summ_dis\":\"по первому этапу\",\"discount\":\"Итого по первому этапу со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":0},{\"number\":2,\"text\":{\"name\":\"Второй этап\",\"summ\":\"Итого по двум этапам:\",\"summ_dis\":\"по второму этапу\",\"discount\":\"Итого по двум этапам со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":0},{\"number\":3,\"text\":{\"name\":\"Третий этап\",\"summ\":\"Итого по трем этапам:\",\"summ_dis\":\"по третьему этапу\",\"discount\":\"Итого по трем этапам со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":0}]", "solution"=>{"name"=>"111", "url"=>"2222", "area"=>"123", "first_floor_height"=>"123", "second_floor_height_min"=>"0.0", "second_floor_height_max"=>"0.0", "third_floor_height_min"=>"0.0", "third_floor_height_max"=>"0.0", "discount_title"=>"", "discount_by_stages"=>{"0"=>"0", "1"=>"0", "2"=>"0"}}, "data"=>""}
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (5.1ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUser Load (3.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Unpermitted parameters: second_floor_height_min, second_floor_height_max, third_floor_height_min, third_floor_height_max, discount_by_stages
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mExpense Load (0.8ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/new.html.haml within layouts/application
Started GET "/solutions" for 127.0.0.1 at 2017-04-29 19:10:11 +0300
  Rendered solutions/_client_file_fields.html.haml (8.8ms)
  Rendered solutions/_technical_file_fields.html.haml (5.9ms)
  Rendered budgets/_discount.html.haml (6.6ms)
  Rendered budgets/_stages.html.haml (21.2ms)
  Rendered solutions/_form.html.haml (154.8ms)
  Rendered solutions/new.html.haml within layouts/application (161.7ms)
  Rendered layouts/_header.html.haml (24.5ms)
Completed 200 OK in 35798ms (Views: 749.8ms | ActiveRecord: 14.4ms)


Processing by SolutionsController#index as HTML
  [1m[36mUser Load (1.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (2.8ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL[0m
  Rendered solutions/index.html.haml within layouts/application (8.8ms)
  Rendered layouts/_header.html.haml (76.2ms)
Completed 200 OK in 701ms (Views: 663.7ms | ActiveRecord: 4.4ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-29 19:10:20 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (0.7ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL[0m
  Rendered solutions/index.html.haml within layouts/application (8.0ms)
  Rendered layouts/_header.html.haml (73.6ms)
Completed 200 OK in 592ms (Views: 558.5ms | ActiveRecord: 1.5ms)


Started GET "/solutions/new" for 127.0.0.1 at 2017-04-29 19:10:22 +0300
Processing by SolutionsController#new as HTML
  [1m[36mProduct Load (1.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.5ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUser Load (4.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.6ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/new.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (7.6ms)
  Rendered solutions/_technical_file_fields.html.haml (5.4ms)
  Rendered budgets/_discount.html.haml (9.7ms)
  Rendered budgets/_stages.html.haml (16.4ms)
  Rendered solutions/_form.html.haml (108.0ms)
  Rendered solutions/new.html.haml within layouts/application (112.0ms)
  Rendered layouts/_header.html.haml (16.9ms)
Completed 200 OK in 988ms (Views: 780.5ms | ActiveRecord: 48.5ms)


Started POST "/solutions" for 127.0.0.1 at 2017-04-29 19:10:35 +0300
Processing by SolutionsController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"u1viIHolyzaqZMYI6fvu2zDbWLlQlVt8Zk5f2tlDq/W+tup2ZSZh7uftGSyXgG0NBEV7isu9hAL3XXDJaBnIiw==", "commit"=>"Сохранить", "estimate"=>{"price"=>"1578.5"}, "json_stages"=>"[{\"number\":1,\"text\":{\"name\":\"Первый этап\",\"summ\":\"Итого по первому этапу:\",\"summ_dis\":\"по первому этапу\",\"discount\":\"Итого по первому этапу со скидкой:\"},\"products\":[{\"id\":1,\"name\":\"Простой продукт 1 этап\",\"unit\":\"шт\",\"custom\":false,\"sets\":[],\"profit\":100,\"price_with_work\":70,\"price_without_work\":10,\"$$hashKey\":\"object:30\",\"quantity\":\"11\",\"with_work\":true,\"price\":143.5}],\"price\":1578.5,\"total_price\":1578.5,\"aggregated_price\":1578.5,\"$$hashKey\":\"object:17\"},{\"number\":2,\"text\":{\"name\":\"Второй этап\",\"summ\":\"Итого по двум этапам:\",\"summ_dis\":\"по второму этапу\",\"discount\":\"Итого по двум этапам со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":1578.5,\"$$hashKey\":\"object:18\"},{\"number\":3,\"text\":{\"name\":\"Третий этап\",\"summ\":\"Итого по трем этапам:\",\"summ_dis\":\"по третьему этапу\",\"discount\":\"Итого по трем этапам со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":1578.5,\"$$hashKey\":\"object:19\"}]", "solution"=>{"name"=>"123", "url"=>"123", "area"=>"123", "first_floor_height"=>"123", "second_floor_height_min"=>"0.0", "second_floor_height_max"=>"0.0", "third_floor_height_min"=>"0.0", "third_floor_height_max"=>"0.0", "discount_title"=>"", "discount_by_stages"=>{"0"=>"0", "1"=>"0", "2"=>"0"}}, "data"=>""}
  [1m[36mProduct Load (1.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (3.2ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Unpermitted parameters: second_floor_height_min, second_floor_height_max, third_floor_height_min, third_floor_height_max, discount_by_stages
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mExpense Load (0.7ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/new.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (4.8ms)
  Rendered solutions/_technical_file_fields.html.haml (4.6ms)
  Rendered budgets/_discount.html.haml (7.9ms)
  Rendered budgets/_stages.html.haml (23.3ms)
  Rendered solutions/_form.html.haml (94.6ms)
  Rendered solutions/new.html.haml within layouts/application (98.6ms)
  Rendered layouts/_header.html.haml (9.3ms)
Completed 200 OK in 776ms (Views: 710.9ms | ActiveRecord: 8.6ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-29 19:10:47 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (1.3ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL[0m
  Rendered solutions/index.html.haml within layouts/application (7.5ms)
  Rendered layouts/_header.html.haml (81.6ms)
Completed 200 OK in 689ms (Views: 642.1ms | ActiveRecord: 12.3ms)


Started GET "/solutions/new" for 127.0.0.1 at 2017-04-29 19:10:49 +0300
Processing by SolutionsController#new as HTML
  [1m[36mProduct Load (2.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (3.4ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUser Load (2.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.4ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/new.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (8.3ms)
  Rendered solutions/_technical_file_fields.html.haml (6.5ms)
  Rendered budgets/_discount.html.haml (6.9ms)
  Rendered budgets/_stages.html.haml (16.7ms)
  Rendered solutions/_form.html.haml (134.7ms)
  Rendered solutions/new.html.haml within layouts/application (137.5ms)
  Rendered layouts/_header.html.haml (11.0ms)
Completed 200 OK in 906ms (Views: 721.4ms | ActiveRecord: 10.2ms)


Started GET "/solutions/new" for 127.0.0.1 at 2017-04-29 19:11:12 +0300
Processing by SolutionsController#new as HTML
  [1m[36mProduct Load (1.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (2.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.7ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/new.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (3.6ms)
  Rendered solutions/_technical_file_fields.html.haml (3.5ms)
  Rendered budgets/_discount.html.haml (7.2ms)
  Rendered budgets/_stages.html.haml (17.5ms)
  Rendered solutions/_form.html.haml (72.0ms)
  Rendered solutions/new.html.haml within layouts/application (75.0ms)
  Rendered layouts/_header.html.haml (9.4ms)
Completed 200 OK in 664ms (Views: 615.7ms | ActiveRecord: 8.3ms)


Started POST "/solutions" for 127.0.0.1 at 2017-04-29 19:11:27 +0300
Processing by SolutionsController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"3DWeon+sGUD0VCmBhMKsh/52toMOCUfyvFgyhDo9T+LZ2Jb0YK+zmLnd9qX6uS9RyuiVsJUhmIwtSx2Xi2csnA==", "commit"=>"Сохранить", "solution"=>{"price"=>"17650.5", "name"=>"123", "url"=>"123", "area"=>"123", "first_floor_height"=>"123", "second_floor_height_min"=>"0.0", "second_floor_height_max"=>"0.0", "third_floor_height_min"=>"0.0", "third_floor_height_max"=>"0.0", "discount_title"=>"", "discount_by_stages"=>{"0"=>"0", "1"=>"0", "2"=>"0"}}, "json_stages"=>"[{\"number\":1,\"text\":{\"name\":\"Первый этап\",\"summ\":\"Итого по первому этапу:\",\"summ_dis\":\"по первому этапу\",\"discount\":\"Итого по первому этапу со скидкой:\"},\"products\":[{\"id\":1,\"name\":\"Простой продукт 1 этап\",\"unit\":\"шт\",\"custom\":false,\"sets\":[],\"profit\":100,\"price_with_work\":70,\"price_without_work\":10,\"$$hashKey\":\"object:16\",\"quantity\":\"123\",\"with_work\":true,\"price\":143.5}],\"price\":17650.5,\"total_price\":17650.5,\"aggregated_price\":17650.5,\"$$hashKey\":\"object:3\"},{\"number\":2,\"text\":{\"name\":\"Второй этап\",\"summ\":\"Итого по двум этапам:\",\"summ_dis\":\"по второму этапу\",\"discount\":\"Итого по двум этапам со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":17650.5,\"$$hashKey\":\"object:4\"},{\"number\":3,\"text\":{\"name\":\"Третий этап\",\"summ\":\"Итого по трем этапам:\",\"summ_dis\":\"по третьему этапу\",\"discount\":\"Итого по трем этапам со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":17650.5,\"$$hashKey\":\"object:5\"}]", "data"=>""}
  [1m[36mProduct Load (4.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.4ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (2.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Unpermitted parameters: second_floor_height_min, second_floor_height_max, third_floor_height_min, third_floor_height_max, discount_by_stages
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mExpense Load (7.3ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/new.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (3.4ms)
  Rendered solutions/_technical_file_fields.html.haml (3.5ms)
  Rendered budgets/_discount.html.haml (6.9ms)
  Rendered budgets/_stages.html.haml (18.4ms)
  Rendered solutions/_form.html.haml (87.9ms)
  Rendered solutions/new.html.haml within layouts/application (91.8ms)
  Rendered layouts/_header.html.haml (13.4ms)
Completed 200 OK in 90718ms (Views: 616.2ms | ActiveRecord: 17.5ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-29 19:13:08 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (1.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (0.8ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL[0m
  Rendered solutions/index.html.haml within layouts/application (7.0ms)
  Rendered layouts/_header.html.haml (73.8ms)
Completed 200 OK in 602ms (Views: 570.5ms | ActiveRecord: 2.3ms)


Started GET "/solutions/new" for 127.0.0.1 at 2017-04-29 19:13:10 +0300
Processing by SolutionsController#new as HTML
  [1m[36mProduct Load (1.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (6.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.7ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/new.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (9.3ms)
  Rendered solutions/_technical_file_fields.html.haml (5.8ms)
  Rendered budgets/_discount.html.haml (6.4ms)
  Rendered budgets/_stages.html.haml (16.8ms)
  Rendered solutions/_form.html.haml (101.7ms)
  Rendered solutions/new.html.haml within layouts/application (105.8ms)
  Rendered layouts/_header.html.haml (11.8ms)
Completed 200 OK in 855ms (Views: 641.4ms | ActiveRecord: 47.9ms)


Started POST "/solutions" for 127.0.0.1 at 2017-04-29 19:13:20 +0300
Processing by SolutionsController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"7ocADxPm2832VVXOvEXLuQlUBELK2JhsTnj+g3P5bRDraghZDOVxFbvciurCPkhvPconcVHwRxLfa9GQwqMObg==", "commit"=>"Сохранить", "solution"=>{"price"=>"1578.5", "name"=>"123", "url"=>"123", "area"=>"123", "first_floor_height"=>"123", "second_floor_height_min"=>"0.0", "second_floor_height_max"=>"0.0", "third_floor_height_min"=>"0.0", "third_floor_height_max"=>"0.0", "discount_title"=>"", "discount_by_stages"=>{"0"=>"0", "1"=>"0", "2"=>"0"}}, "json_stages"=>"[{\"number\":1,\"text\":{\"name\":\"Первый этап\",\"summ\":\"Итого по первому этапу:\",\"summ_dis\":\"по первому этапу\",\"discount\":\"Итого по первому этапу со скидкой:\"},\"products\":[{\"id\":1,\"name\":\"Простой продукт 1 этап\",\"unit\":\"шт\",\"custom\":false,\"sets\":[],\"profit\":100,\"price_with_work\":70,\"price_without_work\":10,\"$$hashKey\":\"object:29\",\"quantity\":\"11\",\"with_work\":true,\"price\":143.5}],\"price\":1578.5,\"total_price\":1578.5,\"aggregated_price\":1578.5,\"$$hashKey\":\"object:16\"},{\"number\":2,\"text\":{\"name\":\"Второй этап\",\"summ\":\"Итого по двум этапам:\",\"summ_dis\":\"по второму этапу\",\"discount\":\"Итого по двум этапам со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":1578.5,\"$$hashKey\":\"object:17\"},{\"number\":3,\"text\":{\"name\":\"Третий этап\",\"summ\":\"Итого по трем этапам:\",\"summ_dis\":\"по третьему этапу\",\"discount\":\"Итого по трем этапам со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":1578.5,\"$$hashKey\":\"object:18\"}]", "data"=>""}
  [1m[36mProduct Load (1.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (9.3ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Unpermitted parameters: second_floor_height_min, second_floor_height_max, third_floor_height_min, third_floor_height_max, discount_by_stages
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (7.2ms)[0m  [1m[32mINSERT INTO "budgets" ("name", "first_floor_height", "price", "area", "discount_title", "discount_by_stages", "created_at", "updated_at", "type", "url") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "123"], ["first_floor_height", #<BigDecimal:7efff8d81630,'0.123E3',9(18)>], ["price", #<BigDecimal:7efff8d81810,'0.15785E4',18(18)>], ["area", #<BigDecimal:7efff8d81720,'0.123E3',9(18)>], ["discount_title", ""], ["discount_by_stages", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007efffc343278 "decimal[]"  elements_type=nil needs quotation>, values=["0", "0", "0"]>], ["created_at", 2017-04-29 16:13:20 UTC], ["updated_at", 2017-04-29 16:13:20 UTC], ["type", "Solution"], ["url", "123"]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
Completed 500 Internal Server Error in 72ms (ActiveRecord: 21.5ms)


  
ActiveRecord::StatementInvalid (PG::NotNullViolation: ERROR:  null value in column "client_id" violates not-null constraint
DETAIL:  Failing row contains (16, 123, null, null, 123.0, 0, 0, 0, 0, 1578.5, 123.0, null, {0,0,0}, {0,0,0}, {0,0,0}, , {0,0,0}, {0,0,0}, {0,0,0}, {0,0,0}, f, null, 2017-04-29 16:13:20.859681, 2017-04-29 16:13:20.859681, null, null, Solution, 123, f, null).
: INSERT INTO "budgets" ("name", "first_floor_height", "price", "area", "discount_title", "discount_by_stages", "created_at", "updated_at", "type", "url") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"):
  
app/controllers/solutions_controller.rb:27:in `create'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (6.9ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.6ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (2.2ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (33.0ms)
DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
  [1m[36mActiveRecord::SchemaMigration Load (1.8ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT pg_try_advisory_lock(6572146483646705745);[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Migrating to RenameEstimatesTable (20170428235151)
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.0ms)[0m  [1m[35mALTER TABLE "technical_files" RENAME COLUMN "budget_id" TO "estimate_id"[0m
  [1m[35m (5.0ms)[0m  [1m[35mALTER INDEX "index_technical_files_on_budget_id" RENAME TO "index_technical_files_on_estimate_id"[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "client_files" RENAME COLUMN "budget_id" TO "estimate_id"[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER INDEX "index_client_files_on_budget_id" RENAME TO "index_client_files_on_estimate_id"[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "stages" RENAME COLUMN "budget_id" TO "estimate_id"[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER INDEX "index_stages_on_budget_id" RENAME TO "index_stages_on_estimate_id"[0m
  [1m[35m (3.3ms)[0m  [1m[35mALTER TABLE "budgets" DROP "proposer_id"[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "budgets" DROP "proposed"[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "budgets" DROP "url"[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "budgets" DROP "type"[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "budgets" RENAME TO "estimates"[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "public"."budgets_id_seq" RENAME TO "estimates_id_seq"[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER INDEX "budgets_pkey" RENAME TO "estimates_pkey"[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER INDEX "index_budgets_on_client_id" RENAME TO "index_estimates_on_client_id"[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "schema_migrations" WHERE "schema_migrations"."version" = $1[0m  [["version", "20170428235151"]]
  [1m[35m (1.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT pg_advisory_unlock(6572146483646705745)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT pg_try_advisory_lock(6572146483646705745);[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.9ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Migrating to RenameEstimatesTable (20170428235151)
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "estimates" RENAME TO "budgets"[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "public"."estimates_id_seq" RENAME TO "budgets_id_seq"[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER INDEX "estimates_pkey" RENAME TO "budgets_pkey"[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER INDEX "index_estimates_on_client_id" RENAME TO "index_budgets_on_client_id"[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "budgets" ADD "type" character varying[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "budgets" ADD "url" character varying[0m
  [1m[35m (25.1ms)[0m  [1m[35mALTER TABLE "budgets" ADD "proposed" boolean DEFAULT 'f'[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "budgets" ADD "proposer_id" integer[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "stages" RENAME COLUMN "estimate_id" TO "budget_id"[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER INDEX "index_stages_on_estimate_id" RENAME TO "index_stages_on_budget_id"[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "client_files" RENAME COLUMN "estimate_id" TO "budget_id"[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER INDEX "index_client_files_on_estimate_id" RENAME TO "index_client_files_on_budget_id"[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "technical_files" RENAME COLUMN "estimate_id" TO "budget_id"[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER INDEX "index_technical_files_on_estimate_id" RENAME TO "index_technical_files_on_budget_id"[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "budgets" ALTER "client_id" DROP NOT NULL[0m
  [1m[35mSQL (6.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20170428235151"]]
  [1m[35m (4.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.7ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT pg_advisory_unlock(6572146483646705745)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
Started GET "/solutions" for 127.0.0.1 at 2017-04-29 19:15:17 +0300
  [1m[36mActiveRecord::SchemaMigration Load (1.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (1.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (1.7ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL[0m
  Rendered solutions/index.html.haml within layouts/application (12.8ms)
  Rendered layouts/_header.html.haml (78.1ms)
Completed 200 OK in 1906ms (Views: 1811.1ms | ActiveRecord: 16.4ms)


Started GET "/solutions/new" for 127.0.0.1 at 2017-04-29 19:15:22 +0300
Processing by SolutionsController#new as HTML
  [1m[36mProduct Load (4.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.2ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.1ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.6ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/new.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (13.9ms)
  Rendered solutions/_technical_file_fields.html.haml (5.2ms)
  Rendered budgets/_discount.html.haml (9.1ms)
  Rendered budgets/_stages.html.haml (24.2ms)
  Rendered solutions/_form.html.haml (161.0ms)
  Rendered solutions/new.html.haml within layouts/application (164.7ms)
  Rendered layouts/_header.html.haml (9.9ms)
Completed 200 OK in 936ms (Views: 669.1ms | ActiveRecord: 44.4ms)


Started POST "/solutions" for 127.0.0.1 at 2017-04-29 19:15:33 +0300
Processing by SolutionsController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"eVaZ66qBjzGO5LXfVqa8YuxYJ88XoJZHiE6V/Tnjmop8u5G9tYIl6cNtavso3T+02MYE/IyISTkZXbruiLn59A==", "commit"=>"Сохранить", "solution"=>{"price"=>"1578.5", "name"=>"123", "url"=>"123", "area"=>"123", "first_floor_height"=>"123", "second_floor_height_min"=>"0.0", "second_floor_height_max"=>"0.0", "third_floor_height_min"=>"0.0", "third_floor_height_max"=>"0.0", "discount_title"=>"", "discount_by_stages"=>{"0"=>"0", "1"=>"0", "2"=>"0"}}, "json_stages"=>"[{\"number\":1,\"text\":{\"name\":\"Первый этап\",\"summ\":\"Итого по первому этапу:\",\"summ_dis\":\"по первому этапу\",\"discount\":\"Итого по первому этапу со скидкой:\"},\"products\":[{\"id\":1,\"name\":\"Простой продукт 1 этап\",\"unit\":\"шт\",\"custom\":false,\"sets\":[],\"profit\":100,\"price_with_work\":70,\"price_without_work\":10,\"$$hashKey\":\"object:17\",\"quantity\":\"11\",\"with_work\":true,\"price\":143.5}],\"price\":1578.5,\"total_price\":1578.5,\"aggregated_price\":1578.5,\"$$hashKey\":\"object:4\"},{\"number\":2,\"text\":{\"name\":\"Второй этап\",\"summ\":\"Итого по двум этапам:\",\"summ_dis\":\"по второму этапу\",\"discount\":\"Итого по двум этапам со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":1578.5,\"$$hashKey\":\"object:5\"},{\"number\":3,\"text\":{\"name\":\"Третий этап\",\"summ\":\"Итого по трем этапам:\",\"summ_dis\":\"по третьему этапу\",\"discount\":\"Итого по трем этапам со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":1578.5,\"$$hashKey\":\"object:6\"}]", "data"=>""}
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.5ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Unpermitted parameters: second_floor_height_min, second_floor_height_max, third_floor_height_min, third_floor_height_max, discount_by_stages
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (1.3ms)[0m  [1m[32mINSERT INTO "budgets" ("name", "first_floor_height", "price", "area", "discount_title", "discount_by_stages", "created_at", "updated_at", "type", "url") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "123"], ["first_floor_height", #<BigDecimal:7f66d5096490,'0.123E3',9(18)>], ["price", #<BigDecimal:7f66d5096af8,'0.15785E4',18(18)>], ["area", #<BigDecimal:7f66d50967b0,'0.123E3',9(18)>], ["discount_title", ""], ["discount_by_stages", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f66d4323240 "decimal[]"  elements_type=nil needs quotation>, values=["0", "0", "0"]>], ["created_at", 2017-04-29 16:15:33 UTC], ["updated_at", 2017-04-29 16:15:33 UTC], ["type", "Solution"], ["url", "123"]]
  [1m[36mAudited::Audit Load (6.0ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 17], ["auditable_type", "Budget"], ["LIMIT", 1]]
  [1m[35mSQL (3.9ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 17], ["auditable_type", "Budget"], ["user_id", 1], ["user_type", "User"], ["action", "create"], ["audited_changes", "---\nname: '123'\nclient_id: \nfloors: \nfirst_floor_height: !ruby/object:BigDecimal 18:0.123E3\nsecond_floor_height_min: !ruby/object:BigDecimal 18:0.0\nsecond_floor_height_max: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_min: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_max: !ruby/object:BigDecimal 18:0.0\nprice: !ruby/object:BigDecimal 18:0.15785E4\narea: !ruby/object:BigDecimal 18:0.123E3\nprice_by_area: \nprice_by_stage:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_area_per_stage:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\ndiscount_title: ''\ndiscount_by_stages:\n- '0'\n- '0'\n- '0'\ndiscount_amount:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated_discounted:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_area_per_stage_discounted:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nsigned: false\ndeleted_at: \nsigning_date: \nuser_id: \nurl: '123'\nproposed: false\nproposer_id: \n"], ["version", 1], ["remote_address", "127.0.0.1"], ["request_uuid", "cfe96ca8-fc9e-44c4-a2c2-638b35828c81"], ["created_at", 2017-04-29 16:15:34 UTC]]
  [1m[35m (1.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (2.7ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."budget_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["budget_id", 17], ["number", 1], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (1.5ms)[0m  [1m[32mINSERT INTO "stages" ("budget_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["budget_id", 17], ["number", 1], ["price", #<BigDecimal:7f66d45211a0,'0.15785E4',18(36)>], ["total_price", #<BigDecimal:7f66d4520de0,'0.15785E4',18(36)>], ["created_at", 2017-04-29 16:15:34 UTC], ["updated_at", 2017-04-29 16:15:34 UTC]]
  [1m[35m (1.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (6.2ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND ("stage_products"."product_id" != 1)[0m  [["stage_id", 41]]
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT  "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND "stage_products"."product_id" = $2 LIMIT $3[0m  [["stage_id", 41], ["product_id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (1.3ms)[0m  [1m[32mINSERT INTO "stage_products" ("product_id", "stage_id", "quantity", "price_with_work", "created_at", "updated_at", "price_without_work") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["product_id", 1], ["stage_id", 41], ["quantity", 11], ["price_with_work", #<BigDecimal:55854a08c850,'0.7E2',9(27)>], ["created_at", 2017-04-29 16:15:34 UTC], ["updated_at", 2017-04-29 16:15:34 UTC], ["price_without_work", #<BigDecimal:55854a085f78,'0.1E2',9(27)>]]
  [1m[35m (1.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (0.6ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."budget_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["budget_id", 17], ["number", 2], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "stages" ("budget_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["budget_id", 17], ["number", 2], ["price", #<BigDecimal:5585491d4d58,'0.0',9(27)>], ["total_price", #<BigDecimal:5585491d49c0,'0.0',9(18)>], ["created_at", 2017-04-29 16:15:34 UTC], ["updated_at", 2017-04-29 16:15:34 UTC]]
  [1m[35m (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.9ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND (1=1)[0m  [["stage_id", 42]]
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."budget_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["budget_id", 17], ["number", 3], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (1.4ms)[0m  [1m[32mINSERT INTO "stages" ("budget_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["budget_id", 17], ["number", 3], ["price", #<BigDecimal:558549fd2720,'0.0',9(27)>], ["total_price", #<BigDecimal:558549fd2428,'0.0',9(18)>], ["created_at", 2017-04-29 16:15:34 UTC], ["updated_at", 2017-04-29 16:15:34 UTC]]
  [1m[35m (2.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND (1=1)[0m  [["stage_id", 43]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mAudited::Audit Load (0.9ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 17], ["auditable_type", "Budget"], ["LIMIT", 1]]
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 17], ["auditable_type", "Budget"], ["user_id", 1], ["user_type", "User"], ["action", "update"], ["audited_changes", "---\nfloors:\n- \n- !ruby/object:BigDecimal 18:0.1E1\nprice_by_area:\n- \n- !ruby/object:BigDecimal 36:0.1283E2\nprice_by_stage:\n- - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n- - !ruby/object:BigDecimal 27:0.15785E4\n  - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated:\n- - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n- - !ruby/object:BigDecimal 27:0.15785E4\n  - !ruby/object:BigDecimal 18:0.15785E4\n  - !ruby/object:BigDecimal 18:0.15785E4\nprice_by_area_per_stage:\n- - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n- - !ruby/object:BigDecimal 36:0.1283E2\n  - !ruby/object:BigDecimal 36:0.1283E2\n  - !ruby/object:BigDecimal 36:0.1283E2\nprice_by_stage_aggregated_discounted:\n- - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n- - !ruby/object:BigDecimal 18:0.15785E4\n  - !ruby/object:BigDecimal 18:0.15785E4\n  - !ruby/object:BigDecimal 18:0.15785E4\nprice_by_area_per_stage_discounted:\n- - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n- - !ruby/object:BigDecimal 36:0.1283E2\n  - !ruby/object:BigDecimal 36:0.1283E2\n  - !ruby/object:BigDecimal 36:0.1283E2\n"], ["version", 2], ["remote_address", "127.0.0.1"], ["request_uuid", "cfe96ca8-fc9e-44c4-a2c2-638b35828c81"], ["created_at", 2017-04-29 16:15:34 UTC]]
  [1m[35mSQL (3.0ms)[0m  [1m[33mUPDATE "budgets" SET "floors" = $1, "price_by_area" = $2, "price_by_stage" = $3, "price_by_stage_aggregated" = $4, "price_by_area_per_stage" = $5, "price_by_stage_aggregated_discounted" = $6, "price_by_area_per_stage_discounted" = $7, "updated_at" = $8 WHERE "budgets"."id" = $9[0m  [["floors", #<BigDecimal:558549f268a8,'0.1E1',9(27)>], ["price_by_area", #<BigDecimal:558549f26768,'0.1283E2',18(45)>], ["price_by_stage", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f66d4323240 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:558549f3c928,'0.15785E4',18(36)>, #<BigDecimal:558549f3c248,'0.0',9(27)>, #<BigDecimal:558549f3c0b8,'0.0',9(27)>]>], ["price_by_stage_aggregated", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f66d4323240 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:558549f3c928,'0.15785E4',18(36)>, #<BigDecimal:558549f37ea0,'0.15785E4',18(27)>, #<BigDecimal:558549f37e28,'0.15785E4',18(27)>]>], ["price_by_area_per_stage", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f66d4323240 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:558549f37248,'0.1283E2',18(45)>, #<BigDecimal:558549f34e30,'0.1283E2',18(45)>, #<BigDecimal:558549f338c8,'0.1283E2',18(45)>]>], ["price_by_stage_aggregated_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f66d4323240 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:558549f35ad8,'0.15785E4',18(27)>, #<BigDecimal:558549f342f0,'0.15785E4',18(27)>, #<BigDecimal:558549f32c70,'0.15785E4',18(27)>]>], ["price_by_area_per_stage_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f66d4323240 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:558549f353a8,'0.1283E2',18(45)>, #<BigDecimal:558549f33f08,'0.1283E2',18(45)>, #<BigDecimal:558549f328d8,'0.1283E2',18(45)>]>], ["updated_at", 2017-04-29 16:15:34 UTC], ["id", 17]]
  [1m[35m (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
Redirected to http://localhost:3000/solutions
Completed 302 Found in 342ms (ActiveRecord: 64.1ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-29 19:15:34 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (0.9ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL[0m
  Rendered solutions/_listing.html.haml (42.4ms)
  Rendered solutions/index.html.haml within layouts/application (54.4ms)
Completed 500 Internal Server Error in 63ms (ActiveRecord: 1.7ms)


  
ActionView::Template::Error (undefined method `updateDate' for #<Solution:0x00558549866c48>
Did you mean?  updated_at
               updated_at=
               updated_at?):
    4:   %td= solution.price_by_area
    5:   %td= solution.get_floor
    6:   %td= solution.area
    7:   %td= solution.updateDate
    8:   %td
    9:     .btn-group
   10:       %button.btn.btn-default.dropdown-toggle{ type: "button", data: { toggle: "dropdown" } }
  
app/views/solutions/_listing.html.haml:7:in `_app_views_solutions__listing_html_haml___1716176573562415293_47015476176740'
app/views/solutions/index.html.haml:30:in `block in _app_views_solutions_index_html_haml___2633358835482248128_47015477920940'
app/views/solutions/index.html.haml:29:in `_app_views_solutions_index_html_haml___2633358835482248128_47015477920940'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (8.2ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (3.1ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.5ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (36.6ms)
Started GET "/solutions" for 127.0.0.1 at 2017-04-29 19:16:09 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (1.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL[0m
  Rendered solutions/_listing.html.haml (4.2ms)
  Rendered solutions/index.html.haml within layouts/application (14.0ms)
  Rendered layouts/_header.html.haml (12.3ms)
Completed 200 OK in 571ms (Views: 564.5ms | ActiveRecord: 1.6ms)


DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
Started GET "/solutions" for 127.0.0.1 at 2017-04-29 19:17:07 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (1.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (0.8ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL[0m
  Rendered solutions/_listing.html.haml (6.4ms)
  Rendered solutions/index.html.haml within layouts/application (22.3ms)
  Rendered layouts/_header.html.haml (14.1ms)
Completed 200 OK in 647ms (Views: 634.8ms | ActiveRecord: 2.5ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-29 19:19:16 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (3.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (0.8ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL[0m
  Rendered solutions/_listing.html.haml (11.9ms)
  Rendered solutions/index.html.haml within layouts/application (27.0ms)
  Rendered layouts/_header.html.haml (11.7ms)
Completed 200 OK in 707ms (Views: 696.7ms | ActiveRecord: 3.8ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-29 19:19:44 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (2.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (0.8ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL[0m
  Rendered solutions/_listing.html.haml (5.5ms)
  Rendered solutions/index.html.haml within layouts/application (16.0ms)
  Rendered layouts/_header.html.haml (8.9ms)
Completed 200 OK in 508ms (Views: 501.3ms | ActiveRecord: 3.2ms)


Started GET "/solutions/17/edit" for 127.0.0.1 at 2017-04-29 19:19:50 +0300
Processing by SolutionsController#edit as HTML
  Parameters: {"id"=>"17"}
  [1m[36mProduct Load (1.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.6ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.3ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Estimate') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 17], ["LIMIT", 1]]
Completed 404 Not Found in 74ms (ActiveRecord: 5.5ms)


  
ActiveRecord::RecordNotFound (Couldn't find Estimate with 'id'=17 [WHERE "budgets"."type" IN ('Estimate') AND "budgets"."deleted_at" IS NULL]):
  
app/controllers/solutions_controller.rb:126:in `find_estimate'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (5.4ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (3.9ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.7ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (48.1ms)
Started GET "/solutions" for 127.0.0.1 at 2017-04-29 19:19:56 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (2.6ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL[0m
  Rendered solutions/_listing.html.haml (8.1ms)
  Rendered solutions/index.html.haml within layouts/application (26.1ms)
  Rendered layouts/_header.html.haml (12.6ms)
Completed 200 OK in 859ms (Views: 851.6ms | ActiveRecord: 3.5ms)


Started GET "/solutions/17/edit" for 127.0.0.1 at 2017-04-29 19:23:01 +0300
Processing by SolutionsController#edit as HTML
  Parameters: {"id"=>"17"}
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.1ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mSolution Load (1.1ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 17], ["LIMIT", 1]]
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.8ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 17]]
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (41, 42, 43)[0m
  [1m[36mStageProduct Load (1.2ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 41]]
  [1m[36mStageProductSet Load (3.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 27[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (1.3ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 42]]
  [1m[36mStageProduct Load (0.9ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 43]]
  [1m[36mExpense Load (0.6ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/edit.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (11.3ms)
  [1m[36mClientFile Load (6.8ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 17]]
  Rendered solutions/_technical_file_fields.html.haml (9.0ms)
  [1m[36mTechnicalFile Load (1.6ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 17]]
  Rendered budgets/_discount.html.haml (12.3ms)
  Rendered budgets/_stages.html.haml (37.9ms)
  Rendered solutions/_form.html.haml (166.2ms)
  Rendered solutions/edit.html.haml within layouts/application (176.5ms)
  Rendered layouts/_header.html.haml (60.7ms)
Completed 200 OK in 1212ms (Views: 838.8ms | ActiveRecord: 25.4ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-29 19:46:07 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (2.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (0.8ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL[0m
  Rendered solutions/_listing.html.haml (4.4ms)
  Rendered solutions/index.html.haml within layouts/application (54.1ms)
  Rendered layouts/_header.html.haml (92.9ms)
Completed 200 OK in 792ms (Views: 746.0ms | ActiveRecord: 2.9ms)


Started GET "/solutions/new" for 127.0.0.1 at 2017-04-29 19:46:08 +0300
Processing by SolutionsController#new as HTML
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.9ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.3ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/new.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (10.9ms)
  Rendered solutions/_technical_file_fields.html.haml (10.3ms)
  Rendered budgets/_discount.html.haml (14.4ms)
  Rendered budgets/_stages.html.haml (35.4ms)
  Rendered solutions/_form.html.haml (166.9ms)
  Rendered solutions/new.html.haml within layouts/application (170.5ms)
  Rendered layouts/_header.html.haml (11.8ms)
Completed 200 OK in 1194ms (Views: 976.0ms | ActiveRecord: 47.6ms)


Started POST "/solutions" for 127.0.0.1 at 2017-04-29 19:46:13 +0300
Processing by SolutionsController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"ptnr5OkVR8Crijn+Ydjn8QURVgGMurVKiTiQju9eduyjNOOy9hbtGOYD5tofo2QnMY91MheSajQYK7+dXgQVkg==", "commit"=>"Сохранить", "solution"=>{"price"=>"0", "name"=>"123", "url"=>"123", "area"=>"0", "first_floor_height"=>"", "second_floor_height_min"=>"0.0", "second_floor_height_max"=>"0.0", "third_floor_height_min"=>"0.0", "third_floor_height_max"=>"0.0", "discount_title"=>"", "discount_by_stages"=>{"0"=>"0", "1"=>"0", "2"=>"0"}}, "json_stages"=>"[{\"number\":1,\"text\":{\"name\":\"Первый этап\",\"summ\":\"Итого по первому этапу:\",\"summ_dis\":\"по первому этапу\",\"discount\":\"Итого по первому этапу со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":0},{\"number\":2,\"text\":{\"name\":\"Второй этап\",\"summ\":\"Итого по двум этапам:\",\"summ_dis\":\"по второму этапу\",\"discount\":\"Итого по двум этапам со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":0},{\"number\":3,\"text\":{\"name\":\"Третий этап\",\"summ\":\"Итого по трем этапам:\",\"summ_dis\":\"по третьему этапу\",\"discount\":\"Итого по трем этапам со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":0}]", "data"=>""}
  [1m[36mProduct Load (2.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (2.1ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.5ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUser Load (2.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Unpermitted parameters: second_floor_height_min, second_floor_height_max, third_floor_height_min, third_floor_height_max, discount_by_stages
  [1m[35m (13.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/new.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (3.6ms)
  Rendered solutions/_technical_file_fields.html.haml (3.9ms)
  Rendered budgets/_discount.html.haml (7.2ms)
  Rendered budgets/_stages.html.haml (46.4ms)
  Rendered solutions/_form.html.haml (105.5ms)
  Rendered solutions/new.html.haml within layouts/application (108.7ms)
  Rendered layouts/_header.html.haml (9.9ms)
Completed 200 OK in 817ms (Views: 720.9ms | ActiveRecord: 24.4ms)


Started POST "/solutions" for 127.0.0.1 at 2017-04-29 19:46:20 +0300
Processing by SolutionsController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"IA8if10yMH02F2v5b5xyp47LWYKz9zELmaBl7u2eDf0l4iopQjGapXuetN0R5/FxulV6sSjf7nUIs0r9XMRugw==", "commit"=>"Сохранить", "solution"=>{"price"=>"0", "name"=>"123", "url"=>"123", "area"=>"123", "first_floor_height"=>"123213", "second_floor_height_min"=>"0.0", "second_floor_height_max"=>"0.0", "third_floor_height_min"=>"0.0", "third_floor_height_max"=>"0.0", "discount_title"=>"", "discount_by_stages"=>{"0"=>"0", "1"=>"0", "2"=>"0"}}, "json_stages"=>"[{\"number\":1,\"text\":{\"name\":\"Первый этап\",\"summ\":\"Итого по первому этапу:\",\"summ_dis\":\"по первому этапу\",\"discount\":\"Итого по первому этапу со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":0},{\"number\":2,\"text\":{\"name\":\"Второй этап\",\"summ\":\"Итого по двум этапам:\",\"summ_dis\":\"по второму этапу\",\"discount\":\"Итого по двум этапам со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":0},{\"number\":3,\"text\":{\"name\":\"Третий этап\",\"summ\":\"Итого по трем этапам:\",\"summ_dis\":\"по третьему этапу\",\"discount\":\"Итого по трем этапам со скидкой:\"},\"products\":[],\"price\":0,\"total_price\":0,\"aggregated_price\":0}]", "data"=>""}
  [1m[36mProduct Load (1.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.9ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.2ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.3ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUser Load (4.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Unpermitted parameters: second_floor_height_min, second_floor_height_max, third_floor_height_min, third_floor_height_max, discount_by_stages
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (1.7ms)[0m  [1m[32mINSERT INTO "budgets" ("name", "first_floor_height", "price", "area", "discount_title", "discount_by_stages", "created_at", "updated_at", "type", "url") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "123"], ["first_floor_height", #<BigDecimal:7f66d75962b8,'0.123213E6',9(18)>], ["price", #<BigDecimal:7f66d75964e8,'0.0',9(18)>], ["area", #<BigDecimal:7f66d75963d0,'0.123E3',9(18)>], ["discount_title", ""], ["discount_by_stages", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f66d4323240 "decimal[]"  elements_type=nil needs quotation>, values=["0", "0", "0"]>], ["created_at", 2017-04-29 16:46:20 UTC], ["updated_at", 2017-04-29 16:46:20 UTC], ["type", "Solution"], ["url", "123"]]
  [1m[36mAudited::Audit Load (1.5ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 18], ["auditable_type", "Budget"], ["LIMIT", 1]]
  [1m[35mSQL (1.3ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 18], ["auditable_type", "Budget"], ["user_id", 1], ["user_type", "User"], ["action", "create"], ["audited_changes", "---\nname: '123'\nclient_id: \nfloors: \nfirst_floor_height: !ruby/object:BigDecimal 18:0.123213E6\nsecond_floor_height_min: !ruby/object:BigDecimal 18:0.0\nsecond_floor_height_max: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_min: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_max: !ruby/object:BigDecimal 18:0.0\nprice: !ruby/object:BigDecimal 18:0.0\narea: !ruby/object:BigDecimal 18:0.123E3\nprice_by_area: \nprice_by_stage:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_area_per_stage:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\ndiscount_title: ''\ndiscount_by_stages:\n- '0'\n- '0'\n- '0'\ndiscount_amount:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated_discounted:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_area_per_stage_discounted:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nsigned: false\ndeleted_at: \nsigning_date: \nuser_id: \nurl: '123'\nproposed: false\nproposer_id: \n"], ["version", 1], ["remote_address", "127.0.0.1"], ["request_uuid", "2972f936-cb2c-4348-bbd6-8a8ca02bd1c5"], ["created_at", 2017-04-29 16:46:20 UTC]]
  [1m[35m (2.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (0.8ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."budget_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["budget_id", 18], ["number", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "stages" ("budget_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["budget_id", 18], ["number", 1], ["price", #<BigDecimal:7f66d6655f88,'0.0',9(27)>], ["total_price", #<BigDecimal:7f66d6655e70,'0.0',9(18)>], ["created_at", 2017-04-29 16:46:20 UTC], ["updated_at", 2017-04-29 16:46:20 UTC]]
  [1m[35m (1.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.9ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND (1=1)[0m  [["stage_id", 44]]
  [1m[36mStage Load (0.8ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."budget_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["budget_id", 18], ["number", 2], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "stages" ("budget_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["budget_id", 18], ["number", 2], ["price", #<BigDecimal:7f66d71e7518,'0.0',9(27)>], ["total_price", #<BigDecimal:7f66d71e7428,'0.0',9(18)>], ["created_at", 2017-04-29 16:46:20 UTC], ["updated_at", 2017-04-29 16:46:20 UTC]]
  [1m[35m (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND (1=1)[0m  [["stage_id", 45]]
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."budget_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["budget_id", 18], ["number", 3], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "stages" ("budget_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["budget_id", 18], ["number", 3], ["price", #<BigDecimal:7f66e0d19b80,'0.0',9(27)>], ["total_price", #<BigDecimal:7f66e0d19ae0,'0.0',9(18)>], ["created_at", 2017-04-29 16:46:20 UTC], ["updated_at", 2017-04-29 16:46:20 UTC]]
  [1m[35m (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND (1=1)[0m  [["stage_id", 46]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mAudited::Audit Load (1.0ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 18], ["auditable_type", "Budget"], ["LIMIT", 1]]
  [1m[35mSQL (1.8ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 18], ["auditable_type", "Budget"], ["user_id", 1], ["user_type", "User"], ["action", "update"], ["audited_changes", "---\nfloors:\n- \n- !ruby/object:BigDecimal 18:0.1E1\nprice_by_area:\n- \n- !ruby/object:BigDecimal 18:0.0\n"], ["version", 2], ["remote_address", "127.0.0.1"], ["request_uuid", "2972f936-cb2c-4348-bbd6-8a8ca02bd1c5"], ["created_at", 2017-04-29 16:46:20 UTC]]
  [1m[35mSQL (1.5ms)[0m  [1m[33mUPDATE "budgets" SET "floors" = $1, "price_by_area" = $2, "updated_at" = $3 WHERE "budgets"."id" = $4[0m  [["floors", #<BigDecimal:7f66e0d0ae78,'0.1E1',9(27)>], ["price_by_area", #<BigDecimal:7f66e0d0ac98,'0.0',9(18)>], ["updated_at", 2017-04-29 16:46:20 UTC], ["id", 18]]
  [1m[35m (1.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mCOMMIT[0m
Redirected to http://localhost:3000/solutions
Completed 302 Found in 311ms (ActiveRecord: 52.3ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-29 19:46:20 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (1.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (1.5ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL[0m
  Rendered solutions/_listing.html.haml (4.2ms)
  Rendered solutions/_listing.html.haml (2.0ms)
  Rendered solutions/index.html.haml within layouts/application (15.4ms)
  Rendered layouts/_header.html.haml (11.8ms)
Completed 200 OK in 636ms (Views: 625.9ms | ActiveRecord: 2.7ms)


Started DELETE "/solutions/18" for 127.0.0.1 at 2017-04-29 19:46:27 +0300
Processing by SolutionsController#destroy as HTML
  Parameters: {"authenticity_token"=>"ebhxwQYyqsvMRtixeH4yysqxdIOU5rxB2jUKrrdxst98VXmXGTEAE4HPB5UGBbEc/i9XsA/OYz9LJiW9BivRoQ==", "id"=>"18"}
  [1m[36mSolution Load (1.8ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 18], ["LIMIT", 1]]
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mAudited::Audit Load (0.7ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 18], ["auditable_type", "Budget"], ["LIMIT", 1]]
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 18], ["auditable_type", "Budget"], ["user_id", 1], ["user_type", "User"], ["action", "destroy"], ["audited_changes", "---\nname: '123'\nclient_id: \nfloors: !ruby/object:BigDecimal 18:0.1E1\nfirst_floor_height: !ruby/object:BigDecimal 18:0.123213E6\nsecond_floor_height_min: !ruby/object:BigDecimal 18:0.0\nsecond_floor_height_max: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_min: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_max: !ruby/object:BigDecimal 18:0.0\nprice: !ruby/object:BigDecimal 18:0.0\narea: !ruby/object:BigDecimal 18:0.123E3\nprice_by_area: !ruby/object:BigDecimal 18:0.0\nprice_by_stage:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_area_per_stage:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\ndiscount_title: ''\ndiscount_by_stages:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\ndiscount_amount:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated_discounted:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_area_per_stage_discounted:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nsigned: false\ndeleted_at: \nsigning_date: \nuser_id: \nurl: '123'\nproposed: false\nproposer_id: \n"], ["version", 3], ["remote_address", "127.0.0.1"], ["request_uuid", "67c4fbc6-e3e0-435a-a39d-4fc152a59bf6"], ["created_at", 2017-04-29 16:46:27 UTC]]
  [1m[35mSQL (1.5ms)[0m  [1m[33mUPDATE "budgets" SET "deleted_at" = '2017-04-29 16:46:27.085930', "updated_at" = '2017-04-29 16:46:27.086008' WHERE "budgets"."type" IN ('Solution') AND "budgets"."id" = $1[0m  [["id", 18]]
  [1m[35m (1.3ms)[0m  [1m[35mCOMMIT[0m
Redirected to http://localhost:3000/solutions
Completed 302 Found in 76ms (ActiveRecord: 7.4ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-29 19:46:27 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (1.9ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL[0m
  Rendered solutions/_listing.html.haml (7.0ms)
  Rendered solutions/index.html.haml within layouts/application (20.7ms)
  Rendered layouts/_header.html.haml (16.9ms)
Completed 200 OK in 678ms (Views: 671.0ms | ActiveRecord: 2.5ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-29 21:00:37 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (4.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (0.9ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL[0m
  Rendered solutions/_listing.html.haml (14.5ms)
  Rendered solutions/index.html.haml within layouts/application (520.0ms)
Completed 500 Internal Server Error in 587ms (ActiveRecord: 4.9ms)


  
ActionView::Template::Error (undefined local variable or method `estimate' for #<#<Class:0x007f66d715dc78>:0x007f66d71ab838>
Did you mean?  estimate_url):
    30:             = render 'listing', solution: solution
    31: 
    32:   - @solutions.each do |solution|
    33:     .modal.fade{ id: "create-estimate-#{estimate.id}" }
    34:       .modal-dialog
    35:         .modal-content
    36:           = form_tag solution_copy_path(solution) do |f|
  
app/views/solutions/index.html.haml:33:in `block in _app_views_solutions_index_html_haml___2633358835482248128_70039917600900'
app/views/solutions/index.html.haml:32:in `_app_views_solutions_index_html_haml___2633358835482248128_70039917600900'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (5.8ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.3ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (4.0ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (37.2ms)
Started GET "/solutions" for 127.0.0.1 at 2017-04-29 21:00:54 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (1.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (1.7ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL[0m
  Rendered solutions/_listing.html.haml (4.0ms)
  [1m[36mClient Load (5.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered solutions/index.html.haml within layouts/application (77.3ms)
  Rendered layouts/_header.html.haml (64.8ms)
Completed 200 OK in 815ms (Views: 792.0ms | ActiveRecord: 17.7ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-29 21:05:33 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (1.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (1.5ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL[0m
  Rendered solutions/_listing.html.haml (4.3ms)
  [1m[36mClient Load (1.2ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered solutions/index.html.haml within layouts/application (58.9ms)
  Rendered layouts/_header.html.haml (8.9ms)
Completed 200 OK in 2418ms (Views: 2410.4ms | ActiveRecord: 3.9ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-29 21:07:06 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (0.7ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL[0m
  Rendered solutions/_listing.html.haml (6.9ms)
  [1m[36mClient Load (1.3ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered solutions/index.html.haml within layouts/application (28.6ms)
  Rendered layouts/_header.html.haml (11.8ms)
Completed 200 OK in 1323ms (Views: 1313.9ms | ActiveRecord: 2.7ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-29 21:07:20 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (1.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (1.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL[0m
  Rendered solutions/_listing.html.haml (8.5ms)
  [1m[36mClient Load (1.1ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered solutions/index.html.haml within layouts/application (55.9ms)
  Rendered layouts/_header.html.haml (14.2ms)
Completed 200 OK in 728ms (Views: 719.0ms | ActiveRecord: 3.6ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-29 21:07:45 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (1.4ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL[0m
  Rendered solutions/_listing.html.haml (6.7ms)
  [1m[36mClient Load (0.9ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered solutions/index.html.haml within layouts/application (24.4ms)
  Rendered layouts/_header.html.haml (8.7ms)
Completed 200 OK in 1251ms (Views: 1243.9ms | ActiveRecord: 3.1ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-29 21:08:21 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (4.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (1.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL[0m
  Rendered solutions/_listing.html.haml (9.0ms)
  [1m[36mClient Load (0.9ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered solutions/index.html.haml within layouts/application (31.6ms)
  Rendered layouts/_header.html.haml (9.6ms)
Completed 200 OK in 514ms (Views: 500.6ms | ActiveRecord: 6.1ms)


Started POST "/solutions/17/copy" for 127.0.0.1 at 2017-04-29 21:08:35 +0300
Processing by SolutionsController#copy as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"8ViUjd7XstCnOdYjmZW/mQJTcC94Xvwp/5BqOhTlRET0tZzbwdQYCOqwCQfn7jxPNs1THON2I1dug0Uppb8nOg==", "name"=>"442424", "client_id"=>"1", "solution_id"=>"17"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 404 Not Found in 6ms (ActiveRecord: 0.6ms)


  
ActiveRecord::RecordNotFound (Couldn't find Solution without an ID):
  
app/controllers/solutions_controller.rb:73:in `copy'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (5.8ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.4ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.2ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (33.1ms)
Started POST "/solutions/17/copy" for 127.0.0.1 at 2017-04-29 21:09:02 +0300
Processing by SolutionsController#copy as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"8ViUjd7XstCnOdYjmZW/mQJTcC94Xvwp/5BqOhTlRET0tZzbwdQYCOqwCQfn7jxPNs1THON2I1dug0Uppb8nOg==", "name"=>"442424", "client_id"=>"1", "solution_id"=>"17"}
  [1m[36mUser Load (1.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mSolution Load (1.0ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 17], ["LIMIT", 1]]
  [1m[36mStage Load (0.8ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = 17[0m
  [1m[36mClientFile Load (0.7ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = 17[0m
  [1m[36mTechnicalFile Load (0.5ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = 17[0m
  [1m[36mClient Load (1.2ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 165ms (ActiveRecord: 9.5ms)


  
NameError (undefined local variable or method `estimate' for #<Solution:0x007f66dd44db08>):
  
app/models/solution.rb:4:in `copy'
app/controllers/solutions_controller.rb:75:in `copy'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (5.1ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.2ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.4ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (40.9ms)
Started POST "/solutions/17/copy" for 127.0.0.1 at 2017-04-29 21:09:34 +0300
Processing by SolutionsController#copy as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"8ViUjd7XstCnOdYjmZW/mQJTcC94Xvwp/5BqOhTlRET0tZzbwdQYCOqwCQfn7jxPNs1THON2I1dug0Uppb8nOg==", "name"=>"442424", "client_id"=>"1", "solution_id"=>"17"}
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mSolution Load (1.0ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 17], ["LIMIT", 1]]
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = 17[0m
  [1m[36mClientFile Load (0.6ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = 17[0m
  [1m[36mTechnicalFile Load (0.8ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = 17[0m
  [1m[36mClient Load (1.1ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK[0m
Completed 500 Internal Server Error in 107ms (ActiveRecord: 5.9ms)


  
ActiveModel::UnknownAttributeError (unknown attribute 'client' for Solution.):
  
app/models/solution.rb:5:in `copy'
app/controllers/solutions_controller.rb:75:in `copy'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (5.6ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.6ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.2ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (36.7ms)
Started POST "/solutions/17/copy" for 127.0.0.1 at 2017-04-29 21:09:59 +0300
Processing by SolutionsController#copy as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"8ViUjd7XstCnOdYjmZW/mQJTcC94Xvwp/5BqOhTlRET0tZzbwdQYCOqwCQfn7jxPNs1THON2I1dug0Uppb8nOg==", "name"=>"442424", "client_id"=>"1", "solution_id"=>"17"}
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mSolution Load (1.2ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 17], ["LIMIT", 1]]
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = 17[0m
  [1m[36mClientFile Load (0.5ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = 17[0m
  [1m[36mTechnicalFile Load (0.5ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = 17[0m
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (2.6ms)[0m  [1m[32mINSERT INTO "budgets" ("name", "client_id", "floors", "first_floor_height", "price", "area", "price_by_area", "price_by_stage", "price_by_stage_aggregated", "price_by_area_per_stage", "discount_title", "price_by_stage_aggregated_discounted", "price_by_area_per_stage_discounted", "created_at", "updated_at", "type", "url") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17) RETURNING "id"[0m  [["name", "442424"], ["client_id", 1], ["floors", #<BigDecimal:7f66cd2e6ab8,'0.1E1',9(18)>], ["first_floor_height", #<BigDecimal:7f66cd2dc2e8,'0.123E3',9(18)>], ["price", #<BigDecimal:7f66cd2dc518,'0.15785E4',18(18)>], ["area", #<BigDecimal:7f66cd2dc400,'0.123E3',9(18)>], ["price_by_area", #<BigDecimal:7f66cd2e64f0,'0.1283E2',18(18)>], ["price_by_stage", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f66d4323240 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f66cd2e6248,'0.15785E4',18(18)>, #<BigDecimal:7f66cd2e6220,'0.0',9(18)>, #<BigDecimal:7f66cd2e61f8,'0.0',9(18)>]>], ["price_by_stage_aggregated", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f66d4323240 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f66cd2e5d20,'0.15785E4',18(18)>, #<BigDecimal:7f66cd2e5cf8,'0.15785E4',18(18)>, #<BigDecimal:7f66cd2e5cd0,'0.15785E4',18(18)>]>], ["price_by_area_per_stage", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f66d4323240 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f66cd2e57f8,'0.1283E2',18(18)>, #<BigDecimal:7f66cd2e57d0,'0.1283E2',18(18)>, #<BigDecimal:7f66cd2e57a8,'0.1283E2',18(18)>]>], ["discount_title", ""], ["price_by_stage_aggregated_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f66d4323240 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f66cd2e4880,'0.15785E4',18(18)>, #<BigDecimal:7f66cd2e4858,'0.15785E4',18(18)>, #<BigDecimal:7f66cd2e4830,'0.15785E4',18(18)>]>], ["price_by_area_per_stage_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f66d4323240 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f66cd2e4358,'0.1283E2',18(18)>, #<BigDecimal:7f66cd2e4330,'0.1283E2',18(18)>, #<BigDecimal:7f66cd2e4308,'0.1283E2',18(18)>]>], ["created_at", 2017-04-29 18:10:00 UTC], ["updated_at", 2017-04-29 18:10:00 UTC], ["type", "Estimate"], ["url", "123"]]
  [1m[36mAudited::Audit Load (0.9ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 19], ["auditable_type", "Budget"], ["LIMIT", 1]]
  [1m[35mSQL (1.7ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 19], ["auditable_type", "Budget"], ["user_id", 1], ["user_type", "User"], ["action", "create"], ["audited_changes", "---\nname: '442424'\nclient_id: 1\nfloors: !ruby/object:BigDecimal 18:0.1E1\nfirst_floor_height: !ruby/object:BigDecimal 18:0.123E3\nsecond_floor_height_min: !ruby/object:BigDecimal 18:0.0\nsecond_floor_height_max: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_min: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_max: !ruby/object:BigDecimal 18:0.0\nprice: !ruby/object:BigDecimal 18:0.15785E4\narea: !ruby/object:BigDecimal 18:0.123E3\nprice_by_area: !ruby/object:BigDecimal 18:0.1283E2\nprice_by_stage:\n- !ruby/object:BigDecimal 18:0.15785E4\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated:\n- !ruby/object:BigDecimal 18:0.15785E4\n- !ruby/object:BigDecimal 18:0.15785E4\n- !ruby/object:BigDecimal 18:0.15785E4\nprice_by_area_per_stage:\n- !ruby/object:BigDecimal 18:0.1283E2\n- !ruby/object:BigDecimal 18:0.1283E2\n- !ruby/object:BigDecimal 18:0.1283E2\ndiscount_title: ''\ndiscount_by_stages:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\ndiscount_amount:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated_discounted:\n- !ruby/object:BigDecimal 18:0.15785E4\n- !ruby/object:BigDecimal 18:0.15785E4\n- !ruby/object:BigDecimal 18:0.15785E4\nprice_by_area_per_stage_discounted:\n- !ruby/object:BigDecimal 18:0.1283E2\n- !ruby/object:BigDecimal 18:0.1283E2\n- !ruby/object:BigDecimal 18:0.1283E2\nsigned: false\ndeleted_at: \nsigning_date: \nuser_id: \nurl: '123'\nproposed: false\nproposer_id: \n"], ["version", 1], ["remote_address", "127.0.0.1"], ["request_uuid", "85c5c6df-9e25-429c-bc35-a59c374a0662"], ["created_at", 2017-04-29 18:10:00 UTC]]
  [1m[35m (1.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (0.6ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 17]]
  [1m[36mStageProduct Load (2.2ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (41, 42, 43)[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.9ms)[0m  [1m[32mINSERT INTO "stages" ("budget_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["budget_id", 19], ["number", 1], ["price", #<BigDecimal:7f66cd40e418,'0.15785E4',18(18)>], ["total_price", #<BigDecimal:7f66cd40e3c8,'0.15785E4',18(18)>], ["created_at", 2017-04-29 18:10:00 UTC], ["updated_at", 2017-04-29 18:10:00 UTC]]
  [1m[35m (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 41]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 27[0m
  [1m[35m (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "stage_products" ("product_id", "stage_id", "quantity", "price_with_work", "created_at", "updated_at", "price_without_work") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["product_id", 1], ["stage_id", 47], ["quantity", 11], ["price_with_work", #<BigDecimal:7f66cf62fba0,'0.7E2',9(18)>], ["created_at", 2017-04-29 18:10:00 UTC], ["updated_at", 2017-04-29 18:10:00 UTC], ["price_without_work", #<BigDecimal:7f66cf62f178,'0.1E2',9(18)>]]
  [1m[35m (2.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSet Load (1.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 27]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "stages" ("budget_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["budget_id", 19], ["number", 2], ["price", #<BigDecimal:7f66cd47bc70,'0.0',9(18)>], ["total_price", #<BigDecimal:7f66cd47bc20,'0.0',9(18)>], ["created_at", 2017-04-29 18:10:00 UTC], ["updated_at", 2017-04-29 18:10:00 UTC]]
  [1m[35m (2.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (1.2ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 42]]
  [1m[35m (0.8ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "stages" ("budget_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["budget_id", 19], ["number", 3], ["price", #<BigDecimal:7f66ccf804a0,'0.0',9(18)>], ["total_price", #<BigDecimal:7f66ccf80428,'0.0',9(18)>], ["created_at", 2017-04-29 18:10:00 UTC], ["updated_at", 2017-04-29 18:10:00 UTC]]
  [1m[35m (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 43]]
  [1m[36mTechnicalFile Load (0.8ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 17]]
  [1m[36mClientFile Load (0.6ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 17]]
Redirected to http://localhost:3000/estimates?client_id=1
Completed 302 Found in 261ms (ActiveRecord: 32.8ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-29 21:10:00 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (1.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (3.0ms)
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered estimates/index.html.haml within layouts/application (23.8ms)
  Rendered layouts/_header.html.haml (60.4ms)
Completed 200 OK in 613ms (Views: 559.6ms | ActiveRecord: 9.2ms)


Started GET "/estimates/19/edit" for 127.0.0.1 at 2017-04-29 21:10:06 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"19"}
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (2.2ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Estimate') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 19], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.9ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 19]]
  [1m[36mStageProduct Load (1.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (47, 48, 49)[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 47]]
  [1m[36mStageProductSet Load (0.8ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 28[0m
  [1m[36mProduct Load (1.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 48]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 49]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (22.8ms)
  [1m[36mClientFile Load (0.8ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 19]]
  Rendered estimates/_technical_file_fields.html.haml (9.2ms)
  [1m[36mTechnicalFile Load (0.8ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 19]]
  Rendered budgets/_discount.html.haml (7.6ms)
  Rendered budgets/_stages.html.haml (24.1ms)
  Rendered estimates/_form.html.haml (131.7ms)
  Rendered estimates/edit.html.haml within layouts/application (137.7ms)
  Rendered layouts/_header.html.haml (15.2ms)
Completed 200 OK in 968ms (Views: 778.5ms | ActiveRecord: 51.7ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-29 21:11:31 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (5.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (1.4ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL[0m
  Rendered solutions/_listing.html.haml (7.0ms)
  [1m[36mClient Load (1.3ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered solutions/index.html.haml within layouts/application (32.5ms)
  Rendered layouts/_header.html.haml (9.9ms)
Completed 200 OK in 570ms (Views: 556.5ms | ActiveRecord: 8.0ms)


Started GET "/solutions/17/edit" for 127.0.0.1 at 2017-04-29 21:11:35 +0300
Processing by SolutionsController#edit as HTML
  Parameters: {"id"=>"17"}
  [1m[36mProduct Load (1.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (2.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.9ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (2.4ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mSolution Load (0.9ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 17], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.8ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 17]]
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (41, 42, 43)[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 41]]
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 27[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 42]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 43]]
  [1m[36mExpense Load (1.3ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/edit.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (3.6ms)
  [1m[36mClientFile Load (1.0ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 17]]
  Rendered solutions/_technical_file_fields.html.haml (3.1ms)
  [1m[36mTechnicalFile Load (1.0ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 17]]
  Rendered budgets/_discount.html.haml (7.3ms)
  Rendered budgets/_stages.html.haml (19.8ms)
  Rendered solutions/_form.html.haml (97.4ms)
  Rendered solutions/edit.html.haml within layouts/application (100.5ms)
  Rendered layouts/_header.html.haml (7.3ms)
Completed 200 OK in 717ms (Views: 640.9ms | ActiveRecord: 18.3ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-29 21:11:41 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (0.7ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL[0m
  Rendered solutions/_listing.html.haml (4.0ms)
  [1m[36mClient Load (1.1ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered solutions/index.html.haml within layouts/application (26.9ms)
  Rendered layouts/_header.html.haml (9.4ms)
Completed 200 OK in 557ms (Views: 547.4ms | ActiveRecord: 2.5ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-29 21:16:13 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (1.1ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL[0m
  Rendered solutions/_listing.html.haml (5.3ms)
  [1m[36mClient Load (0.9ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered solutions/index.html.haml within layouts/application (86.9ms)
  Rendered layouts/_header.html.haml (53.9ms)
Completed 200 OK in 696ms (Views: 661.9ms | ActiveRecord: 4.4ms)


Started GET "/solutions?utf8=%E2%9C%93&name=2" for 127.0.0.1 at 2017-04-29 21:16:25 +0300
Processing by SolutionsController#index as HTML
  Parameters: {"utf8"=>"✓", "name"=>"2"}
  [1m[36mUser Load (1.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (5.4ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND (lower(name) like '%2%')[0m
  Rendered solutions/_listing.html.haml (5.0ms)
  [1m[36mClient Load (1.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered solutions/index.html.haml within layouts/application (27.4ms)
  Rendered layouts/_header.html.haml (8.4ms)
Completed 200 OK in 566ms (Views: 550.6ms | ActiveRecord: 8.3ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-29 21:16:32 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (1.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (2.6ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL[0m
  Rendered solutions/_listing.html.haml (4.5ms)
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered solutions/index.html.haml within layouts/application (28.7ms)
  Rendered layouts/_header.html.haml (13.7ms)
Completed 200 OK in 614ms (Views: 602.0ms | ActiveRecord: 4.6ms)


Started GET "/estimates/new" for 127.0.0.1 at 2017-04-29 21:16:34 +0300
Processing by EstimatesController#new as HTML
  [1m[36mProduct Load (2.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUser Load (2.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mExpense Load (2.0ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/new.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (8.3ms)
  Rendered estimates/_technical_file_fields.html.haml (4.8ms)
  Rendered budgets/_discount.html.haml (14.8ms)
  Rendered budgets/_stages.html.haml (14.8ms)
  Rendered estimates/_form.html.haml (112.3ms)
  Rendered estimates/new.html.haml within layouts/application (115.4ms)
  Rendered layouts/_header.html.haml (46.7ms)
Completed 200 OK in 840ms (Views: 663.5ms | ActiveRecord: 48.7ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-29 21:16:36 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (2.0ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2)[0m
  [1m[36mEstimate Load (1.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" IN (1, 2)[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (8.4ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (6.5ms)
  Rendered clients/_table.html.haml (19.3ms)
  [1m[36mUserClient Load (1.1ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (64.3ms)
  Rendered layouts/_header.html.haml (11.1ms)
Completed 200 OK in 582ms (Views: 562.6ms | ActiveRecord: 13.0ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-29 21:16:37 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (2.2ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (3.6ms)
  [1m[36mClient Load (0.9ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered estimates/index.html.haml within layouts/application (17.9ms)
  Rendered layouts/_header.html.haml (8.6ms)
Completed 200 OK in 619ms (Views: 603.0ms | ActiveRecord: 5.0ms)


Started POST "/estimates/19/copy" for 127.0.0.1 at 2017-04-29 21:23:00 +0300
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Processing by EstimatesController#copy as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"YaqasP/fz2htS6mO6G/3ObEtEnnrfiO4S8DSfZgYXWhkR5Lm4NxlsCDCdqqWFHTvhbMxSnBW/Mba0/1uKUI+Fg==", "name"=>"222", "client_id"=>"1", "commit"=>"Создать", "estimate_id"=>"19"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Estimate') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 19], ["LIMIT", 1]]
  [1m[36mStage Load (0.6ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = 19[0m
  [1m[36mClientFile Load (0.5ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = 19[0m
  [1m[36mTechnicalFile Load (0.6ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = 19[0m
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 333ms (ActiveRecord: 4.0ms)


  
NameError (undefined local variable or method `esimate' for #<EstimatesController:0x007f66cf5c9530>
Did you mean?  estimate):
  
app/controllers/estimates_controller.rb:80:in `copy'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (4.2ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (1.9ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.3ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (148.4ms)
Started POST "/estimates/19/copy" for 127.0.0.1 at 2017-04-29 21:25:12 +0300
Processing by EstimatesController#copy as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"YaqasP/fz2htS6mO6G/3ObEtEnnrfiO4S8DSfZgYXWhkR5Lm4NxlsCDCdqqWFHTvhbMxSnBW/Mba0/1uKUI+Fg==", "name"=>"222", "client_id"=>"1", "commit"=>"Создать", "estimate_id"=>"19"}
  [1m[36mUser Load (1.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Estimate') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 19], ["LIMIT", 1]]
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = 19[0m
  [1m[36mClientFile Load (0.6ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = 19[0m
  [1m[36mTechnicalFile Load (0.6ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = 19[0m
  [1m[36mClient Load (1.1ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (1.0ms)[0m  [1m[32mINSERT INTO "budgets" ("name", "client_id", "floors", "first_floor_height", "price", "area", "price_by_area", "price_by_stage", "price_by_stage_aggregated", "price_by_area_per_stage", "discount_title", "price_by_stage_aggregated_discounted", "price_by_area_per_stage_discounted", "created_at", "updated_at", "type", "url") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17) RETURNING "id"[0m  [["name", "222"], ["client_id", 1], ["floors", #<BigDecimal:7f66e0f46458,'0.1E1',9(18)>], ["first_floor_height", #<BigDecimal:7f66ce0e6d20,'0.123E3',9(18)>], ["price", #<BigDecimal:7f66ce0e7018,'0.15785E4',18(18)>], ["area", #<BigDecimal:7f66ce0e6e10,'0.123E3',9(18)>], ["price_by_area", #<BigDecimal:7f66e0f45da0,'0.1283E2',18(18)>], ["price_by_stage", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f66d4323240 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f66e0f45940,'0.15785E4',18(18)>, #<BigDecimal:7f66e0f45918,'0.0',9(18)>, #<BigDecimal:7f66e0f458f0,'0.0',9(18)>]>], ["price_by_stage_aggregated", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f66d4323240 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f66e0f45328,'0.15785E4',18(18)>, #<BigDecimal:7f66e0f45300,'0.15785E4',18(18)>, #<BigDecimal:7f66e0f452d8,'0.15785E4',18(18)>]>], ["price_by_area_per_stage", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f66d4323240 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f66e0f44e00,'0.1283E2',18(18)>, #<BigDecimal:7f66e0f44dd8,'0.1283E2',18(18)>, #<BigDecimal:7f66e0f44db0,'0.1283E2',18(18)>]>], ["discount_title", ""], ["price_by_stage_aggregated_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f66d4323240 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f66ce1676c8,'0.15785E4',18(18)>, #<BigDecimal:7f66ce1676a0,'0.15785E4',18(18)>, #<BigDecimal:7f66ce167678,'0.15785E4',18(18)>]>], ["price_by_area_per_stage_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f66d4323240 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f66ce166908,'0.1283E2',18(18)>, #<BigDecimal:7f66ce1668e0,'0.1283E2',18(18)>, #<BigDecimal:7f66ce1668b8,'0.1283E2',18(18)>]>], ["created_at", 2017-04-29 18:25:12 UTC], ["updated_at", 2017-04-29 18:25:12 UTC], ["type", "Solution"], ["url", "123"]]
  [1m[36mAudited::Audit Load (0.7ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 20], ["auditable_type", "Budget"], ["LIMIT", 1]]
  [1m[35mSQL (4.7ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 20], ["auditable_type", "Budget"], ["user_id", 1], ["user_type", "User"], ["action", "create"], ["audited_changes", "---\nname: '222'\nclient_id: 1\nfloors: !ruby/object:BigDecimal 18:0.1E1\nfirst_floor_height: !ruby/object:BigDecimal 18:0.123E3\nsecond_floor_height_min: !ruby/object:BigDecimal 18:0.0\nsecond_floor_height_max: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_min: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_max: !ruby/object:BigDecimal 18:0.0\nprice: !ruby/object:BigDecimal 18:0.15785E4\narea: !ruby/object:BigDecimal 18:0.123E3\nprice_by_area: !ruby/object:BigDecimal 18:0.1283E2\nprice_by_stage:\n- !ruby/object:BigDecimal 18:0.15785E4\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated:\n- !ruby/object:BigDecimal 18:0.15785E4\n- !ruby/object:BigDecimal 18:0.15785E4\n- !ruby/object:BigDecimal 18:0.15785E4\nprice_by_area_per_stage:\n- !ruby/object:BigDecimal 18:0.1283E2\n- !ruby/object:BigDecimal 18:0.1283E2\n- !ruby/object:BigDecimal 18:0.1283E2\ndiscount_title: ''\ndiscount_by_stages:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\ndiscount_amount:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated_discounted:\n- !ruby/object:BigDecimal 18:0.15785E4\n- !ruby/object:BigDecimal 18:0.15785E4\n- !ruby/object:BigDecimal 18:0.15785E4\nprice_by_area_per_stage_discounted:\n- !ruby/object:BigDecimal 18:0.1283E2\n- !ruby/object:BigDecimal 18:0.1283E2\n- !ruby/object:BigDecimal 18:0.1283E2\nsigned: false\ndeleted_at: \nsigning_date: \nuser_id: \nurl: '123'\nproposed: false\nproposer_id: \n"], ["version", 1], ["remote_address", "127.0.0.1"], ["request_uuid", "2f0d732e-f903-4948-949d-a3cdffee647f"], ["created_at", 2017-04-29 18:25:12 UTC]]
  [1m[35m (4.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 19]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (47, 48, 49)[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "stages" ("budget_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["budget_id", 20], ["number", 1], ["price", #<BigDecimal:7f66dd728198,'0.15785E4',18(18)>], ["total_price", #<BigDecimal:7f66dd728148,'0.15785E4',18(18)>], ["created_at", 2017-04-29 18:25:12 UTC], ["updated_at", 2017-04-29 18:25:12 UTC]]
  [1m[35m (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 47]]
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 28[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "stage_products" ("product_id", "stage_id", "quantity", "price_with_work", "created_at", "updated_at", "price_without_work") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["product_id", 1], ["stage_id", 50], ["quantity", 11], ["price_with_work", #<BigDecimal:7f66dd033cc0,'0.7E2',9(18)>], ["created_at", 2017-04-29 18:25:12 UTC], ["updated_at", 2017-04-29 18:25:12 UTC], ["price_without_work", #<BigDecimal:7f66dd032d48,'0.1E2',9(18)>]]
  [1m[35m (1.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 28]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "stages" ("budget_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["budget_id", 20], ["number", 2], ["price", #<BigDecimal:7f66dd35bcb8,'0.0',9(18)>], ["total_price", #<BigDecimal:7f66dd35bc68,'0.0',9(18)>], ["created_at", 2017-04-29 18:25:12 UTC], ["updated_at", 2017-04-29 18:25:12 UTC]]
  [1m[35m (1.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 48]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (1.6ms)[0m  [1m[32mINSERT INTO "stages" ("budget_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["budget_id", 20], ["number", 3], ["price", #<BigDecimal:7f66dca01a00,'0.0',9(18)>], ["total_price", #<BigDecimal:7f66dca019b0,'0.0',9(18)>], ["created_at", 2017-04-29 18:25:13 UTC], ["updated_at", 2017-04-29 18:25:13 UTC]]
  [1m[35m (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (3.2ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 49]]
  [1m[36mTechnicalFile Load (0.8ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 19]]
  [1m[36mClientFile Load (0.7ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 19]]
Redirected to http://localhost:3000/estimates?client_id=1
Completed 302 Found in 244ms (ActiveRecord: 36.8ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-29 21:25:13 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (3.3ms)
  [1m[36mClient Load (1.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered estimates/index.html.haml within layouts/application (25.8ms)
  Rendered layouts/_header.html.haml (68.1ms)
Completed 200 OK in 644ms (Views: 627.3ms | ActiveRecord: 4.9ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-29 21:25:19 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (1.3ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2)[0m
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" IN (1, 2)[0m
  [1m[35m (1.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (9.2ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (5.1ms)
  Rendered clients/_table.html.haml (18.2ms)
  [1m[36mUserClient Load (0.7ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (44.1ms)
  Rendered layouts/_header.html.haml (12.3ms)
Completed 200 OK in 697ms (Views: 680.4ms | ActiveRecord: 10.3ms)


Started GET "/clients/1/edit" for 127.0.0.1 at 2017-04-29 21:25:22 +0300
Processing by ClientsController#edit as HTML
  Parameters: {"id"=>"1"}
  [1m[36mClient Load (2.0ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (2.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUserClient Exists (0.8ms)[0m  [1m[34mSELECT  1 AS one FROM "user_clients" WHERE "user_clients"."user_id" = 1 AND "user_clients"."client_id" = 1 LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUserClient Load (1.3ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" WHERE "user_clients"."client_id" = 1 AND ("user_clients"."user_id" != 1)[0m
  Rendering clients/edit.html.haml within layouts/application
  [1m[36mUserClient Load (1.1ms)[0m  [1m[34mSELECT  "user_clients".* FROM "user_clients" WHERE "user_clients"."user_id" = 1 AND "user_clients"."client_id" = 1 LIMIT $1[0m  [["LIMIT", 1]]
  Rendered clients/_form.html.haml (28.9ms)
  Rendered clients/edit.html.haml within layouts/application (35.1ms)
  Rendered layouts/_header.html.haml (11.0ms)
  [1m[36mUser Load (2.9ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE ("users"."id" != $1)[0m  [["id", 1]]
Completed 200 OK in 650ms (Views: 622.5ms | ActiveRecord: 10.3ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-29 21:25:24 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (3.8ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.9ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2)[0m
  [1m[36mEstimate Load (2.8ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" IN (1, 2)[0m
  [1m[35m (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (11.5ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (4.2ms)
  Rendered clients/_table.html.haml (22.2ms)
  [1m[36mUserClient Load (0.7ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (45.7ms)
  Rendered layouts/_header.html.haml (7.1ms)
Completed 200 OK in 618ms (Views: 603.6ms | ActiveRecord: 10.8ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-29 21:25:25 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (1.5ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (3.4ms)
  [1m[36mClient Load (0.9ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered estimates/index.html.haml within layouts/application (61.3ms)
  Rendered layouts/_header.html.haml (9.9ms)
Completed 200 OK in 550ms (Views: 539.3ms | ActiveRecord: 3.8ms)


Started POST "/estimates/19/copy" for 127.0.0.1 at 2017-04-29 21:25:55 +0300
Processing by EstimatesController#copy as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"7PCqzvRBtEob2SmYqikYTvMTKTLH//uwXP6vvVU9Qq3pHaKY60IeklZQ9rzUUpuYx40KAVzXJM7N7YCu5Gch0w==", "name"=>"123", "client_id"=>"1", "commit"=>"Создать", "estimate_id"=>"19"}
  [1m[36mUser Load (1.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (4.8ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Estimate') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 19], ["LIMIT", 1]]
  [1m[36mStage Load (0.8ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = 19[0m
  [1m[36mClientFile Load (0.7ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = 19[0m
  [1m[36mTechnicalFile Load (2.6ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = 19[0m
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (1.8ms)[0m  [1m[32mINSERT INTO "budgets" ("name", "client_id", "floors", "first_floor_height", "price", "area", "price_by_area", "price_by_stage", "price_by_stage_aggregated", "price_by_area_per_stage", "discount_title", "price_by_stage_aggregated_discounted", "price_by_area_per_stage_discounted", "created_at", "updated_at", "type", "url") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17) RETURNING "id"[0m  [["name", "123"], ["client_id", 1], ["floors", #<BigDecimal:7f66cd8f21a0,'0.1E1',9(18)>], ["first_floor_height", #<BigDecimal:7f66cd947bf0,'0.123E3',9(18)>], ["price", #<BigDecimal:7f66cd947d30,'0.15785E4',18(18)>], ["area", #<BigDecimal:7f66cd947c90,'0.123E3',9(18)>], ["price_by_area", #<BigDecimal:7f66cd8f1bd8,'0.1283E2',18(18)>], ["price_by_stage", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f66d4323240 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f66cd8f18b8,'0.15785E4',18(18)>, #<BigDecimal:7f66cd8f1890,'0.0',9(18)>, #<BigDecimal:7f66cd8f1868,'0.0',9(18)>]>], ["price_by_stage_aggregated", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f66d4323240 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f66cd8f1390,'0.15785E4',18(18)>, #<BigDecimal:7f66cd8f1368,'0.15785E4',18(18)>, #<BigDecimal:7f66cd8f1340,'0.15785E4',18(18)>]>], ["price_by_area_per_stage", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f66d4323240 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f66cd8f0df0,'0.1283E2',18(18)>, #<BigDecimal:7f66cd8f0dc8,'0.1283E2',18(18)>, #<BigDecimal:7f66cd8f0da0,'0.1283E2',18(18)>]>], ["discount_title", ""], ["price_by_stage_aggregated_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f66d4323240 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f66cd8bfca0,'0.15785E4',18(18)>, #<BigDecimal:7f66cd8bfc50,'0.15785E4',18(18)>, #<BigDecimal:7f66cd8bfc28,'0.15785E4',18(18)>]>], ["price_by_area_per_stage_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f66d4323240 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f66cd8bf520,'0.1283E2',18(18)>, #<BigDecimal:7f66cd8bf4a8,'0.1283E2',18(18)>, #<BigDecimal:7f66cd8bf480,'0.1283E2',18(18)>]>], ["created_at", 2017-04-29 18:25:55 UTC], ["updated_at", 2017-04-29 18:25:55 UTC], ["type", "Solution"], ["url", "123"]]
  [1m[36mAudited::Audit Load (1.1ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 21], ["auditable_type", "Budget"], ["LIMIT", 1]]
  [1m[35mSQL (2.7ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 21], ["auditable_type", "Budget"], ["user_id", 1], ["user_type", "User"], ["action", "create"], ["audited_changes", "---\nname: '123'\nclient_id: 1\nfloors: !ruby/object:BigDecimal 18:0.1E1\nfirst_floor_height: !ruby/object:BigDecimal 18:0.123E3\nsecond_floor_height_min: !ruby/object:BigDecimal 18:0.0\nsecond_floor_height_max: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_min: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_max: !ruby/object:BigDecimal 18:0.0\nprice: !ruby/object:BigDecimal 18:0.15785E4\narea: !ruby/object:BigDecimal 18:0.123E3\nprice_by_area: !ruby/object:BigDecimal 18:0.1283E2\nprice_by_stage:\n- !ruby/object:BigDecimal 18:0.15785E4\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated:\n- !ruby/object:BigDecimal 18:0.15785E4\n- !ruby/object:BigDecimal 18:0.15785E4\n- !ruby/object:BigDecimal 18:0.15785E4\nprice_by_area_per_stage:\n- !ruby/object:BigDecimal 18:0.1283E2\n- !ruby/object:BigDecimal 18:0.1283E2\n- !ruby/object:BigDecimal 18:0.1283E2\ndiscount_title: ''\ndiscount_by_stages:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\ndiscount_amount:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated_discounted:\n- !ruby/object:BigDecimal 18:0.15785E4\n- !ruby/object:BigDecimal 18:0.15785E4\n- !ruby/object:BigDecimal 18:0.15785E4\nprice_by_area_per_stage_discounted:\n- !ruby/object:BigDecimal 18:0.1283E2\n- !ruby/object:BigDecimal 18:0.1283E2\n- !ruby/object:BigDecimal 18:0.1283E2\nsigned: false\ndeleted_at: \nsigning_date: \nuser_id: \nurl: '123'\nproposed: false\nproposer_id: \n"], ["version", 1], ["remote_address", "127.0.0.1"], ["request_uuid", "da6cd480-7bf2-42c5-805c-33644960c7e7"], ["created_at", 2017-04-29 18:25:55 UTC]]
  [1m[35m (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 19]]
  [1m[36mStageProduct Load (1.1ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (47, 48, 49)[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "stages" ("budget_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["budget_id", 21], ["number", 1], ["price", #<BigDecimal:7f66cf5308f8,'0.15785E4',18(18)>], ["total_price", #<BigDecimal:7f66cf530830,'0.15785E4',18(18)>], ["created_at", 2017-04-29 18:25:55 UTC], ["updated_at", 2017-04-29 18:25:55 UTC]]
  [1m[35m (1.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (1.1ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 47]]
  [1m[36mStageProductSet Load (1.0ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 28[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (1.0ms)[0m  [1m[32mINSERT INTO "stage_products" ("product_id", "stage_id", "quantity", "price_with_work", "created_at", "updated_at", "price_without_work") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["product_id", 1], ["stage_id", 53], ["quantity", 11], ["price_with_work", #<BigDecimal:7f66cf4ea678,'0.7E2',9(18)>], ["created_at", 2017-04-29 18:25:55 UTC], ["updated_at", 2017-04-29 18:25:55 UTC], ["price_without_work", #<BigDecimal:7f66cf4e9ae8,'0.1E2',9(18)>]]
  [1m[35m (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 28]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "stages" ("budget_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["budget_id", 21], ["number", 2], ["price", #<BigDecimal:7f66cf9c0b98,'0.0',9(18)>], ["total_price", #<BigDecimal:7f66cf9c0b48,'0.0',9(18)>], ["created_at", 2017-04-29 18:25:55 UTC], ["updated_at", 2017-04-29 18:25:55 UTC]]
  [1m[35m (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 48]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "stages" ("budget_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["budget_id", 21], ["number", 3], ["price", #<BigDecimal:7f66cf977010,'0.0',9(18)>], ["total_price", #<BigDecimal:7f66cf976f48,'0.0',9(18)>], ["created_at", 2017-04-29 18:25:55 UTC], ["updated_at", 2017-04-29 18:25:55 UTC]]
  [1m[35m (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 49]]
  [1m[36mTechnicalFile Load (0.5ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 19]]
  [1m[36mClientFile Load (0.5ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 19]]
Redirected to http://localhost:3000/estimates?client_id=1
Completed 302 Found in 135ms (ActiveRecord: 33.8ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-29 21:25:55 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (1.2ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (3.3ms)
  [1m[36mClient Load (1.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered estimates/index.html.haml within layouts/application (28.1ms)
  Rendered layouts/_header.html.haml (10.0ms)
Completed 200 OK in 607ms (Views: 591.7ms | ActiveRecord: 4.5ms)


Started GET "/categories" for 127.0.0.1 at 2017-04-29 21:26:23 +0300
Processing by CategoriesController#index as HTML
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering categories/index.html.haml within layouts/application
  [1m[36mCategory Load (1.9ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", false]]
  Rendered categories/_listing.html.haml (3.7ms)
  Rendered categories/_listing.html.haml (0.6ms)
  Rendered categories/_listing.html.haml (0.7ms)
  Rendered categories/_listing.html.haml (0.5ms)
  Rendered categories/_listing.html.haml (0.5ms)
  Rendered categories/_listing.html.haml (0.5ms)
  Rendered categories/_listing.html.haml (0.5ms)
  Rendered categories/_listing.html.haml (0.4ms)
  [1m[36mCategory Load (0.5ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."deleted_at" IS NULL AND "categories"."product" = $1[0m  [["product", true]]
  Rendered categories/_listing.html.haml (0.6ms)
  Rendered categories/_listing.html.haml (1.0ms)
  Rendered categories/_listing.html.haml (0.5ms)
  Rendered categories/_listing.html.haml (0.5ms)
  Rendered categories/_listing.html.haml (0.5ms)
  Rendered categories/_listing.html.haml (0.8ms)
  Rendered categories/_listing.html.haml (0.9ms)
  Rendered categories/index.html.haml within layouts/application (58.4ms)
  Rendered layouts/_header.html.haml (9.7ms)
Completed 200 OK in 616ms (Views: 599.5ms | ActiveRecord: 6.7ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-29 21:26:32 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (3.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (1.5ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (1.4ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2)[0m
  [1m[36mEstimate Load (3.6ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" IN (1, 2)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (9.6ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (8.0ms)
  Rendered clients/_table.html.haml (22.7ms)
  [1m[36mUserClient Load (0.9ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (51.3ms)
  Rendered layouts/_header.html.haml (8.6ms)
Completed 200 OK in 551ms (Views: 533.9ms | ActiveRecord: 11.7ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-29 21:26:52 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (0.9ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL[0m
  Rendered solutions/_listing.html.haml (6.3ms)
  Rendered solutions/_listing.html.haml (0.8ms)
  Rendered solutions/_listing.html.haml (0.8ms)
  [1m[36mClient Load (0.9ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered solutions/index.html.haml within layouts/application (56.1ms)
  Rendered layouts/_header.html.haml (10.2ms)
Completed 200 OK in 555ms (Views: 545.6ms | ActiveRecord: 2.6ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-29 21:27:50 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (2.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (1.0ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2)[0m
  [1m[36mEstimate Load (0.8ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" IN (1, 2)[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (9.0ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (5.6ms)
  Rendered clients/_table.html.haml (18.5ms)
  [1m[36mUserClient Load (0.8ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (111.7ms)
  Rendered layouts/_header.html.haml (62.8ms)
Completed 200 OK in 749ms (Views: 706.8ms | ActiveRecord: 11.3ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-29 21:27:54 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (3.2ms)
  [1m[36mClient Load (1.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered estimates/index.html.haml within layouts/application (20.2ms)
  Rendered layouts/_header.html.haml (8.9ms)
Completed 200 OK in 578ms (Views: 561.7ms | ActiveRecord: 3.1ms)


Started POST "/estimates/19/copy" for 127.0.0.1 at 2017-04-29 21:28:01 +0300
Processing by EstimatesController#copy as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"lgaYN8z2l9Dl+BpV/qhKSuXKRUwcvhDfpmXzaNjZO8yT65Bh0/U9CKhxxXGA08mc0VRmf4eWz6E3dtx7aYNYsg==", "name"=>"33", "client_id"=>"1", "commit"=>"Создать", "estimate_id"=>"19"}
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.1ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Estimate') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 19], ["LIMIT", 1]]
  [1m[36mStage Load (0.5ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = 19[0m
  [1m[36mClientFile Load (0.5ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = 19[0m
  [1m[36mTechnicalFile Load (0.7ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = 19[0m
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mClient Load (0.5ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "budgets" ("name", "client_id", "floors", "first_floor_height", "price", "area", "price_by_area", "price_by_stage", "price_by_stage_aggregated", "price_by_area_per_stage", "discount_title", "price_by_stage_aggregated_discounted", "price_by_area_per_stage_discounted", "created_at", "updated_at", "type", "url") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17) RETURNING "id"[0m  [["name", "33"], ["client_id", 1], ["floors", #<BigDecimal:7f66cd837d00,'0.1E1',9(18)>], ["first_floor_height", #<BigDecimal:7f66cf9381d0,'0.123E3',9(18)>], ["price", #<BigDecimal:7f66cf9383b0,'0.15785E4',18(18)>], ["area", #<BigDecimal:7f66cf9382e8,'0.123E3',9(18)>], ["price_by_area", #<BigDecimal:7f66cd8374e0,'0.1283E2',18(18)>], ["price_by_stage", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f66d4323240 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f66cd837198,'0.15785E4',18(18)>, #<BigDecimal:7f66cd837170,'0.0',9(18)>, #<BigDecimal:7f66cd837148,'0.0',9(18)>]>], ["price_by_stage_aggregated", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f66d4323240 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f66cd836ae0,'0.15785E4',18(18)>, #<BigDecimal:7f66cd836a68,'0.15785E4',18(18)>, #<BigDecimal:7f66cd836a40,'0.15785E4',18(18)>]>], ["price_by_area_per_stage", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f66d4323240 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f66cd836428,'0.1283E2',18(18)>, #<BigDecimal:7f66cd836400,'0.1283E2',18(18)>, #<BigDecimal:7f66cd8363d8,'0.1283E2',18(18)>]>], ["discount_title", ""], ["price_by_stage_aggregated_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f66d4323240 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f66cd834e48,'0.15785E4',18(18)>, #<BigDecimal:7f66cd834e20,'0.15785E4',18(18)>, #<BigDecimal:7f66cd834dd0,'0.15785E4',18(18)>]>], ["price_by_area_per_stage_discounted", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x007f66d4323240 "decimal[]"  elements_type=nil needs quotation>, values=[#<BigDecimal:7f66cd834740,'0.1283E2',18(18)>, #<BigDecimal:7f66cd834718,'0.1283E2',18(18)>, #<BigDecimal:7f66cd8346f0,'0.1283E2',18(18)>]>], ["created_at", 2017-04-29 18:28:01 UTC], ["updated_at", 2017-04-29 18:28:01 UTC], ["type", "Estimate"], ["url", "123"]]
  [1m[36mAudited::Audit Load (1.1ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 22], ["auditable_type", "Budget"], ["LIMIT", 1]]
  [1m[35mSQL (1.8ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 22], ["auditable_type", "Budget"], ["user_id", 1], ["user_type", "User"], ["action", "create"], ["audited_changes", "---\nname: '33'\nclient_id: 1\nfloors: !ruby/object:BigDecimal 18:0.1E1\nfirst_floor_height: !ruby/object:BigDecimal 18:0.123E3\nsecond_floor_height_min: !ruby/object:BigDecimal 18:0.0\nsecond_floor_height_max: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_min: !ruby/object:BigDecimal 18:0.0\nthird_floor_height_max: !ruby/object:BigDecimal 18:0.0\nprice: !ruby/object:BigDecimal 18:0.15785E4\narea: !ruby/object:BigDecimal 18:0.123E3\nprice_by_area: !ruby/object:BigDecimal 18:0.1283E2\nprice_by_stage:\n- !ruby/object:BigDecimal 18:0.15785E4\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated:\n- !ruby/object:BigDecimal 18:0.15785E4\n- !ruby/object:BigDecimal 18:0.15785E4\n- !ruby/object:BigDecimal 18:0.15785E4\nprice_by_area_per_stage:\n- !ruby/object:BigDecimal 18:0.1283E2\n- !ruby/object:BigDecimal 18:0.1283E2\n- !ruby/object:BigDecimal 18:0.1283E2\ndiscount_title: ''\ndiscount_by_stages:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\ndiscount_amount:\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\n- !ruby/object:BigDecimal 18:0.0\nprice_by_stage_aggregated_discounted:\n- !ruby/object:BigDecimal 18:0.15785E4\n- !ruby/object:BigDecimal 18:0.15785E4\n- !ruby/object:BigDecimal 18:0.15785E4\nprice_by_area_per_stage_discounted:\n- !ruby/object:BigDecimal 18:0.1283E2\n- !ruby/object:BigDecimal 18:0.1283E2\n- !ruby/object:BigDecimal 18:0.1283E2\nsigned: false\ndeleted_at: \nsigning_date: \nuser_id: \nurl: '123'\nproposed: false\nproposer_id: \n"], ["version", 1], ["remote_address", "127.0.0.1"], ["request_uuid", "241a0d9d-1e01-405c-b2ae-eb6a4a4bf4f6"], ["created_at", 2017-04-29 18:28:01 UTC]]
  [1m[35m (1.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (0.9ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 19]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (47, 48, 49)[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "stages" ("budget_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["budget_id", 22], ["number", 1], ["price", #<BigDecimal:7f66d13cc078,'0.15785E4',18(18)>], ["total_price", #<BigDecimal:7f66d13cc028,'0.15785E4',18(18)>], ["created_at", 2017-04-29 18:28:01 UTC], ["updated_at", 2017-04-29 18:28:01 UTC]]
  [1m[35m (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 47]]
  [1m[36mStageProductSet Load (2.2ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 28[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "stage_products" ("product_id", "stage_id", "quantity", "price_with_work", "created_at", "updated_at", "price_without_work") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["product_id", 1], ["stage_id", 56], ["quantity", 11], ["price_with_work", #<BigDecimal:7f66cfa8ecc8,'0.7E2',9(18)>], ["created_at", 2017-04-29 18:28:01 UTC], ["updated_at", 2017-04-29 18:28:01 UTC], ["price_without_work", #<BigDecimal:7f66cfa8e1d8,'0.1E2',9(18)>]]
  [1m[35m (1.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = $1[0m  [["stage_product_id", 28]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "stages" ("budget_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["budget_id", 22], ["number", 2], ["price", #<BigDecimal:7f66d658a6a8,'0.0',9(18)>], ["total_price", #<BigDecimal:7f66d658a658,'0.0',9(18)>], ["created_at", 2017-04-29 18:28:01 UTC], ["updated_at", 2017-04-29 18:28:01 UTC]]
  [1m[35m (3.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.9ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 48]]
  [1m[35m (1.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (1.0ms)[0m  [1m[32mINSERT INTO "stages" ("budget_id", "number", "price", "total_price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["budget_id", 22], ["number", 3], ["price", #<BigDecimal:7f66e0f6aee8,'0.0',9(18)>], ["total_price", #<BigDecimal:7f66e0f6ae98,'0.0',9(18)>], ["created_at", 2017-04-29 18:28:01 UTC], ["updated_at", 2017-04-29 18:28:01 UTC]]
  [1m[35m (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 49]]
  [1m[36mTechnicalFile Load (1.0ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 19]]
  [1m[36mClientFile Load (0.6ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 19]]
Redirected to http://localhost:3000/estimates?client_id=1
Completed 302 Found in 216ms (ActiveRecord: 45.8ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-29 21:28:01 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (2.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (7.8ms)
  Rendered estimates/_listing.html.haml (1.0ms)
  [1m[36mClient Load (2.1ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered estimates/index.html.haml within layouts/application (30.4ms)
  Rendered layouts/_header.html.haml (9.5ms)
Completed 200 OK in 539ms (Views: 524.4ms | ActiveRecord: 6.0ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-29 21:28:05 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (1.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (0.7ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL[0m
  Rendered solutions/_listing.html.haml (6.2ms)
  Rendered solutions/_listing.html.haml (0.9ms)
  Rendered solutions/_listing.html.haml (0.8ms)
  [1m[36mClient Load (3.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered solutions/index.html.haml within layouts/application (57.9ms)
  Rendered layouts/_header.html.haml (9.0ms)
Completed 200 OK in 595ms (Views: 577.7ms | ActiveRecord: 9.2ms)


Started GET "/solutions/17/edit" for 127.0.0.1 at 2017-04-29 21:28:18 +0300
Processing by SolutionsController#edit as HTML
  Parameters: {"id"=>"17"}
  [1m[36mProduct Load (2.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.5ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mSolution Load (0.9ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 17], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 17]]
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (41, 42, 43)[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 41]]
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 27[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 42]]
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 43]]
  [1m[36mExpense Load (0.4ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/edit.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (6.8ms)
  [1m[36mClientFile Load (0.5ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 17]]
  Rendered solutions/_technical_file_fields.html.haml (4.3ms)
  [1m[36mTechnicalFile Load (0.5ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 17]]
  Rendered budgets/_discount.html.haml (6.6ms)
  Rendered budgets/_stages.html.haml (17.0ms)
  Rendered solutions/_form.html.haml (76.4ms)
  Rendered solutions/edit.html.haml within layouts/application (79.2ms)
  Rendered layouts/_header.html.haml (10.8ms)
Completed 200 OK in 774ms (Views: 642.0ms | ActiveRecord: 12.4ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-29 22:14:39 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (3.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (0.7ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL[0m
  Rendered solutions/_listing.html.haml (9.9ms)
  Rendered solutions/_listing.html.haml (1.0ms)
  Rendered solutions/_listing.html.haml (1.0ms)
  [1m[36mClient Load (1.8ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered solutions/index.html.haml within layouts/application (52.5ms)
  Rendered layouts/_header.html.haml (9.3ms)
Completed 200 OK in 707ms (Views: 694.6ms | ActiveRecord: 5.7ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-29 22:20:42 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (0.7ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND (NOT (proposed))[0m
  [1m[36mSolution Load (1.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing.html.haml (6.0ms)
  Rendered solutions/_listing.html.haml (0.9ms)
  Rendered solutions/_listing.html.haml (0.8ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND (NOT (proposed))[0m
  [1m[36mClient Load (1.5ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mSolution Load (0.7ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND (proposed)[0m
  Rendered solutions/index.html.haml within layouts/application (99.3ms)
  Rendered layouts/_header.html.haml (62.9ms)
Completed 200 OK in 684ms (Views: 642.8ms | ActiveRecord: 4.9ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-29 22:22:51 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (1.5ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2)[0m
  [1m[36mEstimate Load (1.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" IN (1, 2)[0m
  [1m[35m (3.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (11.8ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (4.8ms)
  Rendered clients/_table.html.haml (20.4ms)
  [1m[36mUserClient Load (6.5ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (105.6ms)
  Rendered layouts/_header.html.haml (52.2ms)
Completed 200 OK in 726ms (Views: 685.9ms | ActiveRecord: 14.4ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-29 22:22:53 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (3.3ms)
  Rendered estimates/_listing.html.haml (0.8ms)
  [1m[36mClient Load (1.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered estimates/index.html.haml within layouts/application (24.7ms)
  Rendered layouts/_header.html.haml (9.0ms)
Completed 200 OK in 611ms (Views: 589.9ms | ActiveRecord: 3.4ms)


Started GET "/estimates/19/edit" for 127.0.0.1 at 2017-04-29 22:22:59 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"19"}
  [1m[36mProduct Load (1.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.2ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Estimate') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 19], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.6ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 19]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (47, 48, 49)[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 47]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 28[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 48]]
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 49]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (7.8ms)
  [1m[36mClientFile Load (0.6ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 19]]
  Rendered estimates/_technical_file_fields.html.haml (4.7ms)
  [1m[36mTechnicalFile Load (0.6ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 19]]
  Rendered budgets/_discount.html.haml (6.1ms)
  Rendered budgets/_stages.html.haml (15.9ms)
  Rendered estimates/_form.html.haml (106.0ms)
  Rendered estimates/edit.html.haml within layouts/application (110.5ms)
  Rendered layouts/_header.html.haml (9.5ms)
Completed 200 OK in 857ms (Views: 640.4ms | ActiveRecord: 60.3ms)


DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
Started GET "/estimates" for 127.0.0.1 at 2017-04-30 22:30:12 +0300
  [1m[36mActiveRecord::SchemaMigration Load (3.3ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Processing by EstimatesController#index as HTML
  [1m[36mUser Load (3.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Redirected to http://localhost:3000/clients
Completed 302 Found in 60ms (ActiveRecord: 17.7ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-30 22:30:12 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (7.0ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2)[0m
  [1m[36mEstimate Load (3.5ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" IN (1, 2)[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (13.1ms)
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (5.3ms)
  Rendered clients/_table.html.haml (24.7ms)
  [1m[36mUserClient Load (1.2ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (182.4ms)
  Rendered layouts/_header.html.haml (100.7ms)
Completed 200 OK in 2714ms (Views: 2656.1ms | ActiveRecord: 30.5ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-30 22:31:23 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (13.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Started GET "/solutions" for 127.0.0.1 at 2017-04-30 22:31:23 +0300
Started GET "/solutions" for 127.0.0.1 at 2017-04-30 22:31:23 +0300
Processing by SolutionsController#index as HTML
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (7.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mUser Load (5.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mSolution Load (6.7ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND (NOT (proposed))[0m
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (1.5ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND (NOT (proposed))[0m
  [1m[36mSolution Load (6.1ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing.html.haml (5.4ms)
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (22.3ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing.html.haml (1.0ms)
  Rendered solutions/_listing.html.haml (1.3ms)
  [1m[36mSolution Load (5.9ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND (NOT (proposed))[0m
  Rendered solutions/_listing.html.haml (1.2ms)
  Rendered solutions/_listing.html.haml (1.3ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND (NOT (proposed))[0m
  Rendered solutions/_listing.html.haml (1.6ms)
  [1m[36mSolution Load (7.7ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND (NOT (proposed))[0m
  Rendered solutions/_listing.html.haml (1.6ms)
  [1m[36mClient Load (7.6ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mClient Load (6.5ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered solutions/_listing.html.haml (1.2ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mSolution Load (1.2ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND (proposed)[0m
  Rendered solutions/_listing.html.haml (1.0ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND (NOT (proposed))[0m
  Rendered solutions/index.html.haml within layouts/application (99.3ms)
  [1m[36mSolution Load (18.3ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND (proposed)[0m
  Rendered solutions/index.html.haml within layouts/application (166.1ms)
  [1m[36mClient Load (12.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mSolution Load (4.4ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND (proposed)[0m
  Rendered solutions/index.html.haml within layouts/application (171.4ms)
Completed 500 Internal Server Error in 487ms (ActiveRecord: 24.1ms)


  
ActionView::Template::Error (can't add a new key into hash during iteration):
     5:     %title Конструктор сметы - Арт СИП Строй
     6:     = csrf_meta_tags
     7:     = stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track': 'reload'
     8:     = javascript_include_tag 'application', 'data-turbolinks-track': 'reload'
     9: 
    10:   %body
    11:     = render 'layouts/header'
  
app/views/layouts/application.html.haml:8:in `_app_views_layouts_application_html_haml___3147594104025224756_69931200241720'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (7.2ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (3.6ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.9ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (147.3ms)
  Rendered layouts/_header.html.haml (24.1ms)
Completed 200 OK in 1784ms (Views: 1699.4ms | ActiveRecord: 67.1ms)


  Rendered layouts/_header.html.haml (32.3ms)
Completed 200 OK in 1898ms (Views: 1810.4ms | ActiveRecord: 35.9ms)


Started POST "/__web_console/repl_sessions/58329142a489052fcf7ce80a2b5af8ac/trace" for 127.0.0.1 at 2017-04-30 22:31:43 +0300
Started POST "/__web_console/repl_sessions/58329142a489052fcf7ce80a2b5af8ac/trace" for 127.0.0.1 at 2017-04-30 22:31:44 +0300
Started GET "/solutions" for 127.0.0.1 at 2017-04-30 22:31:56 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (1.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (4.6ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND (NOT (proposed))[0m
  [1m[36mSolution Load (1.1ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing.html.haml (6.2ms)
  Rendered solutions/_listing.html.haml (1.1ms)
  Rendered solutions/_listing.html.haml (0.9ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND (NOT (proposed))[0m
  [1m[36mClient Load (1.4ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mSolution Load (1.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND (proposed)[0m
  Rendered solutions/index.html.haml within layouts/application (49.3ms)
  Rendered layouts/_header.html.haml (11.5ms)
Completed 200 OK in 610ms (Views: 592.6ms | ActiveRecord: 9.9ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-30 22:32:08 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (1.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (2.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND (NOT (proposed))[0m
  [1m[36mSolution Load (0.9ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing.html.haml (5.8ms)
  Rendered solutions/_listing.html.haml (1.2ms)
  Rendered solutions/_listing.html.haml (1.4ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND (NOT (proposed))[0m
  [1m[36mClient Load (1.2ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mSolution Load (0.9ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND (proposed)[0m
  Rendered solutions/index.html.haml within layouts/application (44.7ms)
  Rendered layouts/_header.html.haml (10.5ms)
Completed 200 OK in 576ms (Views: 560.1ms | ActiveRecord: 6.8ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-30 22:32:13 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (0.7ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND (NOT (proposed))[0m
  [1m[36mSolution Load (1.4ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing.html.haml (9.5ms)
  Rendered solutions/_listing.html.haml (1.0ms)
  Rendered solutions/_listing.html.haml (1.0ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND (NOT (proposed))[0m
  [1m[36mClient Load (1.1ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mSolution Load (0.9ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND (proposed)[0m
  Rendered solutions/index.html.haml within layouts/application (49.0ms)
  Rendered layouts/_header.html.haml (9.6ms)
Completed 200 OK in 793ms (Views: 779.6ms | ActiveRecord: 4.9ms)


Started GET "/solutions/20/edit" for 127.0.0.1 at 2017-04-30 22:32:17 +0300
Processing by SolutionsController#edit as HTML
  Parameters: {"id"=>"20"}
  [1m[36mProduct Load (4.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (3.4ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.9ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (2.5ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mSolution Load (3.0ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 20], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (2.9ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 20]]
  [1m[36mStageProduct Load (3.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (50, 51, 52)[0m
  [1m[36mStageProduct Load (1.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 50]]
  [1m[36mStageProductSet Load (2.8ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 29[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 51]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 52]]
  [1m[36mExpense Load (2.0ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/edit.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (12.2ms)
  [1m[36mClientFile Load (4.5ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered solutions/_technical_file_fields.html.haml (7.5ms)
  [1m[36mTechnicalFile Load (2.1ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered budgets/_discount.html.haml (12.7ms)
  Rendered budgets/_stages.html.haml (19.8ms)
  Rendered solutions/_form.html.haml (180.9ms)
  Rendered solutions/edit.html.haml within layouts/application (184.0ms)
  Rendered layouts/_header.html.haml (11.4ms)
Completed 200 OK in 1021ms (Views: 738.5ms | ActiveRecord: 82.6ms)


DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
  [1m[36mSolution Load (1.8ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 20], ["LIMIT", 1]]
  [1m[35m (2.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mAudited::Audit Load (5.4ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 20], ["auditable_type", "Budget"], ["LIMIT", 1]]
  [1m[35mSQL (4.4ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "action", "audited_changes", "version", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["auditable_id", 20], ["auditable_type", "Budget"], ["action", "update"], ["audited_changes", "---\nproposed:\n- false\n- true\n"], ["version", 2], ["request_uuid", "2342d402-b8fd-4c39-92ab-03593d835268"], ["created_at", 2017-04-30 19:32:43 UTC]]
  [1m[35mSQL (1.8ms)[0m  [1m[33mUPDATE "budgets" SET "updated_at" = $1, "proposed" = $2 WHERE "budgets"."id" = $3[0m  [["updated_at", 2017-04-30 19:32:43 UTC], ["proposed", true], ["id", 20]]
  [1m[35m (5.0ms)[0m  [1m[35mCOMMIT[0m
Started GET "/solutions" for 127.0.0.1 at 2017-04-30 22:32:47 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (4.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (2.5ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND (NOT (proposed))[0m
  [1m[36mSolution Load (0.7ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing.html.haml (4.8ms)
  Rendered solutions/_listing.html.haml (1.0ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND (NOT (proposed))[0m
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mSolution Load (0.6ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND (proposed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing_proposed.html.haml (9.0ms)
  Rendered solutions/_listing_proposed.html.haml (1.0ms)
  Rendered solutions/index.html.haml within layouts/application (60.3ms)
  Rendered layouts/_header.html.haml (12.4ms)
Completed 200 OK in 684ms (Views: 669.6ms | ActiveRecord: 9.6ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-30 22:32:48 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (0.7ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND (NOT (proposed))[0m
  [1m[36mSolution Load (0.7ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing.html.haml (4.8ms)
  Rendered solutions/_listing.html.haml (1.0ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND (NOT (proposed))[0m
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mSolution Load (0.7ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND (proposed)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing_proposed.html.haml (4.4ms)
  Rendered solutions/_listing_proposed.html.haml (1.1ms)
  Rendered solutions/index.html.haml within layouts/application (43.9ms)
  Rendered layouts/_header.html.haml (10.2ms)
Completed 200 OK in 624ms (Views: 616.1ms | ActiveRecord: 3.6ms)


Started GET "/solutions/21/edit" for 127.0.0.1 at 2017-04-30 22:33:06 +0300
Processing by SolutionsController#edit as HTML
  Parameters: {"id"=>"21"}
  [1m[36mProduct Load (3.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.5ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.3ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mSolution Load (0.8ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 21], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (1.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 21]]
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (53, 54, 55)[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 53]]
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 30[0m
  [1m[36mProduct Load (2.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (1.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 54]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 55]]
  [1m[36mExpense Load (0.6ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/edit.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (5.5ms)
  [1m[36mClientFile Load (0.8ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 21]]
  Rendered solutions/_technical_file_fields.html.haml (4.6ms)
  [1m[36mTechnicalFile Load (1.1ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 21]]
  Rendered budgets/_discount.html.haml (10.5ms)
  Rendered budgets/_stages.html.haml (17.7ms)
  Rendered solutions/_form.html.haml (114.7ms)
  Rendered solutions/edit.html.haml within layouts/application (118.9ms)
  Rendered layouts/_header.html.haml (11.9ms)
Completed 200 OK in 788ms (Views: 687.1ms | ActiveRecord: 20.3ms)


Started GET "/solutions/17/edit" for 127.0.0.1 at 2017-04-30 22:33:10 +0300
Processing by SolutionsController#edit as HTML
  Parameters: {"id"=>"17"}
  [1m[36mProduct Load (1.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.1ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.1ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mSolution Load (1.1ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 17], ["LIMIT", 1]]
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.9ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 17]]
  [1m[36mStageProduct Load (1.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (41, 42, 43)[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 41]]
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 27[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 42]]
  [1m[36mStageProduct Load (1.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 43]]
  [1m[36mExpense Load (0.4ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/edit.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (3.4ms)
  [1m[36mClientFile Load (0.9ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 17]]
  Rendered solutions/_technical_file_fields.html.haml (4.0ms)
  [1m[36mTechnicalFile Load (0.8ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 17]]
  Rendered budgets/_discount.html.haml (7.6ms)
  Rendered budgets/_stages.html.haml (18.9ms)
  Rendered solutions/_form.html.haml (87.0ms)
  Rendered solutions/edit.html.haml within layouts/application (90.5ms)
  Rendered layouts/_header.html.haml (14.8ms)
Completed 200 OK in 946ms (Views: 856.6ms | ActiveRecord: 14.6ms)


Started GET "/solutions/20/edit" for 127.0.0.1 at 2017-04-30 22:33:11 +0300
Processing by SolutionsController#edit as HTML
  Parameters: {"id"=>"20"}
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (3.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.5ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mSolution Load (5.1ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 20], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.6ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 20]]
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (50, 51, 52)[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 50]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 29[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 51]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 52]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/edit.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (3.7ms)
  [1m[36mClientFile Load (0.6ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered solutions/_technical_file_fields.html.haml (3.4ms)
  [1m[36mTechnicalFile Load (0.5ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered budgets/_discount.html.haml (8.6ms)
  Rendered budgets/_stages.html.haml (21.1ms)
  Rendered solutions/_form.html.haml (78.8ms)
  Rendered solutions/edit.html.haml within layouts/application (82.5ms)
  Rendered layouts/_header.html.haml (11.2ms)
Completed 200 OK in 767ms (Views: 680.0ms | ActiveRecord: 17.1ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-30 22:33:54 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (1.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing.html.haml (7.9ms)
  Rendered solutions/_listing.html.haml (2.8ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mClient Load (1.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mSolution Load (0.8ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing_proposed.html.haml (5.9ms)
  Rendered solutions/_listing_proposed.html.haml (0.9ms)
  Rendered solutions/index.html.haml within layouts/application (128.2ms)
  Rendered layouts/_header.html.haml (67.7ms)
Completed 200 OK in 799ms (Views: 721.5ms | ActiveRecord: 3.8ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-30 22:33:57 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (0.9ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing.html.haml (7.0ms)
  Rendered solutions/_listing.html.haml (1.1ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mClient Load (1.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mSolution Load (0.8ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing_proposed.html.haml (6.7ms)
  Rendered solutions/_listing_proposed.html.haml (1.1ms)
  Rendered solutions/index.html.haml within layouts/application (49.8ms)
  Rendered layouts/_header.html.haml (11.6ms)
Completed 200 OK in 869ms (Views: 857.4ms | ActiveRecord: 3.9ms)


Started GET "/solutions/17/edit" for 127.0.0.1 at 2017-04-30 22:34:03 +0300
Processing by SolutionsController#edit as HTML
  Parameters: {"id"=>"17"}
  [1m[36mProduct Load (1.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.9ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mSolution Load (1.1ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 17], ["LIMIT", 1]]
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.9ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 17]]
  [1m[36mStageProduct Load (1.3ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (41, 42, 43)[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 41]]
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 27[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (1.9ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 42]]
  [1m[36mStageProduct Load (0.4ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 43]]
  [1m[36mExpense Load (0.6ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/edit.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (12.9ms)
  [1m[36mClientFile Load (0.9ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 17]]
  Rendered solutions/_technical_file_fields.html.haml (12.5ms)
  [1m[36mTechnicalFile Load (11.5ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 17]]
  Rendered budgets/_discount.html.haml (11.9ms)
  Rendered budgets/_stages.html.haml (18.2ms)
  Rendered solutions/_form.html.haml (157.6ms)
  Rendered solutions/edit.html.haml within layouts/application (166.0ms)
  Rendered layouts/_header.html.haml (36.3ms)
Completed 200 OK in 1053ms (Views: 758.1ms | ActiveRecord: 84.1ms)


  [1m[36mSolution Load (1.0ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 17], ["LIMIT", 1]]
Started GET "/solutions" for 127.0.0.1 at 2017-04-30 22:34:46 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (0.9ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing.html.haml (4.7ms)
  Rendered solutions/_listing.html.haml (0.9ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mClient Load (1.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mSolution Load (0.8ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  Rendered solutions/_listing_proposed.html.haml (4.8ms)
  Rendered solutions/index.html.haml within layouts/application (39.9ms)
  Rendered layouts/_header.html.haml (8.9ms)
Completed 200 OK in 630ms (Views: 621.4ms | ActiveRecord: 3.7ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-30 22:35:06 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (0.8ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing.html.haml (6.3ms)
  Rendered solutions/_listing.html.haml (2.9ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mClient Load (1.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mSolution Load (0.9ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  Rendered solutions/_listing_proposed.html.haml (7.5ms)
  Rendered solutions/index.html.haml within layouts/application (52.4ms)
  Rendered layouts/_header.html.haml (8.9ms)
Completed 200 OK in 766ms (Views: 758.6ms | ActiveRecord: 3.6ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-30 22:36:34 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (0.9ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing.html.haml (5.0ms)
  Rendered solutions/_listing.html.haml (3.5ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mClient Load (0.9ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mSolution Load (0.7ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  Rendered solutions/_listing_proposed.html.haml (5.3ms)
  Rendered solutions/index.html.haml within layouts/application (58.3ms)
  Rendered layouts/_header.html.haml (8.4ms)
Completed 200 OK in 654ms (Views: 645.7ms | ActiveRecord: 3.5ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-30 22:36:54 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (0.7ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing.html.haml (4.6ms)
  Rendered solutions/_listing.html.haml (1.0ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mSolution Load (0.8ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  Rendered solutions/_listing_proposed.html.haml (3.3ms)
  Rendered solutions/index.html.haml within layouts/application (44.0ms)
  Rendered layouts/_header.html.haml (9.4ms)
Completed 200 OK in 616ms (Views: 608.9ms | ActiveRecord: 3.2ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-30 22:37:14 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (1.1ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing.html.haml (5.3ms)
  Rendered solutions/_listing.html.haml (26.0ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mSolution Load (0.9ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  Rendered solutions/_listing_proposed.html.haml (3.6ms)
  Rendered solutions/index.html.haml within layouts/application (65.5ms)
  Rendered layouts/_header.html.haml (9.4ms)
Completed 200 OK in 516ms (Views: 507.5ms | ActiveRecord: 3.8ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-30 22:37:56 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (1.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing.html.haml (4.8ms)
  Rendered solutions/_listing.html.haml (0.9ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mClient Load (1.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mSolution Load (0.8ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  Rendered solutions/_listing_proposed.html.haml (3.5ms)
  Rendered solutions/index.html.haml within layouts/application (49.2ms)
  Rendered layouts/_header.html.haml (9.2ms)
Completed 200 OK in 691ms (Views: 677.5ms | ActiveRecord: 3.7ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-30 22:39:15 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (1.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (2.4ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing.html.haml (4.8ms)
  Rendered solutions/_listing.html.haml (1.1ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mClient Load (1.5ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mSolution Load (1.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  Rendered solutions/_listing_proposed.html.haml (4.9ms)
  Rendered solutions/index.html.haml within layouts/application (41.1ms)
Completed 500 Internal Server Error in 51ms (ActiveRecord: 6.7ms)


  
SyntaxError (/home/g1nc/Development/ruby/constructor/app/views/solutions/_listing_proposed.html.haml:14: syntax error, unexpected keyword_ensure, expecting end-of-input):
  
app/views/solutions/_listing_proposed.html.haml:14: syntax error, unexpected keyword_ensure, expecting end-of-input
app/views/solutions/index.html.haml:74:in `block in _app_views_solutions_index_html_haml___760000668259830886_69931250054760'
app/views/solutions/index.html.haml:73:in `_app_views_solutions_index_html_haml___760000668259830886_69931250054760'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (9.0ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (3.3ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.1ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (48.2ms)
Started GET "/solutions" for 127.0.0.1 at 2017-04-30 22:39:29 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (0.9ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing.html.haml (7.0ms)
  Rendered solutions/_listing.html.haml (0.9ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mSolution Load (1.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  Rendered solutions/_listing_proposed.html.haml (4.3ms)
  Rendered solutions/index.html.haml within layouts/application (45.5ms)
  Rendered layouts/_header.html.haml (12.4ms)
Completed 200 OK in 606ms (Views: 597.5ms | ActiveRecord: 3.8ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-30 22:39:48 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (0.8ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing.html.haml (5.9ms)
  Rendered solutions/_listing.html.haml (1.1ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mClient Load (1.1ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mSolution Load (1.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  Rendered solutions/_listing_proposed.html.haml (5.1ms)
  Rendered solutions/index.html.haml within layouts/application (45.2ms)
  Rendered layouts/_header.html.haml (13.6ms)
Completed 200 OK in 712ms (Views: 704.2ms | ActiveRecord: 3.6ms)


Started GET "/solutions/17/edit" for 127.0.0.1 at 2017-04-30 22:40:06 +0300
Processing by SolutionsController#edit as HTML
  Parameters: {"id"=>"17"}
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (2.4ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.9ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (2.2ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mSolution Load (0.8ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 17], ["LIMIT", 1]]
  [1m[36mUser Load (1.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.6ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 17]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (41, 42, 43)[0m
  [1m[36mStageProduct Load (0.9ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 41]]
  [1m[36mStageProductSet Load (0.4ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 27[0m
  [1m[36mProduct Load (1.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 42]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 43]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/edit.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (5.3ms)
  [1m[36mClientFile Load (0.8ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 17]]
  Rendered solutions/_technical_file_fields.html.haml (5.3ms)
  [1m[36mTechnicalFile Load (0.6ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 17]]
  Rendered budgets/_discount.html.haml (11.8ms)
  Rendered budgets/_stages.html.haml (27.6ms)
  Rendered solutions/_form.html.haml (110.0ms)
  Rendered solutions/edit.html.haml within layouts/application (113.2ms)
  Rendered layouts/_header.html.haml (10.2ms)
Completed 200 OK in 944ms (Views: 837.7ms | ActiveRecord: 17.3ms)


Started GET "/clients" for 127.0.0.1 at 2017-04-30 22:40:14 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (1.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (1.3ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (1.4ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2)[0m
  [1m[36mEstimate Load (1.1ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" IN (1, 2)[0m
  [1m[35m (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (12.7ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (6.1ms)
  Rendered clients/_table.html.haml (23.7ms)
  [1m[36mUserClient Load (1.0ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (86.0ms)
  Rendered layouts/_header.html.haml (12.6ms)
Completed 200 OK in 582ms (Views: 553.8ms | ActiveRecord: 16.3ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-04-30 22:40:15 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (3.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (1.0ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.7ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (4.1ms)
  Rendered estimates/_listing.html.haml (0.9ms)
  [1m[36mClient Load (1.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered estimates/index.html.haml within layouts/application (24.3ms)
  Rendered layouts/_header.html.haml (10.4ms)
Completed 200 OK in 510ms (Views: 492.6ms | ActiveRecord: 6.1ms)


Started GET "/estimates/19/edit" for 127.0.0.1 at 2017-04-30 22:40:19 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"19"}
  [1m[36mProduct Load (4.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.5ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.5ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Estimate') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 19], ["LIMIT", 1]]
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.5ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 19]]
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (47, 48, 49)[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 47]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 28[0m
  [1m[36mProduct Load (1.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 48]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 49]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (3.3ms)
  [1m[36mClientFile Load (0.7ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 19]]
  Rendered estimates/_technical_file_fields.html.haml (3.2ms)
  [1m[36mTechnicalFile Load (4.1ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 19]]
  Rendered budgets/_discount.html.haml (11.3ms)
  Rendered budgets/_stages.html.haml (18.1ms)
  Rendered estimates/_form.html.haml (129.5ms)
  Rendered estimates/edit.html.haml within layouts/application (135.1ms)
  Rendered layouts/_header.html.haml (11.4ms)
Completed 200 OK in 826ms (Views: 730.8ms | ActiveRecord: 19.8ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-30 23:38:12 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (3.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (2.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing.html.haml (5.7ms)
  Rendered solutions/_listing.html.haml (2.1ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mClient Load (0.9ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mSolution Load (1.1ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  Rendered solutions/_listing_proposed.html.haml (3.7ms)
  Rendered solutions/index.html.haml within layouts/application (44.1ms)
  Rendered layouts/_header.html.haml (11.1ms)
Completed 200 OK in 617ms (Views: 603.2ms | ActiveRecord: 7.3ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-30 23:56:15 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (2.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (1.7ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing.html.haml (5.8ms)
  Rendered solutions/_listing.html.haml (1.0ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mClient Load (1.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mSolution Load (0.8ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  Rendered solutions/_listing_proposed.html.haml (3.5ms)
  Rendered solutions/index.html.haml within layouts/application (106.5ms)
  Rendered layouts/_header.html.haml (56.6ms)
Completed 200 OK in 729ms (Views: 689.5ms | ActiveRecord: 6.0ms)


Started GET "/solutions/20/accept" for 127.0.0.1 at 2017-04-30 23:56:18 +0300
Processing by SolutionsController#accept as HTML
  Parameters: {"solution_id"=>"20"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mSolution Load (3.3ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 20], ["LIMIT", 1]]
Completed 500 Internal Server Error in 61ms (ActiveRecord: 3.9ms)


  
NoMethodError (undefined method `updates' for #<Solution:0x007f3439a3afb0>
Did you mean?  update
               update!):
  
app/controllers/solutions_controller.rb:74:in `accept'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (4.7ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (6.7ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.3ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (44.9ms)
Started GET "/solutions" for 127.0.0.1 at 2017-04-30 23:56:30 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (1.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (0.8ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing.html.haml (6.3ms)
  Rendered solutions/_listing.html.haml (1.0ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mClient Load (1.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mSolution Load (0.8ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  Rendered solutions/_listing_proposed.html.haml (3.7ms)
  Rendered solutions/index.html.haml within layouts/application (106.8ms)
  Rendered layouts/_header.html.haml (57.6ms)
Completed 200 OK in 758ms (Views: 715.9ms | ActiveRecord: 3.9ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-30 23:56:32 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (1.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (1.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing.html.haml (54.4ms)
  Rendered solutions/_listing.html.haml (0.8ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mClient Load (0.9ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mSolution Load (2.7ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  Rendered solutions/_listing_proposed.html.haml (5.4ms)
  Rendered solutions/index.html.haml within layouts/application (100.6ms)
  Rendered layouts/_header.html.haml (10.5ms)
Completed 200 OK in 687ms (Views: 677.2ms | ActiveRecord: 6.1ms)


Started GET "/solutions/20/accept" for 127.0.0.1 at 2017-04-30 23:56:34 +0300
Processing by SolutionsController#accept as HTML
  Parameters: {"solution_id"=>"20"}
  [1m[36mUser Load (2.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mSolution Load (0.9ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 20], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mAudited::Audit Load (1.4ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 20], ["auditable_type", "Budget"], ["LIMIT", 1]]
  [1m[35mSQL (3.0ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 20], ["auditable_type", "Budget"], ["user_id", 1], ["user_type", "User"], ["action", "update"], ["audited_changes", "---\nproposed:\n- true\n- false\n"], ["version", 3], ["remote_address", "127.0.0.1"], ["request_uuid", "0f0dd4af-da69-4c8b-a172-b69591437c53"], ["created_at", 2017-04-30 20:56:35 UTC]]
  [1m[35mSQL (5.1ms)[0m  [1m[33mUPDATE "budgets" SET "proposed" = $1, "updated_at" = $2 WHERE "budgets"."id" = $3[0m  [["proposed", false], ["updated_at", 2017-04-30 20:56:34 UTC], ["id", 20]]
  [1m[35m (3.3ms)[0m  [1m[35mCOMMIT[0m
Redirected to http://localhost:3000/solutions
Completed 302 Found in 143ms (ActiveRecord: 76.1ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-30 23:56:35 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (0.8ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing.html.haml (9.1ms)
  Rendered solutions/_listing.html.haml (0.9ms)
  Rendered solutions/_listing.html.haml (1.0ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mClient Load (1.1ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mSolution Load (1.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  Rendered solutions/index.html.haml within layouts/application (46.8ms)
  Rendered layouts/_header.html.haml (7.8ms)
Completed 200 OK in 632ms (Views: 624.9ms | ActiveRecord: 3.8ms)


Started GET "/solutions/20/edit" for 127.0.0.1 at 2017-04-30 23:58:21 +0300
Processing by SolutionsController#edit as HTML
  Parameters: {"id"=>"20"}
  [1m[36mProduct Load (1.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.9ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.5ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mSolution Load (0.7ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 20], ["LIMIT", 1]]
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 20]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (50, 51, 52)[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 50]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 29[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 51]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 52]]
  [1m[36mExpense Load (2.1ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/edit.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (7.6ms)
  [1m[36mClientFile Load (1.0ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered solutions/_technical_file_fields.html.haml (4.3ms)
  [1m[36mTechnicalFile Load (0.7ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered budgets/_discount.html.haml (12.2ms)
  Rendered budgets/_stages.html.haml (15.8ms)
  Rendered solutions/_form.html.haml (99.6ms)
  Rendered solutions/edit.html.haml within layouts/application (103.6ms)
  Rendered layouts/_header.html.haml (26.4ms)
Completed 200 OK in 959ms (Views: 689.1ms | ActiveRecord: 13.3ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-30 23:58:33 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (1.1ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing.html.haml (10.1ms)
  Rendered solutions/_listing.html.haml (0.9ms)
  Rendered solutions/_listing.html.haml (3.0ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mClient Load (0.9ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.2ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mSolution Load (0.7ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  Rendered solutions/index.html.haml within layouts/application (92.5ms)
  Rendered layouts/_header.html.haml (8.9ms)
Completed 200 OK in 630ms (Views: 609.7ms | ActiveRecord: 12.4ms)


Started GET "/solutions/21/edit" for 127.0.0.1 at 2017-04-30 23:58:37 +0300
Processing by SolutionsController#edit as HTML
  Parameters: {"id"=>"21"}
  [1m[36mProduct Load (5.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (2.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (4.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mSolution Load (1.3ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 21], ["LIMIT", 1]]
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (1.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 21]]
  [1m[36mStageProduct Load (1.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (53, 54, 55)[0m
  [1m[36mStageProduct Load (1.4ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 53]]
  [1m[36mStageProductSet Load (2.0ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 30[0m
  [1m[36mProduct Load (1.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 54]]
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 55]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/edit.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (3.2ms)
  [1m[36mClientFile Load (0.6ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 21]]
  Rendered solutions/_technical_file_fields.html.haml (3.3ms)
  [1m[36mTechnicalFile Load (0.5ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 21]]
  Rendered budgets/_discount.html.haml (6.6ms)
  Rendered budgets/_stages.html.haml (16.6ms)
  Rendered solutions/_form.html.haml (76.1ms)
  Rendered solutions/edit.html.haml within layouts/application (80.9ms)
  Rendered layouts/_header.html.haml (13.6ms)
Completed 200 OK in 737ms (Views: 648.8ms | ActiveRecord: 25.8ms)


Started GET "/solutions" for 127.0.0.1 at 2017-04-30 23:58:39 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (2.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (1.2ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing.html.haml (5.5ms)
  Rendered solutions/_listing.html.haml (1.0ms)
  Rendered solutions/_listing.html.haml (1.3ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mClient Load (0.9ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mSolution Load (0.7ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  Rendered solutions/index.html.haml within layouts/application (41.5ms)
  Rendered layouts/_header.html.haml (9.9ms)
Completed 200 OK in 618ms (Views: 603.1ms | ActiveRecord: 4.9ms)


DEPRECATION WARNING: to_cleanup is deprecated and will be removed from Rails 5.1 (use ActiveSupport::Reloader.to_complete instead) (called from <top (required)> at /home/g1nc/Development/ruby/constructor/config/environment.rb:5)
Started GET "/solutions/17/edit" for 127.0.0.1 at 2017-05-01 01:42:09 +0300
Processing by SolutionsController#edit as HTML
  Parameters: {"id"=>"17"}
  [1m[36mProduct Load (13.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (2.4ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (2.1ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (2.4ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mSolution Load (4.6ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 17], ["LIMIT", 1]]
  [1m[36mUser Load (3.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (1.4ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 17]]
  [1m[36mStageProduct Load (1.4ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (41, 42, 43)[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 41]]
  [1m[36mStageProductSet Load (1.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 27[0m
  [1m[36mProduct Load (1.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 42]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 43]]
  [1m[36mExpense Load (2.8ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/edit.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (11.9ms)
  [1m[36mClientFile Load (1.4ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 17]]
  Rendered solutions/_technical_file_fields.html.haml (8.8ms)
  [1m[36mTechnicalFile Load (1.3ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 17]]
  Rendered budgets/_discount.html.haml (13.6ms)
  Rendered budgets/_stages.html.haml (50.2ms)
  Rendered solutions/_form.html.haml (226.3ms)
  Rendered solutions/edit.html.haml within layouts/application (234.6ms)
Started GET "/clients" for 127.0.0.1 at 2017-05-01 01:42:13 +0300
  Rendered layouts/_header.html.haml (54.7ms)
Completed 200 OK in 7781ms (Views: 7247.2ms | ActiveRecord: 41.6ms)


Processing by ClientsController#index as HTML
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (5.9ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2)[0m
  [1m[36mEstimate Load (1.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" IN (1, 2)[0m
  [1m[35m (1.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (10.2ms)
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (4.2ms)
  Rendered clients/_table.html.haml (18.1ms)
  [1m[36mUserClient Load (0.8ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (115.5ms)
  Rendered layouts/_header.html.haml (66.8ms)
Completed 200 OK in 952ms (Views: 916.3ms | ActiveRecord: 11.2ms)


Started GET "/clients" for 127.0.0.1 at 2017-05-01 01:42:18 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (13.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (5.8ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (1.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2)[0m
  [1m[36mEstimate Load (2.6ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" IN (1, 2)[0m
  [1m[35m (7.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (13.4ms)
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (7.8ms)
  Rendered clients/_table.html.haml (25.0ms)
  [1m[36mUserClient Load (0.8ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (53.8ms)
  Rendered layouts/_header.html.haml (8.1ms)
Completed 200 OK in 807ms (Views: 771.5ms | ActiveRecord: 31.6ms)


Started GET "/clients" for 127.0.0.1 at 2017-05-01 01:42:22 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (8.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (3.5ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.9ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2)[0m
  [1m[36mEstimate Load (1.9ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" IN (1, 2)[0m
  [1m[35m (1.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (17.8ms)
  [1m[35m (3.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (7.1ms)
  Rendered clients/_table.html.haml (30.1ms)
  [1m[36mUserClient Load (2.3ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (53.6ms)
  Rendered layouts/_header.html.haml (8.2ms)
Completed 200 OK in 732ms (Views: 706.7ms | ActiveRecord: 21.1ms)


Started GET "/clients" for 127.0.0.1 at 2017-05-01 01:42:39 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (0.9ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2)[0m
  [1m[36mEstimate Load (1.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" IN (1, 2)[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (9.3ms)
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (4.4ms)
  Rendered clients/_table.html.haml (18.1ms)
  [1m[36mUserClient Load (1.1ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (41.1ms)
  Rendered layouts/_header.html.haml (42.1ms)
Completed 200 OK in 656ms (Views: 643.0ms | ActiveRecord: 6.1ms)


Started GET "/clients" for 127.0.0.1 at 2017-05-01 01:44:27 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (17.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (17.8ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = true)[0m  [["archived", false]]
  [1m[36mClient Load (1.1ms)[0m  [1m[34mSELECT "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" IN (1, 2)[0m
  [1m[36mEstimate Load (3.6ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" IN (1, 2)[0m
  [1m[35m (6.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 1]]
  Rendered clients/_listing.html.haml (23.6ms)
  [1m[35m (1.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = $1[0m  [["client_id", 2]]
  Rendered clients/_listing.html.haml (16.6ms)
  Rendered clients/_table.html.haml (53.3ms)
  [1m[36mUserClient Load (1.7ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 1 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (97.5ms)
Started GET "/clients/1/edit" for 127.0.0.1 at 2017-05-01 01:44:32 +0300
Processing by ClientsController#edit as HTML
  Parameters: {"id"=>"1"}
  [1m[36mClient Load (23.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (12.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUserClient Exists (12.4ms)[0m  [1m[34mSELECT  1 AS one FROM "user_clients" WHERE "user_clients"."user_id" = 1 AND "user_clients"."client_id" = 1 LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUserClient Load (15.3ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" WHERE "user_clients"."client_id" = 1 AND ("user_clients"."user_id" != 1)[0m
  Rendering clients/edit.html.haml within layouts/application
  [1m[36mUserClient Load (18.5ms)[0m  [1m[34mSELECT  "user_clients".* FROM "user_clients" WHERE "user_clients"."user_id" = 1 AND "user_clients"."client_id" = 1 LIMIT $1[0m  [["LIMIT", 1]]
  Rendered clients/_form.html.haml (70.8ms)
  Rendered clients/edit.html.haml within layouts/application (86.7ms)
  Rendered layouts/_header.html.haml (23.3ms)
Completed 200 OK in 7802ms (Views: 7743.8ms | ActiveRecord: 50.1ms)


  Rendered layouts/_header.html.haml (12.2ms)
  [1m[36mUser Load (1.7ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE ("users"."id" != $1)[0m  [["id", 1]]
Completed 200 OK in 3968ms (Views: 3828.6ms | ActiveRecord: 84.2ms)


Started GET "/estimates?client_id=1" for 127.0.0.1 at 2017-05-01 01:44:42 +0300
Processing by EstimatesController#index as HTML
  Parameters: {"client_id"=>"1"}
  [1m[36mUser Load (3.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mClient Load (1.0ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.7ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."deleted_at" IS NULL AND "budgets"."type" IN ('Estimate') AND "budgets"."client_id" = 1[0m
  Rendering estimates/index.html.haml within layouts/application
  Rendered estimates/_listing.html.haml (3.5ms)
  Rendered estimates/_listing.html.haml (0.9ms)
  [1m[36mClient Load (1.2ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  Rendered estimates/index.html.haml within layouts/application (30.4ms)
  Rendered layouts/_header.html.haml (18.1ms)
Completed 200 OK in 669ms (Views: 634.0ms | ActiveRecord: 7.0ms)


Started GET "/estimates/19/edit" for 127.0.0.1 at 2017-05-01 01:44:47 +0300
Processing by EstimatesController#edit as HTML
  Parameters: {"id"=>"19"}
  [1m[36mProduct Load (1.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (2.5ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (1.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (14.2ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (1.1ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (1.9ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (0.8ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (2.1ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (0.9ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Estimate') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 19], ["LIMIT", 1]]
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (1.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 19]]
  [1m[36mStageProduct Load (0.9ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (47, 48, 49)[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 47]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 28[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 48]]
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 49]]
  [1m[36mExpense Load (0.9ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering estimates/edit.html.haml within layouts/application
  [1m[36mClient Load (0.6ms)[0m  [1m[34mSELECT "clients"."id", "clients"."first_name", "clients"."last_name", "clients"."middle_name" FROM "clients" WHERE "clients"."deleted_at" IS NULL[0m
  Rendered estimates/_client_file_fields.html.haml (9.3ms)
  [1m[36mClientFile Load (0.6ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 19]]
  Rendered estimates/_technical_file_fields.html.haml (5.7ms)
  [1m[36mTechnicalFile Load (1.2ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 19]]
  Rendered budgets/_discount.html.haml (10.3ms)
  Rendered budgets/_stages.html.haml (29.0ms)
  [1m[36mUser Load (6.8ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE (role = 'engineer')[0m
  Rendered estimates/_form.html.haml (169.0ms)
  Rendered estimates/edit.html.haml within layouts/application (173.0ms)
  Rendered layouts/_header.html.haml (10.1ms)
Completed 200 OK in 1291ms (Views: 844.2ms | ActiveRecord: 144.0ms)


Started PATCH "/estimates/19" for 127.0.0.1 at 2017-05-01 01:44:53 +0300
Processing by EstimatesController#update as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"9WEYfECosJEXwIOyJeDtrG5EVRybkTCEWA8S5ckRMxHwjBAqX6saSVpJXJZbm256Wtp2LwC57/rJHD32eEtQbw==", "export"=>"pdf", "estimate"=>{"price"=>"1578.5", "name"=>"442424", "client_id"=>"1", "area"=>"123", "first_floor_height"=>"123.0", "second_floor_height_min"=>"0.0", "second_floor_height_max"=>"0.0", "third_floor_height_min"=>"0.0", "third_floor_height_max"=>"0.0", "discount_title"=>"", "discount_by_stages"=>{"0"=>"0", "1"=>"0", "2"=>"0"}, "signed"=>"0"}, "json_stages"=>"[{\"number\":1,\"text\":{\"name\":\"Первый этап\",\"summ\":\"Итого по первому этапу:\",\"summ_dis\":\"по первому этапу\",\"discount\":\"Итого по первому этапу со скидкой:\"},\"price\":1578.5,\"total_price\":1578.5,\"products\":[{\"id\":1,\"name\":\"Простой продукт 1 этап\",\"unit\":\"шт\",\"custom\":false,\"profit\":100,\"price_with_work\":70,\"price_without_work\":10,\"with_work\":true,\"quantity\":11,\"sets\":[],\"price\":143.5}],\"aggregated_price\":1578.5},{\"number\":2,\"text\":{\"name\":\"Второй этап\",\"summ\":\"Итого по двум этапам:\",\"summ_dis\":\"по второму этапу\",\"discount\":\"Итого по двум этапам со скидкой:\"},\"price\":0,\"total_price\":0,\"products\":[],\"aggregated_price\":1578.5},{\"number\":3,\"text\":{\"name\":\"Третий этап\",\"summ\":\"Итого по трем этапам:\",\"summ_dis\":\"по третьему этапу\",\"discount\":\"Итого по трем этапам со скидкой:\"},\"price\":0,\"total_price\":0,\"products\":[],\"aggregated_price\":1578.5}]", "data"=>"", "id"=>"19"}
  [1m[36mProduct Load (1.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.2ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (16.9ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.7ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (2.8ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (2.9ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (2.0ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Estimate') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 19], ["LIMIT", 1]]
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Unpermitted parameters: second_floor_height_min, second_floor_height_max, third_floor_height_min, third_floor_height_max, discount_by_stages, signed
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mAudited::Audit Load (7.0ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 19], ["auditable_type", "Budget"], ["LIMIT", 1]]
  [1m[35mSQL (7.9ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 19], ["auditable_type", "Budget"], ["user_id", 1], ["user_type", "User"], ["action", "update"], ["audited_changes", "---\ndiscount_by_stages:\n- - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n- - '0'\n  - '0'\n  - '0'\n"], ["version", 2], ["remote_address", "127.0.0.1"], ["request_uuid", "d0a39b32-55f7-4bb2-8b8e-b0a95dfd71f5"], ["created_at", 2017-04-30 22:44:53 UTC]]
  [1m[35mSQL (2.9ms)[0m  [1m[33mUPDATE "budgets" SET "discount_by_stages" = $1, "updated_at" = $2 WHERE "budgets"."id" = $3[0m  [["discount_by_stages", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x00558c8b7f4de8 "decimal[]"  elements_type=nil needs quotation>, values=["0", "0", "0"]>], ["updated_at", 2017-04-30 22:44:53 UTC], ["id", 19]]
  [1m[35m (2.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (1.0ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."budget_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["budget_id", 19], ["number", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (3.1ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND ("stage_products"."product_id" != 1)[0m  [["stage_id", 47]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT  "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND "stage_products"."product_id" = $2 LIMIT $3[0m  [["stage_id", 47], ["product_id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (0.9ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."budget_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["budget_id", 19], ["number", 2], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.9ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND (1=1)[0m  [["stage_id", 48]]
  [1m[36mStage Load (3.1ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."budget_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["budget_id", 19], ["number", 3], ["LIMIT", 1]]
  [1m[35m (0.9ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND (1=1)[0m  [["stage_id", 49]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
Redirected to http://localhost:3000/estimates/19/export_pdf
Completed 302 Found in 228ms (ActiveRecord: 77.5ms)


Started GET "/estimates/19/export_pdf" for 127.0.0.1 at 2017-05-01 01:44:53 +0300
Processing by EstimatesController#export_pdf as HTML
  Parameters: {"estimate_id"=>"19"}
  [1m[36mUser Load (2.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.4ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Estimate') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 19], ["LIMIT", 1]]
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 19]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (47, 48, 49)[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 47]]
  [1m[36mStageProductSet Load (2.0ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 28[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 48]]
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 49]]
  Rendering estimates/export_pdf.html.haml within layouts/application
  Rendered estimates/export_pdf.html.haml within layouts/application (478.2ms)
Completed 500 Internal Server Error in 514ms (ActiveRecord: 10.7ms)


  
ActionView::Template::Error (undefined method `wicked_pdf_asset_base64' for #<#<Class:0x007f3442fa2008>:0x007f34398274d0>):
    1: %html
    2:   %head
    3:     %meta{charset: 'utf-8'}
    4:     = stylesheet_link_tag wicked_pdf_asset_base64("pdf")
    5:   %body
    6:     .row
    7:       .col-xs-4.text-right
  
app/views/estimates/export_pdf.html.haml:4:in `_app_views_estimates_export_pdf_html_haml___3904753984342246996_69931139935120'
app/controllers/application_controller.rb:8:in `render'
app/controllers/estimates_controller.rb:171:in `export_pdf'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (8.2ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.4ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.0ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (47.9ms)
Started PATCH "/estimates/19" for 127.0.0.1 at 2017-05-01 01:46:14 +0300
Processing by EstimatesController#update as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"JqPt8Z5Ny9GCbdkgLnCsrxFEcY8FJ1BLXJ7ylcuz5ccjTuWngU5hCc/kBgRQCy95JdpSvJ4PjzXNjd2GeumGuQ==", "export"=>"doc", "estimate"=>{"price"=>"1578.5", "name"=>"442424", "client_id"=>"1", "area"=>"123", "first_floor_height"=>"123.0", "second_floor_height_min"=>"0.0", "second_floor_height_max"=>"0.0", "third_floor_height_min"=>"0.0", "third_floor_height_max"=>"0.0", "discount_title"=>"", "discount_by_stages"=>{"0"=>"0", "1"=>"0", "2"=>"0"}, "signed"=>"0"}, "json_stages"=>"[{\"number\":1,\"text\":{\"name\":\"Первый этап\",\"summ\":\"Итого по первому этапу:\",\"summ_dis\":\"по первому этапу\",\"discount\":\"Итого по первому этапу со скидкой:\"},\"price\":1578.5,\"total_price\":1578.5,\"products\":[{\"id\":1,\"name\":\"Простой продукт 1 этап\",\"unit\":\"шт\",\"custom\":false,\"profit\":100,\"price_with_work\":70,\"price_without_work\":10,\"with_work\":true,\"quantity\":11,\"sets\":[],\"price\":143.5}],\"aggregated_price\":1578.5},{\"number\":2,\"text\":{\"name\":\"Второй этап\",\"summ\":\"Итого по двум этапам:\",\"summ_dis\":\"по второму этапу\",\"discount\":\"Итого по двум этапам со скидкой:\"},\"price\":0,\"total_price\":0,\"products\":[],\"aggregated_price\":1578.5},{\"number\":3,\"text\":{\"name\":\"Третий этап\",\"summ\":\"Итого по трем этапам:\",\"summ_dis\":\"по третьему этапу\",\"discount\":\"Итого по трем этапам со скидкой:\"},\"price\":0,\"total_price\":0,\"products\":[],\"aggregated_price\":1578.5}]", "data"=>"", "id"=>"19"}
  [1m[36mProduct Load (2.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (3.2ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (1.2ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mProduct Load (2.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 2]]
  [1m[36mUnit Load (1.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 3[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mConstructorObject Load (1.8ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (2, 3)[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 3]]
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 5[0m
  [1m[36mProductSet Load (11.3ms)[0m  [1m[34mSELECT DISTINCT "product_sets".* FROM "product_sets" INNER JOIN "product_template_sets" ON "product_sets"."id" = "product_template_sets"."product_set_id" WHERE "product_sets"."deleted_at" IS NULL AND "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_id" = $1[0m  [["product_id", 3]]
  [1m[36mProductTemplateSet Load (0.6ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = 1[0m
  [1m[36mProductTemplate Load (1.1ms)[0m  [1m[34mSELECT "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" IN (1, 2)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 6[0m
  [1m[36mProductTemplateSet Load (1.5ms)[0m  [1m[34mSELECT "product_template_sets".* FROM "product_template_sets" WHERE "product_template_sets"."deleted_at" IS NULL AND "product_template_sets"."product_set_id" = $1 AND "product_template_sets"."product_id" = 3[0m  [["product_set_id", 1]]
  [1m[36mProductTemplate Load (0.7ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.8ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUnit Load (1.4ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mProductTemplate Load (0.6ms)[0m  [1m[34mSELECT  "product_templates".* FROM "product_templates" WHERE "product_templates"."deleted_at" IS NULL AND "product_templates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mConstructorObject Load (0.5ms)[0m  [1m[34mSELECT  "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT  "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mEstimate Load (1.2ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Estimate') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 19], ["LIMIT", 1]]
  [1m[36mUser Load (2.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Unpermitted parameters: second_floor_height_min, second_floor_height_max, third_floor_height_min, third_floor_height_max, discount_by_stages, signed
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mClient Load (0.5ms)[0m  [1m[34mSELECT  "clients".* FROM "clients" WHERE "clients"."deleted_at" IS NULL AND "clients"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mAudited::Audit Load (2.8ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 19], ["auditable_type", "Budget"], ["LIMIT", 1]]
  [1m[35mSQL (9.4ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "user_id", "user_type", "action", "audited_changes", "version", "remote_address", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["auditable_id", 19], ["auditable_type", "Budget"], ["user_id", 1], ["user_type", "User"], ["action", "update"], ["audited_changes", "---\ndiscount_by_stages:\n- - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n  - !ruby/object:BigDecimal 18:0.0\n- - '0'\n  - '0'\n  - '0'\n"], ["version", 3], ["remote_address", "127.0.0.1"], ["request_uuid", "3961fd33-442d-4945-ab5e-9bb2ff8f93a9"], ["created_at", 2017-04-30 22:46:14 UTC]]
  [1m[35mSQL (2.1ms)[0m  [1m[33mUPDATE "budgets" SET "discount_by_stages" = $1, "updated_at" = $2 WHERE "budgets"."id" = $3[0m  [["discount_by_stages", #<struct ActiveRecord::ConnectionAdapters::PostgreSQL::OID::Array::Data encoder=#<PG::TextEncoder::Array:0x00558c8b7f4de8 "decimal[]"  elements_type=nil needs quotation>, values=["0", "0", "0"]>], ["updated_at", 2017-04-30 22:46:14 UTC], ["id", 19]]
  [1m[35m (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (0.8ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."budget_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["budget_id", 19], ["number", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (1.3ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND ("stage_products"."product_id" != 1)[0m  [["stage_id", 47]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT  "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND "stage_products"."product_id" = $2 LIMIT $3[0m  [["stage_id", 47], ["product_id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStage Load (0.6ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."budget_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["budget_id", 19], ["number", 2], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND (1=1)[0m  [["stage_id", 48]]
  [1m[36mStage Load (0.6ms)[0m  [1m[34mSELECT  "stages".* FROM "stages" WHERE "stages"."budget_id" = $1 AND "stages"."number" = $2 LIMIT $3[0m  [["budget_id", 19], ["number", 3], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1 AND (1=1)[0m  [["stage_id", 49]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
Redirected to http://localhost:3000/estimates/19/export_doc
Completed 302 Found in 171ms (ActiveRecord: 64.1ms)


Started GET "/estimates/19/export_doc" for 127.0.0.1 at 2017-05-01 01:46:14 +0300
Processing by EstimatesController#export_doc as 
  Parameters: {"estimate_id"=>"19"}
  [1m[36mUser Load (1.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEstimate Load (2.3ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Estimate') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 19], ["LIMIT", 1]]
  [1m[36mStage Load (6.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 19]]
  [1m[36mStageProduct Load (2.2ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (47, 48, 49)[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 47]]
  [1m[36mStageProductSet Load (1.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 28[0m
  [1m[36mProduct Load (2.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mUnit Load (1.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (1.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 48]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 49]]
Completed 500 Internal Server Error in 40ms (ActiveRecord: 19.7ms)


  
NoMethodError (To respond to a custom format, register it as a MIME type first: http://guides.rubyonrails.org/action_controller_overview.html#restful-downloads. If you meant to respond to a variant like :tablet or :phone, not a custom format, be sure to nest your variant response within a format response: format.html { |html| html.tablet { ... } }):
  
app/controllers/estimates_controller.rb:179:in `block in export_doc'
app/controllers/estimates_controller.rb:178:in `export_doc'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (36.8ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.0ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.1ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (62.6ms)
Started GET "/solutions" for 127.0.0.1 at 2017-05-01 01:53:57 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (1.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (0.8ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing.html.haml (5.6ms)
  Rendered solutions/_listing.html.haml (0.9ms)
  Rendered solutions/_listing.html.haml (0.8ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mClient Load (1.4ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mSolution Load (0.8ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  Rendered solutions/index.html.haml within layouts/application (125.6ms)
  Rendered layouts/_header.html.haml (79.3ms)
Completed 200 OK in 800ms (Views: 755.4ms | ActiveRecord: 4.3ms)


Started GET "/solutions/20/edit" for 127.0.0.1 at 2017-05-01 01:57:44 +0300
Processing by SolutionsController#edit as HTML
  Parameters: {"id"=>"20"}
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.1ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mSolution Load (0.7ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 20], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.6ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 20]]
  [1m[36mStageProduct Load (0.9ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (50, 51, 52)[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 50]]
  [1m[36mStageProductSet Load (1.0ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 29[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 51]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 52]]
  [1m[36mExpense Load (1.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/edit.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (11.1ms)
  [1m[36mClientFile Load (3.5ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered solutions/_technical_file_fields.html.haml (4.3ms)
  [1m[36mTechnicalFile Load (0.5ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered budgets/_discount.html.haml (6.3ms)
  Rendered budgets/_stages.html.haml (19.1ms)
  Rendered solutions/_form.html.haml (113.6ms)
  Rendered solutions/edit.html.haml within layouts/application (118.7ms)
  Rendered layouts/_header.html.haml (30.8ms)
Completed 200 OK in 1001ms (Views: 735.0ms | ActiveRecord: 15.8ms)


Started GET "/solutions" for 127.0.0.1 at 2017-05-01 01:57:48 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (0.8ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing.html.haml (7.7ms)
  Rendered solutions/_listing.html.haml (0.9ms)
  Rendered solutions/_listing.html.haml (0.9ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mClient Load (0.8ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mSolution Load (1.5ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  Rendered solutions/index.html.haml within layouts/application (83.9ms)
  Rendered layouts/_header.html.haml (16.3ms)
Completed 200 OK in 745ms (Views: 722.0ms | ActiveRecord: 14.7ms)


Started DELETE "/signout" for 127.0.0.1 at 2017-05-01 01:57:53 +0300
Processing by Devise::SessionsController#destroy as HTML
  Parameters: {"authenticity_token"=>"Xi8cRVRinWFQuTQ7E1XnRVEWPsY8IRFTlK63z5zSuDpbwhQTS2E3uR0w6x9tLmSTZYgd9acJzi0FvZjcLYjbRA=="}
  [1m[36mUser Load (2.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
Redirected to http://localhost:3000/
Completed 302 Found in 13ms (ActiveRecord: 2.9ms)


Started GET "/" for 127.0.0.1 at 2017-05-01 01:57:53 +0300
Processing by HomeController#index as HTML
Completed 401 Unauthorized in 6ms (ActiveRecord: 0.0ms)


Started GET "/signin" for 127.0.0.1 at 2017-05-01 01:57:53 +0300
Processing by Devise::SessionsController#new as HTML
  Rendering devise/sessions/new.html.haml within layouts/application
  Rendered devise/sessions/new.html.haml within layouts/application (13.9ms)
  Rendered layouts/_header.html.haml (8.5ms)
Completed 200 OK in 578ms (Views: 574.9ms | ActiveRecord: 0.0ms)


Started POST "/signin" for 127.0.0.1 at 2017-05-01 01:58:00 +0300
Processing by Devise::SessionsController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"hzihwhsMBGx7LfmFQI3OUSDLoHl0qIMpoCf2u7g8nEqIr5NtHrfYR4MbWH/y7DD/AWoejZTktmXqXtRK6fChfw==", "user"=>{"email"=>"architect@test.test", "password"=>"[FILTERED]"}, "commit"=>"Войти"}
  [1m[36mUser Load (1.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."email" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["email", "architect@test.test"], ["LIMIT", 1]]
Completed 401 Unauthorized in 8ms (ActiveRecord: 1.5ms)


Processing by Devise::SessionsController#new as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"hzihwhsMBGx7LfmFQI3OUSDLoHl0qIMpoCf2u7g8nEqIr5NtHrfYR4MbWH/y7DD/AWoejZTktmXqXtRK6fChfw==", "user"=>{"email"=>"architect@test.test", "password"=>"[FILTERED]"}, "commit"=>"Войти"}
  Rendering devise/sessions/new.html.haml within layouts/application
  Rendered devise/sessions/new.html.haml within layouts/application (6.0ms)
  Rendered layouts/_header.html.haml (7.8ms)
Completed 200 OK in 810ms (Views: 623.6ms | ActiveRecord: 0.0ms)


Started POST "/signin" for 127.0.0.1 at 2017-05-01 01:58:06 +0300
Processing by Devise::SessionsController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"DCq3ujLsObBLFZ+UUCyYEvihAK32aVrtXco0HDs7wuQDvYUVN1flm7MjPm7iTWa82QC+WRYlb6EXsxbtavf/0Q==", "user"=>{"email"=>"architect@test.test", "password"=>"[FILTERED]"}, "commit"=>"Войти"}
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."email" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["email", "architect@test.test"], ["LIMIT", 1]]
Completed 401 Unauthorized in 6ms (ActiveRecord: 0.8ms)


Processing by Devise::SessionsController#new as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"DCq3ujLsObBLFZ+UUCyYEvihAK32aVrtXco0HDs7wuQDvYUVN1flm7MjPm7iTWa82QC+WRYlb6EXsxbtavf/0Q==", "user"=>{"email"=>"architect@test.test", "password"=>"[FILTERED]"}, "commit"=>"Войти"}
  Rendering devise/sessions/new.html.haml within layouts/application
  Rendered devise/sessions/new.html.haml within layouts/application (7.3ms)
  Rendered layouts/_header.html.haml (9.1ms)
Completed 200 OK in 785ms (Views: 655.9ms | ActiveRecord: 0.0ms)


Started POST "/signin" for 127.0.0.1 at 2017-05-01 01:58:14 +0300
Processing by Devise::SessionsController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"jUXZe1aoPeBwWoTnDBZd31nZgawgevgd2uJ52LAkESiC0uvUUxPhy4hsJR2+d6NxeHg/WMA2zVGQm1sp4egsHQ==", "user"=>{"email"=>"engineer@test.test", "password"=>"[FILTERED]"}, "commit"=>"Войти"}
  [1m[36mUser Load (2.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."email" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["email", "engineer@test.test"], ["LIMIT", 1]]
Completed 401 Unauthorized in 5ms (ActiveRecord: 2.0ms)


Processing by Devise::SessionsController#new as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"jUXZe1aoPeBwWoTnDBZd31nZgawgevgd2uJ52LAkESiC0uvUUxPhy4hsJR2+d6NxeHg/WMA2zVGQm1sp4egsHQ==", "user"=>{"email"=>"engineer@test.test", "password"=>"[FILTERED]"}, "commit"=>"Войти"}
  Rendering devise/sessions/new.html.haml within layouts/application
  Rendered devise/sessions/new.html.haml within layouts/application (7.8ms)
  Rendered layouts/_header.html.haml (10.7ms)
Completed 200 OK in 720ms (Views: 578.3ms | ActiveRecord: 0.0ms)


Started POST "/signin" for 127.0.0.1 at 2017-05-01 01:58:21 +0300
Processing by Devise::SessionsController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"VayR5DHbBw1l5hOuv9Vz6aGowYcxExhHnHWc5OhVGANaO6NLNGDbJp3QslQNtI1HgAl/c9FfLQvWDL4VuZklNg==", "user"=>{"email"=>"admin@test.test", "password"=>"[FILTERED]"}, "commit"=>"Войти"}
  [1m[36mUser Load (2.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."email" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["email", "admin@test.test"], ["LIMIT", 1]]
Redirected to http://localhost:3000/
Completed 302 Found in 152ms (ActiveRecord: 2.6ms)


Started GET "/" for 127.0.0.1 at 2017-05-01 01:58:22 +0300
Processing by HomeController#index as HTML
  [1m[36mUser Load (1.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering home/index.html.haml within layouts/application
  Rendered home/index.html.haml within layouts/application (1.1ms)
  Rendered layouts/_header.html.haml (8.4ms)
Completed 200 OK in 743ms (Views: 737.8ms | ActiveRecord: 1.3ms)


Started GET "/users" for 127.0.0.1 at 2017-05-01 01:58:25 +0300
Processing by UsersController#index as HTML
  [1m[36mUser Load (2.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering users/index.html.haml within layouts/application
  [1m[35m (1.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  Rendered users/_listing.html.haml (2.7ms)
  Rendered users/_listing.html.haml (0.7ms)
  Rendered users/_listing.html.haml (0.6ms)
  Rendered users/index.html.haml within layouts/application (17.9ms)
  Rendered layouts/_header.html.haml (9.7ms)
Completed 200 OK in 594ms (Views: 584.3ms | ActiveRecord: 4.1ms)


Started GET "/users/2/edit" for 127.0.0.1 at 2017-05-01 01:58:28 +0300
Processing by UsersController#edit as HTML
  Parameters: {"id"=>"2"}
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering users/edit.html.haml within layouts/application
  Rendered users/_form.html.haml (29.2ms)
  Rendered users/edit.html.haml within layouts/application (40.0ms)
  Rendered layouts/_header.html.haml (9.6ms)
Completed 200 OK in 611ms (Views: 601.0ms | ActiveRecord: 1.8ms)


Started DELETE "/signout" for 127.0.0.1 at 2017-05-01 01:58:32 +0300
Processing by Devise::SessionsController#destroy as HTML
  Parameters: {"authenticity_token"=>"XBYK7guEaRrNPj2uMoD7TBa9dTiRjtEoSYDSGZpZh2aHT78fNlhC7tUa4WccgBQXgLMPZvRbmVVVxXKsCFM43Q=="}
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.2ms)[0m  [1m[35mCOMMIT[0m
Redirected to http://localhost:3000/
Completed 302 Found in 9ms (ActiveRecord: 3.4ms)


Started GET "/" for 127.0.0.1 at 2017-05-01 01:58:32 +0300
Processing by HomeController#index as HTML
Completed 401 Unauthorized in 1ms (ActiveRecord: 0.0ms)


Started GET "/signin" for 127.0.0.1 at 2017-05-01 01:58:32 +0300
Processing by Devise::SessionsController#new as HTML
  Rendering devise/sessions/new.html.haml within layouts/application
  Rendered devise/sessions/new.html.haml within layouts/application (6.1ms)
  Rendered layouts/_header.html.haml (7.5ms)
Completed 200 OK in 593ms (Views: 592.0ms | ActiveRecord: 0.0ms)


Started POST "/signin" for 127.0.0.1 at 2017-05-01 01:58:39 +0300
Processing by Devise::SessionsController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"CRvnQYFI7VzigX2HwvtGf53FMzVRPOlloZ0Igf2MXbHcB5uGVYgHlS4Zx3fe7zL/IyIHvoPsP+7DuRnEk7/l+w==", "user"=>{"email"=>"arch@test.test", "password"=>"[FILTERED]"}, "commit"=>"Войти"}
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."email" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["email", "arch@test.test"], ["LIMIT", 1]]
Redirected to http://localhost:3000/
Completed 302 Found in 163ms (ActiveRecord: 1.1ms)


Started GET "/" for 127.0.0.1 at 2017-05-01 01:58:39 +0300
Processing by HomeController#index as HTML
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendering home/index.html.haml within layouts/application
  Rendered home/index.html.haml within layouts/application (0.9ms)
  Rendered layouts/_header.html.haml (9.5ms)
Completed 200 OK in 576ms (Views: 572.0ms | ActiveRecord: 0.8ms)


Started GET "/solutions" for 127.0.0.1 at 2017-05-01 01:58:41 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (2.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (0.7ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing.html.haml (8.0ms)
  Rendered solutions/_listing.html.haml (0.8ms)
  Rendered solutions/_listing.html.haml (0.8ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mClient Load (2.4ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 2]]
  [1m[36mSolution Load (0.9ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  Rendered solutions/index.html.haml within layouts/application (74.1ms)
  Rendered layouts/_header.html.haml (10.2ms)
Completed 200 OK in 688ms (Views: 673.5ms | ActiveRecord: 6.2ms)


Started GET "/solutions/17" for 127.0.0.1 at 2017-05-01 01:58:45 +0300
Processing by SolutionsController#show as HTML
  Parameters: {"id"=>"17"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendering solutions/show.html.haml within layouts/application
  Rendered solutions/show.html.haml within layouts/application (26.8ms)
Completed 500 Internal Server Error in 37ms (ActiveRecord: 0.7ms)


  
ActionView::Template::Error (undefined method `model_name' for nil:NilClass):
    1: = simple_form_for @solution,  wrapper: :horizontal_form do |f|
    2:   .action-buttons.row
    3:     = link_to 'Отмена', solutions_path, class: 'btn btn-default'
    4:     = f.button :submit, 'Сохранить', class: 'btn btn-success pull-right'
  
app/views/solutions/show.html.haml:1:in `_app_views_solutions_show_html_haml___3562336501893392117_69931470966460'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (5.8ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (3.2ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.2ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (34.8ms)
Started GET "/solutions" for 127.0.0.1 at 2017-05-01 01:58:47 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (1.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (0.9ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing.html.haml (6.5ms)
  Rendered solutions/_listing.html.haml (0.9ms)
  Rendered solutions/_listing.html.haml (0.7ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mClient Load (1.2ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 2]]
  [1m[36mSolution Load (0.7ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  Rendered solutions/index.html.haml within layouts/application (34.8ms)
  Rendered layouts/_header.html.haml (17.5ms)
Completed 200 OK in 690ms (Views: 681.4ms | ActiveRecord: 4.7ms)


Started GET "/solutions" for 127.0.0.1 at 2017-05-01 02:03:29 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (0.7ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing.html.haml (5.5ms)
  Rendered solutions/_listing.html.haml (1.0ms)
  Rendered solutions/_listing.html.haml (0.9ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mClient Load (0.7ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 2]]
  [1m[36mSolution Load (0.6ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  Rendered solutions/index.html.haml within layouts/application (41.2ms)
  Rendered layouts/_header.html.haml (11.8ms)
Completed 200 OK in 690ms (Views: 683.0ms | ActiveRecord: 2.9ms)


Started GET "/solutions/20" for 127.0.0.1 at 2017-05-01 02:03:35 +0300
Processing by SolutionsController#show as HTML
  Parameters: {"id"=>"20"}
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendering solutions/show.html.haml within layouts/application
  Rendered solutions/show.html.haml within layouts/application (28.0ms)
Completed 500 Internal Server Error in 38ms (ActiveRecord: 1.1ms)


  
ActionView::Template::Error (undefined method `model_name' for nil:NilClass):
    4:     %li= link_to 'Готовые решения', solutions_path
    5:     %li.active @estimate.name
    6: 
    7:   = simple_form_for @solution,  wrapper: :horizontal_form do |f|
    8:     .action-buttons.row
    9:       = link_to 'Отмена', solutions_path, class: 'btn btn-default'
   10:       - if @solution.proposed
  
app/views/solutions/show.html.haml:7:in `_app_views_solutions_show_html_haml___3562336501893392117_69931217506460'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (6.3ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.8ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.6ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (34.6ms)
Started GET "/solutions/20" for 127.0.0.1 at 2017-05-01 02:04:10 +0300
Processing by SolutionsController#show as HTML
  Parameters: {"id"=>"20"}
  [1m[36mSolution Load (2.8ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 20], ["LIMIT", 1]]
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendering solutions/show.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (7.2ms)
  [1m[36mClientFile Load (1.0ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered solutions/_technical_file_fields.html.haml (5.7ms)
  [1m[36mTechnicalFile Load (1.4ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered budgets/_discount.html.haml (17.1ms)
  Rendered budgets/_stages.html.haml (18.5ms)
  Rendered solutions/show.html.haml within layouts/application (109.6ms)
  Rendered layouts/_header.html.haml (12.4ms)
Completed 200 OK in 772ms (Views: 693.9ms | ActiveRecord: 6.0ms)


Started GET "/solutions/20" for 127.0.0.1 at 2017-05-01 02:04:50 +0300
Processing by SolutionsController#show as HTML
  Parameters: {"id"=>"20"}
  [1m[36mSolution Load (3.0ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 20], ["LIMIT", 1]]
  [1m[36mUser Load (1.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendering solutions/show.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (4.6ms)
  [1m[36mClientFile Load (1.8ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered solutions/_technical_file_fields.html.haml (4.7ms)
  [1m[36mTechnicalFile Load (0.5ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered budgets/_discount.html.haml (18.9ms)
  Rendered budgets/_stages.html.haml (27.0ms)
  Rendered solutions/show.html.haml within layouts/application (116.5ms)
  Rendered layouts/_header.html.haml (9.1ms)
Completed 200 OK in 653ms (Views: 636.7ms | ActiveRecord: 6.6ms)


Started GET "/solutions/20" for 127.0.0.1 at 2017-05-01 02:05:01 +0300
Processing by SolutionsController#show as HTML
  Parameters: {"id"=>"20"}
  [1m[36mSolution Load (2.1ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 20], ["LIMIT", 1]]
  [1m[36mUser Load (2.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendering solutions/show.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (4.0ms)
  [1m[36mClientFile Load (1.2ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered solutions/_technical_file_fields.html.haml (4.4ms)
  [1m[36mTechnicalFile Load (0.5ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered budgets/_discount.html.haml (7.6ms)
  Rendered budgets/_stages.html.haml (16.2ms)
  Rendered solutions/show.html.haml within layouts/application (71.7ms)
  Rendered layouts/_header.html.haml (7.9ms)
Completed 200 OK in 606ms (Views: 590.2ms | ActiveRecord: 6.0ms)


Started GET "/solutions/20" for 127.0.0.1 at 2017-05-01 02:05:21 +0300
Processing by SolutionsController#show as HTML
  Parameters: {"id"=>"20"}
  [1m[36mSolution Load (1.1ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 20], ["LIMIT", 1]]
  [1m[36mUser Load (1.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mStage Load (1.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 20]]
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (50, 51, 52)[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 50]]
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 29[0m
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 51]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 52]]
  [1m[36mExpense Load (0.4ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/show.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (9.1ms)
  [1m[36mClientFile Load (0.5ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered solutions/_technical_file_fields.html.haml (4.8ms)
  [1m[36mTechnicalFile Load (0.7ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered budgets/_discount.html.haml (8.3ms)
  Rendered budgets/_stages.html.haml (19.8ms)
  Rendered solutions/show.html.haml within layouts/application (98.5ms)
  Rendered layouts/_header.html.haml (10.6ms)
Completed 200 OK in 822ms (Views: 628.7ms | ActiveRecord: 10.0ms)


Started GET "/solutions/20" for 127.0.0.1 at 2017-05-01 02:06:55 +0300
Processing by SolutionsController#show as HTML
  Parameters: {"id"=>"20"}
  [1m[36mSolution Load (2.3ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 20], ["LIMIT", 1]]
  [1m[36mUser Load (3.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mStage Load (0.9ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 20]]
  [1m[36mStageProduct Load (1.1ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (50, 51, 52)[0m
  [1m[36mStageProduct Load (1.1ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 50]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 29[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 51]]
  [1m[36mStageProduct Load (1.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 52]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/show.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (3.6ms)
  [1m[36mClientFile Load (1.1ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered solutions/_technical_file_fields.html.haml (4.4ms)
  [1m[36mTechnicalFile Load (0.7ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered budgets/_discount.html.haml (8.9ms)
  Rendered budgets/_stages.html.haml (21.0ms)
  Rendered solutions/show.html.haml within layouts/application (77.3ms)
  Rendered layouts/_header.html.haml (7.6ms)
Completed 200 OK in 673ms (Views: 626.8ms | ActiveRecord: 14.6ms)


Started GET "/solutions/20" for 127.0.0.1 at 2017-05-01 02:07:03 +0300
Processing by SolutionsController#show as HTML
  Parameters: {"id"=>"20"}
  [1m[36mSolution Load (1.5ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 20], ["LIMIT", 1]]
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mStage Load (0.9ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 20]]
  [1m[36mStageProduct Load (1.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (50, 51, 52)[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 50]]
  [1m[36mStageProductSet Load (3.1ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 29[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (2.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 51]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 52]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/show.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (3.6ms)
  [1m[36mClientFile Load (1.6ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered solutions/_technical_file_fields.html.haml (3.3ms)
  [1m[36mTechnicalFile Load (0.7ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered budgets/_discount.html.haml (11.5ms)
  Rendered budgets/_stages.html.haml (16.6ms)
  Rendered solutions/show.html.haml within layouts/application (73.4ms)
  Rendered layouts/_header.html.haml (10.5ms)
Completed 200 OK in 696ms (Views: 654.2ms | ActiveRecord: 15.7ms)


Started GET "/solutions/20" for 127.0.0.1 at 2017-05-01 02:08:08 +0300
Processing by SolutionsController#show as HTML
  Parameters: {"id"=>"20"}
  [1m[36mSolution Load (3.0ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 20], ["LIMIT", 1]]
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mStage Load (2.4ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 20]]
  [1m[36mStageProduct Load (1.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (50, 51, 52)[0m
  [1m[36mStageProduct Load (1.1ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 50]]
  [1m[36mStageProductSet Load (0.9ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 29[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (1.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 51]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 52]]
  [1m[36mExpense Load (1.4ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/show.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (7.7ms)
  [1m[36mClientFile Load (2.6ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered solutions/_technical_file_fields.html.haml (5.4ms)
  [1m[36mTechnicalFile Load (2.0ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered budgets/_discount.html.haml (13.6ms)
  Rendered budgets/_stages.html.haml (28.8ms)
  Rendered solutions/show.html.haml within layouts/application (103.6ms)
  Rendered layouts/_header.html.haml (13.2ms)
Completed 200 OK in 741ms (Views: 693.5ms | ActiveRecord: 22.9ms)


Started GET "/solutions/20" for 127.0.0.1 at 2017-05-01 02:08:43 +0300
Processing by SolutionsController#show as HTML
  Parameters: {"id"=>"20"}
  [1m[36mSolution Load (1.7ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 20], ["LIMIT", 1]]
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mStage Load (0.9ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 20]]
  [1m[36mStageProduct Load (0.9ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (50, 51, 52)[0m
  [1m[36mStageProduct Load (0.9ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 50]]
  [1m[36mStageProductSet Load (1.2ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 29[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (2.9ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 51]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 52]]
  [1m[36mExpense Load (1.0ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/show.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (4.0ms)
  [1m[36mClientFile Load (1.6ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered solutions/_technical_file_fields.html.haml (4.5ms)
  [1m[36mTechnicalFile Load (1.1ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered budgets/_discount.html.haml (8.5ms)
  Rendered budgets/_stages.html.haml (19.2ms)
  Rendered solutions/show.html.haml within layouts/application (81.1ms)
  Rendered layouts/_header.html.haml (15.4ms)
Completed 200 OK in 679ms (Views: 632.3ms | ActiveRecord: 15.2ms)


Started GET "/solutions/20" for 127.0.0.1 at 2017-05-01 02:08:59 +0300
Processing by SolutionsController#show as HTML
  Parameters: {"id"=>"20"}
  [1m[36mSolution Load (4.6ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 20], ["LIMIT", 1]]
  [1m[36mUser Load (1.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mStage Load (1.2ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 20]]
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (50, 51, 52)[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 50]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 29[0m
  [1m[36mProduct Load (2.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (2.4ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 51]]
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 52]]
  [1m[36mExpense Load (0.4ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/show.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (3.3ms)
  [1m[36mClientFile Load (0.5ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered solutions/_technical_file_fields.html.haml (5.5ms)
  [1m[36mTechnicalFile Load (0.6ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered budgets/_discount.html.haml (9.0ms)
  Rendered budgets/_stages.html.haml (16.7ms)
  Rendered solutions/show.html.haml within layouts/application (85.1ms)
  Rendered layouts/_header.html.haml (9.3ms)
Completed 200 OK in 744ms (Views: 699.0ms | ActiveRecord: 17.8ms)


Started GET "/solutions/20" for 127.0.0.1 at 2017-05-01 02:09:18 +0300
Processing by SolutionsController#show as HTML
  Parameters: {"id"=>"20"}
  [1m[36mSolution Load (1.1ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 20], ["LIMIT", 1]]
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mStage Load (0.6ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 20]]
  [1m[36mStageProduct Load (2.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (50, 51, 52)[0m
  [1m[36mStageProduct Load (2.4ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 50]]
  [1m[36mStageProductSet Load (3.1ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 29[0m
  [1m[36mProduct Load (0.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (1.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 51]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 52]]
  [1m[36mExpense Load (0.8ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/show.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (3.6ms)
  [1m[36mClientFile Load (0.7ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered solutions/_technical_file_fields.html.haml (6.9ms)
  [1m[36mTechnicalFile Load (1.9ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered budgets/_discount.html.haml (8.8ms)
  Rendered budgets/_stages.html.haml (22.9ms)
  Rendered solutions/show.html.haml within layouts/application (83.9ms)
  Rendered layouts/_header.html.haml (7.9ms)
Completed 200 OK in 699ms (Views: 656.9ms | ActiveRecord: 16.6ms)


Started GET "/solutions/20" for 127.0.0.1 at 2017-05-01 02:10:15 +0300
Processing by SolutionsController#show as HTML
  Parameters: {"id"=>"20"}
  [1m[36mSolution Load (1.2ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 20], ["LIMIT", 1]]
  [1m[36mUser Load (3.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mStage Load (2.1ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 20]]
  [1m[36mStageProduct Load (1.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (50, 51, 52)[0m
  [1m[36mStageProduct Load (2.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 50]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 29[0m
  [1m[36mProduct Load (1.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mUnit Load (1.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 51]]
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 52]]
  [1m[36mExpense Load (0.7ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/show.html.haml within layouts/application
  [1m[36mClientFile Load (1.3ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered solutions/_technical_file_fields.html.haml (5.5ms)
  [1m[36mTechnicalFile Load (0.8ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered budgets/_discount.html.haml (10.5ms)
  Rendered budgets/_stages.html.haml (41.6ms)
  Rendered solutions/show.html.haml within layouts/application (92.6ms)
  Rendered layouts/_header.html.haml (7.5ms)
Completed 200 OK in 652ms (Views: 606.4ms | ActiveRecord: 18.4ms)


Started GET "/solutions/20" for 127.0.0.1 at 2017-05-01 02:10:33 +0300
Processing by SolutionsController#show as HTML
  Parameters: {"id"=>"20"}
  [1m[36mSolution Load (7.2ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 20], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mStage Load (0.6ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 20]]
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (50, 51, 52)[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 50]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 29[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mUnit Load (0.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 51]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 52]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/show.html.haml within layouts/application
  [1m[36mClientFile Load (0.9ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered solutions/_technical_file_fields.html.haml (7.2ms)
  [1m[36mTechnicalFile Load (0.6ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered budgets/_discount.html.haml (53.2ms)
  Rendered budgets/_stages.html.haml (23.0ms)
  Rendered solutions/show.html.haml within layouts/application (119.8ms)
  Rendered layouts/_header.html.haml (9.1ms)
Completed 200 OK in 728ms (Views: 683.1ms | ActiveRecord: 14.8ms)


Started GET "/solutions/20" for 127.0.0.1 at 2017-05-01 02:11:17 +0300
Processing by SolutionsController#show as HTML
  Parameters: {"id"=>"20"}
  [1m[36mSolution Load (2.0ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 20], ["LIMIT", 1]]
  [1m[36mUser Load (5.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mStage Load (0.8ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 20]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (50, 51, 52)[0m
  [1m[36mStageProduct Load (1.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 50]]
  [1m[36mStageProductSet Load (0.7ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 29[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mUnit Load (0.9ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (1.4ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 51]]
  [1m[36mStageProduct Load (1.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 52]]
  [1m[36mExpense Load (0.6ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/show.html.haml within layouts/application
  [1m[36mClientFile Load (2.7ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 20]]
  [1m[36mTechnicalFile Load (0.8ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered budgets/_discount.html.haml (13.6ms)
  Rendered budgets/_stages.html.haml (22.9ms)
  Rendered solutions/show.html.haml within layouts/application (76.3ms)
  Rendered layouts/_header.html.haml (8.0ms)
Completed 200 OK in 732ms (Views: 689.7ms | ActiveRecord: 18.6ms)


Started GET "/clients" for 127.0.0.1 at 2017-05-01 02:13:28 +0300
Processing by ClientsController#index as HTML
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendering clients/index.html.haml within layouts/application
  [1m[36mUserClient Load (4.5ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 2 and owner = true)[0m  [["archived", false]]
  [1m[36mUserClient Load (1.1ms)[0m  [1m[34mSELECT "user_clients".* FROM "user_clients" INNER JOIN "clients" ON "clients"."id" = "user_clients"."client_id" AND "clients"."deleted_at" IS NULL WHERE "clients"."archived" = $1 AND (user_id = 2 and owner = false)[0m  [["archived", false]]
  Rendered clients/index.html.haml within layouts/application (18.5ms)
  Rendered layouts/_header.html.haml (11.6ms)
Completed 200 OK in 640ms (Views: 606.0ms | ActiveRecord: 6.3ms)


Started GET "/solutions" for 127.0.0.1 at 2017-05-01 02:13:29 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (3.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (0.9ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing.html.haml (7.4ms)
  Rendered solutions/_listing.html.haml (0.7ms)
  Rendered solutions/_listing.html.haml (0.8ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mClient Load (1.2ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 2]]
  [1m[36mSolution Load (0.7ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  Rendered solutions/index.html.haml within layouts/application (48.8ms)
  Rendered layouts/_header.html.haml (10.1ms)
Completed 200 OK in 656ms (Views: 645.0ms | ActiveRecord: 6.8ms)


Started GET "/solutions/20" for 127.0.0.1 at 2017-05-01 02:13:31 +0300
Processing by SolutionsController#show as HTML
  Parameters: {"id"=>"20"}
  [1m[36mSolution Load (1.8ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 20], ["LIMIT", 1]]
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mStage Load (1.2ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 20]]
  [1m[36mStageProduct Load (1.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (50, 51, 52)[0m
  [1m[36mStageProduct Load (3.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 50]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 29[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mUnit Load (0.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 51]]
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 52]]
  [1m[36mExpense Load (3.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/show.html.haml within layouts/application
  [1m[36mClientFile Load (0.6ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 20]]
  [1m[36mTechnicalFile Load (1.2ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered budgets/_discount.html.haml (7.6ms)
  Rendered budgets/_stages.html.haml (39.3ms)
  Rendered solutions/show.html.haml within layouts/application (81.7ms)
  Rendered layouts/_header.html.haml (9.2ms)
Completed 200 OK in 776ms (Views: 730.0ms | ActiveRecord: 16.3ms)


Started GET "/solutions/20" for 127.0.0.1 at 2017-05-01 02:15:05 +0300
Processing by SolutionsController#show as HTML
  Parameters: {"id"=>"20"}
  [1m[36mSolution Load (0.9ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 20], ["LIMIT", 1]]
  [1m[36mUser Load (7.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mStage Load (0.6ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 20]]
  [1m[36mStageProduct Load (1.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (50, 51, 52)[0m
  [1m[36mStageProduct Load (1.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 50]]
  [1m[36mStageProductSet Load (0.9ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 29[0m
  [1m[36mProduct Load (1.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mUnit Load (1.1ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 51]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 52]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/show.html.haml within layouts/application
  [1m[36mClientFile Load (0.6ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 20]]
  [1m[36mTechnicalFile Load (4.5ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered budgets/_discount.html.haml (8.5ms)
  Rendered solutions/show.html.haml within layouts/application (92.8ms)
Completed 500 Internal Server Error in 134ms (ActiveRecord: 22.1ms)


  
SyntaxError (/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:21: syntax error, unexpected tINTEGER, expecting '}'
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:22: syntax error, unexpected '}', expecting tSTRING_DEND
));}\n", 0, false);end;_hamlout.p...
    ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:22: unknown regexp option - h
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:22: syntax error, unexpected tINTEGER, expecting tSTRING_DEND
...col-sm-1'>\n          <h5>%</h5>\n        </div>\n      </di...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:22: unknown regexp options - dv
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:22: syntax error, unexpected $undefined
...\n        </div>\n      </div>\n      <div class='form-group...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:22: syntax error, unexpected keyword_class, expecting keyword_do or '{' or '('
...n      </div>\n      <div class='form-group'>\n        <labe...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:22: syntax error, unexpected $undefined
...      <div class='form-group'>\n        <label class='col-sm...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:22: syntax error, unexpected keyword_class, expecting keyword_do or '{' or '('
...m-group'>\n        <label class='col-sm-3 control-label'>В...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:22: syntax error, unexpected tIDENTIFIER, expecting keyword_do or '{' or '('
...ol-label'>Второй этап</label>\n        <div class=...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:29: unknown regexp option - h
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:29: syntax error, unexpected tINTEGER, expecting tSTRING_DEND
));}</h5>\n", 0, false); else
        ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:31: syntax error, unexpected ')', expecting tSTRING_DEND
));}\n", 0, false);end;_hamlou...
 ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:31: unknown regexp option - h
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:31: syntax error, unexpected tINTEGER, expecting tSTRING_DEND
...col-sm-1'>\n          <h5>%</h5>\n        </div>\n      </di...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:31: unknown regexp options - dv
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:31: syntax error, unexpected $undefined
...\n        </div>\n      </div>\n      <div class='form-group...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:31: syntax error, unexpected keyword_class, expecting keyword_do or '{' or '('
...n      </div>\n      <div class='form-group'>\n        <labe...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:31: syntax error, unexpected $undefined
...      <div class='form-group'>\n        <label class='col-sm...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:31: syntax error, unexpected keyword_class, expecting keyword_do or '{' or '('
...m-group'>\n        <label class='col-sm-3 control-label'>Т...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:31: syntax error, unexpected tIDENTIFIER, expecting keyword_do or '{' or '('
...ol-label'>Третий этап</label>\n        <div class=...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:38: unknown regexp option - h
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:38: syntax error, unexpected tINTEGER, expecting tSTRING_DEND
));}</h5>\n", 0, false); else
        ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:40: syntax error, unexpected ')', expecting tSTRING_DEND
));}\n", 0, false);end;_hamlou...
 ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:40: unknown regexp option - h
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:40: syntax error, unexpected tINTEGER, expecting tSTRING_DEND
...col-sm-1'>\n          <h5>%</h5>\n        </div>\n      </di...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:40: unknown regexp options - dv
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:40: syntax error, unexpected $undefined
...\n        </div>\n      </div>\n    </div>\n  </div>\n</div>...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:40: unknown regexp options - dv
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:40: syntax error, unexpected $undefined
...  </div>\n    </div>\n  </div>\n</div>\n", -5, false);::Haml...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:40: unterminated regexp meets end of file
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:40: syntax error, unexpected end-of-input, expecting tSTRING_DEND):
  
app/views/budgets/_discount.html.haml:21: syntax error, unexpected tINTEGER, expecting '}'
app/views/budgets/_discount.html.haml:22: syntax error, unexpected '}', expecting tSTRING_DEND
app/views/budgets/_discount.html.haml:22: unknown regexp option - h
app/views/budgets/_discount.html.haml:22: syntax error, unexpected tINTEGER, expecting tSTRING_DEND
app/views/budgets/_discount.html.haml:22: unknown regexp options - dv
app/views/budgets/_discount.html.haml:22: syntax error, unexpected $undefined
app/views/budgets/_discount.html.haml:22: syntax error, unexpected keyword_class, expecting keyword_do or '{' or '('
app/views/budgets/_discount.html.haml:22: syntax error, unexpected $undefined
app/views/budgets/_discount.html.haml:22: syntax error, unexpected keyword_class, expecting keyword_do or '{' or '('
app/views/budgets/_discount.html.haml:22: syntax error, unexpected tIDENTIFIER, expecting keyword_do or '{' or '('
app/views/budgets/_discount.html.haml:29: unknown regexp option - h
app/views/budgets/_discount.html.haml:29: syntax error, unexpected tINTEGER, expecting tSTRING_DEND
app/views/budgets/_discount.html.haml:31: syntax error, unexpected ')', expecting tSTRING_DEND
app/views/budgets/_discount.html.haml:31: unknown regexp option - h
app/views/budgets/_discount.html.haml:31: syntax error, unexpected tINTEGER, expecting tSTRING_DEND
app/views/budgets/_discount.html.haml:31: unknown regexp options - dv
app/views/budgets/_discount.html.haml:31: syntax error, unexpected $undefined
app/views/budgets/_discount.html.haml:31: syntax error, unexpected keyword_class, expecting keyword_do or '{' or '('
app/views/budgets/_discount.html.haml:31: syntax error, unexpected $undefined
app/views/budgets/_discount.html.haml:31: syntax error, unexpected keyword_class, expecting keyword_do or '{' or '('
app/views/budgets/_discount.html.haml:31: syntax error, unexpected tIDENTIFIER, expecting keyword_do or '{' or '('
app/views/budgets/_discount.html.haml:38: unknown regexp option - h
app/views/budgets/_discount.html.haml:38: syntax error, unexpected tINTEGER, expecting tSTRING_DEND
app/views/budgets/_discount.html.haml:40: syntax error, unexpected ')', expecting tSTRING_DEND
app/views/budgets/_discount.html.haml:40: unknown regexp option - h
app/views/budgets/_discount.html.haml:40: syntax error, unexpected tINTEGER, expecting tSTRING_DEND
app/views/budgets/_discount.html.haml:40: unknown regexp options - dv
app/views/budgets/_discount.html.haml:40: syntax error, unexpected $undefined
app/views/budgets/_discount.html.haml:40: unknown regexp options - dv
app/views/budgets/_discount.html.haml:40: syntax error, unexpected $undefined
app/views/budgets/_discount.html.haml:40: unterminated regexp meets end of file
app/views/budgets/_discount.html.haml:40: syntax error, unexpected end-of-input, expecting tSTRING_DEND
app/views/solutions/show.html.haml:110:in `block in _app_views_solutions_show_html_haml___3562336501893392117_47031036447760'
app/views/solutions/show.html.haml:7:in `_app_views_solutions_show_html_haml___3562336501893392117_47031036447760'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (12.0ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (3.4ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.3ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (40.2ms)
Started GET "/solutions/20" for 127.0.0.1 at 2017-05-01 02:15:25 +0300
Processing by SolutionsController#show as HTML
  Parameters: {"id"=>"20"}
  [1m[36mSolution Load (2.5ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 20], ["LIMIT", 1]]
  [1m[36mUser Load (2.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mStage Load (1.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 20]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (50, 51, 52)[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 50]]
  [1m[36mStageProductSet Load (0.9ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 29[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 51]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 52]]
  [1m[36mExpense Load (1.2ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/show.html.haml within layouts/application
  [1m[36mClientFile Load (0.6ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 20]]
  [1m[36mTechnicalFile Load (1.0ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered budgets/_discount.html.haml (6.4ms)
  Rendered solutions/show.html.haml within layouts/application (41.1ms)
Completed 500 Internal Server Error in 85ms (ActiveRecord: 13.4ms)


  
SyntaxError (/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:21: syntax error, unexpected tINTEGER, expecting '}'
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:22: syntax error, unexpected '}', expecting tSTRING_DEND
));}\n", 0, false);end;_hamlout.p...
    ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:22: unknown regexp option - h
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:22: syntax error, unexpected tINTEGER, expecting tSTRING_DEND
...col-sm-1'>\n          <h5>%</h5>\n        </div>\n      </di...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:22: unknown regexp options - dv
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:22: syntax error, unexpected $undefined
...\n        </div>\n      </div>\n      <div class='form-group...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:22: syntax error, unexpected keyword_class, expecting keyword_do or '{' or '('
...n      </div>\n      <div class='form-group'>\n        <labe...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:22: syntax error, unexpected $undefined
...      <div class='form-group'>\n        <label class='col-sm...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:22: syntax error, unexpected keyword_class, expecting keyword_do or '{' or '('
...m-group'>\n        <label class='col-sm-3 control-label'>В...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:22: syntax error, unexpected tIDENTIFIER, expecting keyword_do or '{' or '('
...ol-label'>Второй этап</label>\n        <div class=...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:29: unknown regexp option - h
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:29: syntax error, unexpected tINTEGER, expecting tSTRING_DEND
));}</h5>\n", 0, false); else
        ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:31: syntax error, unexpected ')', expecting tSTRING_DEND
));}\n", 0, false);end;_hamlou...
 ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:31: unknown regexp option - h
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:31: syntax error, unexpected tINTEGER, expecting tSTRING_DEND
...col-sm-1'>\n          <h5>%</h5>\n        </div>\n      </di...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:31: unknown regexp options - dv
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:31: syntax error, unexpected $undefined
...\n        </div>\n      </div>\n      <div class='form-group...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:31: syntax error, unexpected keyword_class, expecting keyword_do or '{' or '('
...n      </div>\n      <div class='form-group'>\n        <labe...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:31: syntax error, unexpected $undefined
...      <div class='form-group'>\n        <label class='col-sm...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:31: syntax error, unexpected keyword_class, expecting keyword_do or '{' or '('
...m-group'>\n        <label class='col-sm-3 control-label'>Т...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:31: syntax error, unexpected tIDENTIFIER, expecting keyword_do or '{' or '('
...ol-label'>Третий этап</label>\n        <div class=...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:38: unknown regexp option - h
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:38: syntax error, unexpected tINTEGER, expecting tSTRING_DEND
));}</h5>\n", 0, false); else
        ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:40: syntax error, unexpected ')', expecting tSTRING_DEND
));}\n", 0, false);end;_hamlou...
 ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:40: unknown regexp option - h
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:40: syntax error, unexpected tINTEGER, expecting tSTRING_DEND
...col-sm-1'>\n          <h5>%</h5>\n        </div>\n      </di...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:40: unknown regexp options - dv
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:40: syntax error, unexpected $undefined
...\n        </div>\n      </div>\n    </div>\n  </div>\n</div>...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:40: unknown regexp options - dv
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:40: syntax error, unexpected $undefined
...  </div>\n    </div>\n  </div>\n</div>\n", -5, false);::Haml...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:40: unterminated regexp meets end of file
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:40: syntax error, unexpected end-of-input, expecting tSTRING_DEND):
  
app/views/budgets/_discount.html.haml:21: syntax error, unexpected tINTEGER, expecting '}'
app/views/budgets/_discount.html.haml:22: syntax error, unexpected '}', expecting tSTRING_DEND
app/views/budgets/_discount.html.haml:22: unknown regexp option - h
app/views/budgets/_discount.html.haml:22: syntax error, unexpected tINTEGER, expecting tSTRING_DEND
app/views/budgets/_discount.html.haml:22: unknown regexp options - dv
app/views/budgets/_discount.html.haml:22: syntax error, unexpected $undefined
app/views/budgets/_discount.html.haml:22: syntax error, unexpected keyword_class, expecting keyword_do or '{' or '('
app/views/budgets/_discount.html.haml:22: syntax error, unexpected $undefined
app/views/budgets/_discount.html.haml:22: syntax error, unexpected keyword_class, expecting keyword_do or '{' or '('
app/views/budgets/_discount.html.haml:22: syntax error, unexpected tIDENTIFIER, expecting keyword_do or '{' or '('
app/views/budgets/_discount.html.haml:29: unknown regexp option - h
app/views/budgets/_discount.html.haml:29: syntax error, unexpected tINTEGER, expecting tSTRING_DEND
app/views/budgets/_discount.html.haml:31: syntax error, unexpected ')', expecting tSTRING_DEND
app/views/budgets/_discount.html.haml:31: unknown regexp option - h
app/views/budgets/_discount.html.haml:31: syntax error, unexpected tINTEGER, expecting tSTRING_DEND
app/views/budgets/_discount.html.haml:31: unknown regexp options - dv
app/views/budgets/_discount.html.haml:31: syntax error, unexpected $undefined
app/views/budgets/_discount.html.haml:31: syntax error, unexpected keyword_class, expecting keyword_do or '{' or '('
app/views/budgets/_discount.html.haml:31: syntax error, unexpected $undefined
app/views/budgets/_discount.html.haml:31: syntax error, unexpected keyword_class, expecting keyword_do or '{' or '('
app/views/budgets/_discount.html.haml:31: syntax error, unexpected tIDENTIFIER, expecting keyword_do or '{' or '('
app/views/budgets/_discount.html.haml:38: unknown regexp option - h
app/views/budgets/_discount.html.haml:38: syntax error, unexpected tINTEGER, expecting tSTRING_DEND
app/views/budgets/_discount.html.haml:40: syntax error, unexpected ')', expecting tSTRING_DEND
app/views/budgets/_discount.html.haml:40: unknown regexp option - h
app/views/budgets/_discount.html.haml:40: syntax error, unexpected tINTEGER, expecting tSTRING_DEND
app/views/budgets/_discount.html.haml:40: unknown regexp options - dv
app/views/budgets/_discount.html.haml:40: syntax error, unexpected $undefined
app/views/budgets/_discount.html.haml:40: unknown regexp options - dv
app/views/budgets/_discount.html.haml:40: syntax error, unexpected $undefined
app/views/budgets/_discount.html.haml:40: unterminated regexp meets end of file
app/views/budgets/_discount.html.haml:40: syntax error, unexpected end-of-input, expecting tSTRING_DEND
app/views/solutions/show.html.haml:110:in `block in _app_views_solutions_show_html_haml___3562336501893392117_69931140480160'
app/views/solutions/show.html.haml:7:in `_app_views_solutions_show_html_haml___3562336501893392117_69931140480160'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (19.0ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (4.0ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.2ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (51.5ms)
Started GET "/solutions/20" for 127.0.0.1 at 2017-05-01 02:15:50 +0300
Processing by SolutionsController#show as HTML
  Parameters: {"id"=>"20"}
  [1m[36mSolution Load (2.6ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 20], ["LIMIT", 1]]
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mStage Load (0.8ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 20]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (50, 51, 52)[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 50]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 29[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 51]]
  [1m[36mStageProduct Load (2.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 52]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/show.html.haml within layouts/application
  [1m[36mClientFile Load (0.7ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 20]]
  [1m[36mTechnicalFile Load (1.2ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered budgets/_discount.html.haml (11.1ms)
  Rendered budgets/_stages.html.haml (30.9ms)
  Rendered solutions/show.html.haml within layouts/application (72.8ms)
  Rendered layouts/_header.html.haml (8.7ms)
Completed 200 OK in 780ms (Views: 729.8ms | ActiveRecord: 12.3ms)


Started GET "/solutions/20" for 127.0.0.1 at 2017-05-01 02:16:20 +0300
Processing by SolutionsController#show as HTML
  Parameters: {"id"=>"20"}
  [1m[36mSolution Load (1.9ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 20], ["LIMIT", 1]]
  [1m[36mUser Load (2.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mStage Load (0.6ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 20]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (50, 51, 52)[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 50]]
  [1m[36mStageProductSet Load (3.0ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 29[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 51]]
  [1m[36mStageProduct Load (1.3ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 52]]
  [1m[36mExpense Load (0.8ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/show.html.haml within layouts/application
  [1m[36mClientFile Load (0.8ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 20]]
  [1m[36mTechnicalFile Load (0.7ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered budgets/_stages.html.haml (19.2ms)
  Rendered solutions/show.html.haml within layouts/application (49.7ms)
  Rendered layouts/_header.html.haml (8.5ms)
Completed 200 OK in 615ms (Views: 577.4ms | ActiveRecord: 14.5ms)


Started GET "/solutions/20" for 127.0.0.1 at 2017-05-01 02:16:42 +0300
Processing by SolutionsController#show as HTML
  Parameters: {"id"=>"20"}
  [1m[36mSolution Load (2.0ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 20], ["LIMIT", 1]]
  [1m[36mUser Load (3.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mStage Load (5.5ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 20]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (50, 51, 52)[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 50]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 29[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 51]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 52]]
  [1m[36mExpense Load (0.7ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/show.html.haml within layouts/application
  [1m[36mClientFile Load (1.0ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 20]]
  [1m[36mTechnicalFile Load (1.6ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered budgets/_stages.html.haml (21.9ms)
  Rendered solutions/show.html.haml within layouts/application (52.9ms)
  Rendered layouts/_header.html.haml (9.4ms)
Completed 200 OK in 668ms (Views: 623.8ms | ActiveRecord: 19.1ms)


Started GET "/solutions" for 127.0.0.1 at 2017-05-01 02:16:51 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (2.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (2.5ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing.html.haml (7.9ms)
  Rendered solutions/_listing.html.haml (0.8ms)
  Rendered solutions/_listing.html.haml (0.7ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mClient Load (1.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 2]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 2]]
  [1m[36mSolution Load (0.9ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  Rendered solutions/index.html.haml within layouts/application (87.2ms)
  Rendered layouts/_header.html.haml (9.0ms)
Completed 200 OK in 720ms (Views: 699.2ms | ActiveRecord: 6.5ms)


Started DELETE "/signout" for 127.0.0.1 at 2017-05-01 02:16:54 +0300
Processing by Devise::SessionsController#destroy as HTML
  Parameters: {"authenticity_token"=>"piSFxopPcXEDqRrTl4CtqeoAvxf+zC+G9tXBINau5NUKU0O7BXsuoFFV0+UTIwcA7V64Dh1rQCQ6l1ZnbW+xMA=="}
  [1m[36mUser Load (1.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (2.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mCOMMIT[0m
Redirected to http://localhost:3000/
Completed 302 Found in 11ms (ActiveRecord: 5.0ms)


Started GET "/" for 127.0.0.1 at 2017-05-01 02:16:54 +0300
Processing by HomeController#index as HTML
Completed 401 Unauthorized in 1ms (ActiveRecord: 0.0ms)


Started GET "/signin" for 127.0.0.1 at 2017-05-01 02:16:54 +0300
Processing by Devise::SessionsController#new as HTML
  Rendering devise/sessions/new.html.haml within layouts/application
  Rendered devise/sessions/new.html.haml within layouts/application (9.2ms)
  Rendered layouts/_header.html.haml (6.7ms)
Completed 200 OK in 549ms (Views: 546.3ms | ActiveRecord: 0.0ms)


Started POST "/signin" for 127.0.0.1 at 2017-05-01 02:17:01 +0300
Processing by Devise::SessionsController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"lkjVmiV0UTwjKbqN6ITRlY4e0YQztEINOQ1dSyqJkncA7Sfkp/jyC0EnX/YDcoNySofOzbVByw+hqbH7bxN1FQ==", "user"=>{"email"=>"admin@test.test", "password"=>"[FILTERED]"}, "commit"=>"Войти"}
  [1m[36mUser Load (1.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."email" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["email", "admin@test.test"], ["LIMIT", 1]]
Redirected to http://localhost:3000/
Completed 302 Found in 140ms (ActiveRecord: 1.2ms)


Started GET "/" for 127.0.0.1 at 2017-05-01 02:17:01 +0300
Processing by HomeController#index as HTML
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering home/index.html.haml within layouts/application
  Rendered home/index.html.haml within layouts/application (1.4ms)
  Rendered layouts/_header.html.haml (52.5ms)
Completed 200 OK in 639ms (Views: 634.8ms | ActiveRecord: 1.1ms)


Started GET "/solutions" for 127.0.0.1 at 2017-05-01 02:17:04 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (0.8ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing.html.haml (10.0ms)
  Rendered solutions/_listing.html.haml (1.0ms)
  Rendered solutions/_listing.html.haml (1.3ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mClient Load (2.9ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mSolution Load (1.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  Rendered solutions/index.html.haml within layouts/application (74.2ms)
  Rendered layouts/_header.html.haml (13.8ms)
Completed 200 OK in 628ms (Views: 586.9ms | ActiveRecord: 17.8ms)


  [1m[35m (25.7ms)[0m  [1m[35mBEGIN[0m
  [1m[36mAudited::Audit Load (20.3ms)[0m  [1m[34mSELECT  "audits".* FROM "audits" WHERE "audits"."auditable_id" = $1 AND "audits"."auditable_type" = $2 ORDER BY "audits"."version" DESC LIMIT $3[0m  [["auditable_id", 17], ["auditable_type", "Budget"], ["LIMIT", 1]]
  [1m[35mSQL (7.9ms)[0m  [1m[32mINSERT INTO "audits" ("auditable_id", "auditable_type", "action", "audited_changes", "version", "request_uuid", "created_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["auditable_id", 17], ["auditable_type", "Budget"], ["action", "update"], ["audited_changes", "---\nproposed:\n- false\n- true\n"], ["version", 3], ["request_uuid", "ad3aa4cf-f313-460a-b7bc-0cde0e6f9e6d"], ["created_at", 2017-04-30 23:17:21 UTC]]
  [1m[35mSQL (5.6ms)[0m  [1m[33mUPDATE "budgets" SET "updated_at" = $1, "proposed" = $2 WHERE "budgets"."id" = $3[0m  [["updated_at", 2017-04-30 23:17:20 UTC], ["proposed", true], ["id", 17]]
  [1m[35m (3.1ms)[0m  [1m[35mCOMMIT[0m
Started GET "/solutions" for 127.0.0.1 at 2017-05-01 02:17:23 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (1.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (2.8ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing.html.haml (6.5ms)
  Rendered solutions/_listing.html.haml (1.0ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mClient Load (2.8ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mSolution Load (1.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  Rendered solutions/_listing_proposed.html.haml (5.5ms)
  Rendered solutions/index.html.haml within layouts/application (47.9ms)
  Rendered layouts/_header.html.haml (8.8ms)
Completed 200 OK in 583ms (Views: 567.9ms | ActiveRecord: 8.3ms)


Started GET "/solutions" for 127.0.0.1 at 2017-05-01 02:17:55 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (2.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (0.7ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing.html.haml (53.4ms)
  Rendered solutions/_listing.html.haml (0.9ms)
  [1m[36mCACHE (2.3ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mClient Load (1.1ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mSolution Load (1.8ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  Rendered solutions/_listing_proposed.html.haml (4.8ms)
  Rendered solutions/index.html.haml within layouts/application (110.4ms)
  Rendered layouts/_header.html.haml (11.4ms)
Completed 200 OK in 629ms (Views: 612.7ms | ActiveRecord: 8.9ms)


Started GET "/solutions/17" for 127.0.0.1 at 2017-05-01 02:17:58 +0300
Processing by SolutionsController#show as HTML
  Parameters: {"id"=>"17"}
  [1m[36mSolution Load (9.3ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 17], ["LIMIT", 1]]
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (5.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 17]]
  [1m[36mStageProduct Load (1.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (41, 42, 43)[0m
  [1m[36mStageProduct Load (1.4ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 41]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 27[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mUnit Load (0.8ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 42]]
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 43]]
  [1m[36mExpense Load (0.3ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/show.html.haml within layouts/application
  Rendered solutions/show.html.haml within layouts/application (478.4ms)
Completed 500 Internal Server Error in 529ms (ActiveRecord: 21.1ms)


  
ActionView::Template::Error (undefined local variable or method `solution' for #<#<Class:0x007f343960a9b8>:0x007f345d852ad0>
Did you mean?  @solution):
     9:       = link_to 'Отмена', solutions_path, class: 'btn btn-default'
    10:       - if @solution.proposed
    11:         .btn-group
    12:           = link_to solution_accept_path(solution), class: 'btn btn-success' do
    13:             %span.glyphicon.glyphicon-ok{"aria-hidden" => "true"}
    14:           = link_to solution_path(solution), method: :delete, data: {confirm: 'Are you sure?'}, class: 'btn btn-danger' do
    15:             %span.glyphicon.glyphicon-remove{"aria-hidden" => "true"}
  
app/views/solutions/show.html.haml:12:in `block in _app_views_solutions_show_html_haml___3562336501893392117_69931442019880'
app/views/solutions/show.html.haml:7:in `_app_views_solutions_show_html_haml___3562336501893392117_69931442019880'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (11.8ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.8ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.6ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (49.5ms)
Started GET "/solutions/17" for 127.0.0.1 at 2017-05-01 02:18:14 +0300
Processing by SolutionsController#show as HTML
  Parameters: {"id"=>"17"}
  [1m[36mSolution Load (1.3ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 17], ["LIMIT", 1]]
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (1.0ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 17]]
  [1m[36mStageProduct Load (1.4ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (41, 42, 43)[0m
  [1m[36mStageProduct Load (2.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 41]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 27[0m
  [1m[36mProduct Load (3.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mUnit Load (2.4ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 42]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 43]]
  [1m[36mExpense Load (0.7ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/show.html.haml within layouts/application
  [1m[36mClientFile Load (2.3ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 17]]
  [1m[36mTechnicalFile Load (0.6ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 17]]
  Rendered budgets/_stages.html.haml (21.5ms)
  Rendered solutions/show.html.haml within layouts/application (49.5ms)
  Rendered layouts/_header.html.haml (8.6ms)
Completed 200 OK in 576ms (Views: 537.3ms | ActiveRecord: 18.0ms)


Started GET "/solutions/17" for 127.0.0.1 at 2017-05-01 02:18:30 +0300
Processing by SolutionsController#show as HTML
  Parameters: {"id"=>"17"}
  [1m[36mSolution Load (2.8ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 17], ["LIMIT", 1]]
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (2.3ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 17]]
  [1m[36mStageProduct Load (1.1ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (41, 42, 43)[0m
  [1m[36mStageProduct Load (1.1ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 41]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 27[0m
  [1m[36mProduct Load (1.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mUnit Load (4.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (2.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 42]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 43]]
  [1m[36mExpense Load (0.8ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/show.html.haml within layouts/application
  [1m[36mClientFile Load (0.6ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 17]]
  [1m[36mTechnicalFile Load (0.6ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 17]]
  Rendered budgets/_stages.html.haml (15.9ms)
  Rendered solutions/show.html.haml within layouts/application (43.2ms)
  Rendered layouts/_header.html.haml (8.1ms)
Completed 200 OK in 552ms (Views: 496.4ms | ActiveRecord: 19.8ms)


Started GET "/solutions/17" for 127.0.0.1 at 2017-05-01 02:19:02 +0300
Processing by SolutionsController#show as HTML
  Parameters: {"id"=>"17"}
  [1m[36mSolution Load (5.1ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 17], ["LIMIT", 1]]
  [1m[36mUser Load (1.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (1.9ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 17]]
  [1m[36mStageProduct Load (1.2ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (41, 42, 43)[0m
  [1m[36mStageProduct Load (1.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 41]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 27[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 42]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 43]]
  [1m[36mExpense Load (0.3ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/show.html.haml within layouts/application
  [1m[36mClientFile Load (0.7ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 17]]
  [1m[36mTechnicalFile Load (0.7ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 17]]
  Rendered budgets/_stages.html.haml (19.9ms)
  Rendered solutions/show.html.haml within layouts/application (47.8ms)
  Rendered layouts/_header.html.haml (9.9ms)
Completed 200 OK in 685ms (Views: 645.7ms | ActiveRecord: 16.3ms)


Started GET "/solutions/17" for 127.0.0.1 at 2017-05-01 02:20:53 +0300
Processing by SolutionsController#show as HTML
  Parameters: {"id"=>"17"}
  [1m[36mSolution Load (3.3ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 17], ["LIMIT", 1]]
  [1m[36mUser Load (4.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 17]]
  [1m[36mStageProduct Load (1.1ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (41, 42, 43)[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 41]]
  [1m[36mStageProductSet Load (1.3ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 27[0m
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mUnit Load (0.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (1.2ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 42]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 43]]
  [1m[36mExpense Load (0.5ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/show.html.haml within layouts/application
  [1m[36mClientFile Load (0.7ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 17]]
  [1m[36mTechnicalFile Load (2.0ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 17]]
  Rendered budgets/_stages.html.haml (22.0ms)
  Rendered solutions/show.html.haml within layouts/application (55.0ms)
  Rendered layouts/_header.html.haml (10.3ms)
Completed 200 OK in 668ms (Views: 620.5ms | ActiveRecord: 18.2ms)


Started GET "/solutions" for 127.0.0.1 at 2017-05-01 02:21:01 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (0.8ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing.html.haml (53.3ms)
  Rendered solutions/_listing.html.haml (1.1ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mClient Load (1.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mSolution Load (0.9ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  [1m[36mCACHE (0.1ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  Rendered solutions/_listing_proposed.html.haml (4.3ms)
  Rendered solutions/index.html.haml within layouts/application (96.0ms)
  Rendered layouts/_header.html.haml (15.3ms)
Completed 200 OK in 720ms (Views: 707.9ms | ActiveRecord: 3.5ms)


Started GET "/solutions/20/edit" for 127.0.0.1 at 2017-05-01 02:21:07 +0300
Processing by SolutionsController#edit as HTML
  Parameters: {"id"=>"20"}
  [1m[36mProduct Load (2.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.9ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (2.1ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mSolution Load (2.1ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 20], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 20]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (50, 51, 52)[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 50]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 29[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (2.4ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 51]]
  [1m[36mStageProduct Load (1.0ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 52]]
  [1m[36mExpense Load (0.6ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/edit.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (4.1ms)
  [1m[36mClientFile Load (0.7ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered solutions/_technical_file_fields.html.haml (3.6ms)
  [1m[36mTechnicalFile Load (1.9ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered budgets/_discount.html.haml (438.2ms)
  Rendered solutions/_form.html.haml (492.5ms)
  Rendered solutions/edit.html.haml within layouts/application (499.0ms)
Completed 500 Internal Server Error in 676ms (ActiveRecord: 49.6ms)


  
ActionView::Template::Error (undefined local variable or method `show' for #<#<Class:0x007f343960a9b8>:0x007f343f701640>):
     8:       .form-group
     9:         %label.col-sm-3.control-label Название скидки
    10:         .col-sm-9
    11:           - if show
    12:             %h5= f.object.discount_title
    13:           - else
    14:             = f.input :discount_title, label: false, placeholder: 'Введите название скидки', input_html: { 'ng-model' => 'discount.name' }
  
app/views/budgets/_discount.html.haml:11:in `_app_views_budgets__discount_html_haml__558627760828518766_69931142168880'
app/views/solutions/_form.html.haml:88:in `block in _app_views_solutions__form_html_haml___2969559158462466948_69931189570420'
app/views/solutions/_form.html.haml:1:in `_app_views_solutions__form_html_haml___2969559158462466948_69931189570420'
app/views/solutions/edit.html.haml:7:in `_app_views_solutions_edit_html_haml___106885989673481054_69931189672580'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (9.3ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (4.0ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.1ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (48.2ms)
Started GET "/solutions/20/edit" for 127.0.0.1 at 2017-05-01 02:21:35 +0300
Processing by SolutionsController#edit as HTML
  Parameters: {"id"=>"20"}
  [1m[36mProduct Load (1.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (7.7ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.1ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (2.2ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mSolution Load (0.8ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 20], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.9ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 20]]
  [1m[36mStageProduct Load (1.3ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (50, 51, 52)[0m
  [1m[36mStageProduct Load (0.8ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 50]]
  [1m[36mStageProductSet Load (0.9ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 29[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 51]]
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 52]]
  [1m[36mExpense Load (0.4ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/edit.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (3.1ms)
  [1m[36mClientFile Load (0.6ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered solutions/_technical_file_fields.html.haml (4.1ms)
  [1m[36mTechnicalFile Load (0.6ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered budgets/_discount.html.haml (373.7ms)
  Rendered solutions/_form.html.haml (420.3ms)
  Rendered solutions/edit.html.haml within layouts/application (423.1ms)
Completed 500 Internal Server Error in 504ms (ActiveRecord: 21.6ms)


  
ActionView::Template::Error (undefined local variable or method `show' for #<#<Class:0x007f343960a9b8>:0x007f346124d7f8>):
     8:       .form-group
     9:         %label.col-sm-3.control-label Название скидки
    10:         .col-sm-9
    11:           - if show
    12:             %h5= f.object.discount_title
    13:           - else
    14:             = f.input :discount_title, label: false, placeholder: 'Введите название скидки', input_html: { 'ng-model' => 'discount.name' }
  
app/views/budgets/_discount.html.haml:11:in `_app_views_budgets__discount_html_haml__558627760828518766_69931191371540'
app/views/solutions/_form.html.haml:88:in `block in _app_views_solutions__form_html_haml___2969559158462466948_69931187180020'
app/views/solutions/_form.html.haml:1:in `_app_views_solutions__form_html_haml___2969559158462466948_69931187180020'
app/views/solutions/edit.html.haml:7:in `_app_views_solutions_edit_html_haml___106885989673481054_69931472418140'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (8.4ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (3.0ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.1ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (34.0ms)
Started GET "/solutions/20/edit" for 127.0.0.1 at 2017-05-01 02:22:01 +0300
Processing by SolutionsController#edit as HTML
  Parameters: {"id"=>"20"}
  [1m[36mProduct Load (1.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.6ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.1ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.6ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mSolution Load (1.1ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 20], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.6ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 20]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (50, 51, 52)[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 50]]
  [1m[36mStageProductSet Load (0.6ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 29[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 51]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 52]]
  [1m[36mExpense Load (0.3ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/edit.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (5.6ms)
  [1m[36mClientFile Load (0.7ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered solutions/_technical_file_fields.html.haml (3.7ms)
  [1m[36mTechnicalFile Load (5.8ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered budgets/_discount.html.haml (345.2ms)
  Rendered solutions/_form.html.haml (406.9ms)
  Rendered solutions/edit.html.haml within layouts/application (410.6ms)
Completed 500 Internal Server Error in 482ms (ActiveRecord: 18.4ms)


  
ActionView::Template::Error (undefined local variable or method `show' for #<#<Class:0x007f343960a9b8>:0x007f343d570850>):
     8:       .form-group
     9:         %label.col-sm-3.control-label Название скидки
    10:         .col-sm-9
    11:           - unless show
    12:             = f.input :discount_title, label: false, placeholder: 'Введите название скидки', input_html: { 'ng-model' => 'discount.name' }
    13:           - else
    14:             %h5= f.object.discount_title
  
app/views/budgets/_discount.html.haml:11:in `_app_views_budgets__discount_html_haml__558627760828518766_69931186717540'
app/views/solutions/_form.html.haml:88:in `block in _app_views_solutions__form_html_haml___2969559158462466948_69931192816460'
app/views/solutions/_form.html.haml:1:in `_app_views_solutions__form_html_haml___2969559158462466948_69931192816460'
app/views/solutions/edit.html.haml:7:in `_app_views_solutions_edit_html_haml___106885989673481054_69931172072700'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (8.0ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (3.8ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.2ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (36.0ms)
Started GET "/solutions/20/edit" for 127.0.0.1 at 2017-05-01 02:22:52 +0300
Processing by SolutionsController#edit as HTML
  Parameters: {"id"=>"20"}
  [1m[36mProduct Load (3.9ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (3.3ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (1.2ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (6.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mSolution Load (1.4ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 20], ["LIMIT", 1]]
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.8ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 20]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (50, 51, 52)[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 50]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 29[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 51]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 52]]
  [1m[36mExpense Load (0.3ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/edit.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (3.3ms)
  [1m[36mClientFile Load (0.5ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered solutions/_technical_file_fields.html.haml (3.2ms)
  [1m[36mTechnicalFile Load (0.6ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered budgets/_discount.html.haml (4.7ms)
  Rendered solutions/_form.html.haml (46.3ms)
  Rendered solutions/edit.html.haml within layouts/application (48.8ms)
Completed 500 Internal Server Error in 117ms (ActiveRecord: 22.4ms)


  
SyntaxError (/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:21: syntax error, unexpected tINTEGER, expecting '}'
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:22: syntax error, unexpected '}', expecting tSTRING_DEND
));}\n", 0, false);end;_hamlout.p...
    ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:22: unknown regexp option - h
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:22: syntax error, unexpected tINTEGER, expecting tSTRING_DEND
...col-sm-1'>\n          <h5>%</h5>\n        </div>\n      </di...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:22: unknown regexp options - dv
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:22: syntax error, unexpected $undefined
...\n        </div>\n      </div>\n      <div class='form-group...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:22: syntax error, unexpected keyword_class, expecting keyword_do or '{' or '('
...n      </div>\n      <div class='form-group'>\n        <labe...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:22: syntax error, unexpected $undefined
...      <div class='form-group'>\n        <label class='col-sm...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:22: syntax error, unexpected keyword_class, expecting keyword_do or '{' or '('
...m-group'>\n        <label class='col-sm-3 control-label'>В...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:22: syntax error, unexpected tIDENTIFIER, expecting keyword_do or '{' or '('
...ol-label'>Второй этап</label>\n        <div class=...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:29: unknown regexp option - h
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:29: syntax error, unexpected tINTEGER, expecting tSTRING_DEND
));}</h5>\n", 0, false); else
        ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:31: syntax error, unexpected ')', expecting tSTRING_DEND
));}\n", 0, false);end;_hamlou...
 ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:31: unknown regexp option - h
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:31: syntax error, unexpected tINTEGER, expecting tSTRING_DEND
...col-sm-1'>\n          <h5>%</h5>\n        </div>\n      </di...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:31: unknown regexp options - dv
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:31: syntax error, unexpected $undefined
...\n        </div>\n      </div>\n      <div class='form-group...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:31: syntax error, unexpected keyword_class, expecting keyword_do or '{' or '('
...n      </div>\n      <div class='form-group'>\n        <labe...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:31: syntax error, unexpected $undefined
...      <div class='form-group'>\n        <label class='col-sm...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:31: syntax error, unexpected keyword_class, expecting keyword_do or '{' or '('
...m-group'>\n        <label class='col-sm-3 control-label'>Т...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:31: syntax error, unexpected tIDENTIFIER, expecting keyword_do or '{' or '('
...ol-label'>Третий этап</label>\n        <div class=...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:38: unknown regexp option - h
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:38: syntax error, unexpected tINTEGER, expecting tSTRING_DEND
));}</h5>\n", 0, false); else
        ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:40: syntax error, unexpected ')', expecting tSTRING_DEND
));}\n", 0, false);end;_hamlou...
 ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:40: unknown regexp option - h
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:40: syntax error, unexpected tINTEGER, expecting tSTRING_DEND
...col-sm-1'>\n          <h5>%</h5>\n        </div>\n      </di...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:40: unknown regexp options - dv
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:40: syntax error, unexpected $undefined
...\n        </div>\n      </div>\n    </div>\n  </div>\n</div>...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:40: unknown regexp options - dv
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:40: syntax error, unexpected $undefined
...  </div>\n    </div>\n  </div>\n</div>\n", -5, false);::Haml...
...                               ^
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:40: unterminated regexp meets end of file
/home/g1nc/Development/ruby/constructor/app/views/budgets/_discount.html.haml:40: syntax error, unexpected end-of-input, expecting tSTRING_DEND):
  
app/views/budgets/_discount.html.haml:21: syntax error, unexpected tINTEGER, expecting '}'
app/views/budgets/_discount.html.haml:22: syntax error, unexpected '}', expecting tSTRING_DEND
app/views/budgets/_discount.html.haml:22: unknown regexp option - h
app/views/budgets/_discount.html.haml:22: syntax error, unexpected tINTEGER, expecting tSTRING_DEND
app/views/budgets/_discount.html.haml:22: unknown regexp options - dv
app/views/budgets/_discount.html.haml:22: syntax error, unexpected $undefined
app/views/budgets/_discount.html.haml:22: syntax error, unexpected keyword_class, expecting keyword_do or '{' or '('
app/views/budgets/_discount.html.haml:22: syntax error, unexpected $undefined
app/views/budgets/_discount.html.haml:22: syntax error, unexpected keyword_class, expecting keyword_do or '{' or '('
app/views/budgets/_discount.html.haml:22: syntax error, unexpected tIDENTIFIER, expecting keyword_do or '{' or '('
app/views/budgets/_discount.html.haml:29: unknown regexp option - h
app/views/budgets/_discount.html.haml:29: syntax error, unexpected tINTEGER, expecting tSTRING_DEND
app/views/budgets/_discount.html.haml:31: syntax error, unexpected ')', expecting tSTRING_DEND
app/views/budgets/_discount.html.haml:31: unknown regexp option - h
app/views/budgets/_discount.html.haml:31: syntax error, unexpected tINTEGER, expecting tSTRING_DEND
app/views/budgets/_discount.html.haml:31: unknown regexp options - dv
app/views/budgets/_discount.html.haml:31: syntax error, unexpected $undefined
app/views/budgets/_discount.html.haml:31: syntax error, unexpected keyword_class, expecting keyword_do or '{' or '('
app/views/budgets/_discount.html.haml:31: syntax error, unexpected $undefined
app/views/budgets/_discount.html.haml:31: syntax error, unexpected keyword_class, expecting keyword_do or '{' or '('
app/views/budgets/_discount.html.haml:31: syntax error, unexpected tIDENTIFIER, expecting keyword_do or '{' or '('
app/views/budgets/_discount.html.haml:38: unknown regexp option - h
app/views/budgets/_discount.html.haml:38: syntax error, unexpected tINTEGER, expecting tSTRING_DEND
app/views/budgets/_discount.html.haml:40: syntax error, unexpected ')', expecting tSTRING_DEND
app/views/budgets/_discount.html.haml:40: unknown regexp option - h
app/views/budgets/_discount.html.haml:40: syntax error, unexpected tINTEGER, expecting tSTRING_DEND
app/views/budgets/_discount.html.haml:40: unknown regexp options - dv
app/views/budgets/_discount.html.haml:40: syntax error, unexpected $undefined
app/views/budgets/_discount.html.haml:40: unknown regexp options - dv
app/views/budgets/_discount.html.haml:40: syntax error, unexpected $undefined
app/views/budgets/_discount.html.haml:40: unterminated regexp meets end of file
app/views/budgets/_discount.html.haml:40: syntax error, unexpected end-of-input, expecting tSTRING_DEND
app/views/solutions/_form.html.haml:88:in `block in _app_views_solutions__form_html_haml___2969559158462466948_69931241153100'
app/views/solutions/_form.html.haml:1:in `_app_views_solutions__form_html_haml___2969559158462466948_69931241153100'
app/views/solutions/edit.html.haml:7:in `_app_views_solutions_edit_html_haml___106885989673481054_69931239835200'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (10.8ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (4.6ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.3ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout (42.3ms)
Started GET "/solutions/20/edit" for 127.0.0.1 at 2017-05-01 02:23:13 +0300
Processing by SolutionsController#edit as HTML
  Parameters: {"id"=>"20"}
  [1m[36mProduct Load (2.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.2ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (0.7ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.7ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mSolution Load (0.9ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 20], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (2.4ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 20]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (50, 51, 52)[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 50]]
  [1m[36mStageProductSet Load (0.5ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 29[0m
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 51]]
  [1m[36mStageProduct Load (0.5ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 52]]
  [1m[36mExpense Load (0.3ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/edit.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (3.5ms)
  [1m[36mClientFile Load (0.7ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered solutions/_technical_file_fields.html.haml (3.3ms)
  [1m[36mTechnicalFile Load (0.6ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered budgets/_discount.html.haml (9.8ms)
  Rendered budgets/_stages.html.haml (342.5ms)
  Rendered solutions/_form.html.haml (412.0ms)
  Rendered solutions/edit.html.haml within layouts/application (415.1ms)
Completed 500 Internal Server Error in 493ms (ActiveRecord: 14.2ms)


  
ActionView::Template::Error (undefined local variable or method `show' for #<#<Class:0x007f343960a9b8>:0x007f343deae098>):
    10:           %th.col-sm-2 Стоимость
    11:           %th.col-sm-2 С работой
    12:           %th.col-sm-2
    13:             - unless show
    14:               %a.btn.btn-sm.btn-primary{ ng: { click: 'ctrl.showAddModal(stage.number)' } } Добавить продукт
    15:       %tbody
    16:         %tr{ ng: { repeat: 'product in stage.products' } }
  
app/views/budgets/_stages.html.haml:13:in `_app_views_budgets__stages_html_haml__487727569519149513_69931219200720'
app/views/solutions/_form.html.haml:91:in `block in _app_views_solutions__form_html_haml___2969559158462466948_69931174366860'
app/views/solutions/_form.html.haml:1:in `_app_views_solutions__form_html_haml___2969559158462466948_69931174366860'
app/views/solutions/edit.html.haml:7:in `_app_views_solutions_edit_html_haml___106885989673481054_69931176918360'
app/controllers/application_controller.rb:8:in `render'
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_source.html.erb (7.6ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.9ms)
  Rendering /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.0ms)
  Rendered /home/g1nc/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/actionpack-5.0.2/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (32.4ms)
Started GET "/solutions/20/edit" for 127.0.0.1 at 2017-05-01 02:23:30 +0300
Processing by SolutionsController#edit as HTML
  Parameters: {"id"=>"20"}
  [1m[36mProduct Load (1.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mUnit Load (1.5ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mProductComposition Load (2.8ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mConstructorObject Load (0.9ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."stage" = $1[0m  [["stage", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "product_compositions".* FROM "product_compositions" WHERE "product_compositions"."deleted_at" IS NULL AND "product_compositions"."product_id" = $1[0m  [["product_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "constructor_objects".* FROM "constructor_objects" WHERE "constructor_objects"."id" IN (1, 6)[0m
  [1m[36mSolution Load (0.8ms)[0m  [1m[34mSELECT  "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."id" = $1 LIMIT $2[0m  [["id", 20], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStage Load (0.7ms)[0m  [1m[34mSELECT "stages".* FROM "stages" WHERE "stages"."budget_id" = $1[0m  [["budget_id", 20]]
  [1m[36mStageProduct Load (0.7ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" IN (50, 51, 52)[0m
  [1m[36mStageProduct Load (1.1ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 50]]
  [1m[36mStageProductSet Load (0.8ms)[0m  [1m[34mSELECT "stage_product_sets".* FROM "stage_product_sets" WHERE "stage_product_sets"."stage_product_id" = 29[0m
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."deleted_at" IS NULL AND "products"."id" = 1[0m
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "units".* FROM "units" WHERE "units"."deleted_at" IS NULL AND "units"."id" = 1[0m
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 51]]
  [1m[36mStageProduct Load (0.6ms)[0m  [1m[34mSELECT "stage_products".* FROM "stage_products" WHERE "stage_products"."stage_id" = $1[0m  [["stage_id", 52]]
  [1m[36mExpense Load (0.3ms)[0m  [1m[34mSELECT  "expenses".* FROM "expenses" WHERE "expenses"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/edit.html.haml within layouts/application
  Rendered solutions/_client_file_fields.html.haml (4.0ms)
  [1m[36mClientFile Load (2.9ms)[0m  [1m[34mSELECT "client_files".* FROM "client_files" WHERE "client_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered solutions/_technical_file_fields.html.haml (2.8ms)
  [1m[36mTechnicalFile Load (0.6ms)[0m  [1m[34mSELECT "technical_files".* FROM "technical_files" WHERE "technical_files"."budget_id" = $1[0m  [["budget_id", 20]]
  Rendered budgets/_discount.html.haml (7.1ms)
  Rendered budgets/_stages.html.haml (20.0ms)
  Rendered solutions/_form.html.haml (82.3ms)
  Rendered solutions/edit.html.haml within layouts/application (86.5ms)
  Rendered layouts/_header.html.haml (11.5ms)
Completed 200 OK in 762ms (Views: 681.4ms | ActiveRecord: 17.6ms)


Started GET "/solutions" for 127.0.0.1 at 2017-05-01 02:23:39 +0300
Processing by SolutionsController#index as HTML
  [1m[36mUser Load (3.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  Rendering solutions/index.html.haml within layouts/application
  [1m[36mSolution Load (0.8ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  Rendered solutions/_listing.html.haml (7.1ms)
  Rendered solutions/_listing.html.haml (0.9ms)
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", false]]
  [1m[36mClient Load (1.3ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "clients".* FROM "clients" INNER JOIN "user_clients" ON "clients"."id" = "user_clients"."client_id" WHERE "clients"."deleted_at" IS NULL AND "user_clients"."user_id" = $1[0m  [["user_id", 1]]
  [1m[36mSolution Load (1.9ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  [1m[36mCACHE (0.0ms)[0m  [1m[34mSELECT "budgets".* FROM "budgets" WHERE "budgets"."type" IN ('Solution') AND "budgets"."deleted_at" IS NULL AND "budgets"."proposed" = $1[0m  [["proposed", true]]
  Rendered solutions/_listing_proposed.html.haml (4.4ms)
  Rendered solutions/index.html.haml within layouts/application (54.7ms)
  Rendered layouts/_header.html.haml (11.8ms)
Completed 200 OK in 618ms (Views: 606.2ms | ActiveRecord: 7.4ms)


